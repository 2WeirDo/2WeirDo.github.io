

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/tub.png">
  <link rel="icon" href="/img/tub.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="weirdo">
  <meta name="keywords" content="">
  
    <meta name="description" content="1. CDN的概念CDN只是一种网络技术，资源本质上还是存储在某一台服务器上的，CDN只是帮你找到距离你最近的服务器 CDN（Content Delivery Network，内容分发网络）是一种内容分发网络，它能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户重新导向离用户最近的服务节点上。 其目的是使用户就近获取内容，解决网络拥挤的状况，提高用户访问网站的">
<meta property="og:type" content="article">
<meta property="og:title" content="🤠你知道什么是 CDN 吗?">
<meta property="og:url" content="http://example.com/2023/11/29/CDN/index.html">
<meta property="og:site_name" content="Weirdo">
<meta property="og:description" content="1. CDN的概念CDN只是一种网络技术，资源本质上还是存储在某一台服务器上的，CDN只是帮你找到距离你最近的服务器 CDN（Content Delivery Network，内容分发网络）是一种内容分发网络，它能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户重新导向离用户最近的服务节点上。 其目的是使用户就近获取内容，解决网络拥挤的状况，提高用户访问网站的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300039.png">
<meta property="og:image" content="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300977.png">
<meta property="og:image" content="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300020.png">
<meta property="og:image" content="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300969.png">
<meta property="og:image" content="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300047.png">
<meta property="article:published_time" content="2023-11-29T15:08:20.000Z">
<meta property="article:modified_time" content="2023-11-29T15:07:10.595Z">
<meta property="article:author" content="weirdo">
<meta property="article:tag" content="CDN">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300039.png">
  
  
  
  <title>🤠你知道什么是 CDN 吗? - Weirdo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":80,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#ddfd","options":{"showSpinner":true,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"ukn0C9F4sFzy057RJ7Ohdmq4-gzGzoHsz","app_key":"x8NNzZf5L3jNKvqOKxoMj0FN","server_url":"https://ukn0c9f4.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Weirdo</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/meili.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="🤠你知道什么是 CDN 吗?"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        weirdo
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-29 23:08" pubdate>
          2023年11月29日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          25 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">🤠你知道什么是 CDN 吗?</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="1-CDN的概念"><a href="#1-CDN的概念" class="headerlink" title="1. CDN的概念"></a>1. CDN的概念</h3><p><strong>CDN只是一种网络技术，资源本质上还是存储在某一台服务器上的，</strong><code>CDN</code><strong>只是帮你找到距离你最近的服务器</strong></p>
<p><code>CDN</code>（Content Delivery Network，内容分发网络）是一种内容分发网络，它能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息<strong>将用户重新导向离用户最近的服务节点上</strong>。</p>
<p>其目的是使用户就近获取内容，解决网络拥挤的状况，提高用户访问网站的响应速度。</p>
<p>通俗点就是 :  CDN其实是一个离用户较近的由一个DNS服务器和几台缓存服务器运行起来的，该服务器可以获取到完整的网站资源，并且它会定期与源站进行同步，保证自身服务器上的内容是最新的。</p>
<p><strong>主要优势 :</strong></p>
<ul>
<li>CDN节点解决了跨运营商和跨地域访问的问题，访问延时大大降低；</li>
<li>大部分请求在CDN边缘节点完成，CDN起到了分流作用，减轻了源站的负载。</li>
</ul>
<h3 id="2-CDN的组成部分"><a href="#2-CDN的组成部分" class="headerlink" title="2. CDN的组成部分"></a>2. CDN的组成部分</h3><p>典型的CDN由三个部分组成：<code>分发服务系统</code>、<code>负载均衡系统</code>、<code>运营管理系统</code></p>
<ul>
<li><strong>分发服务系统</strong>：最基本的工作单元是Cache设备，cache负责直接响应最终用户的访问请求，把缓存在本地的内容快速提供给用户。同时cache还负责与源站点进行内容同步，把最新的内容从源站获取下来并保存在本地。cache设备的数量、规模、总服务能力是衡量一个CDN系统服务能力的最基本指标。</li>
<li><strong>负载均衡系统</strong>：主要功能是负责对所有发起请求的用户进行访问调度，确定提供给用户的最终实际访问地址。两级调度体系分为全局负载均衡（GSLB）和本地负载均衡（SLB）。全局负载均衡主要根据用户的就近原则，通过对每个服务节点进行最优判断，确定向用户提供服务的cache的物理地址。本地负载均衡主要负责节点内部的设备负载均衡。</li>
<li><strong>运营管理系统</strong>：运营管理系统分为运营管理和网络管理子系统，负责处理业务层面与外界系统交互所必须的手机、整理与交互。</li>
</ul>
<h3 id="3-⭐CDN工作流程"><a href="#3-⭐CDN工作流程" class="headerlink" title="3. ⭐CDN工作流程"></a>3. ⭐CDN工作流程</h3><p>CDN和DNS有着密不可分的联系，我们先来回顾一下<strong>DNS的解析域名过程:</strong></p>
<p>在浏览器输入 <code>www.test.com</code> 的解析过程如下： </p>
<p>（1） 检查浏览器缓存, 如果存在，则域名解析到此完成。</p>
<p>（2）检查操作系统缓存，常见的如<code>hosts</code>文件 , 如果存在，则域名解析到此完成。</p>
<p>（3）检查路由器缓存 </p>
<p>（4）如果前几步都没有找到，会向<code>ISP</code>(网络服务提供商  )的本地<code>DNS</code>服务器(<code>LDNS</code>)查询 </p>
<p>（5）如果<code>LDNS</code>服务器没找到，会向根域名服务器(<code>Root Server</code>)请求解析，分为以下几步：</p>
<ul>
<li>根服务器返回顶级域名服务器如<code>.com，.cn，.org</code>等的地址，该例子中会返回<code>.com</code>的地址</li>
<li>接着向顶级域名服务器发送请求，然后会返回次级域名服务器的地址，本例子会返回<code>.test</code>的地址</li>
<li>接着向次级域名服务器发送请求，然后会返回通过域名查询到的目标<code>IP</code>，本例子会返回<code>www.test.com</code>的地址</li>
<li><code>Local DNS Server</code>会缓存结果，并返回给用户，缓存在系统中</li>
</ul>
<p><strong>DNS存在的问题:</strong></p>
<ul>
<li>如果存在多个域名(路径过长)需要查询或者网络不佳，可能导致延时大量增加</li>
<li>各大运营商在域名解析缓存的处理上实现的策略不统一</li>
<li>DNS劫持 , 部分运营商会在本地域名服务器劫持域名解析结果，在访问网站过程中插入广告</li>
<li>根服务器一旦被攻击或者关闭服务，将会导致全球互联网瘫痪。</li>
</ul>
<p>*<em>用户未使用<code>CDN</code><em>缓存资源的过程：</em></em></p>
<ol>
<li>浏览器通过<code>DNS</code>对域名进行解析（就是上面的<code>DNS</code>解析过程），依次得到此域名对应的<code>IP</code>地址</li>
<li>浏览器根据得到的<code>IP</code>地址，向域名的服务主机发送数据请求</li>
<li>服务器向浏览器返回响应数据</li>
</ol>
<p>**当使用了<code>CDN</code>**时</p>
<p><code>DNS</code> 服务器根据用户 <code>IP</code> 地址，将域名解析成相应节点的<strong>缓存服务器<code>IP</code>地址</strong>，实现用户就近访问。使用 <code>CDN</code> 服务的网站，只需将其域名解析权交给 <code>CDN</code> 的全局负载均衡（GSLB）设备，将需要分发的内容注入 <code>CDN</code>，就可以实现内容加速了。</p>
<ol>
<li>当用户点击网站页面上的内容URL，经过<strong>本地</strong>DNS系统解析，DNS 系统会最终将域名的解析权交给 CNAME 指向的 CDN 专用 DNS 服务器。</li>
<li>CDN 的 DNS 服务器将 CDN 的<strong>全局负载均衡设备</strong><code>IP</code>地址返回用户。</li>
<li>用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求。</li>
<li>CDN 全局负载均衡设备根据用户 IP 地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。</li>
<li>基于以下这些条件的综合分析<strong>之后</strong>，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的IP地址, 具体过程如下 : <ol>
<li>根据用户 IP 地址，判断哪一台服务器距用户最近；</li>
<li>根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；</li>
<li>查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。</li>
</ol>
</li>
<li>全局负载均衡设备把服务器的 <code>IP</code> 地址返回给用户。</li>
<li>用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。</li>
</ol>
<p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300039.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="4-CDN缓存"><a href="#4-CDN缓存" class="headerlink" title="4. CDN缓存"></a>4. CDN缓存</h3><p>当网站接入了<code>CDN</code>，浏览器本地缓存的资源过期后，浏览器不是直接向源服务器请求资源，而是转向<code>CDN</code>边缘节点请求资源。<code>CDN</code>边缘节点中会将用户请求的资源缓存下来，如果<code>CDN</code>中的缓存也过期了，<code>CDN</code>边缘节点则会向源服务器发出回源请求，从而来获取最新资源。</p>
<p><strong>CDN 缓存策略</strong></p>
<p><code>CDN</code>节点缓存策略一般都会遵循<code>HTTP</code>协议，在没有匹配到自定义缓存规则且源服务器也没有返回任何有效缓存头的情况下，默认配置策略为：</p>
<ul>
<li>针对静态资源，所有正常状态码 <code>200&lt;=code&lt;400</code> 均缓存<code>8</code>天。</li>
<li><code>301</code> 响应缓存 2 小时，302 响应缓存 20 分钟；</li>
<li>针对动态资源，程序会自动识别，则不进行缓存</li>
<li>对于其他大于等于<code>400</code>的不正常响应都不会进行缓存</li>
</ul>
<p><strong>缺陷</strong></p>
<p>但这里需要注意，当源服务器资源更新后，如果 CDN 节点上缓存数据还未过期，用户访问到的依旧是过期的缓存资源，这会导致用户最终访问出现偏差。因此，开发者需要手动刷新相关资源，使 CDN 缓存保持为最新的状态。</p>
<p><strong>如何解决CDN缓存更新不及时?</strong></p>
<ul>
<li>通过<code>URL</code>上加上时间戳参数，使<code>CDN</code>边缘节点同步源站最新资源</li>
<li>调用<code>CDN</code>服务商提供的刷新缓存的接口</li>
</ul>
<h3 id="5-CDN的作用"><a href="#5-CDN的作用" class="headerlink" title="5. CDN的作用"></a>5. CDN的作用</h3><p>CDN最常用的功能当然是加速，但还有一些其他功能。</p>
<ol>
<li><strong>加速访问</strong></li>
</ol>
<p>CDN可以使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。</p>
<p>还提供服务器端加速，解决由于用户访问量大造成的服务器过载问题；</p>
<ol start="2">
<li><strong>实现跨运营商、跨地域的全网覆盖</strong></li>
</ol>
<p>互联不互通、区域ISP地域局限、出口带宽受限制等种种因素都造成了网站的区域性无法访问。</p>
<p><code>CDN</code>加速可以覆盖全球的线路，通过使用其是可以完美的解决跨运营商访问难的问题的。</p>
<ol start="3">
<li><strong>异地备援</strong></li>
</ol>
<p>当某个服务器发生意外故障时，系统将会调用其他临近的健康服务器节点进行服务，进而提供接近<code>100%</code>的可靠性，这就让你的网站可以做到永不宕机。</p>
<ol start="4">
<li><p><strong>减少网站的安全&#x2F;维护成本</strong></p>
</li>
<li><p>CDN的负载均衡和分布式存储技术，可以加强网站的可靠性, 防攻击系统也能避免网站遭到恶意攻击。</p>
</li>
<li><p>投入使用CDN加速可以实现网站的全国铺设，你根据不用考虑购买服务器与后续的托管运维, 并且能降低网站自身建设和维护成本。</p>
</li>
<li><p>且<code>CDN</code>加速厂商一般都会提供一站式服务，业务不仅限于CDN.</p>
</li>
</ol>
<h3 id="6-CDN的应用场景"><a href="#6-CDN的应用场景" class="headerlink" title="6. CDN的应用场景"></a>6. CDN的应用场景</h3><ol>
<li><strong>网站站点&#x2F;应用加速</strong></li>
</ol>
<p>CDN可用于网站或者应用中大量静态资源的加速分发，如<code>html、css、js、img</code>等，可以通过<code>CDN</code>缓存在边缘节点上，当用户访问时可就近获取，提高了用户的访问速度以及降低了源站的压力。</p>
<ol start="2">
<li><strong>大文件下载分发加速（视频等文件）</strong></li>
</ol>
<p><code>CDN</code>可以针对各类文件、在线点播视频提供下载、分发加速，比如<code>mp4</code>、<code>flv</code>视频文件或大小在<code>20M</code>以上的文件，<code>CDN</code>可以搭配<code>对象存储OSS</code>使用，提升回源速度，节约回源带宽成本。</p>
<ol start="3">
<li><strong>移动应用加速</strong></li>
</ol>
<p>CDN可以为移动APP更新文件分发，为移动APP内图片、页面、短视频、UGC等内容的优化提供加速分发效果。同时可提供HTTP DNS服务，避免DNS劫持并获得精确的DNS解析结果。</p>
<ol start="4">
<li><strong>直播加速</strong></li>
</ol>
<p>CDN可以为直播分发提供流畅的播放下行链路，借助负载均衡系统将主播端采集的音视频数据推送到接近观众的数千个边缘节点，当观众端发起请求，就可以就近获取资源，减少网络抖动，增加直播链路的稳定性。</p>
<h3 id="7-⭐如何使用CDN"><a href="#7-⭐如何使用CDN" class="headerlink" title="7. ⭐如何使用CDN"></a>7. ⭐如何使用CDN</h3><blockquote>
<p>在 vite 项目中使用 CDN</p>
</blockquote>
<p>使用 vite 创建项目</p>
<p>首先创建项目和安装依赖</p>
<p><strong>分析依赖</strong></p>
<p>build 视图分析依赖文件 (分析项目中的文件大小及引用情况)</p>
<p>这里可以安装 rollup-plugin-visualizer 插件分析依赖视图</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">npm i rollup-plugin-visualizer -D<br></code></pre></td></tr></table></figure>

<p>使用 rollup-plugin-visualizer</p>
<blockquote>
<p>修改 vite.config.ts</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span><br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue&#x27;</span><br><br><span class="hljs-keyword">import</span> &#123; visualizer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-visualizer&#x27;</span><br><br><span class="hljs-comment">// https://vitejs.dev/config/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<br>      <span class="hljs-title function_">vue</span>(), <br>      <span class="hljs-title function_">visualizer</span>(&#123; <br>          <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 在默认用户代理中打开生成的文件</span><br>          <span class="hljs-attr">gzipSize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 收集 gzip 大小并将其显示</span><br>          <span class="hljs-attr">brotliSize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 收集 brotli 大小并将其显示</span><br>          <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;stats.html&quot;</span>, <span class="hljs-comment">// 分析图生成的文件名</span><br>       &#125;)  <br>  ],   <br>&#125;)<br></code></pre></td></tr></table></figure>

<p>配置的参数有很多是默认的，如果你没有特殊需求，完全可以不添加参数；</p>
<p>下面添加一个表格对已有参数进行诠释：</p>
<p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300977.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>打包项目 : npm run build </p>
<p>打包完成后，会自动打开名为 stats.html 的页面：可以很直观的可以看出各种包的占据程度</p>
<p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300020.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>vite 也会输出</p>
<p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300969.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<blockquote>
<p>分析上图，我们发现整个项目依赖为 1.79MB，其中 vue 体积占比 13.57%，248.43KB 大小，其次是@arco-design+web-vue 占比 81.49%, 1.46MB。</p>
</blockquote>
<p>⭐<strong>CDN 加速</strong></p>
<p>话接上文，我们通过视图分析发现了arco-design + web-vue 是最大的文件依赖,  那我们就尝试在vite+vue下配置这俩个库的cdn引入来减少请求压力</p>
<p>安装 vite-plugin-cdn-import(推荐)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">npm i vite-plugin-cdn-<span class="hljs-keyword">import</span> -D<br></code></pre></td></tr></table></figure>

<p>⭐修改 vite.config.ts (配置需要加速的依赖)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;<br><span class="hljs-keyword">import</span> compression <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-compression&#x27;</span>;<br><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@vitejs/plugin-vue&#x27;</span><br><span class="hljs-keyword">import</span> &#123; visualizer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rollup-plugin-visualizer&#x27;</span><br><span class="hljs-keyword">import</span> importToCDN <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-plugin-cdn-import&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-comment">// 其他配置项...</span><br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-comment">// 其他插件...</span><br>    <span class="hljs-comment">// 第三方库CDN引入</span><br>    importToCDN(&#123;<br>      <span class="hljs-attr">prodUrl</span>: <span class="hljs-string">&quot;https://unpkg.com/&#123;name&#125;@&#123;path&#125;&quot;</span>,<br>      <span class="hljs-attr">modules</span>: [<br>        <span class="hljs-comment">// autoComplete 自动导入</span><br>        <span class="hljs-title function_">autoComplete</span>(<span class="hljs-string">&#x27;vue&#x27;</span>),<br>        <span class="hljs-comment">// element-plus 这个源码中使用了 vue 依赖包里的 ref 变量 , 所以我们将 vue 也引入进来</span><br>        <span class="hljs-title function_">autoComplete</span>(<span class="hljs-string">&#x27;axios&#x27;</span>),<br>        &#123;<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;vue-demi&quot;</span>, <span class="hljs-comment">// vue版本选好 不然会报错</span><br>          <span class="hljs-attr">var</span>: <span class="hljs-string">&quot;VueDemi&quot;</span>,<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;0.14.5&quot;</span>,<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;vue-router&quot;</span>,<br>          <span class="hljs-attr">var</span>: <span class="hljs-string">&quot;VueRouter&quot;</span>,<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;4.2.2&quot;</span>,<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;element-plus&quot;</span>,<br>          <span class="hljs-attr">var</span>: <span class="hljs-string">&quot;ElementPlus&quot;</span>,<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;2.3.6&quot;</span>,<br>          <span class="hljs-attr">css</span>: <span class="hljs-string">&quot;2.3.6/dist/index.css&quot;</span>,<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;@element-plus/icons-vue&quot;</span>,<br>          <span class="hljs-attr">var</span>: <span class="hljs-string">&quot;ElementPlusIconsVue&quot;</span>, <span class="hljs-comment">// 根据main.js中定义的来</span><br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;2.1.0&quot;</span>,<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;pinia&quot;</span>,<br>          <span class="hljs-attr">var</span>: <span class="hljs-string">&quot;Pinia&quot;</span>,<br>          <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;2.1.3&quot;</span>,<br>        &#125;,<br>      ],<br>    &#125;),<br>  ],<br>&#125;);<br></code></pre></td></tr></table></figure>

<blockquote>
<p>CDN 链接查询 <a target="_blank" rel="noopener" href="https://www.jsdelivr.com/">https://www.jsdelivr.com/</a> 这个好用</p>
</blockquote>
<p>CDN 参数获取方式</p>
<ul>
<li><p>name：npm 包的名称</p>
</li>
<li><p>var：组件（main.ts）引用的名称</p>
<ul>
<li>比如 ArcoVue</li>
</ul>
</li>
<li><p>path：cdn 网站存储对应的 js 地址</p>
<ul>
<li>输入对应名称，会自动跳转到对应的 js 文件，复制粘贴，需要修改版本，和自己项目的 package.json 版本一致</li>
</ul>
</li>
<li><p>css：对应位置</p>
<ul>
<li>需要注意的是，css 可以使用本地的，使用本地的就不要添加 css，使用远程 cdn 的就需要在打包前注释本地的，否则会出现样式重叠。(在main.js中注释arcodesign的css引入)</li>
</ul>
</li>
</ul>
<p>怎么找到对应库cdn包的路径，我们好来配置参数</p>
<blockquote>
<p>以UNPKG为例实践如下: 比如我们要配置element-plus的cdn引入</p>
</blockquote>
<ul>
<li>先进入unpkg.com</li>
<li>在地址后面链接你的包名</li>
<li>得到链接配置参数即可</li>
</ul>
<p>重新打包 <code>npm run build</code> </p>
<p>可以看到，原先的 arco-design 依赖包和消失了：</p>
<p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311292300047.png" srcset="/img/loading.gif" lazyload alt="img"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="category-chain-item">性能优化</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CDN/">#CDN</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>🤠你知道什么是 CDN 吗?</div>
      <div>http://example.com/2023/11/29/CDN/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>weirdo</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年11月29日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2023年11月29日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/04/%E7%AC%AC%E4%B8%80%E6%AC%A1PR/" title="😈记录我的第一次PR">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">😈记录我的第一次PR</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/27/node%E8%AE%B0%E8%B4%A6%E6%9C%AC/" title="😈node记账本demo笔记">
                        <span class="hidden-mobile">😈node记账本demo笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"ukn0C9F4sFzy057RJ7Ohdmq4-gzGzoHsz","appKey":"x8NNzZf5L3jNKvqOKxoMj0FN","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":true,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
