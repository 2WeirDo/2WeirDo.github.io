<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ğŸ˜ˆnodeè®°è´¦æœ¬demoç¬”è®°</title>
    <link href="/2023/11/27/node%E8%AE%B0%E8%B4%A6%E6%9C%AC/"/>
    <url>/2023/11/27/node%E8%AE%B0%E8%B4%A6%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬ç»“æ„æ­å»º"><a href="#åŸºæœ¬ç»“æ„æ­å»º" class="headerlink" title="åŸºæœ¬ç»“æ„æ­å»º"></a>åŸºæœ¬ç»“æ„æ­å»º</h2><ol><li><p><code>npm i -g express-generator </code>  : å®‰è£… npm åŒ… (å·²ç»å®‰è£…å°±ç¬¬äºŒæ­¥)</p></li><li><p><code>express -e accounts</code> : å¿«é€Ÿåˆ›å»ºæ–‡ä»¶å¤¹, æ·»åŠ <code>ejs</code>æ¨¡æ¿å¼•æ“çš„æ”¯æŒ</p></li><li><p>åœ¨<code>views</code>ä¸­é€šè¿‡ ejs å†™å¥½é¡µé¢ (å…³äºé¡µé¢çš„æ˜¾ç¤ºè¿™é‡Œå°±ä¸å¤šä»‹ç»)</p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271511346.png" alt="img" style="zoom:67%;" /></li><li><p>å°†æ‰€éœ€è¦çš„ js å’Œ css æ–‡ä»¶å­˜æ”¾åˆ° public æ–‡ä»¶å¤¹ä¸‹</p></li><li><p>åœ¨<code>routes/index.js</code>ä¸­å†™å¥½å¢åˆ æ”¹æŸ¥</p></li><li><p><code>npm i</code> : å®‰è£…ä¾èµ–</p></li><li><p><code>npm start</code> : è¿è¡Œé¡¹ç›® (åœ¨ bin &#x2F; www æ–‡ä»¶, ç«¯å£ç”¨çš„ 3000)</p><blockquote><p>package.json ä¸­çš„ start å‘½ä»¤å¯ä»¥æ”¹ä¸º nodemon</p></blockquote></li></ol><blockquote><p>app.jsä»£ç </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> createError = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http-errors&#x27;</span>);<br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">var</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">var</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;morgan&#x27;</span>);<br><br><span class="hljs-keyword">var</span> indexRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/index&#x27;</span>);  <span class="hljs-comment">//â— æˆ‘ä»¬åªéœ€è¦åœ¨è¿™é‡Œç¼–å†™ä»£ç å³å¯</span><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">// view engine setup</span><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;views&#x27;</span>, path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>)); <span class="hljs-comment">//â— è®¾ç½®æ¨¡æ¿æ–‡ä»¶å­˜æ”¾æ–‡èŒ</span><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>); â— <span class="hljs-comment">// è®¾ç½®æ¨¡æ¿å¼•æ“ä¸º ejs</span><br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">logger</span>(<span class="hljs-string">&#x27;dev&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>()); <span class="hljs-comment">//â— åˆ›å»ºå…¨å±€ä¸­é—´ä»¶ : è·å–è¯·æ±‚ä½“(jsonæ ¼å¼)</span><br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;));  <span class="hljs-comment">//â— åˆ›å»ºå…¨å±€ä¸­é—´ä»¶ : è·å–è¯·æ±‚ä½“(quirestringæ ¼å¼)</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public&#x27;</span>))); <span class="hljs-comment">//â— åˆ›å»ºé™æ€èµ„æºä¸­é—´ä»¶</span><br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/&#x27;</span>, indexRouter); <span class="hljs-comment">// â—è·¯ç”±ä¸­é—´ä»¶</span><br><br><span class="hljs-comment">// catch 404 and forward to error handler</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-title function_">next</span>(<span class="hljs-title function_">createError</span>(<span class="hljs-number">404</span>));<br>&#125;);<br><br><span class="hljs-comment">// error handler</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, req, res, next</span>) &#123;<br>  <span class="hljs-comment">// set locals, only providing error in development</span><br>  res.<span class="hljs-property">locals</span>.<span class="hljs-property">message</span> = err.<span class="hljs-property">message</span>;<br>  res.<span class="hljs-property">locals</span>.<span class="hljs-property">error</span> = req.<span class="hljs-property">app</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;env&#x27;</span>) === <span class="hljs-string">&#x27;development&#x27;</span> ? err : &#123;&#125;;<br><br>  <span class="hljs-comment">// render the error page</span><br>  res.<span class="hljs-title function_">status</span>(err.<span class="hljs-property">status</span> || <span class="hljs-number">500</span>);<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;error&#x27;</span>);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = app; <span class="hljs-comment">// å¯¼å‡º, æœ€ç»ˆæ˜¯åœ¨wwwæ–‡ä»¶ä¸­start</span><br><br></code></pre></td></tr></table></figure><h2 id="Mongodb-è¿æ¥"><a href="#Mongodb-è¿æ¥" class="headerlink" title="Mongodb è¿æ¥"></a>Mongodb è¿æ¥</h2><p>ä¸‹è½½ mongdb â€”  çœç•¥</p><p><strong>å¯åŠ¨æœåŠ¡</strong></p><blockquote><p>è®°å¾—åœ¨ cmd ä¸­å…ˆå¯åŠ¨æœåŠ¡ (ä¸¤ä¸ª cmd çª—å£åˆ†åˆ«å¯åŠ¨)</p></blockquote><ol><li>è¿è¡Œå‘½ä»¤ mongod</li><li>è¿è¡Œå‘½ä»¤ mongosh è¿æ¥æœ¬æœºçš„ mongodb æœåŠ¡</li></ol><p><strong>ä½¿ç”¨ mongoose</strong></p><p><code>npm i mongoose</code> : å…ˆå®‰è£… mongoose </p><blockquote><p>Mongoose æ˜¯ä¸€ä¸ªå¯¹è±¡æ–‡æ¡£æ¨¡å‹åº“ , ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ä»£ç æ“ä½œ mongodbæ•°æ®åº“</p></blockquote><p><strong>Mongoose ä»£ç æ¨¡å—åŒ–</strong></p><p>æˆ‘ä»¬å°† mongoose çš„åŸºæœ¬ä½¿ç”¨å°è£…ä¸ºä¸€ä¸ª db æ–‡ä»¶, é‡Œé¢è£…ä¸€ä¸ªå‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; success  æ•°æ®åº“è¿æ¥æˆåŠŸçš„å›è°ƒ</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">*</span>&#125; error  æ•°æ®åº“è¿æ¥å¤±è´¥çš„å›è°ƒ</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">// db/db.js</span><br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">success, error</span>) &#123;<br><br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¼ å…¥error, ç»™é»˜è®¤å¤±è´¥å›è°ƒ</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> error !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>        <span class="hljs-comment">// ç»™ä¸ªé»˜è®¤å€¼</span><br>        error = <span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¿æ¥å¤±è´¥&#x27;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);<br><br>    <span class="hljs-comment">// weirdoæ˜¯æ•°æ®åº“çš„åç§°(ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º) , 27017æ˜¯mongodbçš„é»˜è®¤ç«¯å£å·(å¯ä»¥ä¸å†™)</span><br>    mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/weirdo&#x27;</span>) <br>    <br>    <span class="hljs-comment">// è®¾ç½®è¿æ¥æˆåŠŸçš„å›è°ƒ, onceåªæ‰§è¡Œä¸€æ¬¡, ç”¨onçš„è¯æ‰çº¿å›æ¥åè¿˜ä¼šæ‰§è¡Œ</span><br>    mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">success</span>();<br>    &#125;)<br>    <br>    <span class="hljs-comment">//è®¾ç½®è¿æ¥é”™è¯¯çš„å›è°ƒ</span><br>    mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">error</span>()<br>    &#125;)<br>    <br>    <span class="hljs-comment">// è®¾ç½®è¿æ¥å…³é—­çš„å›è°ƒ</span><br>    mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">&#x27;close&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¿æ¥å…³é—­&#x27;</span>);<br>    &#125;)<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹ä½¿ç”¨dbå‡½æ•°è¿æ¥æ•°æ®åº“å³å¯</p><ol><li><p>å¯¼å…¥dbæ–‡ä»¶</p></li><li><p>å¯¼å…¥æ¨¡å‹å¯¹è±¡</p></li></ol><p>æˆ‘ä»¬è¿˜å‡†å¤‡æŠŠæ•°æ®åº“çš„ä¸€äº›ä¿¡æ¯å•ç‹¬æ‹¿å‡ºæ¥, åšä¸€ä¸ªé…ç½®æ–‡ä»¶config, é‚£ä¹ˆä»¥åä¿¡æ¯éœ€è¦ä¿®æ”¹çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// config/config.js  é…ç½®æ–‡ä»¶</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    <span class="hljs-attr">DBHOST</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>    <span class="hljs-attr">DBPORT</span>: <span class="hljs-string">&#x27;27017&#x27;</span>,<br>    <span class="hljs-attr">DBNAME</span>: <span class="hljs-string">&#x27;weirdo&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååˆ°db.jsæ–‡ä»¶ä¸­ä½¿ç”¨å³å¯</p><p><strong>åœ¨wwwæ–‡ä»¶ä¸­å¯¼å…¥å¹¶è°ƒç”¨dbå‡½æ•°</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// www</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../db/db&quot;</span>); <span class="hljs-comment">// å¯¼å…¥dbå‡½æ•°</span><br><br><span class="hljs-comment">// è°ƒç”¨dbå‡½æ•° , æ•°æ®åº“è¿æ¥ä¸Šå†å¯åŠ¨httpæœåŠ¡, å¦åˆ™æ²¡æœ‰æ„ä¹‰</span><br><span class="hljs-title function_">db</span>(<span class="hljs-function">() =&gt;</span> &#123;<br> ...<br> ...<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>åˆ›å»º<code>AccountModel.js</code> æ¨¡å‹å¯¹è±¡</strong></p><p>æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmodulesæ–‡ä»¶å¤¹, å­˜æ”¾ä¸€äº›æ•°æ®åº“éœ€è¦çš„æ¨¡å‹å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// modules/AccountModel.js</span><br><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>)<br><br><span class="hljs-keyword">let</span> <span class="hljs-title class_">AccountSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>    <span class="hljs-attr">title</span>: &#123; <span class="hljs-comment">// æ ‡é¢˜</span><br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>        <span class="hljs-attr">require</span>: <span class="hljs-literal">true</span>,<br>    &#125;, <br>    <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>, <span class="hljs-comment">// æ—¶é—´</span><br>    <span class="hljs-attr">type</span>: &#123;  <span class="hljs-comment">//ç±»å‹</span><br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,<br>        <span class="hljs-attr">default</span>: -<span class="hljs-number">1</span>,<br>    &#125;,<br>    <span class="hljs-attr">account</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,<br>        <span class="hljs-attr">require</span>: <span class="hljs-literal">true</span><br>    &#125;,<br>    <span class="hljs-attr">remarks</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    &#125;<br>&#125;)<br><br><span class="hljs-comment">// åˆ›å»ºæ¨¡å‹å¯¹è±¡ : å¯¹æ–‡æ¡£æ“ä½œçš„å°è£…å¯¹è±¡</span><br><span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é›†åˆåç§°, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç»“æ„å¯¹è±¡</span><br><span class="hljs-keyword">let</span> <span class="hljs-title class_">AccountModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;accounts&#x27;</span>, <span class="hljs-title class_">AccountSchema</span>);<br><br><span class="hljs-comment">//æš´éœ²æ¨¡å‹å¯¹è±¡</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">AccountModel</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç”±äºæˆ‘ä»¬çš„æ—¶é—´<code>time</code>åœ¨æœ€åè·å–åˆ°çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², æˆ‘ä»¬è¦å°†å®ƒè½¬æ¢ä¸º<code>Date</code>å‹, å°±è¦ç”¨åˆ°ä¸€ä¸ªå·¥å…·åŒ…</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> i moment<br></code></pre></td></tr></table></figure><p><strong>æ’å…¥æ•°æ®</strong></p><blockquote><p>routes&#x2F;index.js</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// æ–°å¢è®°å½•</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/account&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// åœ¨app.jsä¸­å·²ç»æ·»åŠ äº†body-parserä¸­é—´ä»¶</span><br>  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">create</span>(&#123;<br>    ...req.<span class="hljs-property">body</span>,<br>    <span class="hljs-comment">// ä¿®æ”¹timeå±æ€§çš„å€¼</span><br>    <span class="hljs-attr">time</span>: <span class="hljs-title function_">moment</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">time</span>).<span class="hljs-title function_">toDate</span>() <span class="hljs-comment">// å°†å­—ç¬¦ä¸²ä¿®æ”¹ä¸ºæ—¶é—´å¯¹è±¡</span><br>  &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;success&#x27;</span>, &#123;<span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;æ·»åŠ æˆåŠŸhhh&#x27;</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/account&#x27;</span>&#125;)<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;æ’å…¥å¤±è´¥&#x27;</span>)<br>  &#125;)<br>  <br>&#125;)<br></code></pre></td></tr></table></figure><p><strong>è¯»å–æ•°æ®</strong></p><blockquote><p>routes&#x2F;index.js</p></blockquote><p>è¿™é‡Œç”¨åˆ°äº†æ ¼å¼åŒ–æ—¶é—´, åŒæ ·éœ€è¦å¯¼å…¥<code>moment</code>, ç„¶åè¿™é‡Œä¼ é€’<code>moment</code>åˆ°<code>ejs</code>å»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// è®°è´¦æœ¬çš„åˆ—è¡¨</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/account&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-comment">// è·å–æ‰€æœ‰çš„è´¦å•ä¿¡æ¯</span><br>  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;list&#x27;</span>, &#123;<span class="hljs-attr">accounts</span>: data, <span class="hljs-attr">moment</span>: moment, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/account/create&#x27;</span>&#125;)<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;è¯»å–å¤±è´¥&#x27;</span>)<br>  &#125;)<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨æ ¼å¼åŒ–æ—¶é—´</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271440681.png" alt="img"></p><p>å¦å¤–, ç”±äºæ•°æ®åº“é‡Œé¢çš„<code>id</code>æ˜¯<code>_id</code>, æ‰€ä»¥æˆ‘ä»¬å°†<code>list.ejs</code>çš„ç›¸å…³å­—æ®µæ”¹ä¸€ä¸‹</p><blockquote><p>å…¶å®ä¸æ”¹ä¹Ÿè¡Œ, mongodbé»˜è®¤ä¹Ÿä¼šå¸®æˆ‘ä»¬æ“ä½œ</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271440676.png" alt="img"></p><p><strong>åˆ é™¤æ•°æ®</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// åˆ é™¤è®°å½• (æ ¹æ®idè¿›è¡Œåˆ é™¤)</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/account/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// è·å–paramsçš„idå‚æ•°</span><br>  <span class="hljs-keyword">let</span> id = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;<br>  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">deleteOne</span>(&#123;<br>    <span class="hljs-attr">_id</span>: id,<br>  &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;success&#x27;</span>, &#123;<span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;åˆ é™¤æˆåŠŸhhh&#x27;</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/account&#x27;</span>&#125;)<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;åˆ é™¤å¤±è´¥&#x27;</span>)<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿å‰ç«¯ä¸è¦è¯¯æ“ä½œ, æˆ‘ä»¬ç»™åˆ é™¤æŒ‰é’®æ·»åŠ ä¸€ä¸ªéªŒè¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// list.ejs</span><br><span class="hljs-keyword">let</span> delBtns = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.delBtn&#x27;</span>);<br>delBtns.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> &#123;<br>  item.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">confirm</span>(<span class="hljs-string">&#x27;æ‚¨ç¡®å®šè¦åˆ é™¤è¯¥æ¡æ–‡æ¡£å—?&#x27;</span>)) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      e.<span class="hljs-title function_">preventDefault</span>()<br>    &#125;<br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="æ·»åŠ æ¥å£åŠŸèƒ½"><a href="#æ·»åŠ æ¥å£åŠŸèƒ½" class="headerlink" title="æ·»åŠ æ¥å£åŠŸèƒ½"></a>æ·»åŠ æ¥å£åŠŸèƒ½</h2><p>ä¸ºäº†å°†æ¥æˆ‘ä»¬åœ¨app, å®‰å“, iosä¸­å¼€å‘å®Œç¨‹åºå, åˆ°æ—¶å€™ç›´æ¥å’Œæ¥å£å¯¹æ¥, é‚£ä¹ˆæ•´ä¸ªåŠŸèƒ½å°±å®Œæˆäº†</p><p>é¦–å…ˆå…ˆå¯åŠ¨ mongod æœåŠ¡, ç„¶åæœ¬åœ°è¿æ¥ mongosh </p><p>npm start æ‰“å¼€æˆ‘ä»¬é€šè¿‡ express-generator åšçš„è®°è´¦æœ¬æ¡ˆä¾‹</p><p>åœ¨routesä¸‹æ·»åŠ ä»¥ä¸‹æ–‡ä»¶</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271445059.png" alt="img"></p><p>è¿™é‡Œçš„web&#x2F;index.jså°±æ˜¯åŸå…ˆçš„index.js</p><p>å¦å¤–, åœ¨app.jsä¸­ä¿®æ”¹ç›¸å…³ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> indexRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/web/index&quot;</span>);<br><span class="hljs-keyword">const</span> accountRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/api/account&quot;</span>); <span class="hljs-comment">// å¯¼å…¥ account æ¥å£è·¯ç”±æ–‡ä»¶</span><br>...<br>...<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/&quot;</span>, indexRouter);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;/api&quot;</span>, accountRouter);<br></code></pre></td></tr></table></figure><p>è¿™æ ·, æˆ‘ä»¬é€šè¿‡<code>api</code>è®¿é—®åˆ°çš„å°±æ˜¯æ¥å£è¿”å›çš„ä¿¡æ¯äº†</p><p>api&#x2F;account.js ä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><br><span class="hljs-keyword">const</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;moment&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AccountModel</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../../modules/AccountModel&quot;</span>);<br><br><span class="hljs-comment">// è®°è´¦æœ¬çš„åˆ—è¡¨</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/account&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  <span class="hljs-comment">// è·å–æ‰€æœ‰çš„è´¦å•ä¿¡æ¯</span><br>  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">find</span>()<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;0000&#x27;</span>, <span class="hljs-comment">// å“åº”ç¼–å·, 0000è¡¨ç¤ºæˆåŠŸ</span><br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;è¯»å–æˆåŠŸ&#x27;</span>, <span class="hljs-comment">// å“åº”çš„ä¿¡æ¯</span><br>        <span class="hljs-attr">data</span>: data, <span class="hljs-comment">// å“åº”çš„æ•°æ®</span><br>      &#125;)<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;1001&#x27;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;è¯»å–å¤±è´¥&#x27;</span>,<br>        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span><br>      &#125;)<br>    &#125;);<br>&#125;);<br><br><span class="hljs-comment">// æ–°å¢è®°å½•</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/account&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// â—åœ¨è¿™ä¹‹å‰å¯ä»¥è¿›è¡Œè¡¨å•éªŒè¯</span><br><br>  <span class="hljs-comment">// åœ¨app.jsä¸­å·²ç»æ·»åŠ äº†body-parserä¸­é—´ä»¶</span><br>  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">create</span>(&#123;<br>    ...req.<span class="hljs-property">body</span>,<br>    <span class="hljs-comment">// ä¿®æ”¹timeå±æ€§çš„å€¼</span><br>    <span class="hljs-attr">time</span>: <span class="hljs-title function_">moment</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">time</span>).<span class="hljs-title function_">toDate</span>(),<br>  &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;0000&#x27;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;æ·»åŠ æˆåŠŸ&#x27;</span>,<br>        <span class="hljs-attr">data</span>: data<br>      &#125;)<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;1002&#x27;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;æ·»åŠ å¤±è´¥&#x27;</span>,<br>        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span><br>      &#125;)<br>    &#125;);<br>&#125;);<br><br><span class="hljs-comment">// åˆ é™¤è®°å½• (æ ¹æ®idè¿›è¡Œåˆ é™¤)</span><br>router.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&quot;/account/:id&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// è·å–paramsçš„idå‚æ•°</span><br>  <span class="hljs-keyword">let</span> id = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;<br>  <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">deleteOne</span>(&#123;<br>    <span class="hljs-attr">_id</span>: id,<br>  &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;0000&#x27;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>,<br>        <span class="hljs-attr">data</span>: &#123;&#125;<br>      &#125;)<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;1003&#x27;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;åˆ é™¤å¤±è´¥&#x27;</span>,<br>        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span><br>      &#125;)<br>    &#125;);<br>&#125;);<br><br><span class="hljs-comment">// è·å–å•ä¸ªè´¦å•ä¿¡æ¯</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/account/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> &#123;id&#125; = req.<span class="hljs-property">params</span>;<br>    <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">findById</span>(id).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        res.<span class="hljs-title function_">json</span>(&#123;<br>            <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;0000&#x27;</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;è·å–æˆåŠŸ&#x27;</span>,<br>            <span class="hljs-attr">data</span>: data<br>        &#125;)<br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        res.<span class="hljs-title function_">json</span>(&#123;<br>            <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;1004&#x27;</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;è·å–å¤±è´¥&#x27;</span>,<br>            <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span><br>        &#125;)<br>    &#125;)<br>&#125;)<br><br><span class="hljs-comment">// æ›´æ–°å•ä¸ªè´¦å•ä¿¡æ¯</span><br>router.<span class="hljs-title function_">patch</span>(<span class="hljs-string">&#x27;/account/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> &#123;id&#125; = req.<span class="hljs-property">params</span>;<br>    <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">updateOne</span>(&#123;<span class="hljs-attr">_id</span>: id&#125;, req.<span class="hljs-property">body</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-comment">// æ›´æ–°æˆåŠŸåè¿”å›æ›´æ–°åçš„æ•°æ®</span><br>        <span class="hljs-title class_">AccountModel</span>.<span class="hljs-title function_">findById</span>(id).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>            res.<span class="hljs-title function_">json</span>(&#123;<br>                <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;0000&#x27;</span>,<br>                <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;æ›´æ–°æˆåŠŸ&#x27;</span>,<br>                <span class="hljs-attr">data</span>: data<br>            &#125;)<br>        &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>            res.<span class="hljs-title function_">json</span>(&#123;<br>                <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;1004&#x27;</span>,<br>                <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;è·å–å¤±è´¥&#x27;</span>,<br>                <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span><br>            &#125;)<br>        &#125;)<br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        res.<span class="hljs-title function_">json</span>(&#123;<br>            <span class="hljs-attr">code</span>: <span class="hljs-string">&#x27;1005&#x27;</span>,<br>            <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;æ›´æ–°å¤±è´¥&#x27;</span>,<br>            <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span><br>        &#125;)<br>    &#125;)<br>&#125;)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><blockquote><p>åªæ˜¯å°†ä¹‹å‰è¿”å›çš„æ•°æ®å˜ä¸ºäº†json, ä¹‹å‰æ˜¯ res.render æ¸²æŸ“ ejs é¡µé¢, ç°åœ¨æ˜¯è¿”å› json æ•°æ®</p></blockquote><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨apipostä¸­è¿›è¡Œå„ç§æ“ä½œäº†</p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271447503.png" alt="img" style="zoom: 50%;" /><h2 id="ä¼šè¯æ§åˆ¶"><a href="#ä¼šè¯æ§åˆ¶" class="headerlink" title="ä¼šè¯æ§åˆ¶"></a>ä¼šè¯æ§åˆ¶</h2><p><strong>cookie</strong></p><blockquote><p>å¦‚æœæ˜¯é€šè¿‡ express-generator è¿›è¡Œåˆ›å»ºé¡¹ç›®çš„è¯å°±ä¸ç”¨è‡ªå·±æ­å»ºäº†, è¿™é‡Œä½¿ç”¨çš„æ˜¯åŸç”Ÿexpress</p><p>npm i express   :  æ³¨æ„è¦å®‰è£…è·å– cookie çš„åŒ…</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-comment">//1. å®‰è£… cookie-parser npm i cookie-parser</span><br><span class="hljs-comment">//2. å¼•å…¥ cookieParser åŒ…</span><br><span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">//3. è®¾ç½® cookieParser ä¸­é—´ä»¶</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>());<br><br><span class="hljs-comment">//4-1 è®¾ç½® cookie</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/set-cookie&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>    response.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;username&#x27;</span>,<span class="hljs-string">&#x27;wangwu&#x27;</span>); <span class="hljs-comment">// ä¸å¸¦æ—¶æ•ˆæ€§, å…³é—­æµè§ˆå™¨å°±æ²¡äº†</span><br>    response.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;email&#x27;</span>,<span class="hljs-string">&#x27;23123456@qq.com&#x27;</span>, &#123;<span class="hljs-attr">maxAge</span>: <span class="hljs-number">5</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000</span> &#125;); <span class="hljs-comment">// å¸¦æ—¶æ•ˆæ€§</span><br>    response.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Cookieçš„è®¾ç½®&#x27;</span>); <span class="hljs-comment">//å“åº”</span><br>&#125;);<br><br><span class="hljs-comment">//4-2 è¯»å– cookie</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/get-cookie&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">cookies</span>); <span class="hljs-comment">//è¯»å–æ‰€æœ‰ cookie</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">cookies</span>.<span class="hljs-property">username</span>) <span class="hljs-comment">// å•ç‹¬è¯»å– cookie</span><br>    response.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Cookieçš„è¯»å–&#x27;</span>); <span class="hljs-comment">//å“åº”ä½“</span><br>&#125;);<br><br><br><span class="hljs-comment">// 4-3 åˆ é™¤cookie (ä¸€èˆ¬ç”¨æˆ·é€€å‡ºç™»å½•çš„æ—¶å€™ä¼šç”¨åˆ°)</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/delete-cookie&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">clearCookie</span>(<span class="hljs-string">&#x27;username&#x27;</span>);<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span>)<br>&#125;)<br><br><br><span class="hljs-comment">//å¯åŠ¨æœåŠ¡</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æœåŠ¡å·²ç»å¯åŠ¨....&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>session</strong></p><p>session æ˜¯ä¿å­˜åœ¨ æœåŠ¡å™¨ç«¯çš„ä¸€å—å„¿æ•°æ® ï¼Œä¿å­˜å½“å‰è®¿é—®ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯</p><p>å®ƒå¯å®ç°ä¼šè¯æ§åˆ¶ï¼Œå¯ä»¥è¯†åˆ«ç”¨æˆ·çš„èº«ä»½ï¼Œå¿«é€Ÿè·å–å½“å‰ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯</p><blockquote><p>è¿è¡Œæµç¨‹</p></blockquote><ol><li>å¡«å†™è´¦å·å’Œå¯†ç æ ¡éªŒèº«ä»½ï¼Œæ ¡éªŒé€šè¿‡åæœåŠ¡ç«¯åˆ›å»º <code>session</code> ä¿¡æ¯ ï¼Œç„¶åå°† <code>session_id</code> çš„å€¼é€šè¿‡å“åº”å¤´è¿”å›ç»™æµè§ˆå™¨</li><li>åœ¨ç™»å½•(è¯·æ±‚)äº†ä¸€æ¬¡æ­¤ç½‘ç«™å,  ä¸‹æ¬¡å‘é€è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨æºå¸¦ <code>cookie</code>ï¼ŒæœåŠ¡å™¨é€šè¿‡ <code>cookie</code> ä¸­çš„<code>session_id</code> çš„å€¼ç¡®å®šç”¨æˆ·çš„èº«ä»½</li></ol><blockquote><p>session çš„ä»£ç æ“ä½œ</p></blockquote><p>å®‰è£… <code>npm i express-session</code>  å®ƒå¯åœ¨ <code>express</code> ä¸­å¯¹ <code>session</code> è¿›è¡Œæ“ä½œ</p><p>å®‰è£… <code>npm i connect-mongo</code> , å¯ä»¥è¿æ¥ <code>mongodb</code>æ•°æ®åº“, ä¹Ÿå¯ä»¥åšä¸€äº›æ“ä½œ, è¿™æ ·å°±å¯ä»¥å°†sessionå­˜åˆ°æ•°æ®åº“</p><blockquote><p>è®°å¾—è¦å…ˆæŠŠ mongodb è·‘èµ·æ¥</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-comment">//1. å®‰è£…åŒ… npm i express-session connect-mongo</span><br><span class="hljs-comment">//2. å¼•å…¥ express-session connect-mongo</span><br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-session&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MongoStore</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;connect-mongo&#x27;</span>);<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">//3. è®¾ç½® session çš„ä¸­é—´ä»¶</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">session</span>(&#123;<br>     <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;sid&#x27;</span>, <span class="hljs-comment">//è®¾ç½®cookieçš„nameï¼Œé»˜è®¤å€¼æ˜¯ï¼šconnect.sid</span><br>     <span class="hljs-attr">secret</span>: <span class="hljs-string">&#x27;atguigu&#x27;</span>, <span class="hljs-comment">//å‚ä¸åŠ å¯†çš„å­—ç¬¦ä¸²ï¼ˆåˆç§°ç­¾åï¼‰â—åŠ ç›</span><br>      <br>     <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//æ˜¯å¦ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½è®¾ç½®ä¸€ä¸ªcookieç”¨æ¥å­˜å‚¨sessionçš„id</span><br>     <span class="hljs-comment">//ä¸ç”¨å°±ä¸åˆ›å»º, é™¤éå¯¹åŒ¿åç”¨æˆ·ä¿¡æ¯åšè®°å½•, å°±å¯ä»¥è®¾ç½®ä¸º true</span><br>        <br>     <span class="hljs-attr">resave</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//æ˜¯å¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é‡æ–°ä¿å­˜session (æ¯”å¦‚å¯ä»¥æ›´æ–°sessionçš„è¿‡æœŸæ—¶é—´)</span><br>     <span class="hljs-comment">// ä¸€ç›´å‘è¯·æ±‚å°±ä¸ä¼šé‡æ–°ç™»å½•, é•¿æ—¶é—´æ“ä½œè¿‡äº†sessionè¿‡æœŸæ—¶é—´å°±åˆè¦é‡æ–°ç™»å½•äº†</span><br>     <br>     <span class="hljs-attr">store</span>: <span class="hljs-title class_">MongoStore</span>.<span class="hljs-title function_">create</span>(&#123;<br>         <span class="hljs-attr">mongoUrl</span>: <span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/weirdo&#x27;</span> <span class="hljs-comment">//æ•°æ®åº“çš„è¿æ¥é…ç½®</span><br>     &#125;),<br>     <span class="hljs-attr">cookie</span>: &#123;<br>        <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯åå‰ç«¯æ— æ³•é€šè¿‡ JS è¿›è¡Œè®¿é—®(æ¯”å¦‚ document.cookie)</span><br>        <span class="hljs-attr">maxAge</span>: <span class="hljs-number">1000</span> * <span class="hljs-number">300</span> <span class="hljs-comment">// è¿™ä¸€æ¡ æ˜¯æ§åˆ¶ sessionID çš„è¿‡æœŸæ—¶é—´çš„ï¼ï¼</span><br>        <span class="hljs-comment">// session å’Œ cookie éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªè®¾ç½®</span><br>    &#125;,<br>&#125;))<br><br><span class="hljs-comment">//åˆ›å»º session</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">//è®¾ç½®session</span><br>    <span class="hljs-comment">// æ»¡è¶³æŸæ¡ä»¶(æ¯”å¦‚ç”¨æˆ·åå’Œå¯†ç è¾“å…¥æ­£ç¡®)è®¾ç½®session</span><br>    <span class="hljs-keyword">if</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">username</span> === <span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp; req.<span class="hljs-property">query</span>.<span class="hljs-property">password</span> === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>         req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = <span class="hljs-string">&#x27;zhangsan&#x27;</span>;<br>         req.<span class="hljs-property">session</span>.<span class="hljs-property">email</span> = <span class="hljs-string">&#x27;zhangsan@qq.com&#x27;</span><br>         res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç™»å½•æˆåŠŸ&#x27;</span>);<br>    &#125;<br>    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç™»å½•å¤±è´¥&#x27;</span>);<br>&#125;)<br><br><span class="hljs-comment">//è·å– session</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/home&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;sessionçš„ä¿¡æ¯&#x27;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>);<br>    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`ä½ å¥½ <span class="hljs-subst">$&#123;req.session.username&#125;</span>`</span>);<br>    &#125; <span class="hljs-keyword">else</span>&#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;ç™»å½• æ³¨å†Œ&#x27;</span>);<br>    &#125;<br>&#125;)<br><br><span class="hljs-comment">//é”€æ¯ session</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/logout&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">//é”€æ¯session</span><br>    <span class="hljs-comment">// res.send(&#x27;è®¾ç½®session&#x27;);</span><br>    req.<span class="hljs-property">session</span>.<span class="hljs-title function_">destroy</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;æˆåŠŸé€€å‡º&#x27;</span>);<br>    &#125;);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æœåŠ¡å·²ç»å¯åŠ¨, ç«¯å£ &#x27;</span> + <span class="hljs-number">3000</span> + <span class="hljs-string">&#x27; ç›‘å¬ä¸­...&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>session å’Œ cookie çš„åŒºåˆ«</strong></p><ol><li>å­˜åœ¨çš„ä½ç½®<ol><li>cookieï¼šæµè§ˆå™¨ç«¯</li><li>sessionï¼šæœåŠ¡ç«¯</li></ol></li><li>å®‰å…¨æ€§<ol><li>cookie æ˜¯ä»¥æ˜æ–‡çš„æ–¹å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒä½</li><li>session å­˜æ”¾äºæœåŠ¡å™¨ä¸­ï¼Œæ‰€ä»¥å®‰å…¨æ€§ ç›¸å¯¹ è¾ƒå¥½</li></ol></li><li>ç½‘ç»œä¼ è¾“é‡<ol><li>cookie è®¾ç½®å†…å®¹è¿‡å¤šä¼šå¢å¤§æŠ¥æ–‡ä½“ç§¯ï¼Œ ä¼šå½±å“ä¼ è¾“æ•ˆç‡</li><li>session æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œåªæ˜¯é€šè¿‡ cookie ä¼ é€’ idï¼Œæ‰€ä»¥ä¸å½±å“ä¼ è¾“æ•ˆç‡</li></ol></li><li>å­˜å‚¨é™åˆ¶<ol><li>æµè§ˆå™¨é™åˆ¶å•ä¸ª cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4K ï¼Œä¸”å•ä¸ªåŸŸåä¸‹çš„å­˜å‚¨æ•°é‡ä¹Ÿæœ‰é™åˆ¶</li><li>session æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰è¿™äº›é™åˆ¶</li></ol></li></ol><p><strong>token</strong></p><p>token æ˜¯æœåŠ¡ç«¯ç”Ÿæˆå¹¶è¿”å›ç»™ HTTP å®¢æˆ·ç«¯çš„ä¸€ä¸²åŠ å¯†å­—ç¬¦ä¸²ï¼Œ token ä¸­ä¿å­˜ç€ ç”¨æˆ·ä¿¡æ¯</p><p>å®ƒå¯ä»¥å®ç°ä¼šè¯æ§åˆ¶ï¼Œå¯ä»¥è¯†åˆ«ç”¨æˆ·çš„èº«ä»½ï¼Œä¸»è¦ç”¨äºç§»åŠ¨ç«¯ APP</p><blockquote><p>å·¥ä½œæµç¨‹</p></blockquote><p>å¡«å†™è´¦å·å’Œå¯†ç æ ¡éªŒèº«ä»½ï¼Œæ ¡éªŒé€šè¿‡åå“åº” tokenï¼Œtoken ä¸€èˆ¬æ˜¯åœ¨å“åº”ä½“ä¸­è¿”å›ç»™å®¢æˆ·ç«¯çš„</p><p>åç»­å‘é€è¯·æ±‚æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å°† token æ·»åŠ åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œä¸€èˆ¬æ˜¯æ”¾åœ¨è¯·æ±‚å¤´ä¸­</p><blockquote><p>ç‰¹ç‚¹</p></blockquote><ul><li>æœåŠ¡ç«¯å‹åŠ›æ›´å°<ul><li>æ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯</li></ul></li><li>ç›¸å¯¹æ›´å®‰å…¨<ul><li>æ•°æ®åŠ å¯†</li><li>å¯ä»¥é¿å… CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰å› ä¸ºä¸èƒ½è‡ªåŠ¨æºå¸¦</li></ul></li><li>æ‰©å±•æ€§æ›´å¼º<ul><li>æœåŠ¡é—´å¯ä»¥å…±äº«</li><li>å¢åŠ æœåŠ¡èŠ‚ç‚¹æ›´ç®€å•</li></ul></li></ul><p><strong>å’Œ cookie çš„åŒºåˆ«</strong></p><ul><li><p>token æ‰‹åŠ¨æºå¸¦</p></li><li><p>cookie è‡ªåŠ¨æºå¸¦</p></li></ul><p><strong>jwt</strong></p><p>JWTï¼ˆJSON Web Token ï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œå¯ç”¨äºåŸºäº token çš„èº«ä»½éªŒè¯</p><p>JWT ä½¿ token çš„ç”Ÿæˆä¸æ ¡éªŒæ›´è§„èŒƒ</p><blockquote><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ jsonwebtoken åŒ… æ¥æ“ä½œ token</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript">npm i jsonwebtoken<br><span class="hljs-comment">//å¯¼å…¥ jsonwebtokan</span><br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>);<br><br><span class="hljs-comment">//åˆ›å»º token</span><br><span class="hljs-comment">// jwt.sign(ä¸‰ä¸ªå‚æ•° : æ•°æ®, åŠ å¯†å­—ç¬¦ä¸², é…ç½®å¯¹è±¡)</span><br><span class="hljs-keyword">let</span> token = jwt.<span class="hljs-title function_">sign</span>(&#123; <span class="hljs-comment">// åˆ›å»ºtoken </span><br>    <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;zhangsan&#x27;</span><br>&#125;, <span class="hljs-string">&#x27;zhaoweirduohaoshuai&#x27;</span>, &#123;<br>    <span class="hljs-attr">expiresIn</span>: <span class="hljs-number">60</span> <span class="hljs-comment">// tokençš„å£°æ˜å‘¨æœŸ, å•ä½æ˜¯ç§’</span><br>&#125;)<br><br><span class="hljs-comment">//è§£æ(æ ¡éªŒ) token</span><br>jwt.<span class="hljs-title function_">verify</span>(token, <span class="hljs-string">&#x27;zhaoweiduohaoshuai&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span>(err)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æ ¡éªŒå¤±è´¥~~&#x27;</span>);<br>    <span class="hljs-keyword">return</span><br>  &#125;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="é¡¹ç›®å®Œå–„"><a href="#é¡¹ç›®å®Œå–„" class="headerlink" title="é¡¹ç›®å®Œå–„"></a>é¡¹ç›®å®Œå–„</h2><p>æˆ‘ä»¬å…ˆåœ¨ views æ–‡ä»¶å¤¹ä¸‹åˆ›å»º req.ejs æ–‡ä»¶ç”¨æ¥å­˜æ”¾æ³¨å†Œé¡µé¢</p><p>ç„¶åæˆ‘ä»¬åœ¨webæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ auth.js ç”¨æ¥å­˜æ”¾ç™»å½•å’Œæ³¨å†Œæ‰€è¦ç”¨åˆ°çš„è·¯ç”±</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// routes/web/auth.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">UserModel</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../../modules/UserModel.js&#x27;</span>)<br><span class="hljs-keyword">const</span> md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;md5&#x27;</span>)<br><span class="hljs-comment">// åœ¨å­˜æ”¾æ•°æ®çš„æ—¶å€™, å¯†ç æˆ‘ä»¬éœ€è¦è¿›è¡ŒåŠ å¯†, æ‰€ä»¥ npm i md5, ç„¶åå¯¼å…¥å³å¯</span><br><br><span class="hljs-comment">// æ³¨å†Œé¡µé¢</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/reg&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;reg&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// æ³¨å†Œç”¨æˆ·</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/reg&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// åšè¡¨å•éªŒè¯(è¿™é‡Œå°±ä¸åšäº†)</span><br>    <span class="hljs-title class_">UserModel</span>.<span class="hljs-title function_">create</span>(&#123;<br>        ...req.<span class="hljs-property">body</span>,<br>        <span class="hljs-attr">password</span>: <span class="hljs-title function_">md5</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">password</span>), <span class="hljs-comment">// å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</span><br>    &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>       res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;success&quot;</span>, &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸhhh&quot;</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/login&quot;</span> &#125;);<br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>         res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;æ³¨å†Œå¤±è´¥&quot;</span>);<br>    &#125;);<br>      <br>&#125;)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½ ä¼šå‘ç°æˆ‘ä»¬å¯¹æ•°æ®åº“å­˜å‚¨æ•°æ®, æˆ‘ä»¬éœ€è¦ä¸€ä¸ªUserModel</p><p>æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­, æˆ‘ä»¬å°±è¿˜éœ€è¦ä¸€ä¸ªmodel</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨ modules æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª UserModel.js </p><blockquote><p> æ¥æ”¶ä¸¤ä¸ªæ•°æ®, ç”¨æˆ·åå’Œå¯†ç , å¹¶å°†æ•°æ®å­˜æ”¾åœ¨ users æ•°æ®åº“é›†åˆä¸­</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>)<br><br><span class="hljs-keyword">let</span> <span class="hljs-title class_">UserSchema</span> = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>    <span class="hljs-attr">username</span>: &#123; <span class="hljs-comment">// æ ‡é¢˜</span><br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,<br>    &#125;, <br>    <span class="hljs-attr">password</span>: &#123;  <span class="hljs-comment">//ç±»å‹</span><br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span><br>    &#125;,<br>&#125;)<br><br><span class="hljs-comment">// åˆ›å»ºæ¨¡å‹å¯¹è±¡ : å¯¹æ–‡æ¡£æ“ä½œçš„å°è£…å¯¹è±¡</span><br><span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é›†åˆåç§°, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç»“æ„å¯¹è±¡</span><br><span class="hljs-keyword">let</span> <span class="hljs-title class_">UserModel</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-title class_">UserSchema</span>);<br><br><span class="hljs-comment">//æš´éœ²æ¨¡å‹å¯¹è±¡</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">UserModel</span>;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨ app.js ä¸­å¯¼å…¥ç™»å½•å’Œæ³¨å†Œçš„å…¨å±€ä¸­é—´ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">...<br><span class="hljs-keyword">const</span> authRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./routes/web/auth&quot;</span>);<br>...<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;&quot;</span>, authRouter);<br></code></pre></td></tr></table></figure><p>åŒæ ·æˆ‘ä»¬åœ¨ views ä¸‹æ·»åŠ  login.ejs é¡µé¢</p><p>ç”±äºç™»å½•æ—¶æˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦æ‹¿åˆ°åŠ å¯†åçš„å¯†ç å’Œæ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œæ¯”å¯¹, ä¹Ÿæ˜¯éœ€è¦md5åŠ å¯†</p><p>ç„¶åæˆ‘ä»¬åœ¨ auth.js ä¸­å†™å…¥ç™»å½•çš„ç›¸å…³æ“ä½œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// web/auth.js</span><br><span class="hljs-comment">// ç™»å½•é¡µé¢</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;login&#x27;</span>)<br>&#125;)<br><br><span class="hljs-comment">// ç™»å½•æ“ä½œ</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// è·å–ç”¨æˆ·åå’Œå¯†ç </span><br>    <span class="hljs-keyword">let</span> &#123;username, password&#125; = req.<span class="hljs-property">body</span><br>    <span class="hljs-comment">// æŸ¥è¯¢æ•°æ®åº“</span><br>    <span class="hljs-title class_">UserModel</span>.<span class="hljs-title function_">findOne</span>(&#123;<br>        <span class="hljs-attr">username</span>: username, <br>        <span class="hljs-attr">password</span>: <span class="hljs-title function_">md5</span>(password)<br>    &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>       <span class="hljs-keyword">if</span>(!data) res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;è´¦å·æˆ–è€…å¯†ç é”™è¯¯&#x27;</span>)  <br>       <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å†™å…¥session</span><br>            req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span> = data.<span class="hljs-property">username</span>; <span class="hljs-comment">// å¾…ä¼šå°±ä¼šæ ¹æ®æ˜¯å¦æœ‰usernameåˆ¤æ–­session</span><br>            req.<span class="hljs-property">session</span>.<span class="hljs-property">_id</span> = data.<span class="hljs-property">_id</span>  <span class="hljs-comment">// ç”¨æˆ·æ–‡æ¡£çš„id, ä¸æ˜¯session ID</span><br>            res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;success&quot;</span>, &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;ç™»å½•æˆåŠŸhhh&quot;</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/account&quot;</span> &#125;);<br>       &#125;<br>    &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>       res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥&quot;</span>);<br>    &#125;);<br>&#125;)<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢æ•°æ®åº“æ—¶, å¦‚æœdataæ²¡æœ‰å€¼æ‰è¯´æ˜è´¦å·æˆ–è€…å¯†ç é”™è¯¯, å¦‚æœç™»å½•æˆåŠŸé‚£è¿˜è¦å†™å…¥session</p><p>å†™å…¥sessionæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° ä¸¤ä¸ªåŒ…, ç¬¬ä¸€ä¸ªæ˜¯ç”¨expressè¿›è¡Œsessionæ“ä½œ, ç¬¬äºŒä¸ªæ˜¯è¿æ¥mongdbæ•°æ®åº“</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">npm i express-<span class="hljs-keyword">session</span> <span class="hljs-keyword">connect</span>-mongo<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨app.jsä¸­è¿›è¡Œå¯¼å…¥sessionçš„ä¸­é—´ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// å¯¼å…¥express-session</span><br><span class="hljs-keyword">const</span> session = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express-session&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MongoStore</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;connect-mongo&quot;</span>);<br><br>...<br><br><span class="hljs-comment">//å¯¼å…¥é…ç½®é¡¹</span><br><span class="hljs-keyword">const</span> &#123;<span class="hljs-variable constant_">DBHOST</span>, <span class="hljs-variable constant_">DBNAME</span>, <span class="hljs-variable constant_">DBPORT</span>&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./config/config&#x27;</span>)<br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();<br><br><span class="hljs-comment">// è®¾ç½® session çš„ä¸­é—´ä»¶</span><br>app.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-title function_">session</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;sid&quot;</span>, <span class="hljs-comment">//è®¾ç½®cookieçš„nameï¼Œé»˜è®¤å€¼æ˜¯ï¼šconnect.sid</span><br>    <span class="hljs-attr">secret</span>: <span class="hljs-string">&quot;atguigu&quot;</span>, <span class="hljs-comment">//å‚ä¸åŠ å¯†çš„å­—ç¬¦ä¸²ï¼ˆåˆç§°ç­¾åï¼‰â—åŠ ç›</span><br><br>    <span class="hljs-attr">saveUninitialized</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//æ˜¯å¦ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½è®¾ç½®ä¸€ä¸ªcookieç”¨æ¥å­˜å‚¨sessionçš„id</span><br>    <span class="hljs-comment">//ä¸ç”¨å°±ä¸åˆ›å»º, é™¤éå¯¹åŒ¿åç”¨æˆ·ä¿¡æ¯åšè®°å½•, å°±å¯ä»¥è®¾ç½®ä¸º true</span><br><br>    <span class="hljs-attr">resave</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//æ˜¯å¦åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é‡æ–°ä¿å­˜session (æ¯”å¦‚å¯ä»¥æ›´æ–°sessionçš„è¿‡æœŸæ—¶é—´)</span><br>    <span class="hljs-comment">// ä¸€ç›´å‘è¯·æ±‚å°±ä¸ä¼šé‡æ–°ç™»å½•, é•¿æ—¶é—´æ“ä½œè¿‡äº†sessionè¿‡æœŸæ—¶é—´å°±åˆè¦é‡æ–°ç™»å½•äº†</span><br><br>    <span class="hljs-attr">store</span>: <span class="hljs-title class_">MongoStore</span>.<span class="hljs-title function_">create</span>(&#123;<br>      <span class="hljs-attr">mongoUrl</span>: <span class="hljs-string">`mongodb://<span class="hljs-subst">$&#123;DBHOST&#125;</span>:<span class="hljs-subst">$&#123;DBPORT&#125;</span>/<span class="hljs-subst">$&#123;DBNAME&#125;</span>`</span>, <span class="hljs-comment">//æ•°æ®åº“çš„è¿æ¥é…ç½®</span><br>    &#125;),<br>    <span class="hljs-attr">cookie</span>: &#123;<br>      <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯åå‰ç«¯æ— æ³•é€šè¿‡ JS è¿›è¡Œè®¿é—®(æ¯”å¦‚ document.cookie)</span><br>      <span class="hljs-attr">maxAge</span>: <span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>, <span class="hljs-comment">// è¿™ä¸€æ¡ æ˜¯æ§åˆ¶ sessionID çš„è¿‡æœŸæ—¶é—´çš„ï¼ï¼</span><br>      <span class="hljs-comment">// session å’Œ cookie éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªè®¾ç½®</span><br>    &#125;,<br>  &#125;)<br>);<br></code></pre></td></tr></table></figure><blockquote><p>å¦å¤–æˆ‘ä»¬è¿™é‡Œçš„mongoUrlä¸èƒ½å†™æ­», æ‰€ä»¥æˆ‘ä»¬å¯¼å…¥äº†é…ç½®é¡¹</p></blockquote><p><strong>ç”¨æˆ·ç™»å½•æ£€æµ‹</strong></p><p>æˆ‘ä»¬è®¿é—® account é¡µé¢, æ— ç—•æ¨¡å¼å‘ç°éƒ½èƒ½è¿›è¡Œæ“ä½œ, è¿™æ ·æ˜¯ä¸è¡Œçš„, åªæœ‰ç™»å½•äº†å¹¶ä¸”è¿”å›äº†sessionæ‰èƒ½è¿›è¡Œæ“ä½œ</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨<code>web/index.js</code>ä¸­çš„æ¯ä¸€ä¸ªæ¥å£å‰åŠ å…¥ä»¥ä¸‹åˆ¤æ–­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">if</span>(!req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123; <span class="hljs-comment">// æ ¹æ®æ˜¯å¦æœ‰usernameåˆ¤æ–­session</span><br>     <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ä»£ç å†—ä½™, äºæ˜¯æˆ‘ä»¬å°†å…¶å°è£…ä¸ºä¸€ä¸ªä¸­é—´ä»¶</p><p>åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º middlewares æ–‡ä»¶å¤¹å­˜æ”¾ä¸­é—´ä»¶, å¹¶å°†è¿™æ®µä»£ç æ”¾è¿›å»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// middlewares/checkLoginMiddlewares.js</span><br><span class="hljs-comment">// æ£€æµ‹ç™»å½•çš„ä¸­é—´ä»¶</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ‹¥æœ‰session</span><br>    <span class="hljs-comment">// è¿™é‡Œåˆ¤æ–­çš„æ—¶å€™æ ¹æ®å½“æ—¶å†™å…¥sessonå…·ä½“å­—æ®µå³å¯,(æ¯”å¦‚session.username) ç›´æ¥å†™sessionä¸è¡Œ</span><br>    <span class="hljs-keyword">if</span>(!req.<span class="hljs-property">session</span>.<span class="hljs-property">username</span>) &#123; <br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/login&#x27;</span>);<br>    &#125;<br>    <span class="hljs-title function_">next</span>()<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>index.js</code>ä¸­å¯¼å…¥å³å¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// å¯¼å…¥ä¸­é—´ä»¶æ£€æµ‹ç™»å½•</span><br><span class="hljs-keyword">let</span> checkLoginMiddleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../../middlewares/checkLoginMiddleware&#x27;</span>)<br>...<br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/account&quot;</span>, checkLoginMiddleware, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;...<br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/account/create&quot;</span>, checkLoginMiddleware, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;...<br>...<br></code></pre></td></tr></table></figure><p><strong>é€€å‡ºä¸šåŠ¡</strong></p><p>æˆ‘ä»¬åœ¨auth.jsä¸­å†™é€€å‡ºç›¸å…³æ¥å£</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// é€€å‡ºç™»å½•</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/logout&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// é”€æ¯session</span><br>    req.<span class="hljs-property">session</span>.<span class="hljs-title function_">destroy</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;success&#x27;</span>, &#123;<span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;é€€å‡ºæˆåŠŸ&#x27;</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/login&#x27;</span>&#125;);<br>    &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure><p>ä¸»è¦çš„æ“ä½œå°±æ˜¯é”€æ¯<code>session</code>ç„¶ååœ¨å›è°ƒå‡½æ•°ä¸­è·³è½¬é¡µé¢</p><p>ç„¶åæˆ‘ä»¬åœ¨ list.ejs ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®å®ç°ç‚¹å‡»é€€å‡º</p><p><strong>è¿™é‡Œä¸ºä»€ä¹ˆä¸ç”¨ a æ ‡ç­¾ ç„¶åé‡Œé¢href å†™ â€˜&#x2F;logoutâ€™ ?</strong></p><p>å› ä¸ºå¦‚æœåœ¨å…¶å®ƒç«¯å£é€šè¿‡<code>link/script/image</code>æ ‡ç­¾å‘é€è¯·æ±‚, åˆ™ä¹Ÿä¼šå¯¼è‡´é€€å‡ºç™»å½•  &#x3D;&gt;  å³<strong>XSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )</strong></p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271458377.png" alt="img" style="zoom: 67%;" /><p>æ‰€ä»¥æˆ‘ä»¬å°½é‡æ”¹ä¸ºpostè¯·æ±‚, ä½†æ˜¯è¿™æ ·è¿˜è¿œè¿œä¸å¤Ÿå“ˆ, å…·ä½“çš„è§£å†³åŠæ³•å¯ä»¥çœ‹è‡ªå·±çš„å…«è‚¡</p><p><strong>ä¼˜åŒ–è·¯ç”±å’Œé¦–é¡µ</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// web/index.ts</span><br><span class="hljs-comment">// æ·»åŠ é¦–é¡µçš„è·¯ç”±è§„åˆ™</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/account&#x27;</span>);  <span class="hljs-comment">// åœ¨è·³è½¬åˆ°accounté¡µé¢æ—¶ä¹Ÿä¼šåˆ¤æ–­sessionçš„</span><br>&#125;)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>404.ejs</code> åœ¨urlè·¯å¾„é”™è¯¯çš„æƒ…å†µä¸‹æ”¾ä¸€ä¸ªå…¬ç›Šé¡µé¢</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;body&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//volunteer.cdn-go.cn/404/latest/404.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br>&lt;/body&gt;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨app.js ä¸­å®ƒå¸®æˆ‘ä»¬å†™çš„ä½ç½®ä¿®æ”¹ä¸€ä¸‹, render 404é¡µé¢</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// catch 404 and forward to error handler</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;404&#x27;</span>)<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>JWTå¼•å…¥</strong></p><p> ç›®å‰è¿˜æ˜¯å­˜åœ¨bug, å› ä¸ºæˆ‘ä»¬çš„æ¥å£ç«¯(apié‚£ä¸ª)ä¸å—ä»»ä½•çº¦æŸ</p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271500879.png" alt="img" style="zoom:50%;" /><p>æˆ‘ä»¬åœ¨ api æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª auth.js æ¥é™åˆ¶æˆ‘ä»¬çš„ç™»å½•</p><p>æˆ‘ä»¬å…ˆå®‰è£… jsonwebtoken : <code>npm i jsonwebtoken</code></p><p>ç„¶ååœ¨ auth.js ä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// routes/api/autg.js</span><br><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">UserModel</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../../modules/UserModel.js&quot;</span>);<br><span class="hljs-keyword">const</span> md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;md5&quot;</span>);<br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;jsonwebtoken&quot;</span>);<br><br><span class="hljs-comment">// ç™»å½•æ“ä½œ</span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// è·å–ç”¨æˆ·åå’Œå¯†ç </span><br>  <span class="hljs-keyword">let</span> &#123; username, password &#125; = req.<span class="hljs-property">body</span>;<br>  <span class="hljs-comment">// æŸ¥è¯¢æ•°æ®åº“</span><br>  <span class="hljs-title class_">UserModel</span>.<span class="hljs-title function_">findOne</span>(&#123;<br>    <span class="hljs-attr">username</span>: username,<br>    <span class="hljs-attr">password</span>: <span class="hljs-title function_">md5</span>(password),<br>  &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (!data) &#123;<br>        res.<span class="hljs-title function_">json</span>(&#123;<br>          <span class="hljs-attr">code</span>: <span class="hljs-string">&quot;2002&quot;</span>,<br>          <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>,<br>          <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,<br>        &#125;);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºå½“å‰ç”¨æˆ·çš„token</span><br>        <span class="hljs-keyword">let</span> token = jwt.<span class="hljs-title function_">sign</span>(<br>          &#123;<br>            <span class="hljs-attr">username</span>: data.<span class="hljs-property">username</span>,<br>            <span class="hljs-attr">_id</span>: data.<span class="hljs-property">_id</span>,<br>          &#125;,<br>          <span class="hljs-string">&quot;weirdo&quot;</span>,<br>          &#123;<br>            <span class="hljs-attr">expiresIn</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">7</span>,<br>          &#125;<br>        );<br><br>        <span class="hljs-comment">// å“åº”token(è®°å¾— npm i jsonwebtoken)</span><br>        res.<span class="hljs-title function_">json</span>(&#123;<br>          <span class="hljs-attr">code</span>: <span class="hljs-string">&quot;0000&quot;</span>,<br>          <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>,<br>          <span class="hljs-attr">data</span>: token,<br>        &#125;);<br>      &#125;<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;ç™»å½•å¤±è´¥&quot;</span>);<br>      res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&quot;2001&quot;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;æ•°æ®åº“è¯»å–å¤±è´¥&quot;</span>,<br>        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,<br>      &#125;);<br>    &#125;);<br>&#125;);<br><br><span class="hljs-comment">// é€€å‡ºç™»å½•</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/logout&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// é”€æ¯session</span><br>  req.<span class="hljs-property">session</span>.<span class="hljs-title function_">destroy</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;success&quot;</span>, &#123; <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;é€€å‡ºæˆåŠŸ&quot;</span>, <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/login&quot;</span> &#125;);<br>  &#125;);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>å¯¹äºapiç›¸å…³çš„æ¥å£è¿›è¡Œtokené™åˆ¶, è‡³äºtokenå¦‚ä½•åœ¨å®¢æˆ·ç«¯è¿›è¡Œçš„ä¿å­˜, è¿™å°±ä¸çŸ¥é“äº†</p><p>è¿™æ ·æˆ‘ä»¬åœ¨ç™»å½•æˆåŠŸåå°±å¯ä»¥æ‹¿åˆ°token, é‚£ä¹ˆæˆ‘ä»¬åœ¨è®¿é—®å…³äºaccountçš„ç›¸å…³æ¥å£æ—¶å°±è¦å»æ ¡éªŒ</p><p>åŒç†æˆ‘ä»¬å°†æ ¡éªŒtokenå†™ä¸ºä¸€ä¸ªä¸­é—´ä»¶, æ”¾åœ¨middlewaresæ–‡ä»¶å¤¹ä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// middlewares/checkTokenMiddlewares.js</span><br><br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>) <span class="hljs-comment">// è®°å¾—è¦å¯¼å…¥</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// è·å– token</span><br>  <span class="hljs-keyword">let</span> token = req.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;token&quot;</span>);<br>  <span class="hljs-keyword">if</span> (!token) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<br>      <span class="hljs-attr">code</span>: <span class="hljs-string">&quot;2003&quot;</span>,<br>      <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;token ç¼ºå¤±&quot;</span>,<br>      <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-comment">// æ ¡éªŒ token</span><br>  jwt.<span class="hljs-title function_">verify</span>(token, <span class="hljs-string">&quot;weirdo&quot;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// æ£€æµ‹tokenæ˜¯å¦æ­£ç¡®</span><br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123;<br>        <span class="hljs-attr">code</span>: <span class="hljs-string">&quot;2004&quot;</span>,<br>        <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;tokenæ ¡éªŒå¤±è´¥&quot;</span>,<br>        <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,<br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// æ ¡éªŒæˆåŠŸ</span><br>      <span class="hljs-title function_">next</span>();<br>    &#125;<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>api/account.js</code>ä¸­çš„æ¯ä¸ªæ¥å£ä½¿ç”¨å³å¯</p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271501369.png" alt="img" style="zoom: 67%;" /><p>æˆ‘ä»¬ç°åœ¨æ„Ÿè§‰ â€˜<code>weirdo</code>â€˜ è¿™ä¸ªå¯†é’¥åœ¨åˆ›å»ºå’Œæ ¡éªŒéƒ½ä½¿ç”¨äº†, ä»¥åæ”¹èµ·æ¥ä¸å¤ªæ–¹ä¾¿, äºæ˜¯æˆ‘ä»¬å°†å…¶æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// é…ç½®æ–‡ä»¶</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">DBHOST</span>: <span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>  <span class="hljs-attr">DBPORT</span>: <span class="hljs-string">&quot;27017&quot;</span>,<br>  <span class="hljs-attr">DBNAME</span>: <span class="hljs-string">&quot;weirdo&quot;</span>,  <span class="hljs-comment">// è¿™ä¸ªæ˜¯æ•°æ®åº“é›†åˆåç§°</span><br>  <span class="hljs-attr">secret</span>: <span class="hljs-string">&quot;weirdo&quot;</span>, <span class="hljs-comment">// è¿™ä¸ªæ˜¯æˆ‘ä»¬å®šä¹‰çš„jwtå¯†é’¥</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>å¦å¤–æˆ‘ä»¬å¯ä»¥åœ¨æ ¡éªŒtokenæˆåŠŸå<strong>ä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯</strong></p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271502904.png" alt="img" style="zoom: 67%;" /><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨è®°è´¦æœ¬å…¶å®ƒçš„æ¥å£è®¿é—®è¿™ä¸ªç”¨æˆ·æ•°æ®(req.user)äº†</p><blockquote><p>æ¯”å¦‚</p></blockquote><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271502793.png" alt="img" style="zoom:67%;" /><blockquote><p>åé¢çš„éƒ¨ç½²ä¸Šçº¿å°±è‡ªå·±å»æ“ä½œå§.</p></blockquote><h2 id="æ–‡ä»¶-å›¾ç‰‡-ä¸Šä¼ "><a href="#æ–‡ä»¶-å›¾ç‰‡-ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶(å›¾ç‰‡)ä¸Šä¼ "></a>æ–‡ä»¶(å›¾ç‰‡)ä¸Šä¼ </h2><p>æ³¨æ„ è¿™æ—¶å€™å·²ç»ä½¿ç”¨äº†express-generator</p><p>æ–‡ä»¶ä¸Šä¼ ä¹Ÿæ˜¯åœ¨å‘é€<code>http</code>è¯·æ±‚æŠ¥æ–‡</p><p><code>npm i formidable</code> : æ‹¿åˆ°<code>formidable</code>å¯¹è±¡å¤„ç†æ–‡ä»¶ä¸Šä¼ </p><blockquote><p>routes&#x2F;index.js</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">let</span> &#123;formidable&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;formidable&quot;</span>);  <span class="hljs-comment">// è¿™é‡Œformidableæ˜¯ä¸€ä¸ªå¯¹è±¡, è¦è§£æ„æ‹¿åˆ°</span><br><br><span class="hljs-comment">/* GET home page. */</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;index&quot;</span>, &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;Express&quot;</span> &#125;);<br>&#125;);<br><br><span class="hljs-comment">// æ˜¾ç¤ºç½‘é¡µçš„ (è¡¨å•)</span><br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/portrait&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&quot;portrait&quot;</span>);<br>&#125;);<br><br><span class="hljs-comment">// å¤„ç†æ–‡ä»¶ä¸Šä¼ </span><br>router.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;/portrait&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// åˆ›å»ºè¡¨å•å¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> form = <span class="hljs-title function_">formidable</span>(&#123;<br>    <span class="hljs-comment">// è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜ç›®å½•</span><br>    <span class="hljs-attr">uploadDir</span>: __dirname + <span class="hljs-string">&#x27;/../public/images&#x27;</span>,<br>    <span class="hljs-comment">// ä¿æŒæ–‡ä»¶åç¼€</span><br>    <span class="hljs-attr">keepExtensions</span>: <span class="hljs-literal">true</span><br>  &#125;);<br><br>  <span class="hljs-comment">// è§£æè¯·æ±‚æŠ¥æ–‡</span><br>  <span class="hljs-comment">// fieldså‚¨å­˜é™¤äº†æ–‡ä»¶ä»¥å¤–çš„å­—æ®µ</span><br>  <span class="hljs-comment">// fileså‚¨å­˜</span><br>  form.<span class="hljs-title function_">parse</span>(req, <span class="hljs-function">(<span class="hljs-params">err, fields, files</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>      <span class="hljs-title function_">next</span>(err);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æœåŠ¡å™¨ä¿å­˜è¯¥å›¾ç‰‡çš„è®¿é—® URL : images/46b9df33709488d18ff343900.jpg</span><br>    <span class="hljs-keyword">let</span> url = <span class="hljs-string">&#x27;/images/&#x27;</span> + files.<span class="hljs-property">portrait</span>[<span class="hljs-number">0</span>].<span class="hljs-property">newFilename</span>; <span class="hljs-comment">// å°†æ¥å°†æ­¤æ•°æ®ä¿å­˜åœ¨æ•°æ®åº“ä¸­</span><br>    <span class="hljs-comment">// è¿™é‡Œfiles.portraitæ˜¯ä¸€ä¸ªæ•°ç»„é‡Œé¢å­˜æ”¾ä¸€ä¸ªå¯¹è±¡, æ‹¿åˆ°å³å¯</span><br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(files);                 <br>    res.<span class="hljs-title function_">send</span>(url);<br>  &#125;);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><blockquote><p>portrait.ejs</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ–‡ä»¶ä¸Šä¼ <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æ–‡ä»¶ä¸Šä¼ å¿…é¡»çš„å±æ€§è®¾ç½® enctype=&quot;multipart/form-data&quot; --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/portrait&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>        ç”¨æˆ·å: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        å¤´åƒ : <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;portrait&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>ç‚¹å‡»æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271415354.png" alt="img" style="zoom: 67%;" /><blockquote><p>getè¯·æ±‚è·å–çš„è¡¨å•</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271415261.png" alt="img"></p><blockquote><p>ç‚¹å‡»æäº¤å (å³ post è¯·æ±‚ &#x3D;&gt; è¿›è¡Œæ–‡ä»¶ä¸Šä¼ )</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311271415258.png" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
      <tag>node</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ğŸ˜flexå¸ƒå±€è¯¦è§£</title>
    <link href="/2023/11/18/flex/"/>
    <url>/2023/11/18/flex/</url>
    
    <content type="html"><![CDATA[<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h1 id="flex-å¸ƒå±€"><a href="#flex-å¸ƒå±€" class="headerlink" title="flex å¸ƒå±€"></a>flex å¸ƒå±€</h1><blockquote><p>å¯ä»¥çœ‹è¿™ä¸ª</p></blockquote><p><a href="https://www.ruanyifeng.com/blog/2015/07/flex-examples.html">Flex å¸ƒå±€æ•™ç¨‹:å®ä¾‹ç¯‡ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></p><h2 id="å®¹å™¨å±æ€§"><a href="#å®¹å™¨å±æ€§" class="headerlink" title="å®¹å™¨å±æ€§"></a>å®¹å™¨å±æ€§</h2><p>display å±æ€§ç”¨æ¥å°†çˆ¶å…ƒç´ å®šä¹‰ä¸º Flex å¸ƒå±€çš„å®¹å™¨ï¼Œè®¾ç½® display å€¼ä¸º <code>display: flex;</code> </p><p>å®¹å™¨å¯¹å¤–è¡¨ç°ä¸ºå—çº§å…ƒç´ ï¼›<code>display: inline-flex;</code> å®¹å™¨å¯¹å¤–è¡¨ç°ä¸ºè¡Œå†…å…ƒç´ ï¼Œå¯¹å†…ä¸¤è€…è¡¨ç°æ˜¯ä¸€æ ·çš„ã€‚</p><blockquote><p>æˆ‘ä»¬æœ‰ä»¥ä¸‹å…­ä¸ªå±æ€§å¯ä»¥è®¾ç½®çš„å®¹å™¨ä¸Šï¼š</p></blockquote><ul><li><code>flex-direction</code></li><li><code>flex-wrap</code></li><li><code>flex-flow</code></li><li><code>justify-content</code></li><li><code>align-items</code></li><li><code>align-content</code></li></ul><h4 id="flex-direction"><a href="#flex-direction" class="headerlink" title="flex-direction"></a>flex-direction</h4><p><code>flex-direction</code> å®šä¹‰äº†ä¸»è½´çš„æ–¹å‘ï¼Œå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ã€‚</p><ul><li><code>row</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´åœ¨æ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ä¾§ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ä»å·¦åˆ°å³ï¼›</li><li><code>row-reverse</code>ï¼šä¸»è½´åœ¨æ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ä¾§ï¼›</li><li><code>column</code>ï¼šä¸»è½´åœ¨å‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿ï¼›</li><li><code>column-reverse</code>ï¼š ä¸»è½´åœ¨å‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ã€‚</li></ul><h4 id="flex-wrap"><a href="#flex-wrap" class="headerlink" title="flex-wrap"></a>flex-wrap</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®æ˜¯æ’æˆä¸€è¡Œæ˜¾ç¤ºçš„ï¼Œ<code>flex-wrap</code> ç”¨æ¥å®šä¹‰å½“ä¸€è¡Œæ”¾ä¸ä¸‹æ—¶ï¼Œé¡¹ç›®å¦‚ä½•æ¢è¡Œã€‚</p><p>å‡è®¾æ­¤æ—¶ä¸»è½´æ˜¯ä»å·¦åˆ°å³çš„æ°´å¹³æ–¹å‘ï¼š</p><ul><li><code>nowrap</code>ï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œï¼›</li><li><code>wrap</code>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šé¢ï¼›</li><li><code>wrap-reverse</code>ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹é¢ã€‚</li></ul><h4 id="flex-flow"><a href="#flex-flow" class="headerlink" title="flex-flow"></a>flex-flow</h4><p><code>flex-flow</code> æ˜¯ <code>flex-direction </code>å’Œ <code>flex-wrap</code> çš„ç®€å†™ï¼Œé»˜è®¤å€¼æ˜¯ <code>row no-wrap</code>ã€‚</p><h4 id="justify-content"><a href="#justify-content" class="headerlink" title="justify-content"></a>justify-content</h4><p><code>justify-content</code> å®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚</p><ul><li><code>flex-start</code>ï¼ˆé»˜è®¤ï¼‰ï¼šä¸ä¸»è½´çš„èµ·ç‚¹å¯¹é½ï¼›</li><li><code>flex-end</code>ï¼šä¸ä¸»è½´çš„ç»ˆç‚¹å¯¹é½ï¼›</li><li><code>center</code>ï¼šé¡¹ç›®å±…ä¸­ï¼›</li><li><code>space-between</code>ï¼šä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„è·ç¦»éƒ½ç›¸ç­‰ï¼›</li><li><code>space-around</code>ï¼šæ¯ä¸ªé¡¹ç›®çš„ä¸¤ä¾§é—´éš”ç›¸ç­‰ï¼Œæ‰€ä»¥é¡¹ç›®ä¸é¡¹ç›®ä¹‹é—´çš„é—´éš”æ˜¯é¡¹ç›®ä¸è¾¹æ¡†ä¹‹é—´é—´éš”çš„ä¸¤å€ã€‚</li></ul><h4 id="align-items"><a href="#align-items" class="headerlink" title="align-items"></a>align-items</h4><p><code>align-items </code>å®šä¹‰äº†é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚</p><ul><li><code>flex-start</code>ï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ï¼›</li><li><code>flex-end</code>ï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ï¼›</li><li><code>center</code>ï¼šå±…ä¸­å¯¹é½ï¼›</li><li><code>baseline</code>ï¼šé¡¹ç›®ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ï¼›</li><li><code>stretch</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è€…ä¸º autoï¼Œé¡¹ç›®å°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</li></ul><h4 id="align-content"><a href="#align-content" class="headerlink" title="align-content"></a>align-content</h4><p><code>align-content</code> å®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ï¼Œè‹¥æ­¤æ—¶ä¸»è½´åœ¨æ°´å¹³æ–¹å‘ï¼Œäº¤å‰è½´åœ¨å‚ç›´æ–¹å‘ï¼Œalign-content å°±å¯ä»¥ç†è§£ä¸ºå¤šè¡Œåœ¨å‚ç›´æ–¹å‘çš„å¯¹é½æ–¹å¼ã€‚é¡¹ç›®æ’åˆ—åªæœ‰ä¸€è¡Œæ—¶ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚</p><ul><li><code>flex-start</code>ï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ï¼›</li><li><code>flex-end</code>ï¼š ä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ï¼›</li><li><code>center</code>ï¼šå±…ä¸­å¯¹é½ï¼›</li><li><code>space-between</code>ï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„è·ç¦»ç›¸ç­‰ï¼›</li><li><code>space-around</code>ï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ï¼Œæ‰€ä»¥è½´çº¿ä¸è½´çº¿ä¹‹é—´çš„é—´éš”æ˜¯è½´çº¿ä¸è¾¹æ¡†ä¹‹é—´é—´éš”çš„ä¸¤å€ï¼›</li><li><code>stretch</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è€…ä¸º <code>auto</code>ï¼Œé¡¹ç›®å°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</li></ul><h2 id="é¡¹ç›®å±æ€§"><a href="#é¡¹ç›®å±æ€§" class="headerlink" title="é¡¹ç›®å±æ€§"></a>é¡¹ç›®å±æ€§</h2><p>å¯¹é¡¹ç›®è®¾ç½®å±æ€§ï¼Œå¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶ Flex å¸ƒå±€ã€‚ä»¥ä¸‹å…­ç§å±æ€§å¯ä»¥è®¾ç½®åœ¨é¡¹ç›®ä¸Šï¼š</p><ul><li><code>order</code></li><li><code>flex-grow</code></li><li><code>flex-shrink</code></li><li><code>flex-basis</code></li><li><code>flex</code></li><li><code>align-self</code></li></ul><h4 id="order"><a href="#order" class="headerlink" title="order"></a>order</h4><p><code>order</code> å®šä¹‰äº†é¡¹ç›®çš„æ’åˆ—é¡ºåºï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œæ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.item</span> &#123;<br>    <span class="hljs-attribute">order</span>: &lt;integer&gt;;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027665.png" alt="img"></p><p>ï¼ˆç»™ç¬¬ä¸‰ä¸ªé¡¹ç›®è®¾ç½®äº† order: -1ï¼› åï¼Œè¯¥é¡¹ç›®æ’åˆ°äº†æœ€å‰é¢ï¼‰</p><h4 id="flex-grow"><a href="#flex-grow" class="headerlink" title="flex-grow"></a>flex-grow</h4><p><code>flex-grow</code> å®šä¹‰äº†é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º <code>0</code>ï¼Œä¹Ÿå°±æ˜¯å³ä½¿å­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸ä¼šæ”¾å¤§ã€‚</p><p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„ <code>flex-grow</code> éƒ½ä¸º <code>1</code>ï¼Œåˆ™æ‰€æœ‰é¡¹ç›®å¹³åˆ†å‰©ä½™ç©ºé—´ï¼›</p><p>å¦‚æœå…¶ä¸­æŸä¸ªé¡¹ç›®çš„ <code>flex-grow </code>ä¸º <code>2</code>ï¼Œå…¶ä½™é¡¹ç›®çš„<code> flex-grow</code> ä¸º <code>1</code>ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´æ¯”å…¶ä»–é¡¹ç›®å¤šä¸€å€ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.item</span> &#123;<br>    <span class="hljs-attribute">flex-grow</span>: &lt;number&gt;;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027684.png" alt="img"></p><p>ï¼ˆæ‰€æœ‰é¡¹ç›®çš„ flex-grow éƒ½ä¸º 1ï¼Œå¹³åˆ†å‰©ä½™ç©ºé—´ï¼‰</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027720.png" alt="img"></p><p>ï¼ˆflex-grow å±æ€§å€¼è¶Šå¤§ï¼Œæ‰€å å‰©ä½™ç©ºé—´è¶Šå¤§ï¼‰</p><h4 id="flex-shrink"><a href="#flex-shrink" class="headerlink" title="flex-shrink"></a>flex-shrink</h4><p><code>flex-shrink</code> å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º 1ï¼Œå³å½“ç©ºé—´ä¸è¶³æ—¶ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨ç¼©å°ã€‚</p><p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„ <code>flex-shrink </code>éƒ½ä¸º 1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œæ‰€æœ‰é¡¹ç›®éƒ½å°†ç­‰æ¯”ç¼©å°ï¼›</p><p>å¦‚æœå…¶ä¸­ä¸€ä¸ªé¡¹ç›®çš„ <code>flex-shrink</code> ä¸º 0ï¼Œå…¶ä½™éƒ½ä¸º 1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œ<code>flex-shrink </code>ä¸º 0 çš„ä¸ç¼©å°ã€‚</p><p>è´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.item</span> &#123;<br>    <span class="hljs-attribute">flex-shrink</span>: &lt;number&gt;ï¼›<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027736.png" alt="img"></p><p>ï¼ˆç©ºé—´ä¸è¶³æ—¶ï¼Œé»˜è®¤ç­‰æ¯”ç¼©å°ï¼‰</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027651.png" alt="img"></p><p>ï¼ˆflex-shrink ä¸º 0 çš„ä¸ç¼©å°ï¼‰</p><h4 id="flex-basis"><a href="#flex-basis" class="headerlink" title="flex-basis"></a>flex-basis</h4><p><code>flex-basis </code>å®šä¹‰äº†åœ¨åˆ†é…å¤šä½™çš„ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼Œé»˜è®¤å€¼ä¸º<code> auto</code>ï¼Œå³é¡¹ç›®åŸæ¥çš„å¤§å°ã€‚</p><p>æµè§ˆå™¨ä¼šæ ¹æ®è¿™ä¸ªå±æ€§æ¥è®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™çš„ç©ºé—´ã€‚</p><p><code>flex-basis</code> çš„è®¾ç½®è·Ÿ <code>width</code> æˆ– <code>height </code>ä¸€æ ·ï¼Œå¯ä»¥æ˜¯åƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯ç™¾åˆ†æ¯”ã€‚</p><p>è®¾ç½®äº† <code>flex-basis</code> ä¹‹åï¼Œå®ƒçš„ä¼˜å…ˆçº§æ¯” <code>width</code> æˆ– <code>height</code> é«˜ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.item</span> &#123;<br>    <span class="hljs-attribute">flex-basis</span>: &lt;length&gt; | auto;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027759.png" alt="img"></p><p>ï¼ˆä¸åŒçš„ flex-basis å€¼æ•ˆæœå±•ç¤ºï¼‰</p><h4 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h4><p><code>flex</code> å±æ€§æ˜¯ <code>flex-growã€flex-shrinkã€flex-basis</code> çš„ç¼©å†™ï¼Œé»˜è®¤å€¼æ˜¯ <code>0 1 auto</code>ï¼Œåä¸¤ä¸ªå±æ€§å¯é€‰ã€‚</p><p>è¯¥å±æ€§æœ‰ä¸¤ä¸ªå¿«æ·å€¼ï¼š<code>autoï¼ˆ1 1 autoï¼‰</code>å’Œ <code>noneï¼ˆ0 0 autoï¼‰</code>ã€‚</p><p><code>auto</code> ä»£è¡¨åœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥æ‹‰ä¼¸ä¹Ÿå¯ä»¥æ”¶ç¼©ï¼Œ<code>none</code>è¡¨ç¤ºæ—¢ä¸èƒ½æ‹‰ä¼¸ä¹Ÿä¸èƒ½æ”¶ç¼©ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.item</span> &#123;<br>    <span class="hljs-attribute">flex</span>: auto | none | [ &lt;<span class="hljs-string">&#x27;flex-grow&#x27;</span>&gt; &lt;<span class="hljs-string">&#x27;flex-shrink&#x27;</span>&gt;? || &lt;<span class="hljs-string">&#x27;flex-basis&#x27;</span>&gt; ]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="align-self"><a href="#align-self" class="headerlink" title="align-self"></a>align-self</h4><p><code>align-self </code>ç”¨æ¥å®šä¹‰å•ä¸ªé¡¹ç›®ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯ä»¥è¦†ç›– <code>align-items</code> å±æ€§ã€‚</p><p>é»˜è®¤å±æ€§å€¼æ˜¯ <code>auto</code>ï¼Œå³ç»§æ‰¿çˆ¶å…ƒç´ çš„ <code>align-items</code> å±æ€§å€¼ã€‚å½“æ²¡æœ‰çˆ¶å…ƒç´ æ—¶ï¼Œå®ƒçš„è¡¨ç°ç­‰åŒäº <code>stretch</code>ã€‚</p><p><code>align-self </code>çš„å…­ä¸ªå¯èƒ½å±æ€§å€¼ï¼Œé™¤äº† <code>auto </code>ä¹‹å¤–ï¼Œå…¶ä»–çš„è¡¨ç°å’Œ <code>align-items</code> ä¸€æ ·ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.item</span> &#123;<br>    <span class="hljs-attribute">align-self</span>: auto | flex-start | flex-end | center | baseline | stretch;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027302.png" alt="img"></p><p>ï¼ˆç¬¬ä¸‰ä¸ªé¡¹ç›®çš„å¯¹é½æ–¹å¼ä¸å…¶ä»–ä¸åŒï¼‰</p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><ul><li>å½“æˆ‘ä»¬ä¸ºçˆ¶ç›’å­è®¾ä¸º<code>flex</code>å¸ƒå±€ä¹‹åï¼Œå­å…ƒç´ çš„<code>float</code>ï¼Œ<code>clear</code>å’Œ<code>vertical-align</code>å±æ€§å°†å¤±æ•ˆ</li><li><code>align-items</code>æ˜¯å•è¡Œï¼Œ<code>align-content</code>æ˜¯å¤šè¡Œ</li></ul><p><code>flex</code>å±æ€§æ˜¯<code>flex-grow</code>ï¼Œ<code>flex-shrink</code>å’Œ<code>flex-basis</code>çš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º<code>0 1 auto</code>ã€‚</p><ul><li><code>flex-grow</code>æ˜¯å¦‚æœæœ‰å‰©ä½™ç©ºé—´ï¼Œæ˜¯å¦æ‰©å¤§ï¼Œ<code>1</code>ä¸ºæ‰©å¤§</li><li><code>flex-shrink</code>æ˜¯å¦‚æœå‰©ä½™ç©ºé—´ä¸å¤Ÿï¼Œæ˜¯å¦ç¼©å°ï¼Œ<code>1</code>ä¸ºç¼©å°</li><li><code>flex-basis</code>ä¸ºé¡¹ç›®æœ¬èº«çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯<code>auto</code></li></ul><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027272.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-direction</span>: column;<br>  <span class="hljs-attribute">justify-content</span>: space-between;<br>  <span class="hljs-attribute">align-items</span>: flex-end;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027277.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>&#125;<br><br><span class="hljs-selector-class">.item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) &#123;<br>  <span class="hljs-attribute">align-self</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027296.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>: space-between;<br>&#125;<br><br><span class="hljs-selector-class">.item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) &#123;<br>  <span class="hljs-attribute">align-self</span>: flex-end;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027278.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>&#125;<br><br><span class="hljs-selector-class">.item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) &#123;<br>  <span class="hljs-attribute">align-self</span>: center;<br>&#125;<br><br><span class="hljs-selector-class">.item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) &#123;<br>  <span class="hljs-attribute">align-self</span>: flex-end;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027287.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>  <span class="hljs-attribute">justify-content</span>: flex-end;<br>  <span class="hljs-attribute">align-content</span>: space-between;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027769.png" alt="img"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;column&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;column&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>  <span class="hljs-attribute">align-content</span>: space-between;<br>&#125;<br><br><span class="hljs-selector-class">.column</span> &#123;<br>  <span class="hljs-attribute">flex-basis</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>: space-between;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027803.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>  <span class="hljs-attribute">align-content</span>: space-between;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027782.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-direction</span>: column;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>  <span class="hljs-attribute">align-content</span>: space-between;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027815.png" alt="img"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>&#125;<br><br><span class="hljs-selector-class">.row</span>&#123;<br>  <span class="hljs-attribute">flex-basis</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">display</span>:flex;<br>&#125;<br><br><span class="hljs-selector-class">.row</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>)&#123;<br>  <span class="hljs-attribute">justify-content</span>: center;<br>&#125;<br><br><span class="hljs-selector-class">.row</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>)&#123;<br>  <span class="hljs-attribute">justify-content</span>: space-between;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027840.png" alt="img"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="â­-flex-å„ä¸ªå€¼çš„åŒºåˆ«"><a href="#â­-flex-å„ä¸ªå€¼çš„åŒºåˆ«" class="headerlink" title="â­ flex å„ä¸ªå€¼çš„åŒºåˆ«"></a>â­ flex å„ä¸ªå€¼çš„åŒºåˆ«</h2><p>ä¸‹é¢æ¥åˆ†åˆ«è®²è®² <code>flex:1</code>ï¼Œ <code>flex:auto</code>ï¼Œ <code>flex:0</code>ï¼Œ <code>flex:none</code>çš„åŒºåˆ«</p><p>flex å±æ€§æ˜¯ <code>flex-grow</code>ã€<code>flex-shrink</code>ã€<code>flex-basis</code> çš„ç¼©å†™ï¼Œé»˜è®¤å€¼æ˜¯ <code>0 1 auto</code>ï¼Œåä¸¤ä¸ªå±æ€§å¯é€‰ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>` : å¯¹åº”çš„æ˜¯`<span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>%`ï¼Œ ç›¸å½“äºå¯æ‰©å¤§ï¼Œå¯ç¼©å°ï¼Œ`flex-basis`ä¸º`<span class="hljs-number">0</span>%<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027937.png" alt="img"></p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs d">flex: <span class="hljs-keyword">auto</span><span class="hljs-string">` :  å¯¹åº”çš„æ˜¯`</span><span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-keyword">auto</span><span class="hljs-string">`ï¼Œ ç›¸å½“äºå¯æ‰©å¤§ï¼Œå¯ç¼©å°ï¼Œ`</span>flex-basis<span class="hljs-string">`ä¸º`</span><span class="hljs-keyword">auto</span><br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027283.png" alt="img"></p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">flex: <span class="hljs-literal">none</span><span class="hljs-string">` : å¯¹åº”çš„æ˜¯`</span><span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-literal">auto</span><span class="hljs-string">`ï¼Œ ç›¸å½“äºä¸å¯æ‰©å¤§ï¼Œä¸å¯ç¼©å°ï¼Œ`</span>flex-basis<span class="hljs-string">`ä¸º`</span><span class="hljs-literal">auto</span><br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027352.png" alt="img"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flex</span>: <span class="hljs-number">0</span>` : å¯¹åº”çš„æ˜¯`<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>%`ï¼Œ ç›¸å½“äºä¸å¯æ‰©å¤§ï¼Œå¯ç¼©å°ï¼Œ`flex-basis`ä¸º`<span class="hljs-number">0</span>%<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311181027342.png" alt="img"></p><p><strong>flex : 1 å’Œ flex : auto çš„åŒºåˆ«</strong></p><p><code>flex: 1</code> ä¸ç®¡å†…å®¹å¤šå°‘ï¼Œä¸€èˆ¬éƒ½æ˜¯å¹³åˆ†ç©ºé—´ï¼Œç©ºé—´å¤§å°éƒ½ä¸€è‡´</p><p><code>flex: auto</code>æ˜¯<strong>æ ¹æ®å†…å®¹çš„å¤§å°æ¥åˆ†</strong>ï¼Œä¸æ˜¯å‡åˆ†çš„ï¼ˆé™¤éå†…å®¹éƒ½æ˜¯ä¸€æ ·ï¼Œæ‰å‡åˆ†ï¼‰</p><p><strong>flex: 0 å’Œ flex: none çš„åŒºåˆ«ï¼š</strong></p><p><code>flex: 0</code> ä¸å¯æ‰©å¤§ï¼Œå¯ç¼©å°ï¼Œè¡¨ç°å½¢å¼ä¸º<strong>æœ€å°å†…å®¹å®½åº¦</strong>ï¼Œ ä¸Šå›¾ä½ å¯ä»¥çœ‹åˆ° div çš„å®½åº¦å°±æ˜¯ä¸€ä¸ªå­—çš„å®½åº¦</p><p>è€Œ<code>flex: none</code> ä¸å¯æ‰©å¤§ï¼Œä¸å¯ç¼©å°ï¼Œå†…å®¹æœ¬èº«çš„å®½åº¦æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘</p>]]></content>
    
    
    <categories>
      
      <category>css</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¸ƒå±€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cookie/session/token/jwtåˆ†æ¸…æ¥šæ²¡?</title>
    <link href="/2023/11/17/jwt_token/"/>
    <url>/2023/11/17/jwt_token/</url>
    
    <content type="html"><![CDATA[<h2 id="è®¤è¯å’Œæˆæƒ"><a href="#è®¤è¯å’Œæˆæƒ" class="headerlink" title="è®¤è¯å’Œæˆæƒ"></a>è®¤è¯å’Œæˆæƒ</h2><p><strong>è®¤è¯</strong></p><p>æŒ‡çš„æ˜¯ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç æ¥éªŒè¯å½“å‰ç”¨æˆ·çš„èº«ä»½ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç”¨æˆ·ç™»é™†ã€‚</p><blockquote><p>äº’è”ç½‘ä¸­çš„è®¤è¯ï¼š</p></blockquote><ul><li>ç”¨æˆ·åå¯†ç ç™»å½•</li><li>é‚®ç®±å‘é€ç™»å½•é“¾æ¥</li><li>æ‰‹æœºå·æ¥æ”¶éªŒè¯ç </li><li>åªè¦ä½ èƒ½æ”¶åˆ°é‚®ç®±&#x2F;éªŒè¯ç ï¼Œå°±é»˜è®¤ä½ æ˜¯è´¦å·çš„ä¸»äºº</li></ul><p><strong>æˆæƒ</strong></p><p>æŒ‡å½“ç”¨æˆ·ç™»é™†ä»¥åï¼Œå½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®ç‰¹å®šçš„èµ„æºã€‚</p><p>å®ç°æˆæƒçš„æ–¹å¼æœ‰ï¼š<code>cookie</code>ã€<code>session</code>ã€<code>token</code>ã€<code>OAuth</code></p><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p><strong>ä¸ºä»€ä¹ˆä¼šå‡ºç°Cookie?</strong></p><p>HTTP æ˜¯æ— çŠ¶æ€çš„åè®®ï¼ˆå¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼šè¯å®Œæˆæ—¶ï¼ŒæœåŠ¡ç«¯ä¸ä¼šä¿å­˜ä»»ä½•ä¼šè¯ä¿¡æ¯)</p><p>æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼ŒæœåŠ¡ç«¯æ— æ³•ç¡®è®¤å½“å‰è®¿é—®è€…çš„èº«ä»½ä¿¡æ¯ï¼Œæ— æ³•åˆ†è¾¨ä¸Šä¸€æ¬¡çš„è¯·æ±‚å‘é€è€…å’Œè¿™ä¸€æ¬¡çš„å‘é€è€…æ˜¯ä¸æ˜¯åŒä¸€ä¸ªäººã€‚</p><p>æ‰€ä»¥æœåŠ¡å™¨ä¸æµè§ˆå™¨ä¸ºäº†è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼ˆçŸ¥é“æ˜¯è°åœ¨è®¿é—®æˆ‘ï¼‰ï¼Œå°±å¿…é¡»ä¸»åŠ¨çš„å»ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯å‰åä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚</p><p>è€Œè¿™ä¸ªçŠ¶æ€éœ€è¦é€šè¿‡ <code>cookie</code> æˆ–è€… <code>session</code> å»å®ç°ã€‚</p><p><strong>Cookieçš„åˆ›å»º</strong></p><p>å½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘å‡ºçš„ <code>HTTP</code> è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€å¸¦æœ‰å“åº”çš„ <code>Set-Cookie</code> æ ‡å¤´ï¼Œ<code>Cookie</code> é€šå¸¸<strong>ç”±æµè§ˆå™¨å­˜å‚¨</strong>ï¼Œç„¶åå°† <code>Cookie</code> ä¸ <code>HTTP</code> æ ‡å¤´ä¸€åŒå‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚</p><p>éšç€å¯¹æœåŠ¡å™¨çš„æ¯ä¸ªæ–°è¯·æ±‚ï¼Œæµè§ˆå™¨å°†ä½¿ç”¨ <code>Cookie</code> å¤´å°†æ‰€æœ‰ä»¥å‰å­˜å‚¨çš„ <code>Cookie</code> å‘é€å›æœåŠ¡å™¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">//æœåŠ¡ç«¯</span><br><span class="hljs-title class_">Set</span>-<span class="hljs-title class_">Cookie</span>: ...<br><br><span class="hljs-comment">//å®¢æˆ·ç«¯</span><br><span class="hljs-title class_">Cookie</span>: ...<br></code></pre></td></tr></table></figure><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p><strong>ä»€ä¹ˆæ˜¯Session?</strong></p><p>session æ˜¯å¦ä¸€ç§è®°å½•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯<strong>ä¼šè¯çŠ¶æ€</strong>çš„æœºåˆ¶</p><p>session æ˜¯åŸºäº cookie å®ç°çš„ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒsessionId ä¼šè¢«å­˜å‚¨åˆ°å®¢æˆ·ç«¯çš„cookie ä¸­</p><p><strong>Sessionè®¤è¯æµç¨‹</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311172338258.png" alt="img"></p><ul><li>ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æ ¹æ®ç”¨æˆ·æäº¤çš„ç›¸å…³ä¿¡æ¯ï¼Œåˆ›å»ºå¯¹åº”çš„ <code>Session</code></li><li>è¯·æ±‚è¿”å›æ—¶å°†æ­¤ <code>Session</code> çš„å”¯ä¸€æ ‡è¯†ä¿¡æ¯ <code>SessionID</code> è¿”å›ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ <code>SessionID</code> ä¿¡æ¯åï¼Œä¼šå°†æ­¤ä¿¡æ¯å­˜å…¥åˆ° <code>Cookie</code> ä¸­ï¼ŒåŒæ—¶ <code>Cookie</code> è®°å½•æ­¤ <code>SessionID</code> å±äºå“ªä¸ªåŸŸåã€‚</li><li>å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨åˆ¤æ–­æ­¤åŸŸåä¸‹æ˜¯å¦å­˜åœ¨ <code>Cookie</code> ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨è‡ªåŠ¨å°† <code>Cookie</code> ä¿¡æ¯ä¹Ÿå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä» <code>Cookie</code> ä¸­è·å– <code>SessionID</code>ï¼Œå†æ ¹æ® <code>SessionID</code> æŸ¥æ‰¾å¯¹åº”çš„ <code>Session</code> ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç™»å½•å¤±æ•ˆï¼Œå¦‚æœæ‰¾åˆ° <code>Session</code> è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•å¯æ‰§è¡Œåé¢æ“ä½œã€‚</li></ul><blockquote><p>æ ¹æ®ä»¥ä¸Šæµç¨‹å¯çŸ¥ï¼Œ<code>SessionID</code> æ˜¯è¿æ¥ <code>Cookie</code> å’Œ <code>Session</code> çš„ä¸€é“æ¡¥æ¢ï¼Œå¤§éƒ¨åˆ†ç³»ç»Ÿä¹Ÿæ˜¯æ ¹æ®æ­¤åŸç†æ¥éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚</p></blockquote><h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h2><p><strong>ä»€ä¹ˆæ˜¯Token?</strong></p><p>è®¿é—®èµ„æºæ¥å£ (api)  æ—¶æ‰€éœ€è¦çš„èµ„æºå‡­è¯</p><blockquote><p>ç®€å• <code>token</code> çš„ç»„æˆï¼š  </p></blockquote><ul><li>uid : ç”¨æˆ·å”¯ä¸€çš„èº«ä»½æ ‡è¯†</li><li>time : å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³</li><li>sign : ç­¾åï¼Œtoken çš„å‰å‡ ä½ä»¥å“ˆå¸Œç®—æ³•å‹ç¼©æˆçš„ä¸€å®šé•¿åº¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²</li></ul><p><strong>Token çš„èº«ä»½éªŒè¯æµç¨‹</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311172338267.png" alt="img"></p><ul><li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè·Ÿå¯†ç è¯·æ±‚ç™»å½•</li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå»éªŒè¯ç”¨æˆ·åä¸å¯†ç </li><li>éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç­¾å‘ä¸€ä¸ª <code>token</code> å¹¶æŠŠè¿™ä¸ª <code>token</code> å‘é€ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯æ”¶åˆ° token ä»¥åï¼Œä¼šæŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚æ”¾åœ¨ cookie é‡Œæˆ–è€… localStorage é‡Œ</li><li>å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºçš„æ—¶å€™éœ€è¦å¸¦ç€æœåŠ¡ç«¯ç­¾å‘çš„ token</li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„ token ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚çš„æ•°æ®</li></ul><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p><strong>ä»€ä¹ˆæ˜¯JWT?</strong></p><p>JSON Web Tokenï¼ˆç®€ç§° JWTï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆã€‚</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311172338321.png" alt="img"></p><ol><li>ç”¨æˆ·ç™»é™†ï¼Œç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»é™†ï¼Œå¦‚æœç™»é™†æˆåŠŸï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›ä¸€ä¸ªåŠ å¯†æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£å°±æ˜¯<code>jwt</code>ï¼Œå…¶ä¸­åŒ…å«é™¤äº†ç”¨æˆ·å¯†ç ä»¥å¤–çš„å…¨éƒ¨çš„è®¤è¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€emailã€è§’è‰²ã€æƒé™ç­‰ç­‰ï¼Œè€Œå®¢æˆ·ç«¯åœ¨æ‹¿åˆ°<code>jwt</code>ä»¥åå°±å¯ä»¥æŠŠå®ƒä¿å­˜èµ·æ¥äº†ï¼Œå¯ä»¥ä¿å­˜<code>cookie</code>ä¸­ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åœ¨<code>LocalStorage</code>é‡Œé¢ï¼Œè€Œç”Ÿæˆ<code>jwt</code>ä»¥åä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šä¿å­˜ã€‚</li><li>ç”¨æˆ·éœ€è¦è®¿é—®æŸäº›èµ„æºï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·éœ€è¦æŠŠ<code>jwt</code>æ”¾åœ¨<code>http</code>è¯·æ±‚çš„<code>header</code>ä¸­ï¼Œä¸<code>http</code>è¯·æ±‚ä¸€åŒå‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å–å¾—<code>jwt</code>ä»¥åï¼Œä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥ç»™ç»™<code>jwt</code>æ–‡æ¡£è§£å¯†ï¼Œå¦‚æœè§£å¯†æˆåŠŸè€Œä¸”æ•°æ®ä¾ç„¶æœ‰æ•ˆï¼Œåˆ™ä»£è¡¨ç”¨æˆ·å·²ç»ç™»é™†äº†ï¼Œå¦‚æœ<code>jwt</code>æ‰€æè¿°çš„ç”¨æˆ·æƒé™å…è®¸è¯¥ç”¨æˆ·è®¿é—®èµ„æºï¼ŒæœåŠ¡å™¨å°±ä¼šæŠŠèµ„æºä¿¡æ¯é€šè¿‡<code>http</code>å“åº”å‘é€å›åˆ°å®¢æˆ·ç«¯ã€‚</li></ol><p><strong>ä»€ä¹ˆæ—¶å€™ç”¨JWT?</strong></p><p>å­¦æ ¡æ–°å»ºäº†ä¸€ä¸ªå›¾ä¹¦é¦†ç³»ç»Ÿ, å­¦æ ¡å¸Œæœ›è¿™ä¸ªç³»ç»Ÿå¯ä»¥æ— ç¼è¡”æ¥å­¦ç”Ÿç³»ç»Ÿï¼Œä½¿ç”¨åŒä¸€å¥—è´¦æˆ·ï¼Œåœ¨å­¦ç”Ÿç³»ç»Ÿä¸­ç™»å½•ä»¥åå°±èƒ½ç›´æ¥è¿›å…¥å›¾ä¹¦é¦†ç³»ç»Ÿã€‚</p><ul><li><strong>ä½¿ç”¨ä¼ ç»Ÿçš„sessionéªŒè¯æ–¹å¼</strong>ï¼Œå¿…é¡»åœ¨å­¦ç”Ÿç³»ç»Ÿå’Œå›¾ä¹¦é¦†ç³»ç»Ÿéƒ½å„è‡ªåˆ›å»ºä¸€å¥—<code>session</code>æ‰èƒ½å®ç°ç™»å½•ï¼Œè€Œå„è‡ªçš„<code>session</code>æ— æ³•å½¢æˆæœ‰æ•ˆçš„è”ç³»ï¼Œæ‰€ä»¥åœ¨æœ€åº•å±‚åˆ›å»ºä¸€ä¸ªå•ç‚¹ç™»å½•ç³»ç»Ÿï¼Œä¸ç®¡å­¦ç”Ÿè®¿é—®å“ªä¸ªç³»ç»Ÿï¼Œéƒ½ä¼šè¿æ¥åˆ°å•ç‚¹ç™»å½•ç³»ç»Ÿè¿›è¡Œ<code>session</code>çš„éªŒè¯ï¼Œå½“å­¦ç”Ÿçš„ç™»å½•ä¿¡æ¯éªŒè¯æˆåŠŸä»¥åï¼Œå•ç‚¹ç™»å½•ç³»ç»Ÿä¼šåšä¸€ä¸ªé‡å®šå‘ï¼ŒæŠŠæµé‡å¼•å¯¼è‡³ç›¸åº”çš„ç³»ç»Ÿä¸­ã€‚è¿™æ ·å°±å¯ä»¥å®ç°è¿™å­¦ç”Ÿç³»ç»Ÿå’Œå›¾ä¹¦é¦†ç³»ç»Ÿçš„æ— ç¼è¿æ¥ã€‚ä½†æ˜¯ï¼Œå•ç‚¹ç™»å½•ç³»ç»Ÿåœ¨ä½¿ç”¨åˆ†å¸ƒå¼éƒ¨ç½²çš„æ—¶å€™åˆè¦è€ƒè™‘ä¸åŒçš„æœåŠ¡å™¨ä¹‹é—´<code>session</code>çš„ä¸€è‡´æ€§ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿæ¶æ„éå¸¸å¤æ‚ã€‚</li></ul><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311172338304.png" alt="img"></p><ul><li>ä½¿ç”¨çš„**<code>jwt</code>**çš„éªŒè¯æ–¹å¼ï¼Œé‚£ä¹ˆæƒ³è¦æ‹“å±•ç³»ç»Ÿç®€ç›´å°±æ˜¯æ˜“å¦‚åæŒã€‚å› ä¸º<code>jwt</code>ä¸ä¼šä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥æœåŠ¡å™¨å¦‚ä½•éƒ¨ç½²å®Œå…¨ä¸ä¼šå½±å“åˆ°<code>jwt</code>çš„ä½¿ç”¨ã€‚å­¦ç”Ÿç™»å½•å®Œæˆä»¥åï¼ŒæŠŠ<code>jwt</code>ä¿¡æ¯ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œéœ€è¦è®¿é—®å­¦ä¹ ç³»ç»Ÿæˆ–å›¾ä¹¦é¦†ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¼šå‘æœåŠ¡å™¨å‘é€å¸¦æœ‰<code>jwt</code>çš„è¯·æ±‚ï¼Œå­¦ç”Ÿç³»ç»Ÿå’Œå›¾ä¹¦é¦†ç³»ç»Ÿåªéœ€è¦ä½¿ç”¨ç›¸åŒçš„ç§é’¥æ¥éªŒè¯<code>token</code>ï¼ŒéªŒè¯æˆåŠŸä»¥åï¼Œå°±å¯ä»¥é€šè¿‡<code>token</code>ä¸­ç”¨æˆ·çš„æƒé™ç»™ä¸åŒçš„ç”¨æˆ·è¾“å‡ºä¸åŒçš„æ•°æ®ã€‚</li></ul><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311172338335.png" alt="img"></p><p><strong>JWTçš„ä¼˜åŠ¿</strong></p><ul><li>æ— çŠ¶æ€ç™»å½•ï¼Œç®€åŒ–æœåŠ¡å™¨çš„ç”¨æˆ·éªŒè¯æµç¨‹ï¼ŒåŒæ—¶å®Œç¾æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚</li><li>ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œåªè¦ç§é’¥ä¸æ³„éœ²ï¼Œå¯ä»¥ä¿è¯<code>token</code>æ˜¯ç»å¯¹å®‰å…¨çš„ã€‚</li></ul><p><strong>JWTçš„ç¼ºé™·</strong></p><ul><li><code>jwt token</code>ä¸€ç»å‘å¸ƒå°±æ— æ³•æŒ½å›äº†ï¼Œå› ä¸ºå…·æœ‰æ— çŠ¶æ€çš„ç‰¹å¾ï¼Œæ‰€ä»¥åœ¨å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ä¹Ÿæ— æ³•è¢«æœåŠ¡ç¦ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç”¨æˆ·è‡ªèº«å› ä¸ºæŸäº›åŸå› å¯¼è‡´<code>token</code>è¢«é»‘å®¢çªƒå–ï¼Œé‚£ä¹ˆé»‘å®¢å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ª<code>token</code>æ¥ä¼ªè£…ç™»å½•ï¼Œè€ŒæœåŠ¡ç«¯å¯¹æ­¤æ²¡æœ‰ä»»ä½•åŠæ³•ï¼Œåªèƒ½ç­‰å¾…<code>token</code>è¿‡æœŸå¤±æ•ˆã€‚</li><li><code>jwt</code>çš„å‰ä¸¤ä¸ªéƒ¨åˆ†å…¶å®å¹¶æ²¡æœ‰åŠ å¯†ï¼Œä»…ä»…ä½¿ç”¨äº†<code>base64</code>æ¥ç¼–ç è€Œå·²ï¼Œä¹Ÿå°±æ˜¯è¯´<code>jwt</code>çš„ç”¨æˆ·ä¿¡æ¯ç­‰äºæ˜¯æ˜æ–‡ä¼ é€’çš„ï¼Œå¾ˆå®¹æ˜“é€ æˆç”¨æˆ·çš„ä¿¡æ¯æ³„éœ²ã€‚</li></ul><blockquote><p>æœ¬æ–‡è½¬è½½è‡ª<a href="https://juejin.cn/post/7167718864447340558#heading-15">â¤ï¸â¤ï¸åŒ…æ•™åŒ…ä¼šâ€”â€”Cookieã€Sessionã€Tokenã€JWT - æ˜é‡‘</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æµè§ˆå™¨åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æˆæƒæœºåˆ¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½ çŸ¥é“ HTTP ä»£ç†/ä»£ç†ç¼“å­˜å—?</title>
    <link href="/2023/11/13/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98/"/>
    <url>/2023/11/13/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚ä½•ç†è§£-HTTP-ä»£ç†"><a href="#å¦‚ä½•ç†è§£-HTTP-ä»£ç†" class="headerlink" title="å¦‚ä½•ç†è§£ HTTP ä»£ç†?"></a>å¦‚ä½•ç†è§£ HTTP ä»£ç†?</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨ HTTP æ˜¯åŸºäºè¯·æ±‚-å“åº”æ¨¡å‹çš„åè®®ï¼Œä¸€èˆ¬ç”±å®¢æˆ·ç«¯å‘è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥è¿›è¡Œå“åº”ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯ä»£ç†æœåŠ¡å™¨çš„æƒ…å†µã€‚å¼•å…¥ä»£ç†ä¹‹åï¼Œä½œä¸ºä»£ç†çš„æœåŠ¡å™¨ç›¸å½“äºä¸€ä¸ªä¸­é—´äººçš„è§’è‰²ï¼Œå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œè¡¨ç°ä¸ºæœåŠ¡å™¨è¿›è¡Œå“åº”ï¼›è€Œå¯¹äºæºæœåŠ¡å™¨ï¼Œè¡¨ç°ä¸ºå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼Œå…·æœ‰<strong>åŒé‡èº«ä»½</strong>ã€‚</p><h4 id="ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½"><a href="#ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½" class="headerlink" title="ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½"></a>ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½</h4><ol><li><strong>è´Ÿè½½å‡è¡¡</strong>ã€‚å®¢æˆ·ç«¯çš„è¯·æ±‚åªä¼šå…ˆåˆ°è¾¾ä»£ç†æœåŠ¡å™¨ï¼Œåé¢åˆ°åº•æœ‰å¤šå°‘æºæœåŠ¡å™¨ï¼ŒIP éƒ½æ˜¯å¤šå°‘ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸çŸ¥é“çš„ã€‚å› æ­¤ï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨å¯ä»¥æ‹¿åˆ°è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šçš„ç®—æ³•åˆ†å‘ç»™ä¸åŒçš„æºæœåŠ¡å™¨ï¼Œè®©å„å°æºæœåŠ¡å™¨çš„è´Ÿè½½å°½é‡å¹³å‡ã€‚å½“ç„¶ï¼Œè¿™æ ·çš„ç®—æ³•æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬<strong>éšæœºç®—æ³•</strong>ã€<strong>è½®è¯¢</strong>ã€<strong>ä¸€è‡´æ€§hash</strong>ã€<strong>LRU</strong><code>(æœ€è¿‘æœ€å°‘ä½¿ç”¨)</code>ç­‰ç­‰ã€‚</li><li><strong>ä¿éšœå®‰å…¨</strong>ã€‚åˆ©ç”¨<strong>å¿ƒè·³</strong>æœºåˆ¶ç›‘æ§åå°çš„æœåŠ¡å™¨ï¼Œä¸€æ—¦å‘ç°æ•…éšœæœºå°±å°†å…¶è¸¢å‡ºé›†ç¾¤ã€‚å¹¶ä¸”å¯¹äºä¸Šä¸‹è¡Œçš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¯¹éæ³• IP é™æµï¼Œè¿™äº›éƒ½æ˜¯ä»£ç†æœåŠ¡å™¨çš„å·¥ä½œã€‚</li><li><strong>ç¼“å­˜ä»£ç†</strong>ã€‚å°†å†…å®¹ç¼“å­˜åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥ä»ä»£ç†æœåŠ¡å™¨è·å¾—è€Œä¸ç”¨åˆ°æºæœåŠ¡å™¨é‚£é‡Œã€‚</li></ol><h4 id="ç›¸å…³å¤´éƒ¨å­—æ®µ"><a href="#ç›¸å…³å¤´éƒ¨å­—æ®µ" class="headerlink" title="ç›¸å…³å¤´éƒ¨å­—æ®µ"></a><strong>ç›¸å…³å¤´éƒ¨å­—æ®µ</strong></h4><ul><li><code>Via</code></li></ul><p>ä»£ç†æœåŠ¡å™¨éœ€è¦æ ‡æ˜è‡ªå·±çš„èº«ä»½ï¼Œåœ¨ HTTP ä¼ è¾“ä¸­ç•™ä¸‹è‡ªå·±çš„ç—•è¿¹ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ é€šè¿‡<code>Via</code>å­—æ®µæ¥è®°å½•ã€‚</p><blockquote><p>ä¸¾ä¸ªä¾‹å­</p></blockquote><p>ç°åœ¨ä¸­é—´æœ‰ä¸¤å°ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨å®¢æˆ·ç«¯å‘é€è¯·æ±‚åä¼šç»å†è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">å®¢æˆ·ç«¯ -&gt; ä»£ç†<span class="hljs-number">1</span> -&gt; ä»£ç†<span class="hljs-number">2</span> -&gt; æºæœåŠ¡å™¨<br></code></pre></td></tr></table></figure><p>åœ¨æºæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåœ¨è¯·æ±‚å¤´æ‹¿åˆ°è¿™ä¸ªå­—æ®µ:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Via</span>: proxy_server1, proxy_server2<br></code></pre></td></tr></table></figure><p>è€ŒæºæœåŠ¡å™¨å“åº”æ—¶ï¼Œæœ€ç»ˆåœ¨å®¢æˆ·ç«¯ä¼šæ‹¿åˆ°è¿™æ ·çš„å“åº”å¤´:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Via</span>: proxy_server2, proxy_server1<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼ŒViaä¸­ä»£ç†çš„é¡ºåºå³ä¸ºåœ¨ HTTP ä¼ è¾“ä¸­æŠ¥æ–‡ä¼ è¾¾çš„é¡ºåºã€‚</p></blockquote><ul><li><code>X-Forwarded-For</code></li></ul><p>å­—é¢æ„æ€å°±æ˜¯ä¸ºè°è½¬å‘, å®ƒè®°å½•çš„æ˜¯è¯·æ±‚æ–¹çš„<code>IP</code>**åœ°å€ ** (æ³¨æ„ï¼Œå’Œ<code>Via</code>åŒºåˆ†å¼€ï¼Œ<code>X-Forwarded-For</code>è®°å½•çš„æ˜¯è¯·æ±‚æ–¹è¿™ä¸€ä¸ª<code>IP</code>)ã€‚</p><ul><li><p><code>X-Real-IP</code>  : æ˜¯ä¸€ç§è·å–ç”¨æˆ·çœŸå® <code>IP</code> çš„å­—æ®µï¼Œä¸ç®¡ä¸­é—´ç»è¿‡å¤šå°‘ä»£ç†ï¼Œè¿™ä¸ªå­—æ®µå§‹ç»ˆè®°å½•<strong>æœ€åˆçš„å®¢æˆ·ç«¯çš„<code>IP</code>ã€‚</strong></p></li><li><p><code>X-Forwarded-Host</code>ï¼Œè®°å½•<strong>å®¢æˆ·ç«¯ (ä¸åŒ…æ‹¬ä»£ç†) çš„åŸŸå</strong>ã€‚</p></li><li><p><code>X-Forwarded-Proto</code> : è®°å½•<strong>å®¢æˆ·ç«¯(ä¸åŒ…æ‹¬ä»£ç†)çš„åè®®å</strong></p></li></ul><h4 id="X-Forwarded-Foräº§ç”Ÿçš„é—®é¢˜"><a href="#X-Forwarded-Foräº§ç”Ÿçš„é—®é¢˜" class="headerlink" title="X-Forwarded-Foräº§ç”Ÿçš„é—®é¢˜"></a><strong>X-Forwarded-Foräº§ç”Ÿçš„é—®é¢˜</strong></h4><p>å‰é¢å¯ä»¥çœ‹åˆ°ï¼Œ<code>X-Forwarded-For</code>è¿™ä¸ªå­—æ®µè®°å½•çš„æ˜¯è¯·æ±‚æ–¹çš„ IPï¼Œè¿™æ„å‘³ç€æ¯ç»è¿‡ä¸€ä¸ªä¸åŒçš„ä»£ç†ï¼Œè¿™ä¸ªå­—æ®µçš„åå­—éƒ½è¦å˜ï¼Œä»å®¢æˆ·ç«¯åˆ°ä»£ç†1ï¼Œè¿™ä¸ªå­—æ®µæ˜¯å®¢æˆ·ç«¯çš„ IPï¼Œä»ä»£ç†1åˆ°ä»£ç†2ï¼Œè¿™ä¸ªå­—æ®µå°±å˜ä¸ºäº†ä»£ç†1çš„ IPã€‚</p><blockquote><p>ä½†æ˜¯è¿™ä¼šäº§ç”Ÿä¸¤ä¸ªé—®é¢˜:</p></blockquote><ul><li><p>æ„å‘³ç€ä»£ç†å¿…é¡»è§£æ HTTP è¯·æ±‚å¤´ï¼Œç„¶åä¿®æ”¹ï¼Œæ¯”ç›´æ¥è½¬å‘æ•°æ®æ€§èƒ½ä¸‹é™ã€‚</p></li><li><p>åœ¨ HTTPS é€šä¿¡åŠ å¯†çš„è¿‡ç¨‹ä¸­ï¼ŒåŸå§‹æŠ¥æ–‡æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ã€‚</p></li></ul><p>ç”±æ­¤äº§ç”Ÿäº†ä»£ç†åè®®ï¼Œä¸€èˆ¬ä½¿ç”¨æ˜æ–‡ç‰ˆæœ¬ï¼Œåªéœ€è¦åœ¨ <code>HTTP</code> è¯·æ±‚è¡Œä¸Šé¢åŠ ä¸Šè¿™æ ·æ ¼å¼çš„æ–‡æœ¬å³å¯:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// PROXY + TCP4/TCP6 + è¯·æ±‚æ–¹åœ°å€ + æ¥æ”¶æ–¹åœ°å€ + è¯·æ±‚ç«¯å£ + æ¥æ”¶ç«¯å£</span><br><span class="hljs-variable constant_">PROXY</span> <span class="hljs-title class_">TCP4</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span> <span class="hljs-number">1111</span> <span class="hljs-number">2222</span><br><span class="hljs-variable constant_">GET</span> / <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span><br>...<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥è§£å†³<code>X-Forwarded-For</code>å¸¦æ¥çš„é—®é¢˜äº†ã€‚</p><h2 id="ä»£ç†ç¼“å­˜æ˜¯ä»€ä¹ˆ"><a href="#ä»£ç†ç¼“å­˜æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä»£ç†ç¼“å­˜æ˜¯ä»€ä¹ˆ?"></a>ä»£ç†ç¼“å­˜æ˜¯ä»€ä¹ˆ?</h2><blockquote><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜</p></blockquote><p>é¦–å…ˆé€šè¿‡ <code>Cache-Control</code> éªŒè¯å¼ºç¼“å­˜æ˜¯å¦å¯ç”¨</p><ul><li>å¦‚æœå¼ºç¼“å­˜å¯ç”¨ï¼Œç›´æ¥ä½¿ç”¨</li><li>å¦åˆ™è¿›å…¥åå•†ç¼“å­˜ï¼Œå³å‘é€ HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡è¯·æ±‚å¤´ä¸­çš„If-Modified-Sinceæˆ–è€…If-None-Matchè¿™äº›æ¡ä»¶è¯·æ±‚å­—æ®µæ£€æŸ¥èµ„æºæ˜¯å¦æ›´æ–°<ul><li>è‹¥èµ„æºæ›´æ–°ï¼Œè¿”å›èµ„æºå’Œ200çŠ¶æ€ç </li><li>å¦åˆ™ï¼Œè¿”å›304ï¼Œå‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜è·å–èµ„æº</li></ul></li></ul><p>æˆ‘ä»¬è¯´è¯´å¦å¤–ä¸€ç§ç¼“å­˜æ–¹å¼: <strong>ä»£ç†ç¼“å­˜ã€‚</strong></p><h4 id="ä¸ºä»€ä¹ˆäº§ç”Ÿä»£ç†ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆäº§ç”Ÿä»£ç†ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆäº§ç”Ÿä»£ç†ç¼“å­˜ï¼Ÿ"></a><strong>ä¸ºä»€ä¹ˆäº§ç”Ÿä»£ç†ç¼“å­˜ï¼Ÿ</strong></h4><p>å¯¹äºæºæœåŠ¡å™¨æ¥è¯´ï¼Œå®ƒä¹Ÿæ˜¯æœ‰ç¼“å­˜çš„ï¼Œæ¯”å¦‚<code>Redis</code>, <code>Memcache</code>ï¼Œä½†å¯¹äº <code>HTTP</code> ç¼“å­˜æ¥è¯´ï¼Œå¦‚æœæ¯æ¬¡å®¢æˆ·ç«¯ç¼“å­˜å¤±æ•ˆéƒ½è¦åˆ°æºæœåŠ¡å™¨è·å–ï¼Œé‚£ç»™æºæœåŠ¡å™¨çš„å‹åŠ›æ˜¯å¾ˆå¤§çš„ã€‚</p><p>ç”±æ­¤å¼•å…¥äº†ç¼“å­˜ä»£ç†çš„æœºåˆ¶ã€‚è®©ä»£ç†æœåŠ¡å™¨æ¥ç®¡ä¸€éƒ¨åˆ†çš„æœåŠ¡ç«¯<code>HTTP</code>ç¼“å­˜ï¼Œ<strong>å®¢æˆ·ç«¯ç¼“å­˜è¿‡æœŸåå°±è¿‘åˆ°ä»£ç†ç¼“å­˜ä¸­è·å–ï¼Œä»£ç†ç¼“å­˜è¿‡æœŸäº†æ‰è¯·æ±‚æºæœåŠ¡å™¨ï¼Œè¿™æ ·æµé‡å·¨å¤§çš„æ—¶å€™èƒ½æ˜æ˜¾é™ä½æºæœåŠ¡å™¨çš„å‹åŠ›ã€‚</strong></p><blockquote><p>é‚£ç¼“å­˜ä»£ç†ç©¶ç«Ÿæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</p></blockquote><p>æ€»çš„æ¥è¯´ï¼Œç¼“å­˜ä»£ç†çš„æ§åˆ¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯<strong>æºæœåŠ¡å™¨ç«¯çš„æ§åˆ¶</strong>ï¼Œä¸€éƒ¨åˆ†æ˜¯<strong>å®¢æˆ·ç«¯çš„æ§åˆ¶</strong>ã€‚</p><h4 id="æºæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶"><a href="#æºæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶" class="headerlink" title="æºæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶"></a><strong>æºæœåŠ¡å™¨çš„ç¼“å­˜æ§åˆ¶</strong></h4><ul><li><code>private</code> å’Œ <code>public</code></li></ul><p>åœ¨æºæœåŠ¡å™¨çš„å“åº”å¤´ä¸­ï¼Œä¼šåŠ ä¸Š<code>Cache-Control</code>è¿™ä¸ªå­—æ®µè¿›è¡Œç¼“å­˜æ§åˆ¶å­—æ®µï¼Œé‚£ä¹ˆå®ƒçš„å€¼å½“ä¸­å¯ä»¥åŠ å…¥<code>private</code>æˆ–è€…<code>public</code>è¡¨ç¤ºæ˜¯å¦å…è®¸ä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼Œå‰è€…ç¦æ­¢ï¼Œåè€…ä¸ºå…è®¸ã€‚</p><p>æ¯”å¦‚å¯¹äºä¸€äº›éå¸¸ç§å¯†çš„æ•°æ®ï¼Œå¦‚æœç¼“å­˜åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œåˆ«äººç›´æ¥è®¿é—®ä»£ç†å°±å¯ä»¥æ‹¿åˆ°è¿™äº›æ•°æ®ï¼Œæ˜¯éå¸¸å±é™©çš„ï¼Œå› æ­¤å¯¹äºè¿™äº›æ•°æ®ä¸€èˆ¬æ˜¯ä¸ä¼šå…è®¸ä»£ç†æœåŠ¡å™¨è¿›è¡Œç¼“å­˜çš„ï¼Œå°†å“åº”å¤´éƒ¨çš„<code>Cache-Control</code>è®¾ä¸º<code>private</code>ï¼Œè€Œä¸æ˜¯<code>public</code>ã€‚</p><ul><li><code>proxy-revalidate</code></li></ul><p><code>must-revalidate</code>çš„æ„æ€æ˜¯å®¢æˆ·ç«¯ç¼“å­˜è¿‡æœŸå°±å»æºæœåŠ¡å™¨è·å–</p><p><code>proxy-revalidate</code>åˆ™è¡¨ç¤º<strong>ä»£ç†æœåŠ¡å™¨çš„ç¼“å­˜è¿‡æœŸååˆ°æºæœåŠ¡å™¨è·å–</strong>ã€‚</p><ul><li><code>s-maxage</code></li></ul><p>é™å®šäº†<strong>ç¼“å­˜åœ¨ä»£ç†æœåŠ¡å™¨ä¸­å¯ä»¥å­˜æ”¾å¤šä¹…</strong>ï¼Œå’Œé™åˆ¶å®¢æˆ·ç«¯ç¼“å­˜æ—¶é—´çš„<code>max-age</code>å¹¶ä¸å†²çªã€‚</p><blockquote><p>ä¸¾ä¾‹ : æºæœåŠ¡å™¨åœ¨å“åº”å¤´ä¸­åŠ å…¥è¿™æ ·ä¸€ä¸ªå­—æ®µ:</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span>: public, max-age=<span class="hljs-number">1000</span>, s-maxage=<span class="hljs-number">2000</span><br></code></pre></td></tr></table></figure><p>ç›¸å½“äºæºæœåŠ¡å™¨è¯´: æˆ‘è¿™ä¸ªå“åº”æ˜¯å…è®¸ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„ï¼Œå®¢æˆ·ç«¯ç¼“å­˜è¿‡æœŸäº†åˆ°ä»£ç†ä¸­æ‹¿ï¼Œå¹¶ä¸”åœ¨å®¢æˆ·ç«¯çš„ç¼“å­˜æ—¶é—´ä¸º 1000 ç§’ï¼Œåœ¨ä»£ç†æœåŠ¡å™¨ä¸­çš„ç¼“å­˜æ—¶é—´ä¸º 2000 sã€‚</p><h4 id="å®¢æˆ·ç«¯çš„ç¼“å­˜æ§åˆ¶"><a href="#å®¢æˆ·ç«¯çš„ç¼“å­˜æ§åˆ¶" class="headerlink" title="å®¢æˆ·ç«¯çš„ç¼“å­˜æ§åˆ¶"></a><strong>å®¢æˆ·ç«¯çš„ç¼“å­˜æ§åˆ¶</strong></h4><ul><li><code>max-stale</code> å’Œ <code>min-fresh</code> :åœ¨å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¸­ï¼Œå¯ä»¥åŠ å…¥è¿™ä¸¤ä¸ªå­—æ®µï¼Œæ¥å¯¹ä»£ç†æœåŠ¡å™¨ä¸Šçš„ç¼“å­˜è¿›è¡Œå®½å®¹å’Œé™åˆ¶æ“ä½œã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">max-<span class="hljs-attr">stale</span>: <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>è¡¨ç¤ºå®¢æˆ·ç«¯åˆ°ä»£ç†æœåŠ¡å™¨ä¸Šæ‹¿ç¼“å­˜çš„æ—¶å€™ï¼Œå³ä½¿ä»£ç†ç¼“å­˜è¿‡æœŸäº†ä¹Ÿä¸è¦ç´§ï¼Œ<strong>åªè¦è¿‡æœŸæ—¶é—´åœ¨5ç§’ä¹‹å†…ï¼Œè¿˜æ˜¯å¯ä»¥ä»ä»£ç†ä¸­è·å–çš„ã€‚</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">min-<span class="hljs-attr">fresh</span>: <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>è¡¨ç¤ºä»£ç†ç¼“å­˜éœ€è¦ä¸€å®šçš„<strong>æ–°é²œåº¦</strong>ï¼Œä¸è¦ç­‰åˆ°ç¼“å­˜åˆšå¥½åˆ°æœŸå†æ‹¿ï¼Œä¸€å®šè¦åœ¨<strong>åˆ°æœŸå‰ 5 ç§’ä¹‹å‰çš„æ—¶é—´æ‹¿ï¼Œå¦åˆ™æ‹¿ä¸åˆ°ã€‚</strong></p><ul><li><code>only-if-cached</code></li></ul><p>è¿™ä¸ªå­—æ®µåŠ ä¸Šåè¡¨ç¤ºå®¢æˆ·ç«¯<strong>åªä¼šæ¥å—ä»£ç†ç¼“å­˜ï¼Œè€Œä¸ä¼šæ¥å—æºæœåŠ¡å™¨çš„å“åº”ã€‚</strong>å¦‚æœä»£ç†ç¼“å­˜æ— æ•ˆï¼Œåˆ™ç›´æ¥è¿”å›<code>504</code>ï¼ˆGateway Timeoutï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HTTP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰ç«¯äººéƒ½åº”è¯¥çŸ¥é“çš„æ€§èƒ½ä¼˜åŒ–ğŸ“•</title>
    <link href="/2023/11/09/%E6%80%A7%E8%83%BD%E6%A3%80%E6%B5%8B%E4%B8%8E%E4%BC%98%E5%8C%96/"/>
    <url>/2023/11/09/%E6%80%A7%E8%83%BD%E6%A3%80%E6%B5%8B%E4%B8%8E%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.yuque.com/cuggz/feplus/mdg9w2#LL94M">å‰ç«¯æ€§èƒ½ä¼˜åŒ– | ä»€ä¹ˆæ˜¯æ€§èƒ½ä¼˜åŒ– Â· è¯­é›€</a></p><h1 id="æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°"><a href="#æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°"></a>æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°</h1><h3 id="æ€§èƒ½ä¼˜åŒ–çš„å½±å“"><a href="#æ€§èƒ½ä¼˜åŒ–çš„å½±å“" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–çš„å½±å“"></a>æ€§èƒ½ä¼˜åŒ–çš„å½±å“</h3><ul><li><p><strong>ç”¨æˆ·çš„ç•™å­˜</strong> : åŠ è½½è¶Šå¿«, ç”¨æˆ·ç•™å­˜ç‡è¶Šé«˜</p></li><li><p><strong>ç½‘ç«™çš„è½¬åŒ–ç‡</strong> : ç›®æ ‡è¡Œä¸ºè®¿é—®æ¬¡æ•° &#x2F; æ€»è®¿é—®æ¬¡æ•°, æ¯”å¦‚è´­ç‰©</p></li><li><p><strong>ä½“éªŒä¸ä¼ æ’­</strong> : å¥½è¯„&#x2F;å·®è¯„</p></li></ul><h3 id="æ€§èƒ½ä¼˜åŒ–çš„è¯„ä¼°æ¨¡å‹"><a href="#æ€§èƒ½ä¼˜åŒ–çš„è¯„ä¼°æ¨¡å‹" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–çš„è¯„ä¼°æ¨¡å‹"></a>æ€§èƒ½ä¼˜åŒ–çš„è¯„ä¼°æ¨¡å‹</h3><ol><li><p><strong>å“åº”</strong> : ç½‘ç«™å¯¹äºå“åº”æ–¹é¢çš„è¦æ±‚æ˜¯ï¼šåœ¨ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿä¹‹å‰æ¥æ”¶åˆ°æ“ä½œçš„åé¦ˆ , æ¯”å¦‚å¿…é¡»åœ¨ 100ms ä¹‹å†…æ”¶åˆ°åé¦ˆ</p></li><li><p><strong>åŠ¨ç”»</strong> : è¦æ±‚æµç•…,  æœ€å¥½æ§åˆ¶åœ¨ 10ms ä»¥å†…</p></li><li><p><strong>ç©ºé—²</strong> : åˆ©ç”¨ç©ºé—²æ—¶é—´æ¥å¤„ç†å¯å»¶è¿Ÿçš„ä»»åŠ¡, å‡å°‘é¢„åŠ è½½çš„æ•°æ®å¤§å°, ä½¿ç”¨æˆ·æ„ŸçŸ¥ä¸å»¶è¿Ÿ</p></li><li><p>åŠ <strong>è½½</strong> : å…ˆæ¸²æŸ“å…³é”®æ¸²æŸ“è·¯å¾„, ç©ºé—²æ—¶é—´å†æ¸²æŸ“éå…³é”®èµ„æºã€‚</p></li></ol><h3 id="æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡"><a href="#æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡"></a>æ€§èƒ½ä¼˜åŒ–çš„æŒ‡æ ‡</h3><p><strong>æ„Ÿå®˜æŒ‡æ ‡</strong></p><ul><li><p><strong>é¦–æ¬¡ç»˜åˆ¶æ—¶é—´ (FP)</strong> : é¡µé¢é¦–æ¬¡ç»˜åˆ¶çš„æ—¶é—´ç‚¹</p></li><li><p><strong>é¦–æ¬¡æœ‰å†…å®¹ç»˜åˆ¶æ—¶é—´ (FCP)</strong> : æµè§ˆå™¨å®Œæˆæ¸²æŸ“DOMç¬¬ä¸€ä¸ªå†…å®¹çš„æ—¶é—´ç‚¹</p></li><li><p><strong>é¦–æ¬¡æœ‰æ„ä¹‰ç»˜åˆ¶æ—¶é—´ (FMP)</strong> : é¡µé¢å…³é”®å…ƒç´ æ¸²æŸ“æ—¶é—´</p></li><li><p><strong>é¦–å±æ—¶é—´ :</strong>  è¿›å…¥é¡µé¢ä¹‹å, åº”ç”¨æ¸²æŸ“å®Œæ•´ä¸ªå±å¹•(æœªæ»šåŠ¨ä¹‹å‰) å†…å®¹çš„æ—¶é—´.</p></li></ul><p><strong>Performance API</strong></p><blockquote><p>è¿™ä¸ª <code>API </code>æ˜¯ <code>HTML5 </code>æ–°å¢çš„ç‰¹æ€§ , ä¸æ˜ç™½çš„å¯ä»¥çœ‹çœ‹ MDN</p><p>å¯ä»¥åœ¨æ§åˆ¶å°çš„<code>console</code>é¢æ¿ä¸­é€šè¿‡<code>window.performance</code>æ¥è·å–ç½‘ç«™çš„å„é¡¹æŒ‡æ ‡ä¿¡æ¯</p></blockquote><p>Performance æ¥å£å¯ä»¥è·å–åˆ°å½“å‰é¡µé¢ä¸­ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚å®ƒæ˜¯ High Resolution Time API çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ—¶ä¹Ÿèåˆäº† Performance Timeline APIã€Navigation Timing APIã€ User Timing API å’Œ Resource Timing APIã€‚è¯¥ç±»å‹çš„å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨åªè¯»å±æ€§ Window.performance æ¥è·å¾—ã€‚</p><ul><li><code>performance</code>åŒ…æ‹¬äº†äº”ä¸ªå±æ€§ï¼Œå…¶ä¸­<code>timing</code>æ˜¯éœ€è¦é‡ç‚¹å…³æ³¨çš„ï¼Œ<code>timing</code>æ˜¯ä¸€ä¸ª<code>map</code>æ•°æ®ç»“æ„ï¼Œå…¶ä¸­<code>key</code>å€¼æ˜¯æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡ï¼Œ<code>value</code>å€¼æ˜¯å¯¹åº”çš„æ—¶é—´æˆ³ã€‚</li><li>å¾ˆå¤šæŒ‡æ ‡éƒ½æ˜¯æˆå¯¹å‡ºç°ï¼Œç›´æ¥ä½œå·®å°±å¯ä»¥æ±‚å‡ºå¯¹åº”é¡µé¢åŠ è½½è¿‡ç¨‹ä¸­å…³é”®èŠ‚ç‚¹çš„æ—¶é—´ï¼Œä»‹ç»å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> timingInfo = <span class="hljs-variable language_">window</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">timing</span>; <br><br><span class="hljs-comment">// TCPè¿æ¥è€—æ—¶</span><br>timingInfo.<span class="hljs-property">connectEnd</span> - timingInfo.<span class="hljs-property">connectStart</span><br><br><span class="hljs-comment">// DNSæŸ¥è¯¢è€—æ—¶</span><br>timingInfo.<span class="hljs-property">domainLookupEnd</span> - timingInfo.<span class="hljs-property">domainLookupStart</span>;<br><br><span class="hljs-comment">// è·å¾—é¦–å­—èŠ‚è€—è´¹æ—¶é—´ï¼Œä¹Ÿå«TTFB</span><br>timingInfo.<span class="hljs-property">responseStart</span> - timingInfo.<span class="hljs-property">navigationStart</span><br><br><span class="hljs-comment">// domReadyæ—¶é—´(ä¸å‰é¢æåˆ°çš„DomContentLoadäº‹ä»¶å¯¹åº”)</span><br>timingInfo.<span class="hljs-property">domContentLoadedEventStart</span> - timingInfo.<span class="hljs-property">navigationStart</span><br><br><span class="hljs-comment">// DOMèµ„æºä¸‹è½½</span><br>timingInfo.<span class="hljs-property">responseEnd</span> - timingInfo.<span class="hljs-property">responseStart</span><br></code></pre></td></tr></table></figure><blockquote><p>ä¸Šè¿°å°±æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡ä¹Ÿå¯ä»¥åœ¨Chromeæµè§ˆå™¨çš„networké¢æ¿ä¸­çš„Timingä¸‹è·å–ï¼š</p></blockquote><h3 id="æ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤"><a href="#æ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤"></a>æ€§èƒ½ä¼˜åŒ–çš„æ­¥éª¤</h3><ul><li><strong>ä¼ è¾“èµ„æºçš„ä¼˜åŒ–</strong>ï¼šæ¯”å¦‚å›¾åƒèµ„æºï¼Œä¸åŒçš„æ ¼å¼ç±»å‹ä¼šæœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åˆ¤æ–­æ˜¯å¦æ°å½“ï¼›</li><li><strong>åŠ è½½è¿‡ç¨‹çš„ä¼˜åŒ–</strong>ï¼šæ¯”å¦‚åŠ è½½å»¶è¿Ÿï¼Œæ˜¯å¦æœ‰ä¸éœ€è¦åœ¨é¦–å±å±•ç¤ºçš„éå…³é”®ä¿¡æ¯ï¼Œå ç”¨äº†é¡µé¢çš„åŠ è½½æ—¶é—´ï¼›</li><li><strong>JavaScriptçš„ä¼˜åŒ–</strong>ï¼šJavaScriptä»£ç æ˜¯å¦è¿›è¡Œäº†å‹ç¼©ï¼Œä¹¦å†™æ˜¯å¦è§„èŒƒï¼Œæœ‰æ— è€ƒè™‘å†…å­˜æ³„æ¼ç­‰ï¼›</li><li><strong>å…³é”®æ¸²æŸ“è·¯å¾„ä¼˜åŒ–ï¼š</strong>æ¯”å¦‚æ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„å›æµä¸é‡ç»˜ç­‰ï¼›</li><li><strong>æœ¬åœ°å­˜å‚¨å’Œæµè§ˆå™¨ç¼“å­˜ã€‚</strong></li></ul><h1 id="å‰ç«¯é¡µé¢çš„æ€§èƒ½æ£€æµ‹"><a href="#å‰ç«¯é¡µé¢çš„æ€§èƒ½æ£€æµ‹" class="headerlink" title="å‰ç«¯é¡µé¢çš„æ€§èƒ½æ£€æµ‹"></a>å‰ç«¯é¡µé¢çš„æ€§èƒ½æ£€æµ‹</h1><h3 id="å¸¸è§çš„æ€§èƒ½æ£€æµ‹å·¥å…·"><a href="#å¸¸è§çš„æ€§èƒ½æ£€æµ‹å·¥å…·" class="headerlink" title="å¸¸è§çš„æ€§èƒ½æ£€æµ‹å·¥å…·"></a>å¸¸è§çš„æ€§èƒ½æ£€æµ‹å·¥å…·</h3><ol><li><strong>Chrome ä»»åŠ¡ç®¡ç†å™¨ :</strong> æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿›ç¨‹å…³äºGPUã€ç½‘ç»œã€å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µ,  è¿™äº›è¿›ç¨‹åŒ…æ‹¬å½“å‰æ‰“å¼€çš„æ ‡ç­¾é¡µã€å®‰è£…çš„å„ç§æ’ä»¶ä»¥åŠGPUã€ç½‘ç»œã€æ¸²æŸ“ç­‰æµè§ˆå™¨çš„é»˜è®¤è¿›ç¨‹ã€‚é€šè¿‡ç›‘æ§è¿™äº›æ•°æ®, å¯ä»¥å®šä½å­˜åœ¨å†…å­˜æ³„æ¼æˆ–è€…ç½‘ç»œèµ„æºåŠ è½½å¼‚å¸¸çš„é—®é¢˜è¿›ç¨‹ã€‚</li></ol><blockquote><p>å¾ˆç†Ÿæ‚‰äº†</p></blockquote><ol start="2"><li><strong>Network é¢æ¿</strong> : å¯ä»¥æŸ¥çœ‹ç½‘ç«™èµ„æºçš„è¯·æ±‚æƒ…å†µï¼ŒåŒ…æ‹¬åŠ è½½æ—¶é—´ã€å°ºå¯¸å¤§å°ã€ä¼˜å…ˆçº§è®¾ç½®ã€HTTPç¼“å­˜è§¦å‘æƒ…å†µç­‰ä¿¡æ¯ï¼Œä»è€Œå‘ç°ç½‘ç«™èµ„æºè¯·æ±‚ä¸­å­˜åœ¨çš„é—®é¢˜ã€‚</li></ol><blockquote><p>å¾ˆç†Ÿæ‚‰äº†</p></blockquote><ol start="3"><li><p><strong>Coverage é¢æ¿</strong> : ç›‘æ§å¹¶ç»Ÿè®¡å‡ºç½‘ç«™åº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­ä»£ç æ‰§è¡Œçš„è¦†ç›–ç‡æƒ…å†µã€‚è¯¥é¢æ¿ç»Ÿè®¡çš„å¯¹è±¡æ˜¯JavaScriptè„šæœ¬æ–‡ä»¶ä¸CSSæ ·å¼è¡¨æ–‡ä»¶ã€‚ä»£ç è¦†ç›–ç‡ä½å°±æ„å‘³ç€è¯¥ä»£ç æ–‡ä»¶å­˜åœ¨ç€è¾ƒå¤šæ²¡æœ‰ç”¨åˆ°çš„ä»£ç ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è¿™ä¸ªç»“æœå¯¹ä»£ç è¿›è¡Œæ‹†åˆ†ï¼Œåœ¨éœ€è¦çš„æ—¶å€™åœ¨è¿›è¡ŒåŠ è½½ã€‚</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091430789.png" alt="img"></p></li></ol><blockquote><p>ç‚¹å‡»â€™æ›´å¤šå·¥å…·â€™æ‰“å¼€</p></blockquote><ol start="4"><li><strong>PageSpeed</strong> : <a href="https://pagespeed.web.dev/">https://pagespeed.web.dev/</a> å¯ä»¥ç›´æ¥è¾“å…¥é¡µé¢çš„URLæ¥åˆ†æé¡µé¢çš„æ€§èƒ½</li></ol><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091310804.png" alt="img"></p><ol start="5"><li><strong>WEBPAGETEST</strong> : å¯ä»¥å¯¹æ£€æµ‹åˆ†æçš„ç¯å¢ƒé…ç½®è¿›è¡Œè‡ªå®šä¹‰åŒ–ï¼Œå†…å®¹åŒ…æ‹¬æµ‹è¯•èŠ‚ç‚¹çš„ç‰©ç†ä½ç½®ã€è®¾å¤‡å‹å·ã€æµè§ˆå™¨ç‰ˆæœ¬ã€ç½‘ç»œæ¡ä»¶å’Œæ£€æµ‹æ¬¡æ•°ç­‰ã€‚<a href="https://www.webpagetest.org/">https://www.webpagetest.org/</a></li></ol><h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><p><code>Performance</code>(æ€§èƒ½)é¢æ¿ä¸»è¦æ˜¯å¯¹ç½‘ç«™åº”ç”¨çš„è¿è¡Œæ—¶æ€§èƒ½è¡¨ç°è¿›è¡Œæ£€æµ‹ä¸åˆ†æï¼Œå…¶å¯ä»¥æ£€æµ‹çš„å†…å®¹åŒ…æ‹¬ï¼šé¡µé¢çš„æ¯ç§’å¸§æ•°ï¼ˆFPSï¼‰ã€CPUçš„ä½¿ç”¨æƒ…å†µã€å„ç§è¯·æ±‚çš„æ—¶é—´èŠ±è´¹ã€ç½‘ç»œä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µã€‚å»ºè®®åœ¨<strong>æ— ç—•æ¨¡å¼</strong>ä¸‹ä½¿ç”¨è¯¥å·¥å…·ï¼Œå› ä¸ºè¯¥æ¨¡å¼ä¸‹ç½‘é¡µä¸ä¼šå—åˆ°ç¼“å­˜æˆ–å…¶ä»–æ’ä»¶ç¨‹åºç­‰å› ç´ çš„å½±å“</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091310746.png" alt="img"></p><p><strong>æ§åˆ¶é¢æ¿</strong></p><ul><li><p>å±å¹•æˆªå›¾ï¼šè¡¨ç¤ºæ˜¯å¦æˆªå–æ¯ä¸€å¸§çš„å±å¹•æˆªå›¾ï¼Œé»˜è®¤ä¼šå‹¾é€‰</p></li><li><p>å†…å­˜ï¼šè¡¨ç¤ºæ˜¯å¦è®°å½•å†…å­˜æ¶ˆè€—ï¼Œé»˜è®¤ä¸ä¼šå€™é€‰</p></li><li><p>Web Vitalsï¼šæµ‹è¯•ç½‘é¡µçš„åŠ è½½é€Ÿåº¦åŠç”¨æˆ·ä½“éªŒç­‰</p></li><li><p>Disable javaScript samplesï¼šå…³é—­JavaScriptæ ·æœ¬ï¼Œå‡å°‘åœ¨æ‰‹æœºç«¯è¿è¡Œæ—¶çš„å¼€é”€</p></li><li><p>Enable advanced paint instrucmentationï¼ˆslowï¼‰ï¼šè¡¨ç¤ºæ˜¯å¦å¼€å¯åŠ é€Ÿæ¸²æŸ“å·¥å…·ï¼Œç”¨æ¥è®°å½•æ¸²æŸ“äº‹ä»¶çš„ç›¸å…³ç»†èŠ‚ï¼Œè¯¥åŠŸèƒ½æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½</p></li><li><p>Networkï¼šåˆ‡æ¢æ¨¡æ‹Ÿç½‘ç»œç¯å¢ƒï¼Œå¯ä»¥æ¨¡æ‹Ÿå¼±ç½‘(2g&#x2F;3g)æ¡ä»¶ä¸‹ç½‘ç«™çš„ä¸€äº›è¡¨ç°æƒ…å†µï¼Œç„¶åæ ¹æ®å¼±ç½‘çš„å…·ä½“è¡¨ç°è¿›è¡Œç›¸å…³ä¼˜åŒ–</p></li><li><p>CPUï¼šé™åˆ¶CPUçš„å¤„ç†é€Ÿåº¦ï¼Œä¸»è¦ç”¨äºæ¨¡æ‹Ÿä½é€ŸCPUè¿è¡Œæ—¶çš„æ€§èƒ½ã€‚</p></li></ul><p><strong>æ¦‚è§ˆé¢æ¿</strong></p><p>åœ¨æ¦‚è§ˆé¢æ¿ä¸­ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªèµ·å§‹æ—¶é—´ç‚¹ï¼Œç„¶åæ‹–åŠ¨é¼ æ ‡å·¦é”®æ¥æ»‘åŠ¨é€‰æ‹©é¢æ¿ä¸­å›½çš„å±€éƒ¨èŒƒå›´ï¼Œæ¥è¿›è¡Œæ›´å°èŒƒå›´çš„æ€§èƒ½è§‚å¯Ÿã€‚è¿™éƒ¨åˆ†çš„æ€§èƒ½ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p><ul><li><p>FPSï¼šè¡¡é‡åŠ¨ç”»æ˜¯å¦æµç•…çš„é‡è¦æŒ‡æ ‡ã€‚</p></li><li><p>CPUï¼šå±•ç¤ºCPUçš„ä½¿ç”¨æƒ…å†µã€‚</p></li><li><p>NETï¼šå±•ç¤ºå„ä¸ªè¯·æ±‚æ‰€èŠ±è´¹çš„å…·ä½“æ—¶é—´</p></li></ul><p><strong>çº¿ç¨‹é¢æ¿</strong></p><p>ä¸»çº¿ç¨‹åœ¨è§£æHTMLå’ŒCSSã€é¡µé¢ç»˜åˆ¶åŠæ‰§è¡ŒJavaScriptçš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªäº‹ä»¶è°ƒç”¨æ ˆå’Œè€—æ—¶æƒ…å†µéƒ½ä¼šååº”åœ¨è¿™ä¸ªå›¾ä¸­ã€‚</p><p>æ¯ä¸€ä¸ªé•¿æ¡éƒ½ä»£è¡¨ä¸€ä¸ªäº‹ä»¶ï¼Œå°†é¼ æ ‡æ‚¬æµ®è‡³å…¶ä¸Šé¢æ—¶ï¼Œå°±å¯ä»¥æŸ¥çœ‹åˆ°ç›¸åº”çš„æ—¶é—´çš„æ‰§è¡Œè€—æ—¶ä¸äº‹ä»¶åã€‚</p><p>å›¾ä¸­ä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒçš„äº‹ä»¶ç±»å‹ã€‚æ¨ªè½´ä»£è¡¨æ—¶é—´ï¼Œçºµè½´ä»£è¡¨å…·ä½“çš„è°ƒç”¨å †æ ˆã€‚è°ƒç”¨å †æ ˆå°±åƒæ˜¯æµè§ˆå™¨å½“ä¸­çš„è§£é‡Šå™¨ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè¿½è¸ªå‡½æ•°çš„æ‰§è¡Œæµã€‚</p><blockquote><p>å¸¸è§çš„äº‹ä»¶ç±»å‹æœ‰ï¼š</p></blockquote><ul><li>HTMLè§£æï¼›</li><li>JavaScriptäº‹ä»¶ï¼›</li><li>é¡µé¢å¸ƒå±€æ›´æ”¹ï¼›</li><li>å…ƒç´ æ ·å¼é‡æ–°è®¡ç®—ï¼›</li><li>é¡µé¢æ¶‚å±‚çš„ç»˜åˆ¶ã€‚</li></ul><p><strong>ç»Ÿè®¡é¢æ¿</strong></p><p>ç»Ÿè®¡é¢æ¿ä¼šæ ¹æ®åœ¨æ¦‚å¿µé¢æ¿ä¸­é€‰æ‹©æ—¶é—´åŒºåŸŸçš„ä¸åŒï¼Œç»˜åˆ¶å‡ºä¸åŒç±»å‹ä»»åŠ¡æ‰§è¡Œè€—æ—¶çš„å¯è§†åŒ–å›¾æ ‡</p><p>ç‚¹å‡»ä¹‹åçœ‹åˆ°è¿™ä¸ªäº‹ä»¶ä¸‹å¯¹åº”çš„ä¸€äº›å…·ä½“ä¿¡æ¯ï¼Œè¿™é‡Œè¿˜å¯ä»¥ç‚¹å‡»Rangeå³ä¾§é“¾æ¥ï¼Œç‚¹å‡»ä¹‹åä¼šç›´æ¥è·³åˆ°sourcesé¢æ¿å¯¹åº”çš„ä»£ç ä½ç½®ï¼Œè¿™ä¸ªåŠŸèƒ½æ–¹ä¾¿äº†å®šä½ä»£ç </p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091310556.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091430160.png" alt="img"></p><p>ç»Ÿè®¡é¢æ¿ä¸­åŒ…å«å››ä¸ªTabï¼Œå…¶å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>Summaryï¼šå±•ç¤ºå„ç±»ä»»åŠ¡äº‹ä»¶è€—æ—¶ç¯å½¢å›¾ï¼›</li><li>Bottom-Upï¼šæŸ¥çœ‹å„ä¸ªäº‹ä»¶è€—æ—¶çš„æ’åºåˆ—è¡¨ï¼Œåˆ—è¡¨åŒ…å«ä¸¤ä¸ªç»´åº¦ï¼šå»é™¤å­äº‹ä»¶åè¯¥äº‹ä»¶æœ¬èº«çš„è€—æ—¶å’ŒåŒ…å«å­äº‹ä»¶ä»å¼€å§‹åˆ°ç»“æŸçš„æ€»è€—æ—¶ï¼›</li><li>Call Treeï¼šæŸ¥çœ‹å…¨éƒ¨æˆ–æŒ‡å®šç«ç„°å›¾ä¸­æŸä¸ªäº‹ä»¶çš„è°ƒç”¨æ ˆï¼›</li><li>Event Logï¼šæŸ¥çœ‹å…³äºæ¯ä¸ªäº‹ä»¶è¯¦ç»†çš„æ—¥å¿—ã€‚</li></ul><h3 id="LightHouse"><a href="#LightHouse" class="headerlink" title="LightHouse"></a>LightHouse</h3><p>ä¸º Lighthouse æä¾›ä¸€ä¸ªéœ€è¦å®¡æŸ¥çš„ç½‘å€ï¼Œå®ƒå°†é’ˆå¯¹æ­¤é¡µé¢è¿è¡Œä¸€è¿ä¸²çš„æµ‹è¯•ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæœ‰å…³é¡µé¢æ€§èƒ½çš„æŠ¥å‘Šï¼Œå…¶å†…å®¹åŒ…æ‹¬ï¼šæ€§èƒ½æ£€æµ‹ã€å¯è®¿é—®æ€§æ£€æµ‹ã€SEOæ£€æµ‹ã€æ˜¯å¦ç¬¦åˆPWAçš„æ£€æµ‹ã€å…¶ä»–æ˜¯å¦ç¬¦åˆæœ€ä½³å®è·µçš„æ£€æµ‹ã€‚ æ£€æµ‹æŠ¥å‘Šä¸ä»…æ¶‰åŠä¸Šé¢è¿™äº›æ–¹é¢çš„ç°çŠ¶åˆ†æï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€äº›ä¼˜åŒ–æŒ‡å¯¼å»ºè®®ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿå‘ç°æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå¹¶å®æ–½ä¼˜åŒ–æ”¹è¿›ã€‚</p><p>åœ¨æ–°ç‰ˆçš„Chromeæµè§ˆå™¨ä¸­ï¼Œå°†LightHouseé›†æˆåœ¨äº†å¼€å‘è€…å·¥å…·ä¸­ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œåˆ‡æ¢åˆ°LightHouseé¢æ¿</p><p>å¯ä»¥çœ‹åˆ°æŠ¥å‘Šè¯¦ç»†ç»™å‡ºäº†å„ç§æƒ…å†µä¸‹çš„åˆ†æ•°æƒ…å†µï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯Performance(é¡µé¢æ€§èƒ½)ã€Accessibility(å¯è®¿æ€§)ã€Best Practise(æœ€ä½³å®è·µ)ã€SEO(æœç´¢å¼•æ“ä¼˜åŒ–)ã€Progressive Web App(æ¸è¿›å¼åº”ç”¨)ã€‚ç‚¹å‡»å…¶ä¸­çš„æ¯ä¸€é¡¹éƒ½å¯ä»¥çœ‹åˆ°ç»™å‡ºçš„å…·ä½“ä¼˜åŒ–å»ºè®®ã€‚</p><p><strong>æ£€æµ‹å¾—åˆ†</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091310791.png" alt="img"></p><p><strong>é¡µé¢æ€§èƒ½</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091310807.png" alt="img"></p><p><strong>ä¼˜åŒ–å»ºè®®</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311091310335.png" alt="img"></p><p>æ ¹æ®æ¯éƒ¨åˆ†ç»™å‡ºçš„è¯„æµ‹ç»“æœä»¥åŠä¼˜åŒ–å»ºè®®ï¼Œå¼€å‘è€…å°±å¯ä»¥é’ˆå¯¹æ€§çš„å¯¹ç½‘ç«™é¡µé¢è¿›è¡Œä¼˜åŒ–ã€‚</p><h1 id="é›…è™35æ¡å†›è§„"><a href="#é›…è™35æ¡å†›è§„" class="headerlink" title="é›…è™35æ¡å†›è§„"></a>é›…è™35æ¡å†›è§„</h1><blockquote><p>å¯èƒ½æ²¡æœ‰35æ¡, å› ä¸ºæœ‰äº›å·²ç»ä¸éœ€è¦äº†</p></blockquote><h3 id="1-å›¾ç‰‡ä¼˜åŒ–"><a href="#1-å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="1. å›¾ç‰‡ä¼˜åŒ–"></a>1. å›¾ç‰‡ä¼˜åŒ–</h3><p><strong>ä¼˜åŒ–å›¾ç‰‡</strong></p><ul><li><p>æ£€æŸ¥ GIF å›¾ç‰‡çš„è°ƒè‰²æ¿å¤§å°æ˜¯å¦åŒ¹é…å›¾ç‰‡é¢œè‰²æ•°ï¼›</p></li><li><p>æŠŠ GIF æ ¼å¼è½¬æ¢æˆ PNG æ ¼å¼ï¼Œçœ‹çœ‹æ˜¯å¦èŠ‚çœç©ºé—´ï¼›</p></li><li><p>è¿è¡Œ pngcrush æˆ–å…¶å®ƒå·¥å…·æ¥å‹ç¼© png æ ¼å¼çš„å›¾ç‰‡ï¼›</p></li><li><p>è¿è¡Œ jpegtran æˆ–å…¶å®ƒå·¥å…·æ¥å‹ç¼© jpeg æ ¼å¼çš„å›¾ç‰‡ã€‚</p></li></ul><p><strong>ä¼˜åŒ–CSS Sprite</strong></p><ul><li><p>æŠŠå›¾ç‰‡æ¨ªå‘åˆå¹¶è€Œä¸æ˜¯çºµå‘ï¼Œå› ä¸ºæ¨ªå‘å›¾ç‰‡æ–‡ä»¶æ›´å°ï¼›</p></li><li><p>æŠŠé¢œè‰²è¿‘ä¼¼çš„å›¾ç‰‡åˆå¹¶åˆ°ä¸€å¼ é›ªç¢§å›¾ï¼Œè¿™æ ·å¯ä»¥è®©é¢œè‰²æ•°æ›´å°‘ï¼Œå¦‚æœä½äº 256 è‰²å°±å¯ä»¥ç”¨ png8 æ ¼å¼ï¼›</p></li><li><p>å¯¹ç§»åŠ¨ç«¯å‹å¥½ï¼Œåˆå¹¶æ—¶å›¾ç‰‡é—´çš„é—´è·ä¸è¦å¤ªå¤§ã€‚è™½ç„¶è¿™å¯¹å›¾ç‰‡å¤§å°å½±å“ä¸æ˜¯å¤ªå¤§ï¼Œä½†è¿™æ ·åšå¯ä»¥èŠ‚çœç”¨æˆ·ä»£ç†æŠŠå›¾ç‰‡è§£å‹æˆåƒç´ æ˜ å°„æ—¶æ¶ˆè€—çš„å†…å­˜ã€‚100Ã—100çš„å›¾ç‰‡æ˜¯1ä¸‡ä¸ªåƒç´ ï¼Œè€Œ1000Ã—1000çš„å›¾ç‰‡å°±æ˜¯100ä¸‡ä¸ªåƒç´ äº†ã€‚</p></li></ul><p><strong>ç¦æ­¢åœ¨HTMLä¸­ç¼©æ”¾å›¾ç‰‡</strong></p><p>ä¸è¦åœ¨ HTML ä¸­ç¼©æ”¾å›¾ç‰‡ã€‚ä¸è¦å› ä¸ºå¯ä»¥è®¾ç½®å›¾ç‰‡çš„å®½é«˜å°±å»ç”¨æ¯”éœ€è¦çš„å¤§å¾—å¤šçš„å›¾ç‰‡ã€‚</p><p>å¦‚æœéœ€è¦100px * 100pxçš„å›¾ç‰‡ï¼Œé‚£å°±ä¸è¦ç”¨500px  * 500pxçš„ã€‚</p><p><strong>ç”¨å°çš„ä¸”å¯ä»¥ç¼“å­˜çš„favicon</strong></p><ul><li><p><code>favicon.ico</code>æ˜¯æ”¾åœ¨æœåŠ¡å™¨æ ¹ç›®å½•çš„å›¾ç‰‡ï¼Œæµè§ˆå™¨ä¹Ÿä¼šè‡ªåŠ¨è¯·æ±‚å®ƒï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦ç»™ä¸€ä¸ª<code>404 Not Found</code>å“åº”ã€‚è€Œä¸”åªè¦åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œæ¯æ¬¡è¯·æ±‚å®ƒæ—¶éƒ½ä¼šå‘é€<code>cookie</code>ï¼Œæ­¤å¤–è¿™ä¸ªå›¾ç‰‡è¿˜ä¼šå¹²æ‰°ä¸‹è½½é¡ºåºï¼Œä¾‹å¦‚åœ¨<code>IE</code>ä¸­ï¼Œå½“ä½ åœ¨<code>onload</code>ä¸­è¯·æ±‚é¢å¤–ç»„ä»¶æ—¶ï¼Œå°†ä¼šå…ˆä¸‹è½½<code>favicon</code>ã€‚</p></li><li><p>æ‰€ä»¥ä¸ºäº†ç¼“è§£<code>favicon.ico</code>çš„ç¼ºç‚¹ï¼Œåº”è¯¥ç¡®ä¿ï¼š</p><ul><li><p>è¶³å¤Ÿå°ï¼Œæœ€å¥½åœ¨<code>1K</code>ä»¥ä¸‹ï¼›</p></li><li><p><code>favicon.ico</code> ä¸€èˆ¬æ˜¯ä¸è¿›è¡Œæ›´æ¢çš„ï¼Œæ‰€ä»¥å¯ä»¥ç»™å®ƒè®¾ç½®<code>Expires</code>å¤´ï¼Œè€Œä¸”å¯ä»¥å®‰å…¨åœ°è®¾ç½®ä¸ºå‡ ä¸ªæœˆï¼Œé¿å…æ¯ä¸€æ¬¡æ‰“å¼€é¡µé¢éƒ½éœ€è¦å»è¿›è¡Œè¯·æ±‚ã€‚</p></li></ul></li></ul><h3 id="2-CSS-ä¼˜åŒ–"><a href="#2-CSS-ä¼˜åŒ–" class="headerlink" title="2. CSS ä¼˜åŒ–"></a>2. CSS ä¼˜åŒ–</h3><p><strong>å°†CSSæ ·å¼æ”¾åœ¨é¡¶éƒ¨</strong></p><ul><li><p>å°†æ ·å¼è¡¨ç§»åˆ° <code>&lt;head&gt;</code> é‡Œä¼šè®©é¡µé¢åŠ è½½åœ°æ›´å¿«ã€‚è¿™æ˜¯å› ä¸ºæŠŠæ ·å¼è¡¨ç§»åˆ° <code>&lt;head&gt;</code> é‡Œå…è®¸é¡µé¢é€æ­¥æ¸²æŸ“ã€‚</p></li><li><p>æˆ‘ä»¬å¸Œæœ›æµè§ˆå™¨å°½æ—©çš„å»æ¸²æŸ“è·å–åˆ°çš„å†…å®¹ï¼Œè¿™å¯¹å¤§é¡µé¢å’Œç½‘é€Ÿæ…¢çš„ç”¨æˆ·å¾ˆé‡è¦ã€‚ç»™ç”¨æˆ·è§†è§‰åé¦ˆï¼ˆæ¯”å¦‚è¿›åº¦æŒ‡æ ‡ï¼‰å°±éå¸¸é‡è¦ï¼ŒHTML é¡µé¢å°±æ˜¯è¿›åº¦æŒ‡æ ‡ã€‚å½“æµè§ˆå™¨é€æ­¥åŠ è½½é¡µé¢å¤´éƒ¨ï¼Œå¯¼èˆªæ¡ï¼Œé¡¶éƒ¨ logo ç­‰å†…å®¹æ—¶ï¼Œè¿™äº›éƒ½æ˜¯ç»™ç­‰å¾…é¡µé¢çš„ç”¨æˆ·çš„è§†è§‰åé¦ˆï¼Œèƒ½å¤Ÿæé«˜æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚</p></li><li><p>æŠŠæ ·å¼è¡¨æ”¾åœ¨æ–‡æ¡£åº•éƒ¨çš„é—®é¢˜æ˜¯å®ƒé˜»æ­¢äº†è®¸å¤šæµè§ˆå™¨çš„é€æ­¥æ¸²æŸ“ï¼ŒåŒ…æ‹¬ IEã€‚è¿™äº›æµè§ˆå™¨é˜»æ­¢æ¸²æŸ“æ¥é¿å…åœ¨æ ·å¼æ›´æ”¹æ—¶éœ€è¦é‡ç»˜é¡µé¢å…ƒç´ ã€‚æ‰€ä»¥ç”¨æˆ·ä¼šå¡åœ¨ç™½å±ã€‚</p></li></ul><p><strong>é¿å…ä½¿ç”¨CSSè¡¨è¾¾å¼</strong></p><p>CSS è¡¨è¾¾å¼æ˜¯å¼ºå¤§çš„ï¼ˆå¯èƒ½ä¹Ÿæ˜¯å±é™©çš„ï¼‰è®¾ç½®åŠ¨æ€ CSS å±æ€§çš„æ–¹æ³•ã€‚CSS è¡¨è¾¾å¼çš„é—®é¢˜æ˜¯å®ƒä»¬å¯èƒ½æ¯”é¢„æœŸè®¡ç®—çš„æ›´é¢‘ç¹ã€‚å®ƒä»¬ä¸ä»…åœ¨é¡µé¢è½½å…¥å’Œè°ƒæ•´å¤§å°æ—¶é‡æ–°è®¡ç®—ï¼Œä¹Ÿåœ¨æ»šåŠ¨é¡µé¢ç”šè‡³æ˜¯ç”¨æˆ·åœ¨é¡µé¢ä¸Šç§»åŠ¨é¼ æ ‡æ—¶è®¡ç®—ã€‚æ¯”å¦‚åœ¨é¡µé¢ä¸Šç§»åŠ¨é¼ æ ‡å¯èƒ½è½»æ˜“è®¡ç®—è¶…è¿‡10000æ¬¡ã€‚è¦é¿å…CSSè¡¨è¾¾å¼è®¡ç®—å¤ªå¤šæ¬¡ï¼Œå¯ä»¥åœ¨å®ƒç¬¬ä¸€æ¬¡è®¡ç®—åæ›¿æ¢æˆç¡®åˆ‡å€¼ï¼Œæˆ–è€…ç”¨äº‹ä»¶å¤„ç†å‡½æ•°è€Œä¸æ˜¯CSSè¡¨è¾¾å¼ã€‚</p><p><strong>é€‰æ‹©<code>&lt;link&gt;</code> èˆå¼ƒ<code>@import</code></strong></p><p>ä¸Šé¢æåˆ°äº†ä¸€ä¸ªæœ€ä½³å®è·µï¼šä¸ºäº†å®ç°é€æ­¥æ¸²æŸ“ï¼Œ<code>CSS</code>åº”è¯¥æ”¾åœ¨é¡¶éƒ¨ã€‚åœ¨IEä¸­ç”¨<code>@import</code>ä¸åœ¨åº•éƒ¨ç”¨<code>&lt;link&gt;</code>æ•ˆæœä¸€æ ·ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦ç”¨å®ƒã€‚</p><h3 id="3-Cookie-ä¼˜åŒ–"><a href="#3-Cookie-ä¼˜åŒ–" class="headerlink" title="3.Cookie ä¼˜åŒ–"></a>3.Cookie ä¼˜åŒ–</h3><p><strong>å‡å°‘Cookieçš„ä½“ç§¯</strong></p><p>HTTP Cookie çš„ä½¿ç”¨æœ‰å¤šç§åŸå› ï¼Œæ¯”å¦‚æˆæƒå’Œä¸ªæ€§åŒ–ã€‚Cookie çš„ä¿¡æ¯é€šè¿‡ http å¤´éƒ¨åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢ã€‚</p><p>é‡è¦çš„æ˜¯ä¿è¯cookieå°½å¯èƒ½çš„å°ï¼Œä»¥æœ€å°åŒ–å¯¹ç”¨æˆ·å“åº”æ—¶é—´çš„å½±å“ã€‚å¯ä»¥å¯¹Cookieåšå¦‚ä¸‹ä¼˜åŒ–ï¼š</p><ul><li>æ¶ˆé™¤ä¸å¿…è¦çš„ <code>Cookie</code> , æ¥é™ä½å“åº”æ—¶é—´ï¼›</li><li>æ³¨æ„è®¾ç½® <code>Cookie </code>åˆ°åˆé€‚çš„åŸŸåçº§åˆ«ï¼Œä»¥å…å½±å“å…¶å®ƒå­åŸŸï¼›</li><li>è®¾ç½®åˆé€‚çš„ <code>Expires </code>æ—¥æœŸã€‚æ›´æ—©çš„æœ‰æ•ˆæœŸæˆ–è€…<code>none</code>å¯ä»¥æ›´å¿«çš„åˆ é™¤<code>cookie</code>ï¼Œæé«˜ç”¨æˆ·å“åº”æ—¶é—´ã€‚</li></ul><p><strong>æŠŠç»„ä»¶æ”¾åœ¨ä¸å«<code>Cookie</code>çš„åŸŸä¸‹</strong></p><p>å½“æµè§ˆå™¨è¯·æ±‚é™æ€å›¾ç‰‡å¹¶æŠŠ cookie ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œcookie æ­¤æ—¶å¯¹æœåŠ¡å™¨æ²¡ä»€ä¹ˆç”¨å¤„ã€‚æ‰€ä»¥è¿™äº› cookie åªä¼šå¢åŠ æ— æ„ä¹‰çš„ç½‘ç»œæµé‡ã€‚æ‰€ä»¥åº”è¯¥ä¿è¯é™æ€ç»„ä»¶çš„è¯·æ±‚æ˜¯æ²¡æœ‰ cookie çš„ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªå­åŸŸåæ¥æ‰˜ç®¡æ‰€æœ‰é™æ€ç»„ä»¶ã€‚</p><p>æ¯”å¦‚ï¼ŒåŸŸåæ˜¯<a href="http://www.example.org,å¯ä»¥æŠŠé™æ€ç»„ä»¶æ‰˜ç®¡åœ¨static.example.org.ä¸è¿‡,å¦‚æœæŠŠcookieè®¾ç½®åœ¨é¡¶çº§åŸŸå/">www.example.orgï¼Œå¯ä»¥æŠŠé™æ€ç»„ä»¶æ‰˜ç®¡åœ¨static.example.orgã€‚ä¸è¿‡ï¼Œå¦‚æœæŠŠcookieè®¾ç½®åœ¨é¡¶çº§åŸŸå</a> example.org ä¸‹ï¼Œè¿™äº›cookieä»ç„¶ä¼šè¢«ä¼ ç»™ static.example.orgã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯ç”¨ä¸€ä¸ªå…¨æ–°çš„åŸŸåæ¥æ‰˜ç®¡é™æ€ç»„ä»¶ã€‚</p><p>æ³¨æ„ï¼šå› ä¸ºcookieæ˜¯å¯ä»¥è·¨äºŒçº§åŸŸåçš„ï¼Œæ‰€ä»¥å¦‚æœè®¾ç½®çš„é¡¶çº§åŸŸåæ˜¯example.orgï¼Œé‚£ä¹ˆstatic.example.org ä¹Ÿæ˜¯å¯ä»¥è¢«è®¿é—®åˆ°çš„ï¼Œå› æ­¤éœ€è¦å¯ç”¨ä¸€ä¸ªå…¨æ–°çš„åŸŸåã€‚</p><p>å¦å¤–ä¸€ä¸ªç”¨æ²¡æœ‰ cookie çš„åŸŸåæä¾›ç»„ä»¶çš„å¥½å¤„æ˜¯ï¼ŒæŸäº›ä»£ç†å¯èƒ½ä¼šé˜»æ­¢ç¼“å­˜å¸¦ cookie çš„é™æ€ç»„ä»¶è¯·æ±‚ã€‚</p><h3 id="4-æœåŠ¡ç«¯ä¼˜åŒ–"><a href="#4-æœåŠ¡ç«¯ä¼˜åŒ–" class="headerlink" title="4. æœåŠ¡ç«¯ä¼˜åŒ–"></a>4. æœåŠ¡ç«¯ä¼˜åŒ–</h3><p><strong>ä½¿ç”¨CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰</strong></p><ul><li>ç”¨æˆ·æ¥è¿‘æœåŠ¡å™¨å°±ä¼šå‡å°‘å“åº”æ—¶é—´ã€‚æŠŠå†…å®¹å‘å¸ƒåˆ°å¤šä¸ªåœ°ç†ä¸Šåˆ†æ•£çš„æœåŠ¡å™¨å¯ä»¥è®©é¡µé¢åŠ è½½æ›´å¿«ã€‚</li><li>80-90%çš„ç»ˆç«¯ç”¨æˆ·å“åº”æ—¶é—´èŠ±è´¹åœ¨ä¸‹è½½é¡µé¢ä¸­çš„æ‰€æœ‰ç»„ä»¶ï¼šå›¾ç‰‡ã€æ ·å¼ã€è„šæœ¬ã€falsh ç­‰ï¼Œè¿™å°±æ˜¯ä¸šç»©é»„é‡‘æ³•åˆ™ã€‚</li><li>æœ€å¥½å…ˆåˆ†æ•£é™æ€å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹å°±é‡æ–°è®¾è®¡åº”ç”¨ç¨‹åºç»“æ„ã€‚è¿™ä¸ä»…èƒ½å¤Ÿå¤§å¤§å‡å°‘å“åº”æ—¶é—´ï¼Œè¿˜æ›´å®¹æ˜“è¡¨ç°å‡ºCDNçš„åŠŸåŠ³ã€‚</li><li>å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰æ˜¯ä¸€ç»„åˆ†æ•£åœ¨ä¸åŒåœ°ç†ä½ç½®çš„webæœåŠ¡å™¨ï¼Œç”¨æ¥ç»™ç”¨æˆ·æ›´é«˜æ•ˆåœ°å‘é€å†…å®¹ã€‚å…¸å‹åœ°ï¼Œé€‰æ‹©ç”¨æ¥å‘é€å†…å®¹çš„æœåŠ¡å™¨æ˜¯åŸºäºç½‘ç»œè·ç¦»çš„è¡¡é‡æ ‡å‡†çš„ã€‚</li></ul><p><strong>æ·»åŠ <code>Expires</code>æˆ–è€…<code>Cache-Control</code>å¤´éƒ¨</strong></p><p>è¿™æ¡è§„åˆ™æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li>å¯¹é™æ€ç»„ä»¶ï¼šé€šè¿‡è®¾ç½® <code>Expires</code>å¤´éƒ¨æ¥å®ç°æ°¸ä¸è¿‡æœŸç­–ç•¥ã€‚</li><li>å¯¹åŠ¨æ€ç»„ä»¶ï¼šç”¨åˆé€‚çš„ <code>Cache-Control</code> å¤´éƒ¨æ¥å¸®åŠ©æµè§ˆå™¨è¿›è¡Œæœ‰æ¡ä»¶æ€§çš„è¯·æ±‚ã€‚</li></ul><p>ç½‘ç«™è®¾è®¡è¶Šæ¥è¶Šä¸°å¯Œï¼Œè¿™æ„å‘³ç€æ›´å¤šè„šæœ¬ï¼Œæ ·å¼ï¼Œå›¾ç‰‡ç­‰ã€‚ç¬¬ä¸€æ¬¡è®¿é—®çš„ç”¨æˆ·å¯èƒ½éœ€è¦å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œä½†ä½¿ç”¨Expireså¯ä»¥è®©è¿™äº›ç»„ä»¶è¢«ç¼“å­˜ã€‚è¿™é¿å…äº†è®¿é—®å­é¡µé¢æ—¶æ²¡å¿…è¦çš„ http è¯·æ±‚ã€‚Expires ä¸€èˆ¬ç”¨åœ¨å›¾ç‰‡ä¸Šï¼Œä½†å®ƒåº”è¯¥ç”¨åœ¨æ‰€æœ‰çš„ç»„ä»¶ä¸Šï¼ŒåŒ…æ‹¬è„šæœ¬ã€æ ·å¼ç­‰ã€‚</p><p>æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜æ¥å‡å°‘HTTPè¯·æ±‚æ•°å’Œå¤§å°ï¼ŒåŠ å¿«é¡µé¢åŠ è½½ã€‚æœåŠ¡å™¨ä½¿ç”¨HTTPå“åº”çš„Expireså¤´éƒ¨æ¥å‘Šè¯‰å®¢æˆ·ç«¯ä¸€ä¸ªç»„ä»¶å¯ä»¥ç¼“å­˜å¤šä¹…ã€‚æ³¨æ„ï¼Œå¦‚æœè®¾ç½®äº†Expireså¤´éƒ¨ï¼Œå½“ç»„ä»¶æ›´æ–°åï¼Œå¿…é¡»æ›´æ”¹æ–‡ä»¶åã€‚</p><p><strong>ä¼ è¾“æ—¶ç”¨gzipç­‰å‹ç¼©ç»„ä»¶</strong></p><p><code>HTTP </code>è¯·æ±‚æˆ–å“åº”çš„ä¼ è¾“æ—¶é—´å¯ä»¥è¢«æ˜¾è‘—å‡å°‘ã€‚å‹ç¼©å¯ä»¥é€šè¿‡å‡å°‘ <code>http </code>å“åº”çš„å¤§å°æ¥ç¼©çŸ­å“åº”æ—¶é—´ã€‚ä»<code> HTTP/1.1</code> å¼€å§‹ï¼Œå®¢æˆ·ç«¯é€šè¿‡<code>http</code>è¯·æ±‚ä¸­çš„ <code>Accept-Encoding</code> å¤´éƒ¨æ¥æç¤ºæ”¯æŒçš„å‹ç¼©ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br></code></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡å™¨çœ‹åˆ°è¿™ä¸ªå¤´éƒ¨ï¼Œå®ƒå°±ä¼šé€‰ç”¨åˆ—è¡¨ä¸­çš„æŸä¸ªæ–¹æ³•å‹ç¼©å“åº”ã€‚æœåŠ¡å™¨é€šè¿‡<code>Content-Encoding</code> å¤´éƒ¨æ¥æç¤ºå®¢æˆ·ç«¯ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-attribute">Content-Encoding</span><span class="hljs-punctuation">: </span>gzip<br></code></pre></td></tr></table></figure><p><code>gzip </code>ä¸€èˆ¬å¯å‡å°å“åº”çš„ <code>70%</code>ã€‚å°½å¯èƒ½å»<code>gzip</code>æ›´å¤šï¼ˆæ–‡æœ¬ï¼‰ç±»å‹çš„æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯æå‡ç”¨æˆ·ä½“éªŒæœ€ç®€å•çš„æ–¹æ³•ã€‚</p><p>htmlï¼Œè„šæœ¬ï¼Œæ ·å¼ï¼Œxml å’Œ json ç­‰éƒ½åº”è¯¥è¢«gzipï¼Œ<strong>è€Œå›¾ç‰‡ï¼Œpdfç­‰ä¸åº”è¯¥è¢«gzip</strong>ï¼Œå› ä¸ºå®ƒä»¬æœ¬èº«å·²è¢«å‹ç¼©è¿‡ï¼Œgzip å®ƒä»¬åªæ˜¯æµªè´¹ cpuï¼Œç”šè‡³å¢åŠ æ–‡ä»¶å¤§å°ã€‚</p><p> <strong>é…ç½® <code>ETags</code></strong></p><blockquote><p>åå•†ç¼“å­˜</p></blockquote><p>å®ä½“æ ‡è®°ï¼ˆEntity tagsï¼Œç®€ç§°ETagï¼‰æ˜¯æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´åˆ¤æ–­æµè§ˆå™¨ç¼“å­˜ä¸­æŸä¸ªç»„ä»¶æ˜¯å¦åŒ¹é…æœåŠ¡å™¨ç«¯åŸç»„ä»¶çš„ä¸€ç§æœºåˆ¶ã€‚å®ä½“å°±æ˜¯ç»„ä»¶ï¼šå›¾ç‰‡ï¼Œè„šæœ¬ï¼Œæ ·å¼ç­‰ã€‚ETagè¢«å½“ä½œéªŒè¯å®ä½“çš„æ¯”æœ€åæ›´æ”¹ï¼ˆlast-modifiedï¼‰æ—¥æœŸæ›´é«˜æ•ˆçš„æœºåˆ¶ã€‚ä¸€ä¸ªETagæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸ºä¸€ä¸ªç»„ä»¶æŸä¸€å…·ä½“ç‰ˆæœ¬çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å”¯ä¸€çš„æ ¼å¼çº¦æŸæ˜¯å­—ç¬¦ä¸²å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚æœåŠ¡å™¨è¿™æ ·è®¾ç½®ç»„ä»¶çš„ETagï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Last-Modified</span><span class="hljs-punctuation">: </span>Tue, 12 Dec 2006 03:03:59 GMT<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>&quot;10c24bc-4ab-457e1c1f&quot;<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>12195<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œå¦‚æœæµè§ˆå™¨è¦éªŒè¯ç»„ä»¶ï¼Œå®ƒç”¨ <code>If-None-Match</code> å¤´éƒ¨æ¥æŠŠ ETag ä¼ å›æœåŠ¡å™¨ã€‚å¦‚æœ ETag åŒ¹é…æˆåŠŸï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç 304ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-keyword">GET</span> <span class="hljs-string">/i/yahoo.gif</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>us.yimg.com<br><span class="hljs-attribute">If-Modified-Since</span><span class="hljs-punctuation">: </span>Tue, 12 Dec 2006 03:03:59 GMT<br><span class="hljs-attribute">If-None-Match</span><span class="hljs-punctuation">: </span>&quot;10c24bc-4ab-457e1c1f&quot;<br>HTTP/1.1 304 Not Modified<br></code></pre></td></tr></table></figure><p>ETag çš„é—®é¢˜æ˜¯å®ƒä»¬è¢«æ„é€ æ¥ä½¿å®ƒä»¬å¯¹ç‰¹å®šçš„è¿è¡Œè¿™ä¸ªç½‘ç«™çš„å”¯ä¸€æœåŠ¡å™¨ã€‚</p><p>æµè§ˆå™¨ä»ä¸€ä¸ªæœåŠ¡å™¨è·å–ç»„ä»¶ï¼Œä¹‹åå‘å¦ä¸€ä¸ªæœåŠ¡å™¨éªŒè¯ï¼ŒETag å°†ä¸åŒ¹é…ã€‚</p><p>ç„¶è€ŒæœåŠ¡å™¨é›†ç¾¤æ˜¯å¤„ç†è¯·æ±‚çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä¸èƒ½è§£å†³å¤šæœåŠ¡å™¨é—´çš„ ETag åŒ¹é…é—®é¢˜ï¼Œé‚£ä¹ˆåˆ é™¤ ETag å¯èƒ½æ›´å¥½ã€‚</p><p><strong>å°½æ—©æ¸…ç©ºç¼“å†²åŒº</strong></p><p>å½“ç”¨æˆ·è¯·æ±‚ä¸€ä¸ªé¡µé¢ï¼ŒæœåŠ¡å™¨ä¸€èˆ¬è¦èŠ± <code>200-500ms</code> æ¥æ¸²æŸ“æ•´ä¸ªé¡µé¢ã€‚è¿™æ®µæ—¶é—´ï¼Œæµè§ˆå™¨æ˜¯ç©ºé—²çš„ï¼ˆç­‰å¾…æ•°æ®è¿”å›ï¼‰ã€‚åœ¨ <code>php</code>ä¸­ï¼Œæœ‰ä¸ªæ–¹æ³• <code>flush()</code> å…è®¸ä¼ è¾“éƒ¨åˆ†å‡†å¤‡å¥½çš„ <code>html</code> å“åº”ç»™æµè§ˆå™¨ã€‚è¿™æ ·çš„è¯æµè§ˆå™¨å°±å¯ä»¥å¼€å§‹ä¸‹è½½ç»„ä»¶ï¼Œè€ŒåŒæ—¶åå°å¯ä»¥ç»§ç»­ç”Ÿæˆé¡µé¢å‰©ä¸‹çš„éƒ¨åˆ†ã€‚è¿™ç§å¥½å¤„æ›´å¤šæ˜¯åœ¨å¿™ç¢Œçš„åå°æˆ–è½»å‰ç«¯ç½‘ç«™å¯ä»¥çœ‹åˆ°ã€‚</p><p>è¾ƒç†æƒ³çš„æ¸…ç©ºç¼“å†²åŒºçš„ä½ç½®æ˜¯<code>HEAD</code>åé¢ï¼Œå› ä¸º<code>HTML</code>çš„<code>HEAD</code>éƒ¨åˆ†é€šå¸¸æ›´å®¹æ˜“ç”Ÿæˆï¼Œå¹¶ä¸”å…è®¸å¼•å…¥ä»»ä½•<code>CSS</code>å’Œ<code>JavaScript</code>æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥è®©æµè§ˆå™¨åœ¨åå°è¿˜åœ¨å¤„ç†çš„æ—¶å€™å°±å¼€å§‹å¹¶è¡Œè·å–ç»„ä»¶ã€‚</p><p> <strong>å¯¹Ajaxç”¨GETè¯·æ±‚</strong></p><p>å½“ä½¿ç”¨ <code>XMLHttpRequest </code>æ—¶ï¼Œ<code>POST</code>è¯·æ±‚è¢«æµè§ˆå™¨å®ç°ä¸ºä¸¤æ­¥ï¼šé¦–å…ˆå‘é€å¤´éƒ¨ï¼Œç„¶åå‘é€æ•°æ®ã€‚æ‰€ä»¥æœ€å¥½ä½¿ç”¨ <code>GET</code>ï¼Œä»…ç”¨ä¸€ä¸ª <code>TCP </code>åŒ…å‘é€ï¼ˆé™¤é<code>cookie</code>å¤ªå¤šï¼‰ã€‚å¦‚æœPOSTä¸æäº¤ä»»ä½•æ•°æ®ï¼Œé‚£å®ƒè·Ÿ GET è¡Œä¸ºç±»ä¼¼ã€‚ä½†ä»è¯­ä¹‰ä¸Šè®²ï¼Œè·å–æ•°æ®åº”è¯¥ç”¨ <code>GET</code>ï¼Œæäº¤æ•°æ®åˆ°æœåŠ¡å™¨ç”¨ <code>POST</code>ã€‚</p><p><strong>é¿å…å›¾ç‰‡<code>src</code>å±æ€§ä¸ºç©º</strong></p><p>ç©º<code>src</code>å±æ€§çš„å›¾ç‰‡çš„è¡Œä¸ºæœ‰ä¸¤ç§å½¢å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;img src=<span class="hljs-string">&quot;&quot;</span>&gt;  <span class="hljs-comment">// htmlæ ‡ç­¾ï¼š</span><br><span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>(); img.<span class="hljs-property">src</span> = <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment">// js</span><br></code></pre></td></tr></table></figure><ul><li>ä¸Šé¢çš„ä¸¤ç§å½¢å¼éƒ½ä¼šé€ æˆåŒä¸€ç§åæœï¼šæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€å¦ä¸€ä¸ªè¯·æ±‚ã€‚</li><li>å‘é€å¤§é‡çš„æ„æ–™ä¹‹å¤–çš„æµé‡ï¼Œä¼šå‰Šå¼±æœåŠ¡å™¨ï¼Œç”šè‡³å¯èƒ½ä¼šç ´åç”¨æˆ·æ•°æ®ã€‚å¦‚æœä½ åœ¨è·Ÿè¸ªè¯·æ±‚çŠ¶æ€ï¼Œé€šè¿‡ cookie æˆ–å…¶å®ƒï¼Œå¯èƒ½ä¼šç ´åæ•°æ®ã€‚å³ä½¿ image çš„è¯·æ±‚ä¸ä¼šè¿”å›å›¾ç‰‡ï¼Œä½†æ‰€æœ‰çš„å¤´éƒ¨æ•°æ®éƒ½è¢«æµè§ˆå™¨è¯»å–äº†ï¼ŒåŒ…æ‹¬ cookieã€‚å³ä½¿å‰©ä¸‹çš„å“åº”ä½“è¢«ä¸¢å¼ƒï¼Œç ´åå¯èƒ½å·²ç»å‘ç”Ÿã€‚ è¿™ç§è¡Œä¸ºçš„æ ¹æºæ˜¯ <code>uri </code>è§£æå‘ç”Ÿåœ¨æµè§ˆå™¨ã€‚</li><li>RFC 3986 å®šä¹‰äº†è¿™ç§è¡Œä¸ºï¼Œç©ºå­—ç¬¦ä¸²è¢«å½“ä½œç›¸å¯¹è·¯å¾„ï¼ŒFirefox, Safari, å’Œ Chromeéƒ½æ­£ç¡®è§£æã€‚æ€»ä¹‹ï¼Œæµè§ˆå™¨è§£æç©ºå­—ç¬¦ä¸²ä¸ºç›¸å¯¹è·¯å¾„çš„è¡Œä¸ºè¢«è®¤ä¸ºæ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚</li><li>html5åœ¨4.8.2æ·»åŠ äº†å¯¹æ ‡ç­¾srcå±æ€§çš„æè¿°ï¼ŒæŒ‡å¯¼æµè§ˆå™¨ä¸è¦å‘å‡ºé¢å¤–çš„è¯·æ±‚ã€‚å¹¸è¿çš„æ˜¯å°†æ¥æµè§ˆå™¨ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†ï¼ˆä»…åœ¨å›¾ç‰‡ä¸Šï¼‰ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ<code>&lt;script src=&quot;&quot;&gt;</code>å’Œ<code>&lt;link href=&quot;&quot;&gt;</code>æ²¡æœ‰è¿™æ ·çš„è§„èŒƒã€‚</li></ul><h3 id="5-JavaScript-ä¼˜åŒ–"><a href="#5-JavaScript-ä¼˜åŒ–" class="headerlink" title="5. JavaScript ä¼˜åŒ–"></a>5. <code>JavaScript </code>ä¼˜åŒ–</h3><p><strong>æŠŠè„šæœ¬æ”¾åˆ°åº•éƒ¨</strong></p><ul><li>è„šæœ¬ä¼šé˜»å¡å¹¶è¡Œä¸‹è½½ã€‚HTTP&#x2F;1.1 è§„èŒƒå»ºè®®æµè§ˆå™¨æ¯ä¸ªåŸŸåä¸‹ä¸è¦å¹¶è¡Œä¸‹è½½è¶…è¿‡2ä¸ªç»„ä»¶ã€‚å¦‚æœå›¾ç‰‡åˆ†æ•£åœ¨ä¸åŒæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±èƒ½å¹¶è¡Œä¸‹è½½å¤šä¸ªå›¾ç‰‡ã€‚å¦‚æœè„šæœ¬æ­£åœ¨ä¸‹è½½ï¼Œæµè§ˆå™¨å°±ä¸å¼€å§‹ä»»ä½•å…¶å®ƒä¸‹è½½ä»»åŠ¡ï¼Œå³ä½¿æ˜¯åœ¨ä¸åŒä¸»æœºåä¸‹çš„ã€‚</li><li>æœ‰äº›æƒ…å†µä¸‹ï¼ŒæŠŠè„šæœ¬ç§»åŠ¨åˆ°åº•éƒ¨å¹¶ä¸ç®€å•ã€‚æ¯”å¦‚ï¼Œè„šæœ¬ä¸­ç”¨äº† <code>document.write</code> æ¥æ’å…¥å†…å®¹ï¼Œå®ƒå°±ä¸èƒ½è¢«ç§»åŠ¨åˆ°åº•éƒ¨ã€‚å¦å¤–æœ‰å¯èƒ½æœ‰ä½œç”¨åŸŸé—®é¢˜ã€‚ä½†å¤§å¤šæ•°æƒ…å†µï¼Œè¿™äº›é—®é¢˜éƒ½æœ‰åŠæ³•è§£å†³ã€‚</li><li>ä¸€ä¸ªæ›¿ä»£å»ºè®®æ˜¯ä½¿ç”¨å¼‚æ­¥è„šæœ¬ã€‚<code>defer/async</code>å±æ€§è¡¨æ˜è„šæœ¬ä¸åŒ…å« <code>document.write</code>ï¼Œå¹¶ä¸”æç¤ºæµè§ˆå™¨å¯ä»¥ç»§ç»­æ¸²æŸ“ã€‚å¦‚æœè„šæœ¬èƒ½å¼‚æ­¥åŠ è½½ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥æŠŠå®ƒç§»åŠ¨åˆ°åº•éƒ¨ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§åŠ å¿«ç½‘é¡µè¿è¡Œé€Ÿåº¦ã€‚</li><li>è¿™é‡Œè¦æ³¨æ„<code>JavaScript</code>æ˜¯ä¼šé˜»å¡æµè§ˆå™¨è¿è¡Œçš„ï¼Œæ‰€ä»¥è„šæœ¬æ–‡ä»¶å°½é‡æ”¾åˆ°é¡µé¢çš„æœ€ä¸‹é¢ã€‚</li></ul><p><strong>ä½¿ç”¨å¤–éƒ¨JavaScriptå’ŒCSS</strong></p><ul><li>å®é™…ä¸Šï¼Œä½¿ç”¨å¤–éƒ¨æ–‡ä»¶ä¸€èˆ¬å¯ä»¥è®©é¡µé¢åŠ è½½æ›´å¿«ï¼Œå› ä¸º JS å’Œ CSS æ–‡ä»¶ä¼šè¢«æµè§ˆå™¨ç¼“å­˜ã€‚å†…è€Œè”çš„ JavaScript å’ŒCSS åœ¨æ¯æ¬¡ HTML æ–‡æ¡£ä¸‹è½½æ—¶éƒ½è¢«ä¸‹è½½ã€‚è™½ç„¶å†…è”å‡å°‘äº†<code>http</code>è¯·æ±‚ï¼Œä½†å¢åŠ äº†<code>HTML</code>æ–‡æ¡£å¤§å°ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ <code>JavaScript </code>å’Œ <code>CSS </code>è¢«ç¼“å­˜äº†ï¼Œé‚£ä¹ˆ HTML æ–‡æ¡£å¯ä»¥å‡å°å¤§å°è€Œä¸å¢åŠ  HTTP è¯·æ±‚ã€‚</li><li>æ ¸å¿ƒå› ç´ å°±æ˜¯ <code>JavaScript </code>å’Œ <code>CSS </code>è¢«ç¼“å­˜ç›¸å¯¹äº HTML æ–‡æ¡£è¢«è¯·æ±‚çš„é¢‘ç‡ã€‚å¦‚æœç½‘ç«™ç”¨æˆ·æ¯ä¸ªä¼šè¯æ‰“å¼€äº†å¤šä¸ªé¡µé¢ï¼Œè®¸å¤šé¡µé¢é‡å¤ä½¿ç”¨ç›¸åŒçš„ JavaScript å’ŒCSSï¼Œé‚£ä¹ˆæœ‰å¾ˆå¤§å¯èƒ½ç”¨å¤–éƒ¨ JS å’Œ CSS æ›´å¥½ã€‚</li><li>è®¸å¤šç½‘ç«™ç”¨è¿™äº›æŒ‡æ ‡è®¡ç®—ååœ¨ä¸­é—´ä½ç½®ã€‚å¯¹è¿™äº›ç½‘ç«™æ¥è¯´ï¼Œæœ€ä½³æ–¹æ¡ˆè¿˜æ˜¯ç”¨å¤–éƒ¨ JS å’Œ CSS æ–‡ä»¶ã€‚å”¯ä¸€ä¾‹å¤–æ˜¯å†…è”æ›´è¢«ä¸»é¡µåçˆ±ã€‚ä¸»é¡µæ¯ä¸ªä¼šè¯å¯èƒ½åªä¼šæ‰“å¼€å°‘é‡ç”šè‡³ä¸€ä¸ªé¡µé¢ï¼Œè¿™æ—¶å€™å†…è”å¯èƒ½æ›´å¿«ã€‚</li></ul><blockquote><p>æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©</p></blockquote><p><strong>å‹ç¼©JSå’ŒCSS</strong></p><ul><li>å‹ç¼©å°±æ˜¯åˆ é™¤ä»£ç ä¸­ä¸å¿…è¦çš„å­—ç¬¦æ¥å‡å°æ–‡ä»¶å¤§å°ï¼Œä»è€Œæé«˜åŠ è½½é€Ÿåº¦ã€‚å½“ä»£ç å‹ç¼©æ—¶ï¼Œæ³¨é‡Šåˆ é™¤ï¼Œä¸éœ€è¦çš„ç©ºæ ¼ï¼ˆç©ºç™½ï¼Œæ¢è¡Œï¼Œtabï¼‰ä¹Ÿè¢«åˆ é™¤ã€‚åœ¨<code>JavaScript</code>ä¸­è¿™æ ·åšèƒ½å¤Ÿæé«˜å“åº”æ€§èƒ½ï¼Œå› ä¸ºè¦ä¸‹è½½çš„æ–‡ä»¶å˜å°äº†ã€‚ä¸¤ä¸ªæœ€å¸¸ç”¨çš„<code>JavaScript</code>ä»£ç å‹ç¼©å·¥å…·æ˜¯<code>JSMin</code>å’Œ<code>YUI Compressor</code>ï¼Œ<code>YUI compressor</code>è¿˜å¯ä»¥å‹ç¼©<code>CSS</code>ã€‚</li><li>æ··æ·†æ˜¯å¯¹ä»£ç å¯é€‰çš„ä¼˜åŒ–ã€‚å®ƒæ¯”å‹ç¼©æ›´å¤æ‚ï¼Œå¹¶ä¸”å¯èƒ½äº§ç”Ÿ <code>bug</code>ã€‚åœ¨å¯¹ç¾å›½ Top10 ç½‘ç«™çš„è°ƒæŸ¥ä¸­ï¼Œå‹ç¼©å¯å‡å° <code>21%</code>ï¼Œè€Œæ··æ·†å¯ä»¥å‡å° <code>25%</code>ã€‚é™¤äº†å¤–éƒ¨è„šæœ¬å’Œæ ·å¼ï¼Œå†…è”çš„è„šæœ¬å’Œæ ·å¼åŒæ ·åº”è¯¥è¢«å‹ç¼©ã€‚</li><li>é™¤äº†å‹ç¼©å¤–éƒ¨è„šæœ¬å’Œæ ·å¼ï¼Œè¡Œå†…çš„<code>&lt;script&gt;</code>å’Œ<code>&lt;style&gt;</code>å—ä¹Ÿå¯ä»¥å‹ç¼©ã€‚å³ä½¿å¯ç”¨äº†<code>gzip</code>æ¨¡å—ï¼Œå…ˆè¿›è¡Œå‹ç¼©ä¹Ÿèƒ½å¤Ÿç¼©å°<code>5%</code>æˆ–è€…æ›´å¤šçš„å¤§å°ã€‚<code>JavaScript</code>å’Œ<code>CSS</code>çš„ç”¨å¤„è¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥å‹ç¼©ä»£ç ä¼šæœ‰ä¸é”™çš„æ•ˆæœã€‚</li></ul><p><strong>åˆ é™¤é‡å¤çš„è„šæœ¬</strong></p><ul><li>åœ¨é¡µé¢ä¸­ä¸¤æ¬¡å¼•å…¥ç›¸åŒçš„è„šæœ¬ä¼šé™ä½æ€§èƒ½ã€‚å½“ç¡®å®å¼•å…¥é‡å¤è„šæœ¬ï¼Œä¼šå‘å‡ºä¸å¿…è¦çš„<code>http</code>è¯·æ±‚å’Œæµªè´¹<code>js</code>æ‰§è¡Œæ—¶é—´ã€‚</li><li>é™¤äº†äº§ç”Ÿæ²¡æœ‰æ„ä¹‰çš„<code>HTTP</code>è¯·æ±‚ä¹‹å¤–ï¼Œå¤šæ¬¡å¯¹è„šæœ¬æ±‚å€¼ä¹Ÿä¼šæµªè´¹æ—¶é—´, éƒ½ä¼šæ‰§è¡Œå†—ä½™çš„JavaScriptä»£ç ã€‚</li><li>é¿å…ä¸å°å¿ƒæŠŠç›¸åŒè„šæœ¬å¼•å…¥ä¸¤æ¬¡çš„ä¸€ç§æ–¹æ³•å°±æ˜¯åœ¨æ¨¡ç‰ˆç³»ç»Ÿä¸­å®ç°è„šæœ¬ç®¡ç†æ¨¡å—ã€‚</li></ul><p><strong>å°½é‡å‡å°‘DOMè®¿é—®</strong></p><p>ç”¨ JavaScript è®¿é—® DOM å…ƒç´ æ˜¯å¾ˆæ…¢çš„ï¼Œæ‰€ä»¥ä¸ºäº†è®©é¡µé¢ååº”æ›´è¿…é€Ÿï¼Œåº”è¯¥ï¼š</p><ul><li>ç¼“å­˜è®¿é—®è¿‡çš„å…ƒç´ çš„å¼•ç”¨ï¼›</li><li>åœ¨ DOM æ ‘å¤–æ›´æ–°èŠ‚ç‚¹ï¼Œç„¶åæ·»åŠ åˆ° DOM æ ‘ï¼›</li><li>é¿å…ç”¨JavaScriptä¿®å¤å¸ƒå±€é—®é¢˜ï¼›</li></ul><p>æ³¨æ„ï¼Œèƒ½ç”¨<code>CSS</code>è§£å†³çš„äº‹æƒ…ï¼Œå°±å°½é‡ä¸ç”¨<code>JS</code>æ“ä½œ<code>DOM</code>ï¼ŒDOMæ“ä½œå¼€é”€å¾ˆå¤§ã€‚</p><p><strong>ç”¨æ™ºèƒ½çš„äº‹ä»¶å¤„ç†å™¨</strong></p><p>æœ‰æ—¶å€™é¡µé¢çœ‹èµ·æ¥å“åº”é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ˜¯å› ä¸ºç»‘å®šåˆ°ä¸åŒå…ƒç´ çš„å¤§é‡äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå¤ªå¤šæ¬¡ã€‚ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨äº‹ä»¶å§”æ‰˜ã€‚å¦å¤–ï¼Œä¸å¿…ç­‰åˆ° <code>onload </code>äº‹ä»¶æ¥å¼€å§‹å¤„ç† <code>DOM </code>æ ‘ï¼Œä½¿ç”¨<code>DOMContentLoaded </code>ä¼šæ›´å¿«ã€‚å¤§å¤šæ—¶å€™éœ€è¦çš„åªæ˜¯æƒ³è®¿é—®çš„å…ƒç´ å·²åœ¨ <code>DOM </code>æ ‘ä¸­ï¼Œæ‰€ä»¥ä¸å¿…ç­‰åˆ°æ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œã€‚</p><blockquote><p>æ³¨æ„ï¼š</p></blockquote><ul><li><code>onLoad</code>æ˜¯çš„åœ¨é¡µé¢æ‰€æœ‰æ–‡ä»¶åŠ è½½å®Œæˆåæ‰§è¡Œï¼›</li><li><code>DomContentLoad</code>æ˜¯<code>Dom</code>åŠ è½½å®Œæˆåæ‰§è¡Œï¼Œ<strong>ä¸å¿…ç­‰å¾…æ ·å¼è„šæœ¬å’Œå›¾ç‰‡åŠ è½½ã€‚</strong></li></ul><h3 id="6-ç§»åŠ¨ç«¯ä¼˜åŒ–"><a href="#6-ç§»åŠ¨ç«¯ä¼˜åŒ–" class="headerlink" title="6. ç§»åŠ¨ç«¯ä¼˜åŒ–"></a>6. ç§»åŠ¨ç«¯ä¼˜åŒ–</h3><p><strong>ä¿æŒç»„ä»¶å°äº25K</strong></p><p>è¿™ä¸ªé™åˆ¶æ˜¯å› ä¸º<code>iPhone</code>ä¸èƒ½ç¼“å­˜å¤§äº<code>25K</code>çš„ç»„ä»¶ï¼Œæ³¨æ„è¿™é‡ŒæŒ‡çš„æ˜¯æœªå‹ç¼©çš„å¤§å°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¼©å‡å†…å®¹æœ¬èº«ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºå•çº¯çš„<code>gzip</code>å¯èƒ½ä¸å¤Ÿã€‚</p><p> <strong>ç»„ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªå¤åˆæ–‡æ¡£ä¸­</strong></p><p>å°†ç»„ä»¶æ‰“åŒ…åˆ°å¤åˆæ–‡æ¡£å°±åƒå¸¦æœ‰é™„ä»¶çš„ç”µå­é‚®ä»¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª <code>HTTP </code>è¯·æ±‚è·å–å¤šä¸ªç»„ä»¶ï¼ˆè¯·è®°ä½ï¼š<code>HTTP </code>è¯·æ±‚å¾ˆæ˜‚è´µï¼‰ã€‚ä½¿ç”¨æ­¤æŠ€æœ¯æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç”¨æˆ·ä»£ç†æ˜¯å¦æ”¯æŒå®ƒ( <code>iPhone </code>å°±ä¸æ”¯æŒ)ã€‚</p><h3 id="7-å†…å®¹ä¼˜åŒ–"><a href="#7-å†…å®¹ä¼˜åŒ–" class="headerlink" title="7. å†…å®¹ä¼˜åŒ–"></a>7. å†…å®¹ä¼˜åŒ–</h3><p><strong>å‡å°‘HTTPè¯·æ±‚æ•°</strong></p><p><code>80%</code>çš„ç»ˆç«¯ç”¨æˆ·å“åº”æ—¶é—´éƒ½èŠ±åœ¨äº†å‰ç«¯ä¸Šï¼Œå¤§éƒ¨åˆ†ç”¨äºä¸‹è½½ç»„ä»¶ <code>js/css/image/flash</code> ç­‰ã€‚å‡å°‘ç»„ä»¶æ•°å¿…ç„¶èƒ½å¤Ÿå‡å°‘æ¸²æŸ“é¡µé¢æ‰€éœ€çš„ <code>http </code>è¯·æ±‚æ•°ã€‚è¿™æ˜¯è®©é¡µé¢æ›´å¿«çš„å…³é”®ã€‚</p><blockquote><p>å‡å°‘ç»„ä»¶æ•°çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ç®€åŒ–é¡µé¢è®¾è®¡ã€‚ä¿æŒå¯Œå†…å®¹çš„é¡µé¢ä¸”èƒ½å‡å°‘ http è¯·æ±‚ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæŠ€æœ¯ï¼š</p></blockquote><ul><li><strong>Combined files</strong> (åˆå¹¶æ–‡ä»¶)ï¼šé€šè¿‡æŠŠæ‰€æœ‰è„šæœ¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ–¹å¼æ¥å‡å°‘è¯·æ±‚æ•°çš„ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥åˆå¹¶æ‰€æœ‰çš„<code>CSS</code>ã€‚å¦‚æœå„ä¸ªé¡µé¢çš„è„šæœ¬å’Œæ ·å¼ä¸ä¸€æ ·çš„è¯ï¼Œåˆå¹¶æ–‡ä»¶å°±æ˜¯ä¸€é¡¹æ¯”è¾ƒéº»çƒ¦çš„å·¥ä½œäº†ï¼Œä½†æŠŠè¿™ä¸ªä½œä¸ºç«™ç‚¹å‘å¸ƒè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ç¡®å®å¯ä»¥æé«˜å“åº”æ—¶é—´ã€‚</li><li><strong>CSS Sprites</strong>ï¼ˆé›ªç¢§å›¾ï¼‰ï¼šé›ªç¢§å›¾å¯ä»¥åˆå¹¶å¤šä¸ªèƒŒæ™¯å›¾ç‰‡ï¼Œé€šè¿‡ <code>background-image</code> å’Œ<code>background-position</code> æ¥æ˜¾ç¤ºä¸åŒéƒ¨åˆ†ã€‚</li><li><strong>Image maps</strong> ï¼ˆå›¾ç‰‡æ˜ å°„ï¼‰ï¼šå¯ä»¥æŠŠå¤šå¼ å›¾ç‰‡åˆå¹¶æˆå•å¼ å›¾ç‰‡ï¼Œæ€»å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œä½†å‡å°‘äº†è¯·æ±‚æ•°å¹¶åŠ é€Ÿäº†é¡µé¢åŠ è½½ã€‚å›¾ç‰‡æ˜ å°„åªæœ‰åœ¨å›¾åƒåœ¨é¡µé¢ä¸­è¿ç»­çš„æ—¶å€™æ‰æœ‰ç”¨ï¼Œæ¯”å¦‚å¯¼èˆªæ¡ã€‚ç»™<code>image map</code>è®¾ç½®åæ ‡çš„è¿‡ç¨‹æ—¢æ— èŠåˆå®¹æ˜“å‡ºé”™ï¼Œç”¨<code>image map</code>æ¥åšå¯¼èˆªä¹Ÿä¸å®¹æ˜“ï¼Œæ‰€ä»¥<strong>ä¸æ¨è</strong>ç”¨è¿™ç§æ–¹å¼ã€‚</li><li><strong>Inline images</strong> (å†…è”å›¾ç‰‡)ï¼šä½¿ç”¨ <code>data:url scheme</code> æ¥å†…è”å›¾ç‰‡ï¼Œå°†å†…åµŒå›¾åƒç»„åˆåˆ°ï¼ˆç¼“å­˜çš„ï¼‰æ ·å¼è¡¨ä¸­åŒæ ·ä¹Ÿæ˜¯ä¸€ç§å‡å°‘ <code>HTTP</code> è¯·æ±‚å¹¶é¿å…å¢åŠ é¡µé¢å¤§å°çš„æ–¹æ³•ã€‚<code>Inline images</code> è¿™é‡Œæ˜¯å°†çŸ¢é‡å›¾æ ‡è½¬æ¢ä¸º<code>base64</code>ç¼–ç ï¼Œç„¶åç›´æ¥å†…åµŒåˆ°<code>HTML</code>æ–‡ä»¶æˆ–è€…<code>CSS</code>æ–‡ä»¶å½“ä¸­ï¼Œå‡å°‘<code>http</code>è¯·æ±‚ã€‚</li></ul><p>å‡å°‘è¯·æ±‚æ•°æ˜¯ä¸ºç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢çš„ç”¨æˆ·æé«˜æ€§èƒ½çš„æœ€é‡è¦çš„æŒ‡å¯¼ã€‚</p><p><strong>å‡å°‘DNSæŸ¥è¯¢</strong></p><p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ç½‘å€ï¼Œé€šè¿‡ DNS æŸ¥è¯¢å¾—åˆ°ç½‘ç«™çœŸå® IPã€‚DNS æŸ¥è¯¢è¢«ç¼“å­˜æ¥å°±å¯ä»¥æé«˜æ€§èƒ½ã€‚è¿™ç§ç¼“å­˜å¯èƒ½å‘ç”Ÿåœ¨ç‰¹å®šçš„ç¼“å­˜æœåŠ¡å™¨ï¼ˆISP&#x2F;local area networkç»´æŠ¤ï¼‰ï¼Œæˆ–è€…ç”¨æˆ·çš„è®¡ç®—æœºã€‚DNS ä¿¡æ¯ç•™å­˜åœ¨æ“ä½œç³»ç»Ÿ DNS ç¼“å­˜ä¸­ã€‚å¤§å¤šæµè§ˆå™¨æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œç‹¬ç«‹äºæ“ä½œç³»ç»Ÿç¼“å­˜ã€‚åªè¦æµè§ˆå™¨åœ¨è‡ªå·±çš„ç¼“å­˜é‡Œæœ‰æŸæ¡DNS è®°å½•ï¼Œå®ƒå°±ä¸ä¼šå‘æ“ä½œç³»ç»Ÿå‘ DNS è§£æè¯·æ±‚ã€‚IEé»˜è®¤ç¼“å­˜ DNS è®°å½•30åˆ†é’Ÿï¼ŒFireFox é»˜è®¤ç¼“å­˜1åˆ†é’Ÿã€‚</p><p>å½“å®¢æˆ·ç«¯çš„ DNS ç¼“å­˜æ˜¯ç©ºçš„ï¼ŒDNS æŸ¥æ‰¾æ¬¡æ•°ç­‰äºé¡µé¢ä¸­çš„å”¯ä¸€åŸŸåæ•°ã€‚å‡å°‘DNSè¯·æ±‚æ•°å¯èƒ½ä¼šå‡å°‘å¹¶è¡Œä¸‹è½½æ•°ã€‚é¿å… DNS æŸ¥æ‰¾å‡å°‘å“åº”æ—¶é—´ï¼Œä½†å‡å°‘å¹¶è¡Œä¸‹è½½æ•°å¯èƒ½ä¼šå¢åŠ å“åº”æ—¶é—´ã€‚æŒ‡å¯¼åŸåˆ™æ˜¯ç»„ä»¶å¯ä»¥åˆ†æ•£åœ¨è‡³å°‘2ä¸ªä½†ä¸å¤šäº4ä¸ªçš„ä¸åŒåŸŸåã€‚è¿™æ˜¯è¿™ä¸¤è€…çš„ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚</p><p><strong>é¿å…é‡å®šå‘</strong></p><p>é‡å®šå‘ç”¨301æˆ–302çŠ¶æ€ç æ¥å®Œæˆã€‚</p><blockquote><p>ä¸€ä¸ª301å“åº” http å¤´çš„ä¾‹å­ï¼š</p></blockquote><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">301</span> Moved Permanently<br><span class="hljs-attribute">Location</span><span class="hljs-punctuation">: </span>http://example.com/newuri<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html<br></code></pre></td></tr></table></figure><ul><li>æµè§ˆå™¨è‡ªåŠ¨è·³è½¬åˆ° <code>Location </code>æŒ‡å®šçš„è·¯å¾„ã€‚é‡å®šå‘æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ <code>http </code>å¤´éƒ¨ï¼Œæ‰€ä»¥ <code>http</code>ä¸»ä½“ä¸€èˆ¬æ˜¯ç©ºçš„ã€‚301å’Œ302å“åº”ä¸€èˆ¬ä¸ä¼šè¢«ç¼“å­˜ï¼Œé™¤éæœ‰é¢å¤–çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæ¯”å¦‚ Expires æˆ– Cache-Control æŒ‡å®šè¦ç¼“å­˜ã€‚meta åˆ·æ–°æ ‡ç­¾æˆ– JavaScript ä¹Ÿå¯ä»¥è·³è½¬ï¼Œä½†å¦‚æœçœŸè¦è·³è½¬ï¼Œ3xxè·³è½¬æ›´å¥½ï¼Œä¸»è¦æ˜¯ä¿è¯è¿”å›é”®å¯ç”¨ã€‚</li><li>æœ€é‡è¦çš„æ˜¯é‡å®šå‘ä¼šé™ä½ç”¨æˆ·ä½“éªŒã€‚åœ¨ç”¨æˆ·å’Œ HTML æ–‡æ¡£ä¹‹é—´æ’å…¥é‡å®šå‘ä¼šå»¶è¿Ÿé¡µé¢ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œå› ä¸ºé¡µé¢ä¸­çš„ä»»ä½•å†…å®¹éƒ½æ— æ³•å‘ˆç°ï¼Œå¹¶ä¸”åœ¨ HTML æ–‡æ¡£åˆ°è¾¾ä¹‹å‰ä¸ä¼šå¼€å§‹ä¸‹è½½ä»»ä½•ç»„ä»¶ã€‚</li><li>æœ€æµªè´¹çš„è·³è½¬ä¹‹ä¸€å‘ç”Ÿåœ¨urlå°¾éƒ¨æ–œæ ï¼ˆ&#x2F;ï¼‰ç¼ºå¤±ã€‚æ¯”å¦‚<a href="http://astrology.yahoo.com/astrology%E4%BC%9A301%E8%B7%B3%E8%BD%AC%E5%88%B0http://astrology.yahoo.com/astrology/%E3%80%82%E8%BF%99%E5%8F%AF%E4%BB%A5%E8%A2%ABApache%E7%AD%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%AE%E5%A4%8D%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFApache%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%EF%BC%8C%E5%88%99%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8Alias%EF%BC%8Cmod_rewrite%E6%88%96DirectorySlash%E6%8C%87%E4%BB%A4%E6%9D%A5%E5%8F%96%E6%B6%88%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91%E3%80%82">http://astrology.yahoo.com/astrologyä¼š301è·³è½¬åˆ°http://astrology.yahoo.com/astrology/ã€‚è¿™å¯ä»¥è¢«Apacheç­‰æœåŠ¡å™¨ä¿®å¤ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯Apacheå¤„ç†ç¨‹åºï¼Œåˆ™å¯ä»¥ä½¿ç”¨Aliasï¼Œmod_rewriteæˆ–DirectorySlashæŒ‡ä»¤æ¥å–æ¶ˆä¸å¿…è¦çš„é‡å®šå‘ã€‚</a></li><li>é‡å®šå‘æœ€å¸¸è§çš„ç”¨é€”æ˜¯æŠŠæ—§ç«™ç‚¹è¿æ¥åˆ°æ–°çš„ç«™ç‚¹ï¼Œè¿˜å¯ä»¥è¿æ¥åŒä¸€ç«™ç‚¹çš„ä¸åŒéƒ¨åˆ†ï¼Œé’ˆå¯¹ç”¨æˆ·çš„ä¸åŒæƒ…å†µï¼ˆæµè§ˆå™¨ç±»å‹ï¼Œç”¨æˆ·å¸å·ç±»å‹ç­‰ï¼‰åšä¸€äº›å¤„ç†ã€‚ç”¨é‡å®šå‘æ¥è¿æ¥ä¸¤ä¸ªç½‘ç«™æ˜¯æœ€ç®€å•çš„ï¼Œåªéœ€è¦å°‘é‡çš„é¢å¤–ä»£ç ã€‚è™½ç„¶åœ¨è¿™äº›æ—¶å€™ä½¿ç”¨é‡å®šå‘å‡å°‘äº†å¼€å‘äººå‘˜çš„å¼€å‘å¤æ‚åº¦ï¼Œä½†é™ä½äº†ç”¨æˆ·ä½“éªŒã€‚ä¸€ç§æ›¿ä»£æ–¹æ¡ˆæ˜¯ç”¨Aliaså’Œmod_rewriteï¼Œå‰ææ˜¯ä¸¤ä¸ªä»£ç è·¯å¾„éƒ½åœ¨ç›¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚å¦‚æœæ˜¯å› ä¸ºåŸŸåå˜åŒ–è€Œä½¿ç”¨äº†é‡å®šå‘ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€æ¡CNAMEï¼ˆåˆ›å»ºä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªåŸŸåçš„DNSè®°å½•ä½œä¸ºåˆ«åï¼‰ç»“åˆAliasæˆ–è€…mod_rewriteæŒ‡ä»¤ã€‚</li></ul><p><strong>è®©Ajaxå¯ç¼“å­˜</strong></p><p>ä½¿ç”¨ ajax çš„å¥½å¤„æ˜¯å¯ä»¥å‘ç”¨æˆ·æä¾›å¾ˆå¿«çš„åé¦ˆï¼Œå› ä¸ºå®ƒæ˜¯å‘åå°å¼‚æ­¥è¯·æ±‚æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™äº›å¼‚æ­¥è¯·æ±‚ä¸ä¿è¯ç”¨æˆ·ç­‰å¾…çš„æ—¶é—´â€”â€”å¼‚æ­¥ä¸æ„å‘³ç€ç¬æ—¶ã€‚æé«˜ajaxæ€§èƒ½çš„æœ€é‡è¦çš„æ–¹æ³•æ˜¯è®©å“åº”è¢«ç¼“å­˜ï¼Œå³åœ¨ä¸Šé¢è®¨è®ºçš„ Expires ã€‚å…¶å®ƒæ–¹æ³•æ˜¯ï¼š</p><ul><li>gzip ç»„ä»¶</li><li>å‡å°‘ DNS æŸ¥æ‰¾</li><li>å‹ç¼© JS</li><li>é¿å…è·³è½¬</li><li>è®¾ç½® ETags</li></ul><p><strong>å»¶è¿ŸåŠ è½½ç»„ä»¶</strong></p><p>æˆ‘ä»¬éœ€è¦è€ƒè™‘ä»€ä¹ˆæ˜¯é¡µé¢åˆå§‹åŒ–æ—¶æ‰€å¿…é¡»çš„ã€‚å‰©ä¸‹çš„å†…å®¹å’Œç»„ä»¶å°±å¯ä»¥å»¶è¿ŸåŠ è½½ã€‚<code>JavaScript </code>æ˜¯ç†æƒ³çš„ï¼ˆå»¶è¿Ÿï¼‰å€™é€‰è€…ï¼Œå¯ä»¥åˆ‡åˆ†åˆ° <code>onload </code>äº‹ä»¶ä¹‹å‰å’Œä¹‹åã€‚æ¯”å¦‚æ‹–æ”¾çš„ <code>js</code>åº“å¯ä»¥å»¶è¿Ÿï¼Œå› ä¸ºæ‹–åŠ¨å¿…é¡»åœ¨é¡µé¢åˆå§‹åŒ–ä¹‹åã€‚å…¶å®ƒå¯å»¶è¿Ÿçš„åŒ…æ‹¬éšè—çš„å†…å®¹ï¼ŒæŠ˜å èµ·æ¥çš„å›¾ç‰‡ç­‰ã€‚</p><p><strong>é¢„åŠ è½½ç»„ä»¶</strong></p><p>é¢„åŠ è½½çœ‹èµ·æ¥ä¸å»¶è¿ŸåŠ è½½æ˜¯ç›¸åçš„ï¼Œä½†å®ƒçš„ç¡®æœ‰ä¸åŒçš„ç›®æ ‡ã€‚é€šè¿‡é¢„åŠ è½½å¯ä»¥åˆ©ç”¨æµè§ˆå™¨çš„ç©ºé—²æ—¶é—´æ¥è¯·æ±‚å°†æ¥ä¼šç”¨åˆ°çš„ç»„ä»¶ã€‚è¿™æ ·å½“ç”¨æˆ·è®¿é—®ä¸‹ä¸€ä¸ªé¡µé¢æ—¶ï¼Œä¼šæœ‰æ›´å¤šçš„ç»„ä»¶å·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œè¿™æ ·ä¼šæå¤§åŠ å¿«é¡µé¢åŠ è½½ã€‚é¢„åŠ è½½ç±»å‹ï¼š</p><ul><li>æ— æ¡ä»¶é¢„åŠ è½½ï¼šä¸€æ—¦ <code>onload </code>è§¦å‘ï¼Œä½ ç«‹å³è·å–å¦å¤–çš„ç»„ä»¶ã€‚æ¯”å¦‚è°·æ­Œä¼šåœ¨ä¸»é¡µè¿™æ ·åŠ è½½æœç´¢ç»“æœé¡µé¢ç”¨åˆ°çš„é›ªç¢§å›¾ã€‚</li><li>æœ‰æ¡ä»¶é¢„åŠ è½½ï¼šåŸºäºç”¨æˆ·åŠ¨ä½œï¼Œæ¨æµ‹ç”¨æˆ·ä¸‹ä¸€æ­¥ä¼šå»å“ªé‡Œå¹¶åŠ è½½ç›¸åº”ç»„ä»¶ã€‚</li><li>é¢„æœŸçš„é¢„åŠ è½½ï¼šåœ¨å‘å¸ƒé‡æ–°è®¾è®¡çš„ç½‘ç«™å‰æå‰åŠ è½½ã€‚åœ¨æ—§ç½‘é¡µé¢„åŠ è½½æ–°ç½‘é¡µçš„éƒ¨åˆ†ç»„ä»¶ï¼Œé‚£ä¹ˆåˆ‡æ¢åˆ°æ–°ç½‘é¡µæ—¶å°±ä¸ä¼šæ˜¯æ²¡æœ‰ä»»ä½•ç¼“å­˜äº†ã€‚</li></ul><p><strong>å‡å°‘DOMå…ƒç´ çš„æ•°é‡</strong></p><p>ä¸€ä¸ªå¤æ‚çš„é¡µé¢æ„å‘³ç€æ›´å¤šçš„å†…å®¹éœ€è¦ä¸‹è½½ï¼Œä»¥åŠæ›´æ…¢çš„ <code>DOM </code>è®¿é—®ã€‚æ¯”å¦‚åœ¨æœ‰ 500ä¸ªDOM å…ƒç´ çš„é¡µé¢æ·»åŠ äº‹ä»¶å¤„ç†å°±å’Œæœ‰ 5000 ä¸ªDOM å…ƒç´ æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><p>å¦‚æœé¡µé¢ DOM å…ƒç´ å¾ˆå¤šï¼Œé‚£ä¹ˆæ„å‘³ç€å¯èƒ½éœ€è¦åˆ é™¤æ— ç”¨çš„å†…å®¹å’Œæ ‡ç­¾æ¥ä¼˜åŒ–ã€‚</p><p><strong>æŠŠç»„ä»¶åˆ†æ•£åˆ°ä¸åŒçš„åŸŸå</strong></p><p>æŠŠç»„ä»¶åˆ†æ•£åˆ°ä¸åŒçš„åŸŸåå…è®¸ä½ æœ€å¤§åŒ–å¹¶è¡Œä¸‹è½½æ•°ã€‚ä½†è¦ç¡®ä¿åªç”¨ä¸è¶…è¿‡<code>2-4</code>ä¸ªåŸŸï¼Œå› ä¸ºå­˜åœ¨<code>DNS</code>æŸ¥æ‰¾çš„ä»£ä»·ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŠŠ<code>HTML</code>å’ŒåŠ¨æ€å†…å®¹éƒ¨ç½²åœ¨<a href="http://www.example.orgï¼Œè€ŒæŠŠé™æ€ç»„ä»¶åˆ†ç¦»åˆ°[static1.example.org]()å’Œ[static2.example.org]()ã€‚">www.example.orgï¼Œè€ŒæŠŠé™æ€ç»„ä»¶åˆ†ç¦»åˆ°[static1.example.org]()å’Œ[static2.example.org]()ã€‚</a></p><p><strong>å°½é‡å°‘ç”¨ iframe</strong></p><p><code>iframe </code>å…è®¸ <code>html </code>æ–‡æ¡£è¢«æ’å…¥åˆ°çˆ¶æ–‡æ¡£é‡Œã€‚</p><p>iframeçš„ä¼˜ç‚¹</p><ul><li><p>å¸®åŠ©è§£å†³ç¼“æ…¢çš„ç¬¬ä¸‰æ–¹å†…å®¹çš„åŠ è½½ï¼Œå¦‚å¹¿å‘Šå’Œæ ‡å¿—ï¼›</p></li><li><p>å¹¶è¡Œä¸‹è½½è„šæœ¬ï¼›</p></li><li><p>å®‰å…¨æ²™ç®±ï¼›</p></li></ul><p>iframeçš„ç¼ºç‚¹</p><ul><li>å³ä½¿ç©ºçš„ä¹Ÿæ¶ˆè€—ï¼ˆèµ„æºå’Œæ—¶é—´ï¼‰ï¼›</li><li>é˜»å¡äº†é¡µé¢çš„onloadï¼›</li><li>éè¯­ä¹‰åŒ–ï¼ˆæ ‡ç­¾ï¼‰ï¼›</li></ul><p><strong>æœç»404</strong></p><p><code>http </code>è¯·æ±‚æ˜¯æ˜‚è´µçš„ï¼Œæ‰€ä»¥å‘å‡º <code>http </code>è¯·æ±‚ä½†è·å¾—æ²¡ç”¨çš„å“åº”ï¼ˆå¦‚404ï¼‰æ˜¯å®Œå…¨ä¸å¿…è¦çš„ï¼Œå¹¶ä¸”ä¼šé™ä½ç”¨æˆ·ä½“éªŒã€‚ä¸€äº›ç½‘ç«™ä¼šæœ‰ç‰¹åˆ«çš„ 404 é¡µé¢æé«˜ç”¨æˆ·ä½“éªŒï¼Œä½†è¿™ä»ç„¶ä¼šæµªè´¹æœåŠ¡å™¨èµ„æºã€‚æœ€åçš„æƒ…å†µçš„æ˜¯å½“é“¾æ¥æŒ‡å‘å¤–éƒ¨ <code>js</code>ä½†å´å¾—åˆ° <code>404 </code>ç»“æœï¼Œè¿™æ ·é¦–å…ˆä¼šå ç”¨å¹¶è¡Œä¸‹è½½æ•°ï¼Œå…¶æ¬¡æµè§ˆå™¨å¯èƒ½ä¼šæŠŠ <code>404 </code>å“åº”ä½“å½“ä½œ <code>js</code>æ¥è§£æï¼Œè¯•å›¾ä»é‡Œé¢æ‰¾å‡ºå¯ç”¨çš„ä¸œè¥¿ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ€§èƒ½ä¼˜åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ€§èƒ½ä¼˜åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çŸ¥é“HTTPSå—? å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <link href="/2023/11/02/https/"/>
    <url>/2023/11/02/https/</url>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯-HTTPS"><a href="#ä»€ä¹ˆæ˜¯-HTTPS" class="headerlink" title="ä»€ä¹ˆæ˜¯ HTTPS?"></a>ä»€ä¹ˆæ˜¯ HTTPS?</h2><blockquote><p>HTTPSå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„åè®®, å®ƒåœ¨HTTPå’ŒTCPçš„ä¼ è¾“ä¸­<strong>å»ºç«‹äº†ä¸€ä¸ªå®‰å…¨å±‚</strong>ï¼Œåˆ©ç”¨<strong>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆæ•°å­—è¯ä¹¦è®¤è¯</strong>çš„æ–¹å¼ï¼Œè®©ä¼ è¾“è¿‡ç¨‹çš„å®‰å…¨æ€§å¤§å¤§æé«˜ã€‚</p></blockquote><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202311021222407.png" alt="img" style="zoom:67%;" /><p>HTTP åè®®é‡‡ç”¨<strong>æ˜æ–‡ä¼ è¾“</strong>ä¿¡æ¯ï¼Œå­˜åœ¨<strong>ä¿¡æ¯çªƒå¬</strong>ã€<strong>ä¿¡æ¯ç¯¡æ”¹</strong>å’Œ<strong>ä¿¡æ¯åŠ«æŒ</strong>çš„é£é™©</p><p>å…·ä½“æ¥è¯´ï¼ŒHTTP æ•°æ®ç»è¿‡ TCP å±‚ï¼Œç„¶åç»è¿‡ WIFI è·¯ç”±å™¨ã€è¿è¥å•†å’Œç›®æ ‡æœåŠ¡å™¨ï¼Œè¿™äº›ç¯èŠ‚ä¸­éƒ½å¯èƒ½è¢«ä¸­é—´äººæ‹¿åˆ°æ•°æ®å¹¶è¿›è¡Œç¯¡æ”¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„<strong>ä¸­é—´äººæ”»å‡»ã€‚</strong></p><p>è€Œåè®®<code>TLS/SSL</code>å…·æœ‰<strong>èº«ä»½éªŒè¯</strong>ã€<strong>ä¿¡æ¯åŠ å¯†</strong>å’Œ<strong>å®Œæ•´æ€§æ ¡éªŒ</strong>çš„åŠŸèƒ½ï¼Œå¯ä»¥é¿å…æ­¤ç±»é—®é¢˜å‘ç”Ÿã€‚å®‰å…¨å±‚çš„ä¸»è¦èŒè´£å°±æ˜¯<strong>å¯¹å‘èµ·çš„ HTTP è¯·æ±‚çš„æ•°æ®è¿›è¡ŒåŠ å¯†æ“ä½œ</strong> å’Œ <strong>å¯¹æ¥æ”¶åˆ°çš„ HTTP çš„å†…å®¹è¿›è¡Œè§£å¯†æ“ä½œ</strong>ã€‚</p><p><strong><code>TLS/SSL</code><strong>å…¨ç§°</strong>å®‰å…¨ä¼ è¾“å±‚åè®®</strong>ï¼ˆTransport Layer Securityï¼‰ï¼Œ æ˜¯ä»‹äº<code>TCP</code>å’Œ<code>HTTP</code>ä¹‹é—´çš„ä¸€å±‚å®‰å…¨åè®®ï¼Œä¸å½±å“åŸæœ‰çš„<code>TCP</code>åè®®å’Œ<code>HTTP</code>åè®®ï¼Œæ‰€ä»¥ä½¿ç”¨<code>HTTPS</code>åŸºæœ¬ä¸Šä¸éœ€è¦å¯¹<code>HTTP</code>é¡µé¢è¿›è¡Œå¤ªå¤šçš„æ”¹é€ ã€‚</p><p><code>TLS/SSL</code>çš„åŠŸèƒ½å®ç°ä¸»è¦ä¾èµ–ä¸‰ç±»åŸºæœ¬ç®—æ³•ï¼š<strong>æ•£åˆ—å‡½æ•° hash</strong>ã€<strong>å¯¹ç§°åŠ å¯†</strong>ã€<strong>éå¯¹ç§°åŠ å¯†</strong>ã€‚</p><blockquote><p> è¿™ä¸‰ç±»ç®—æ³•çš„ä½œç”¨å¦‚ä¸‹ï¼š</p></blockquote><ul><li>åŸºäºæ•£åˆ—å‡½æ•°éªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§</li><li>å¯¹ç§°åŠ å¯†ç®—æ³•é‡‡ç”¨åå•†çš„ç§˜é’¥å¯¹æ•°æ®åŠ å¯†</li><li>éå¯¹ç§°åŠ å¯†å®ç°èº«ä»½è®¤è¯å’Œç§˜é’¥åå•†</li></ul><p><strong>æ•£åˆ—å‡½æ•°</strong> : åœ¨ä¿¡æ¯ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œç”±äºä¼ è¾“æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œä¸­é—´äººå¯ä»¥ä¿®æ”¹ä¿¡æ¯åé‡æ–°è®¡ç®—ä¿¡æ¯çš„æ‘˜è¦ï¼Œæ‰€ä»¥éœ€è¦å¯¹ä¼ è¾“çš„ä¿¡æ¯å’Œä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†ã€‚</p><p><strong>å¯¹ç§°åŠ å¯†</strong> : å¯¹ç§°åŠ å¯†çš„ä¼˜åŠ¿å°±æ˜¯ä¿¡æ¯ä¼ è¾“ä½¿ç”¨ä¸€å¯¹ä¸€ï¼Œéœ€è¦å…±äº«ç›¸åŒçš„å¯†ç ï¼Œå¯†ç çš„å®‰å…¨æ˜¯ä¿è¯ä¿¡æ¯å®‰å…¨çš„åŸºç¡€ï¼ŒæœåŠ¡å™¨å’Œ N ä¸ªå®¢æˆ·ç«¯é€šä¿¡ï¼Œéœ€è¦ç»´æŒ N ä¸ªå¯†ç è®°å½•ä¸”ä¸èƒ½ä¿®æ”¹å¯†ç ã€‚</p><p><strong>éå¯¹ç§°åŠ å¯†</strong> : éå¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹å°±æ˜¯ä¿¡æ¯ä¸€å¯¹å¤šï¼ŒæœåŠ¡å™¨åªéœ€è¦ç»´æŒä¸€ä¸ªç§é’¥å°±å¯ä»¥å’Œå¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œä½†æœåŠ¡å™¨å‘å‡ºçš„ä¿¡æ¯èƒ½å¤Ÿè¢«æ‰€æœ‰çš„å®¢æˆ·ç«¯è§£å¯†ï¼Œä¸”è¯¥ç®—æ³•çš„è®¡ç®—å¤æ‚ï¼ŒåŠ å¯†çš„é€Ÿåº¦æ…¢ã€‚</p><h2 id="HTTPS-æ˜¯å¦‚ä½•ä¿è¯å®‰å…¨çš„"><a href="#HTTPS-æ˜¯å¦‚ä½•ä¿è¯å®‰å…¨çš„" class="headerlink" title="HTTPS æ˜¯å¦‚ä½•ä¿è¯å®‰å…¨çš„?"></a>HTTPS æ˜¯å¦‚ä½•ä¿è¯å®‰å…¨çš„?</h2><p><strong>å¯¹ç§°åŠ å¯†ï¼š</strong></p><ul><li>å³é€šä¿¡çš„åŒæ–¹éƒ½ä½¿ç”¨åŒâ¼€ä¸ªç§˜é’¥è¿›è¡ŒåŠ è§£å¯†ï¼Œå¯¹ç§°åŠ å¯†è™½ç„¶å¾ˆç®€å•æ€§èƒ½ä¹Ÿå¥½</li><li>ä½†æ˜¯æ— æ³•è§£å†³é¦–æ¬¡æŠŠç§˜é’¥å‘ç»™å¯¹æ–¹çš„é—®é¢˜ï¼Œ<strong>å¾ˆå®¹æ˜“è¢«é»‘å®¢æ‹¦æˆªç§˜é’¥ã€‚</strong></li></ul><p><strong>éå¯¹ç§°åŠ å¯†ï¼š</strong></p><ul><li>ç§é’¥ + å…¬é’¥ &#x3D; å¯†é’¥å¯¹</li><li>å³ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®ï¼Œåªæœ‰å¯¹åº”çš„å…¬é’¥æ‰èƒ½è§£å¯†ï¼Œç”¨å…¬é’¥åŠ å¯†çš„æ•°æ®ï¼Œåªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†</li><li>å› ä¸ºé€šä¿¡åŒæ–¹çš„æ”¶é›†éƒ½æœ‰â¼€å¥—è‡ªå·±çš„å¯†é’¥å¯¹ï¼Œé€šä¿¡ä¹‹å‰åŒæ–¹ä¼šå…ˆæŠŠè‡ªå·±çš„å…¬é’¥éƒ½å…ˆå‘ç»™å¯¹æ–¹</li><li>ç„¶åå¯¹æ–¹å†æ‹¿ç€è¿™ä¸ªå…¬é’¥æ¥åŠ å¯†æ•°æ®å“åº”ç»™å¯¹æ–¹ï¼Œç­‰åˆ°åˆ°äº†å¯¹æ–¹é‚£é‡Œï¼Œå¯¹æ–¹å†ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†</li></ul><p><strong>éå¯¹ç§°åŠ å¯†ä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ä¸ç§é’¥ï¼Œæ‰€ä»¥å®‰å…¨æ€§é«˜ï¼Œä½†åŠ å¯†ä¸è§£å¯†é€Ÿåº¦æ…¢ï¼Œå½±å“æ€§èƒ½ã€‚</strong></p><blockquote><p>æœ‰æ²¡æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹æ¡ˆå‘¢?</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼šä¸¤è€…ç»“åˆ</p><p><strong>ç»“åˆä¸¤ç§åŠ å¯†æ–¹å¼ï¼Œ è§£å†³çš„åŠæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€å‡ºå»ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†å¾—åˆ°å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œç„¶ååŒæ–¹å¯ä»¥ä½¿ç”¨å¯¹ç§°åŠ å¯†æ¥è¿›è¡Œæ²Ÿé€šã€‚</strong></p><p>å°½ç®¡é€šè¿‡ä¸¤è€…åŠ å¯†æ–¹å¼çš„ç»“åˆï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°å®ç°åŠ å¯†ä¼ è¾“ï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯å­˜åœ¨ä¸€äº›<strong>é—®é¢˜</strong></p><p>ç°åœ¨çš„æ–¹æ³•ä¹Ÿä¸ä¸€å®šæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•ç¡®å®šå¾—åˆ°çš„å…¬é’¥å°±ä¸€å®šæ˜¯å®‰å…¨çš„å…¬é’¥ã€‚å¯èƒ½å­˜åœ¨ä¸€ä¸ªä¸­é—´äººï¼Œæˆªå–äº†å¯¹æ–¹å‘ç»™æˆ‘ä»¬çš„å…¬é’¥ï¼Œç„¶åå°†ä»–è‡ªå·±çš„å…¬é’¥å‘é€ç»™æˆ‘ä»¬ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä»–çš„å…¬é’¥åŠ å¯†åå‘é€çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥è¢«ä»–ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ã€‚ç„¶åä»–ä¼ªè£…æˆæˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹æ³•å‘å¯¹æ–¹å‘é€ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä¿¡æ¯å°±è¢«çªƒå–äº†ï¼Œç„¶è€Œè‡ªå·±è¿˜ä¸çŸ¥é“ã€‚</p><p>äº‹å®ä¸Š HTTPS åœ¨ä¸Šè¿°ç»“åˆå¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†çš„åŸºç¡€ä¸Šï¼Œåˆæ·»åŠ äº†<strong>æ•°å­—è¯ä¹¦è®¤è¯</strong>çš„æ­¥éª¤ã€‚</p><p>å…¶ç›®çš„å°±æ˜¯<strong>è®©æœåŠ¡å™¨è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œ é˜²æ­¢è¢«ä¸­é—´äººæ”»å‡»ã€‚</strong></p><h2 id="æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ•°å­—è¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>é¦–å…ˆä½¿ç”¨ä¸€ç§ Hash ç®—æ³•æ¥å¯¹å…¬é’¥å’Œå…¶ä»–ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆä¸€ä¸ªä¿¡æ¯æ‘˜è¦ï¼Œç„¶åè®©æœ‰å…¬ä¿¡åŠ›çš„è®¤è¯ä¸­å¿ƒï¼ˆç®€ç§° CA ï¼‰ç”¨å®ƒçš„<strong>ç§é’¥</strong>å¯¹æ¶ˆæ¯æ‘˜è¦åŠ å¯†ï¼Œå½¢æˆç­¾åã€‚æœ€åå°†åŸå§‹çš„ä¿¡æ¯å’Œç­¾ååˆåœ¨ä¸€èµ·ï¼Œç§°ä¸ºæ•°å­—è¯ä¹¦ã€‚å½“æ¥æ”¶æ–¹æ”¶åˆ°æ•°å­—è¯ä¹¦çš„æ—¶å€™ï¼Œå…ˆæ ¹æ®åŸå§‹ä¿¡æ¯ä½¿ç”¨åŒæ ·çš„ Hash ç®—æ³•ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ï¼Œç„¶åä½¿ç”¨ CA çš„<strong>å…¬é’¥</strong>æ¥å¯¹æ•°å­—è¯ä¹¦ä¸­çš„ç­¾åè¿›è¡Œè§£å¯†ï¼Œæœ€åå°†è§£å¯†è·å¾—çš„æ‘˜è¦å’Œç”Ÿæˆçš„æ‘˜è¦è¿›è¡Œå¯¹æ¯”ï¼Œå°±èƒ½å‘ç°å¾—åˆ°çš„ä¿¡æ¯æ˜¯å¦è¢«æ›´æ”¹äº†ã€‚</p><blockquote><p>è¿™ä¸ªæ–¹æ³•æœ€è¦çš„æ˜¯è®¤è¯ä¸­å¿ƒçš„å¯é æ€§ï¼Œä¸€èˆ¬æµè§ˆå™¨é‡Œä¼šå†…ç½®ä¸€äº›é¡¶å±‚çš„è®¤è¯ä¸­å¿ƒçš„è¯ä¹¦ï¼Œç›¸å½“äºæˆ‘ä»¬è‡ªåŠ¨ä¿¡ä»»äº†ä»–ä»¬ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®çš„å®‰å…¨ã€‚</p></blockquote><blockquote><p> ä¸‹é¢ä¸ºå…·ä½“æµç¨‹</p></blockquote><p><strong>CA ï¼ˆæœ‰å…¬ä¿¡åŠ›çš„è®¤è¯ä¸­å¿ƒï¼‰ ç­¾å‘è¯ä¹¦çš„è¿‡ç¨‹ï¼š</strong></p><ul><li>é¦–å…ˆ CA ä¼šæŠŠæŒæœ‰è€…çš„å…¬é’¥ã€ç”¨é€”ã€é¢å‘è€…ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯æ‰“æˆä¸€ä¸ªåŒ…ï¼Œç„¶åå¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œ <code>Hash</code> è®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ª <code>Hash</code> å€¼ï¼›</li><li>ç„¶å <code>CA</code> ä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥å°†è¯¥ <code>Hash</code> å€¼åŠ å¯†ï¼Œç”Ÿæˆ <code>Certificate Signature</code>ï¼Œä¹Ÿå°±æ˜¯ <code>CA</code> å¯¹è¯ä¹¦åšäº†ç­¾åï¼›</li><li>æœ€åå°† <code>Certificate Signature</code> æ·»åŠ åœ¨æ–‡ä»¶è¯ä¹¦ä¸Šï¼Œå½¢æˆæ•°å­—è¯ä¹¦ï¼›</li></ul><p><strong>å®¢æˆ·ç«¯æ ¡éªŒæœåŠ¡ç«¯çš„æ•°å­—è¯ä¹¦çš„è¿‡ç¨‹ï¼š</strong></p><ul><li>é¦–å…ˆå®¢æˆ·ç«¯ä¼šä½¿ç”¨åŒæ ·çš„ <code>Hash</code> ç®—æ³•è·å–è¯¥è¯ä¹¦çš„ <code>Hash</code> å€¼ <code>H1</code>ï¼›</li><li>æµè§ˆå™¨æ”¶åˆ°è¯ä¹¦åå¯ä»¥ä½¿ç”¨ <code>CA</code> çš„å…¬é’¥è§£å¯† Certificate Signature å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ª <code>Hash</code> å€¼ <code>H2</code> ï¼›</li><li>æœ€åæ¯”è¾ƒ <code>H1</code> å’Œ <code>H2</code>ï¼Œå¦‚æœå€¼ç›¸åŒï¼Œåˆ™ä¸ºå¯ä¿¡èµ–çš„è¯ä¹¦ï¼Œå¦åˆ™åˆ™è®¤ä¸ºè¯ä¹¦ä¸å¯ä¿¡ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œåè®®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>offset/client/scrollä½ éƒ½è®°æ¸…äº†å—?</title>
    <link href="/2023/10/27/scroll%20%20offset%20%20client/"/>
    <url>/2023/10/27/scroll%20%20offset%20%20client/</url>
    
    <content type="html"><![CDATA[<h2 id="offsetå®¶æ—"><a href="#offsetå®¶æ—" class="headerlink" title="offsetå®¶æ—"></a><code>offset</code>å®¶æ—</h2><blockquote><p>éƒ½æ˜¯æ•´æ•°å€¼, å¦‚æœæ˜¯å°æ•°ä¼šå››èˆäº”å…¥</p></blockquote><ol><li><p><code>Element.offsetHeight</code>è¿”å›ä¸€ä¸ªæ•´æ•°ï¼ŒåŒ…æ‹¬**å…ƒç´ æœ¬èº«çš„é«˜åº¦ã€padding å’Œ border **ï¼Œä»¥åŠæ°´å¹³æ»šåŠ¨æ¡çš„é«˜åº¦ (å¦‚æœå­˜åœ¨æ»šåŠ¨æ¡ï¼‰ã€‚</p></li><li><p><code>Element.offsetWidth</code>è¡¨ç¤ºå…ƒç´ æœ¬èº«çš„å®½åº¦,  å…¶ä»–éƒ½ä¸<code>Element.offsetHeight</code>ä¸€è‡´ã€‚</p></li></ol><blockquote><p>è¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯<strong>åªè¯»</strong>å±æ€§ï¼Œåªæ¯”<code>Element.clientHeight</code>å’Œ<code>Element.clientWidth</code>å¤šäº†è¾¹æ¡†çš„é«˜åº¦æˆ–å®½åº¦ã€‚</p><p>å¦‚æœå…ƒç´ çš„ CSS è®¾ä¸ºä¸å¯è§ï¼ˆæ¯”å¦‚<code>display: none;</code>ï¼‰ï¼Œåˆ™è¿”å›<code>0</code>ã€‚</p></blockquote><ol start="3"><li><code>Element.offsetParent</code>å±æ€§è¿”å›æœ€é è¿‘å½“å‰å…ƒç´ çš„ã€å¹¶ä¸” CSS çš„<code>position</code>å±æ€§ä¸ç­‰äº<code>static</code>çš„ä¸Šå±‚å…ƒç´ ã€‚</li></ol><blockquote><p>è¯¥å±æ€§ä¸»è¦ç”¨äºç¡®å®šå­å…ƒç´ ä½ç½®åç§»çš„è®¡ç®—åŸºå‡†ï¼Œ<code>Element.offsetTop</code>å’Œ<code>Element.offsetLeft</code>å°±æ˜¯<code>offsetParent</code>å…ƒç´ è®¡ç®—çš„ã€‚</p><p>å¦‚æœè¯¥å…ƒç´ æ˜¯ä¸å¯è§çš„ï¼ˆ<code>display</code>å±æ€§ä¸º<code>none</code>ï¼‰ï¼Œæˆ–è€…ä½ç½®æ˜¯å›ºå®šçš„ï¼ˆ<code>position</code>å±æ€§ä¸º<code>fixed</code>ï¼‰ï¼Œåˆ™<code>offsetParent</code>å±æ€§è¿”å›<code>null</code>ã€‚</p></blockquote><ol start="4"><li><p><code>Element.offsetLeft</code>è¿”å›å½“å‰å…ƒç´ å·¦ä¸Šè§’ç›¸å¯¹äºæœ€è¿‘çš„å¼€å¯äº†å®šä½çš„èŠ‚ç‚¹çš„æ°´å¹³ä½ç§»</p></li><li><p><code>Element.offsetTop</code>è¿”å›å‚ç›´ä½ç§»ï¼Œå•ä½ä¸ºåƒç´ ã€‚é€šå¸¸ï¼Œè¿™ä¸¤ä¸ªå€¼æ˜¯æŒ‡ç›¸å¯¹äºçˆ¶èŠ‚ç‚¹çš„ä½ç§»ã€‚</p></li></ol><h2 id="clientå®¶æ—"><a href="#clientå®¶æ—" class="headerlink" title="clientå®¶æ—"></a><code>client</code>å®¶æ—</h2><blockquote><p>éƒ½æ˜¯æ•´æ•°å€¼, å¦‚æœæ˜¯å°æ•°ä¼šå››èˆäº”å…¥</p></blockquote><ol><li><code>Element.clientHeight</code>è¡¨ç¤º<strong>å…ƒç´ èŠ‚ç‚¹æœ¬èº«çš„é«˜åº¦å’Œ</strong> **<code>padding</code>**ï¼Œåªå¯¹å—çº§å…ƒç´ ç”Ÿæ•ˆï¼Œå¯¹äºè¡Œå†…å…ƒç´ è¿”å›<code>0</code>ã€‚</li></ol><blockquote><p>è¿™ä¸ªé«˜åº¦ä¸åŒ…æ‹¬<code>border</code>ã€<code>margin</code>ã€‚å¦‚æœæœ‰æ°´å¹³æ»šåŠ¨æ¡ï¼Œè¿˜è¦å‡å»æ°´å¹³æ»šåŠ¨æ¡çš„é«˜åº¦ã€‚</p></blockquote><ol start="2"><li><p><code>Element.clientWidth</code>è¡¨ç¤º<strong>å…ƒç´ èŠ‚ç‚¹æœ¬èº«çš„å®½åº¦å’Œ</strong> <strong><code>padding</code></strong>, å…¶ä½™å’Œ<code>Element.clientHeight</code>ä¸€è‡´</p></li><li><p><code>Element.clientLeft</code>è¡¨ç¤ºå…ƒç´ èŠ‚ç‚¹<strong>å·¦è¾¹æ¡†çš„å®½åº¦</strong>ï¼Œä¸åŒ…æ‹¬å·¦ä¾§çš„<code>padding</code>å’Œ<code>margin</code>ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®å·¦è¾¹æ¡†ï¼Œæˆ–è€…æ˜¯è¡Œå†…å…ƒç´ ï¼ˆ<code>display: inline</code>ï¼‰ï¼Œè¯¥å±æ€§è¿”å›<code>0</code>ã€‚</p></li><li><p><code>Element.clientTop</code>è¡¨ç¤ºç½‘é¡µå…ƒç´ <strong>ä¸Šè¾¹æ¡†çš„å®½åº¦</strong>ï¼Œå…¶ä»–ç‰¹ç‚¹éƒ½ä¸<code>clientLeft</code>ç›¸åŒã€‚</p></li></ol><p><strong>åˆ¤æ–­æ»šåŠ¨æ¡æ˜¯å¦æ»šåŠ¨åˆ°åº•</strong> </p><ul><li>å‚ç›´æ»šåŠ¨æ¡ : <code>scrollHeight -scrollTop = clientHeight</code></li><li>æ°´å¹³æ»šåŠ¨æ¡ :  <code>scrollWidth - scrollLeft = clientWidth</code></li></ul><p><strong>å…¶å®ƒ</strong></p><ul><li><code>document.documentElement</code>çš„<code>clientHeight</code>å±æ€§ï¼Œè¿”å›å½“å‰è§†å£çš„é«˜åº¦ï¼ˆå³æµè§ˆå™¨çª—å£çš„é«˜åº¦ï¼‰ï¼Œç­‰åŒäº<code>window.innerHeight</code>å±æ€§å‡å»æ°´å¹³æ»šåŠ¨æ¡çš„é«˜åº¦ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li><li><code>document.body</code>çš„é«˜åº¦åˆ™æ˜¯ç½‘é¡µçš„å®é™…é«˜åº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>document.body.clientHeight</code>(ç½‘é¡µæ€»é«˜åº¦)å¤§äº<code>document.documentElement.clientHeight</code>(è§†å£é«˜åº¦)ã€‚</li></ul><h2 id="scrollå®¶æ—"><a href="#scrollå®¶æ—" class="headerlink" title="scrollå®¶æ—"></a><code>scroll</code>å®¶æ—</h2><blockquote><p>éƒ½æ˜¯æ•´æ•°å€¼, å¦‚æœæ˜¯å°æ•°ä¼šå››èˆäº”å…¥</p></blockquote><ol><li><p><code>Element.scrollHeight</code>è¡¨ç¤ºå½“å‰å…ƒç´ çš„<strong>æ€»é«˜åº¦ï¼ŒåŒ…æ‹¬æº¢å‡ºå®¹å™¨ã€å½“å‰ä¸å¯è§çš„éƒ¨åˆ†</strong>ã€‚å®ƒåŒ…æ‹¬<code>padding</code>ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬<code>border</code>ã€<code>margin</code>ä»¥åŠæ°´å¹³æ»šåŠ¨æ¡çš„é«˜åº¦ï¼ˆå¦‚æœæœ‰æ°´å¹³æ»šåŠ¨æ¡çš„è¯ï¼‰ï¼Œè¿˜åŒ…æ‹¬ä¼ªå…ƒç´ ï¼ˆ<code>::before</code>æˆ–<code>::after</code>ï¼‰çš„é«˜åº¦ã€‚</p></li><li><p><code>Element.scrollWidth</code>å±æ€§è¡¨ç¤ºå½“å‰å…ƒç´ çš„<strong>æ€»å®½åº¦</strong>ï¼Œå…¶ä»–åœ°æ–¹éƒ½ä¸<code>scrollHeight</code>å±æ€§ç±»ä¼¼ã€‚è¿™ä¸¤ä¸ªå±æ€§åªè¯»ã€‚</p></li></ol><blockquote><p> æ•´å¼ ç½‘é¡µçš„æ€»é«˜åº¦å¯ä»¥ä»<code>document.documentElement</code>æˆ–<code>document.body</code>ä¸Šè¯»å–ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// è¿”å›ç½‘é¡µçš„æ€»é«˜åº¦</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollHeight</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollHeight</span><br></code></pre></td></tr></table></figure><ol start="3"><li><p><code>Element.scrollLeft</code>å±æ€§è¡¨ç¤ºå½“å‰å…ƒç´ çš„æ°´å¹³æ»šåŠ¨æ¡<strong>å‘å³ä¾§æ»šåŠ¨çš„è·ç¦»ã€‚</strong></p></li><li><p><code>Element.scrollTop</code>å±æ€§è¡¨ç¤ºå½“å‰å…ƒç´ çš„å‚ç›´æ»šåŠ¨æ¡<strong>å‘ä¸‹æ»šåŠ¨çš„è·ç¦»</strong>ã€‚å¯¹äºé‚£äº›æ²¡æœ‰æ»šåŠ¨æ¡çš„ç½‘é¡µå…ƒç´ ï¼Œè¿™ä¸¤ä¸ªå±æ€§æ€»æ˜¯ç­‰äº<code>0</code>ã€‚</p></li></ol><p>å¦‚æœè¦æŸ¥çœ‹æ•´å¼ ç½‘é¡µçš„æ°´å¹³çš„å’Œå‚ç›´çš„æ»šåŠ¨è·ç¦»ï¼Œè¦ä»<code>document.documentElement</code>å…ƒç´ ä¸Šè¯»å–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollLeft</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå±æ€§éƒ½<strong>å¯è¯»å†™</strong>ï¼Œ<strong>è®¾ç½®è¯¥å±æ€§çš„å€¼ï¼ˆä¸éœ€è¦å•ä½ï¼‰ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨å°†å½“å‰å…ƒç´ è‡ªåŠ¨æ»šåŠ¨åˆ°ç›¸åº”çš„ä½ç½®ã€‚</strong></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310272108830.png" alt="image-20231027210801789"></p>]]></content>
    
    
    <categories>
      
      <category>CSS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘é¡µç‰¹æ•ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨æ¸²æŸ“ä¹‹ä»€ä¹ˆæ˜¯åˆæˆå±‚?</title>
    <link href="/2023/10/26/CSS%E5%90%88%E6%88%90%E5%B1%82/"/>
    <url>/2023/10/26/CSS%E5%90%88%E6%88%90%E5%B1%82/</url>
    
    <content type="html"><![CDATA[<h2 id="å±…ä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-transform-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨-margin-Left-x2F-Top"><a href="#å±…ä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-transform-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨-margin-Left-x2F-Top" class="headerlink" title="å±…ä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ transform , ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ margin Left&#x2F;Top ?"></a>å±…ä¸­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ transform , ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ margin Left&#x2F;Top ?</h2><p>åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ä¼šå®ç°ä¸€äº›åŠ¨ç”»ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šé€‰æ‹©æ”¹å˜ <code>top/left</code> å»å®ç°ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹çš„æ¸²æŸ“ä¼šå‘ç”Ÿåœ¨<strong>æ™®é€šæ–‡æ¡£æµ</strong>ä¸­ã€‚è¯¥å±æ€§çš„å˜åŒ–ä¼šå¯¼è‡´é‡æ’ï¼ˆ<code>reflow/relayout</code>ï¼‰</p><p>è€Œä½¿ç”¨ <code>transform</code> å’Œ <code>opacity</code> å®ç°åŠ¨ç”»èƒ½å¤Ÿè®©èŠ‚ç‚¹è¢«æ”¾ç½®åˆ°ä¸€ä¸ª<strong>ç‹¬ç«‹åˆæˆå±‚</strong>ä¸­è¿›è¡Œæ¸²æŸ“ç»˜åˆ¶ï¼ŒåŠ¨ç”»ä¸ä¼šå½±å“å…¶ä»–å›¾å±‚ï¼Œå¹¶ä¸” <code>GPU</code>æ¸²æŸ“ç›¸æ¯” <code>CPU </code>èƒ½å¤Ÿæ›´å¿«ï¼Œè¿™ä¼šè®©ä½ çš„åŠ¨ç”»å˜çš„æ›´åŠ æµç•…</p><h2 id="ä»€ä¹ˆæ˜¯åˆæˆå±‚"><a href="#ä»€ä¹ˆæ˜¯åˆæˆå±‚" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆæˆå±‚?"></a>ä»€ä¹ˆæ˜¯åˆæˆå±‚?</h2><p>åœ¨è®¨è®º<code>åˆæˆå±‚</code>ä¹‹å‰æˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹æµè§ˆå™¨æ¸²æŸ“ï¼Œæµè§ˆå™¨å¸¸è§çš„æ¸²æŸ“å¼•æ“æœ‰ Webkit&#x2F;Gecko ç­‰ï¼Œä»–ä»¬çš„ä¸»è¦æ¸²æŸ“æµç¨‹åŸºæœ¬ç›¸åŒ</p><blockquote><p>è®¨è®ºä¸€ä¸‹ WebKit ç®€åŒ–çš„æ¸²æŸ“æµç¨‹ã€‚</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310262312479.png" alt="img"></p><ol><li>æµè§ˆå™¨ä¸‹è½½å¹¶è§£æ HTMLã€‚</li><li>å¤„ç† <code>CSS</code> æ„å»º <code>CSSOM</code> æ ‘ï¼Œç”Ÿæˆ <code>DOM</code> æ ‘ã€‚</li><li><code>DOM</code> ä¸ <code>CSSOM</code> åˆå¹¶æˆä¸€ä¸ª <code>Render</code> æ ‘ã€‚</li><li>æœ‰äº† <code>Render Tree</code>ï¼Œæµè§ˆå™¨å¯ä»¥çŸ¥é“å„ä¸ªèŠ‚ç‚¹çš„ <code>CSS</code> å®šä¹‰ä»¥åŠä»–ä»¬çš„ä»å±å…³ç³»ï¼Œä»è€Œå»è®¡ç®—å‡ºæ¯ä¸ªèŠ‚ç‚¹åœ¨å±å¹•ä¸­çš„ä½ç½®ï¼Œç”Ÿæˆä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç”»å¸ƒæ¥å®¹çº³æ‰€æœ‰å…ƒç´ ã€‚</li><li>æ ¹æ®æµè§ˆå™¨æä¾›å„å±‚çš„ä¿¡æ¯åˆæˆå›¾å±‚ï¼Œæ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</li></ol><p><code>åˆæˆå±‚</code>å°±å‡ºç°åœ¨æœ€åä¸€æ­¥æµç¨‹ä¸­ï¼Œè¿™äº›åˆæˆå›¾å±‚ä¸­ä¸€äº›ç‰¹æ®Šçš„å›¾å±‚è¢«è®¤ä¸ºæ˜¯åˆæˆå±‚ï¼ˆCompositing Layersï¼‰</p><p>é¦–å…ˆåˆæˆå°±æ˜¯å°†é¡µé¢çš„å„ä¸ªéƒ¨åˆ†åˆ†æˆå¤šä¸ªå±‚ã€å•ç‹¬<strong>å…‰æ …åŒ–</strong>å®ƒä»¬å¹¶åœ¨åˆæˆå™¨çº¿ç¨‹ä¸­åˆæˆä¸ºä¸€ä¸ªé¡µé¢çš„æŠ€æœ¯ã€‚</p><blockquote><p>å…‰æ …åŒ– : æµè§ˆå™¨æ ¹æ®æ–‡æ¡£çš„ç»“æ„ã€æ¯ä¸ªå…ƒç´ çš„æ ·å¼ã€é¡µé¢çš„å‡ ä½•å½¢çŠ¶å’Œç»˜åˆ¶é¡ºåºè½¬æ¢ä¸ºå±å¹•ä¸Šçš„åƒç´ çš„è¿‡ç¨‹</p></blockquote><ul><li>ä¸€èˆ¬æ¥è¯´ï¼Œæ‹¥æœ‰ä¸€äº›ç‰¹å®šå±æ€§çš„æ¸²æŸ“å±‚ï¼Œä¼šè¢«æµè§ˆå™¨è‡ªåŠ¨æå‡ä¸ºåˆæˆå±‚ã€‚</li><li>åˆæˆå±‚æ‹¥æœ‰å•ç‹¬çš„å›¾å±‚ï¼ˆGraphicsLayerï¼‰ï¼Œå’Œå…¶ä»–å›¾å±‚ä¹‹é—´æ— ä¸å½±å“ã€‚</li><li>è€Œå…¶å®ƒä¸æ˜¯åˆæˆå±‚çš„æ¸²æŸ“å±‚ï¼Œåˆ™å’Œç¬¬ä¸€ä¸ªæ‹¥æœ‰å›¾å±‚çš„çˆ¶å±‚å…±ç”¨ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯æ™®é€šæ–‡æ¡£æµä¸­çš„å†…å®¹</li></ul><h2 id="æå‡ä¸ºåˆæˆå±‚çš„å±æ€§"><a href="#æå‡ä¸ºåˆæˆå±‚çš„å±æ€§" class="headerlink" title="æå‡ä¸ºåˆæˆå±‚çš„å±æ€§"></a>æå‡ä¸ºåˆæˆå±‚çš„å±æ€§</h2><p>æˆ‘ä»¬çœ‹ä¸€äº›<strong>å¸¸è§çš„æå‡ä¸ºåˆæˆå±‚çš„å±æ€§ã€‚</strong></p><ul><li>è®¾ç½® <code>transform: translateZ(0)</code>ï¼Œæ³¨æ„å®ƒå¿…é¡»æ˜¯ <code>translateZ</code>ï¼Œå› ä¸ºå®ƒä½¿ç”¨ <code>GPU</code>æ¥è®¡ç®— <code>perspective distortion</code>ï¼ˆé€è§†å¤±çœŸï¼‰ã€‚<code>perspective</code> åœ¨ <code>3D</code>è®¾è®¡ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„å±æ€§ã€‚å¦‚æœä½ ä½¿ç”¨ <code>translateX</code> æˆ– <code>translateY</code>ï¼Œå…ƒç´ å°†ä¼šè¢«ç»˜åˆ¶åœ¨æ™®é€šæ–‡æ¡£æµä¸­ </li><li><code>backface-visibility: hidden</code> : æŒ‡å®šå½“å…ƒç´ èƒŒé¢æœå‘è§‚å¯Ÿè€…æ—¶æ˜¯å¦å¯è§</li><li><code>transform</code> &#x2F; <code> opacity</code></li><li><code>video</code>ã€<code>canvas</code>ã€<code>iframe</code> ç­‰å…ƒç´ ã€‚</li><li><code>will-change</code> :  å‘Šè¯‰æµè§ˆå™¨è¯¥å…ƒç´ ä¼šæœ‰å“ªäº›å˜åŒ–ï¼Œè¿™æ ·æµè§ˆå™¨å¯ä»¥æå‰åšå¥½å¯¹åº”çš„ä¼˜åŒ–å‡†å¤‡å·¥ä½œã€‚<ul><li>å½“è¯¥å±æ€§çš„å€¼ä¸º <code>opacity</code>ã€<code>transform</code>ã€<code>top</code>ã€<code>left</code>ã€<code>bottom</code>ã€<code>right </code>æ—¶ã€‚</li></ul></li></ul><p><strong>éšå¼åˆæˆ</strong>å°±æ˜¯ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå­˜åœ¨ä¼šè¢«é»˜è®¤æå‡ä¸ºåˆæˆå±‚çš„æƒ…å†µã€‚</p><ul><li>ä¸€ä¸ªæˆ–å¤šä¸ªéåˆæˆå…ƒç´ åº”å‡ºç°åœ¨å †å é¡ºåºä¸Š (<code>z-index</code>) çš„åˆæˆå…ƒç´ ä¹‹ä¸Šï¼Œä¼šè¢«æå‡ä¸ºåˆæˆå±‚ã€‚</li></ul><h2 id="åˆæˆå±‚çš„å¥½å¤„å’Œé—®é¢˜"><a href="#åˆæˆå±‚çš„å¥½å¤„å’Œé—®é¢˜" class="headerlink" title="åˆæˆå±‚çš„å¥½å¤„å’Œé—®é¢˜"></a>åˆæˆå±‚çš„å¥½å¤„å’Œé—®é¢˜</h2><p>åˆæˆå±‚å¼€å¯çš„<strong>å¥½å¤„</strong></p><ul><li><p>å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼Œåˆæˆå±‚çš„ä½å›¾ä¼šäº¤ç”± <code>GPU</code>åˆæˆï¼Œç›¸æ¯” <code>CPU </code>å¤„ç†è¦å¿«ã€‚</p></li><li><p>åˆæˆå±‚å‘ç”Ÿ <code>repaint</code>çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“å…¶ä»–å›¾å±‚ã€‚</p></li><li><p>å¯¹äº <code>transform </code>å’Œ <code>opacity</code>æ•ˆæœï¼Œä¸ä¼šè§¦å‘ <code>layout</code>å’Œ <code>paint</code>ã€‚</p></li></ul><p>å½“ç„¶åˆæˆå±‚ä¹Ÿå­˜åœ¨ä¸€äº›<strong>é—®é¢˜</strong>ï¼š</p><ul><li>å¦‚æœæˆ‘ä»¬æŠŠæ‰€æœ‰æ¸²æŸ“å·¥ä½œéƒ½äº¤ç»™ <code>GPU</code>ï¼Œåœ¨ç°æœ‰çš„ä¼˜åŒ–ä¸‹ï¼Œå®ƒä¼šå¯¼è‡´æ¸²æŸ“å†…å­˜å ç”¨æ¯”å¤§å¹…åº¦æå‡ï¼Œåè€Œå‡ºç°è´Ÿé¢çš„æ•ˆæœã€‚</li><li>å¦å¤–éšå¼åˆæˆå®¹æ˜“äº§ç”Ÿå¤§é‡æˆ‘ä»¬æ„æ–™ä¹‹å¤–çš„åˆæˆå±‚ï¼Œè¿‡å¤§çš„å†…å­˜å ç”¨ï¼Œä¼šè®©é¡µé¢å˜çš„å¡é¡¿ï¼Œæ€§èƒ½ä¼˜åŒ–é€‚å¾—å…¶åã€‚</li></ul><p><strong>è°¨æ…ä½¿ç”¨ <code>will-change</code></strong></p><p>é™¤éä½ çš„å…ƒç´ çš„çœŸçš„å­˜åœ¨æŸä¸ªå±æ€§é©¬ä¸Šä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚ <code>transform</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>will-change: transform</code> å‘ŠçŸ¥æµè§ˆå™¨ï¼Œæ ¹æ®æ‚¨æ‰“ç®—æ›´æ”¹çš„å…ƒç´ ï¼Œæµè§ˆå™¨å¯èƒ½å¯ä»¥é¢„å…ˆå®‰æ’ï¼Œå…ƒç´ çš„æ”¹å˜å’Œæ¸²æŸ“é€Ÿåº¦éƒ½ä¼šå˜å¾—æ›´å¿«ã€‚</p><blockquote><p>è¿™äº›å±æ€§å¯èƒ½ä¼šç»™ä½ å¸¦æ¥ä¸€äº›å‰¯ä½œç”¨</p></blockquote><p><strong>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦åˆ›å»ºå¤ªå¤šçš„æ¸²æŸ“å±‚ã€‚å› ä¸ºæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ¸²æŸ“å±‚ï¼Œå°±æ„å‘³ç€æ–°çš„å†…å­˜åˆ†é…å’Œæ›´å¤æ‚çš„å±‚çš„ç®¡ç†ã€‚</strong></p><blockquote><p>å¦‚æœä½ å·²ç»æŠŠä¸€ä¸ªå…ƒç´ æ”¾åˆ°ä¸€ä¸ªæ–°çš„åˆæˆå±‚é‡Œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Timeline æ¥ç¡®è®¤è¿™ä¹ˆåšæ˜¯å¦çœŸçš„æ”¹è¿›äº†æ¸²æŸ“æ€§èƒ½ã€‚åˆ«ç›²ç›®æå‡åˆæˆå±‚ï¼Œä¸€å®šè¦åˆ†æå…¶å®é™…æ€§èƒ½è¡¨ç°ã€‚</p></blockquote><p>å…¶å®ä»æ€§èƒ½æ–¹é¢è€ƒè™‘ï¼Œæœ€ç†æƒ³çš„æ¸²æŸ“æµæ°´çº¿æ˜¯æ²¡æœ‰å¸ƒå±€å’Œç»˜åˆ¶ç¯èŠ‚çš„ï¼Œåªéœ€è¦åšåˆæˆå±‚çš„åˆå¹¶å³å¯ï¼š </p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310262312540.png" alt="img"></p><p>ä¸ºäº†å®ç°ä¸Šè¿°æ•ˆæœï¼Œå°±éœ€è¦åªä½¿ç”¨é‚£äº›ä»…è§¦å‘ <code>Composite </code>çš„å±æ€§ã€‚ç›®å‰ï¼Œ<strong>åªæœ‰ä¸¤ä¸ªå±æ€§æ˜¯æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„ï¼štransforms å’Œ opacityã€‚</strong></p><p><strong>åˆç†ç®¡ç†åˆæˆå±‚</strong>ï¼š</p><blockquote><p> å¤§å¤šæ•°äººéƒ½å¾ˆå–œæ¬¢ä½¿ç”¨ <code>translateZ(0)</code> æ¥è¿›è¡Œæ‰€è°“çš„ç¡¬ä»¶åŠ é€Ÿï¼Œä»¥æå‡æ€§èƒ½</p><p>ä½†æ˜¯æ€§èƒ½ä¼˜åŒ–å¹¶æ²¡æœ‰æ‰€è°“çš„â€é“¶å¼¹â€ (å¯è§£å†³å¤æ‚é—®é¢˜çš„ç®€å•æ–¹æ¡ˆ)ï¼Œ<code>translateZ(0)</code> ä¸æ˜¯ï¼Œæœ¬æ–‡åˆ—å‡ºçš„ä¼˜åŒ–å»ºè®®ä¹Ÿä¸æ˜¯ã€‚</p><p>æŠ›å¼€äº†å¯¹é¡µé¢çš„å…·ä½“åˆ†æï¼Œä»»ä½•çš„æ€§èƒ½ä¼˜åŒ–éƒ½æ˜¯ç«™ä¸ä½è„šçš„ï¼Œç›²ç›®çš„ä½¿ç”¨ä¸€äº›ä¼˜åŒ–æªæ–½ï¼Œç»“æœå¯èƒ½ä¼šé€‚å¾—å…¶åã€‚</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªæ–°çš„åˆæˆå±‚å¹¶ä¸æ˜¯å…è´¹çš„ï¼Œå®ƒå¾—æ¶ˆè€—é¢å¤–çš„å†…å­˜å’Œç®¡ç†èµ„æºã€‚å®é™…ä¸Šï¼Œåœ¨å†…å­˜èµ„æºæœ‰é™çš„è®¾å¤‡ä¸Šï¼Œåˆæˆå±‚å¸¦æ¥çš„æ€§èƒ½æ”¹å–„ï¼Œå¯èƒ½è¿œè¿œèµ¶ä¸ä¸Šè¿‡å¤šåˆæˆå±‚å¼€é”€ç»™é¡µé¢æ€§èƒ½å¸¦æ¥çš„è´Ÿé¢å½±å“ã€‚å› æ­¤åˆ‡å®çš„å»åˆ†æé¡µé¢çš„å®é™…æ€§èƒ½è¡¨ç°ï¼Œä¸æ–­çš„æ”¹è¿›æµ‹è¯•ï¼Œæ‰æ˜¯æ­£ç¡®çš„ä¼˜åŒ–é€”å¾„ã€‚</li></ul><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310262312522.png" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>æµè§ˆå™¨åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GPUæ¸²æŸ“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GPU å’Œ CSS ç¡¬ä»¶åŠ é€Ÿ</title>
    <link href="/2023/10/25/GPU%E6%B8%B2%E6%9F%93/"/>
    <url>/2023/10/25/GPU%E6%B8%B2%E6%9F%93/</url>
    
    <content type="html"><![CDATA[<h3 id="ä»cpuèŠèµ·"><a href="#ä»cpuèŠèµ·" class="headerlink" title="ä»cpuèŠèµ·"></a>ä»<code>cpu</code>èŠèµ·</h3><p>cpu æ¯ä¸ªæ ¸åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯å•æ§åˆ¶æµã€å•æ•°æ®æµã€‚è¿™æ ·çš„æ¶æ„å¯¼è‡´ cpu åœ¨ä¸€äº›åœºæ™¯ä¸‹æ•ˆç‡æ˜¯ä¸é«˜çš„ï¼Œæ¯”å¦‚ 3d æ¸²æŸ“çš„åœºæ™¯ã€‚</p><blockquote><p>3d æ¸²æŸ“çš„æµç¨‹æ˜¯ï¼š</p></blockquote><ul><li>è®¡ç®—é¡¶ç‚¹æ•°æ®ï¼Œæ„æˆ 3d çš„å›¾å½¢</li><li>ç»™æ¯ä¸ªä¸‰è§’å½¢è´´å›¾ï¼Œç”»ä¸Šçº¹ç†</li><li>æŠ•å½±åˆ°äºŒç»´çš„å±å¹•ï¼Œè®¡ç®—æ¯ä¸ªåƒç´ çš„é¢œè‰²ï¼ˆå…‰æ …åŒ–ï¼‰</li><li>æŠŠä¸€å¸§çš„æ•°æ®å†™å…¥æ˜¾å­˜çš„å¸§ç¼“å†²åŒº</li></ul><p>é¡¶ç‚¹çš„æ•°é‡æ˜¯éå¸¸åºå¤§çš„ï¼Œè€Œ cpu åªèƒ½é¡ºåºçš„ä¸€ä¸ªä¸ªè®¡ç®—ï¼Œæ‰€ä»¥å¤„ç†è¿™ç§ 3d æ¸²æŸ“ä¼šç‰¹åˆ«è´¹åŠ²ï¼Œäºæ˜¯å°±å‡ºç°äº†ä¸“é—¨ç”¨äºè¿™ç§ 3d æ•°æ®çš„å¹¶è¡Œè®¡ç®—çš„ç¡¬ä»¶ï¼Œä¹Ÿå°±æ˜¯ GPUã€‚</p><h3 id="GPU-çš„æ„æˆ"><a href="#GPU-çš„æ„æˆ" class="headerlink" title="GPU çš„æ„æˆ"></a>GPU çš„æ„æˆ</h3><p>å’Œ cpu çš„ä¸€ä¸ªä¸€ä¸ªæ•°æ®è®¡ç®—ä¸åŒï¼Œgpu æ˜¯å¹¶è¡Œçš„ï¼Œæœ‰æˆç™¾ä¸Šåƒä¸ªæ ¸å¿ƒç”¨äºå¹¶è¡Œè®¡ç®—</p><p>gpu ä¹Ÿæ˜¯æœ‰ç€æŒ‡ä»¤ã€è¯‘ç ã€æ‰§è¡Œçš„æµç¨‹ï¼Œåªä¸è¿‡ï¼Œæ¯ä¸ªæŒ‡ä»¤ä¼šå¹¶è¡Œæ‰§è¡Œ n ä¸ªè®¡ç®—ï¼Œæ˜¯å•æ§åˆ¶æµå¤šæ•°æ®æµçš„ï¼Œè€Œ cpu æ˜¯å•æ§åˆ¶æµå•æ•°æ®æµã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äº 3d æ¸²æŸ“è¿™ç§è¦è®¡ç®—æˆä¸‡ä¸ªé¡¶ç‚¹æ•°æ®å’Œåƒç´ ç‚¹çš„åœºæ™¯ï¼ŒGPU ä¼šæ¯” CPU é«˜æ•ˆå¾ˆå¤šã€‚</p><h3 id="cpu-å’Œ-gpu-çš„åŒºåˆ«"><a href="#cpu-å’Œ-gpu-çš„åŒºåˆ«" class="headerlink" title="cpu å’Œ gpu çš„åŒºåˆ«"></a>cpu å’Œ gpu çš„åŒºåˆ«</h3><p>cpu æ˜¯é€šç”¨çš„ï¼Œèƒ½å¤Ÿæ‰§è¡Œå„ç§é€»è¾‘å’Œè¿ç®—ï¼Œè€Œ gpu åˆ™æ˜¯ä¸»è¦æ˜¯ç”¨äºå¹¶è¡Œè®¡ç®—å¤§æ‰¹é‡çš„é‡å¤ä»»åŠ¡ï¼Œä¸èƒ½å¤„ç†å¤æ‚é€»è¾‘ã€‚</p><p>cpu ä¸­æ§åˆ¶å™¨å’Œç¼“å­˜å æ®äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œè€Œ gpu ä¸­è¿™ä¸¤éƒ¨åˆ†åˆ™å¾ˆå°‘ï¼Œä½†æ˜¯æœ‰æ›´å¤šçš„æ ¸å¿ƒç”¨äºè®¡ç®—ã€‚</p><p>ä¸¤è€…å¯¹æ¯”çš„è¯ï¼Œcpu ç›¸å½“äºä¸€ä¸ªå¤§å­¦ç”Ÿï¼Œèƒ½å¤Ÿè§£å†³å„ç§éš¾é¢˜ï¼Œä½†æ˜¯è®¡ç®— 1 ä¸‡ä¸ªåŠ æ³•å°±æ²¡é‚£ä¹ˆå¿«ï¼Œè€Œ gpu å°±åƒä¸€å¸®å°å­¦ç”Ÿï¼Œè§£å†³ä¸äº†éš¾é¢˜ï¼Œä½†æ˜¯è®¡ç®—åŠ æ³•è¿™ç§å°±å¾ˆå¿«ï¼Œå› ä¸ºäººå¤šã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœé€»è¾‘å¤æ‚ï¼Œé‚£ä¹ˆåªèƒ½ç”¨ cpuï¼Œå¦‚æœåªæ˜¯è®¡ç®—é‡å¤§ï¼Œå¹¶ä¸”æ¯ä¸ªè®¡ç®—éƒ½æ¯”è¾ƒé‡å¤ï¼Œé‚£å°±æ¯”è¾ƒé€‚åˆ gpuã€‚</p><blockquote><p>3d çš„æ¸²æŸ“ä¸­æœ‰å¤§é‡è¿™ç§é‡å¤å´ç®€å•çš„è®¡ç®—ï¼Œæ¯”å¦‚é¡¶ç‚¹æ•°æ®å’Œå…‰æ …åŒ–çš„åƒç´ æ•°æ®ï¼Œé€šè¿‡ gpu å°±å¯ä»¥å¹¶å‘çš„ä¸€æ¬¡è®¡ç®—æˆç™¾ä¸Šåƒä¸ª</p></blockquote><h3 id="css-ç¡¬ä»¶åŠ é€Ÿ"><a href="#css-ç¡¬ä»¶åŠ é€Ÿ" class="headerlink" title="css ç¡¬ä»¶åŠ é€Ÿ"></a>css ç¡¬ä»¶åŠ é€Ÿ</h3><p>css å¤§éƒ¨åˆ†æ ·å¼è¿˜æ˜¯é€šè¿‡ cpu æ¥è®¡ç®—çš„ï¼Œä½† css ä¸­ä¹Ÿæœ‰ä¸€äº› 3d çš„æ ·å¼å’ŒåŠ¨ç”»çš„æ ·å¼ï¼Œè®¡ç®—è¿™äº›æ ·å¼åŒæ ·æœ‰å¾ˆå¤šé‡å¤ä¸”å¤§é‡çš„è®¡ç®—ä»»åŠ¡ï¼Œå¯ä»¥äº¤ç»™ gpu æ¥è·‘ã€‚</p><p>æµè§ˆå™¨åœ¨å¤„ç†ä¸‹é¢çš„ css çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ gpu æ¸²æŸ“ï¼š</p><ul><li>transform</li><li>opacity</li><li>filter</li><li>will-change</li></ul><p>æµè§ˆå™¨æ˜¯æŠŠå†…å®¹åˆ†åˆ°ä¸åŒçš„å›¾å±‚åˆ†åˆ«æ¸²æŸ“çš„ï¼Œæœ€ååˆå¹¶åˆ°ä¸€èµ·ï¼Œè€Œè§¦å‘ gpu æ¸²æŸ“ä¼šæ–°å»ºä¸€ä¸ªå›¾å±‚ï¼ŒæŠŠè¯¥å…ƒç´ æ ·å¼çš„è®¡ç®—äº¤ç»™ gpuã€‚</p><p>opacity éœ€è¦æ”¹å˜æ¯ä¸ªåƒç´ çš„å€¼ï¼Œç¬¦åˆé‡å¤ä¸”å¤§é‡çš„ç‰¹ç‚¹ï¼Œä¼šæ–°å»ºå›¾å±‚ï¼Œäº¤ç»™ gpu æ¸²æŸ“ã€‚transform æ˜¯åŠ¨ç”»ï¼Œæ¯ä¸ªæ ·å¼å€¼çš„è®¡ç®—ä¹Ÿç¬¦åˆé‡å¤ä¸”å¤§é‡çš„ç‰¹ç‚¹ï¼Œä¹Ÿé»˜è®¤ä¼šä½¿ç”¨ gpu åŠ é€Ÿã€‚åŒç† fiter ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p><p><strong>ç”±äºGPUä¸­çš„è¿™äº›CSSå±æ€§ä¸è§¦å‘</strong><code>repaint</code>ï¼Œå› æ­¤ä¸éœ€è¦é‡ç»˜ï¼Œå•ç‹¬å¤„ç†ï¼Œæ‰€ä»¥èƒ½å¤§å¤§æé«˜ç½‘é¡µçš„æ€§èƒ½ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ gpu ç¡¬ä»¶åŠ é€Ÿæ˜¯éœ€è¦æ–°å»ºå›¾å±‚çš„ï¼Œè€ŒæŠŠè¯¥å…ƒç´ ç§»åŠ¨åˆ°æ–°å›¾å±‚æ˜¯ä¸ªè€—æ—¶æ“ä½œï¼Œç•Œé¢å¯èƒ½ä¼šé—ªä¸€ä¸‹ï¼Œæ‰€ä»¥æœ€å¥½æå‰åšã€‚<code>will-change</code> å°±æ˜¯æå‰å‘Šè¯‰æµè§ˆå™¨åœ¨ä¸€å¼€å§‹å°±æŠŠå…ƒç´ æ”¾åˆ°æ–°çš„å›¾å±‚ï¼Œæ–¹ä¾¿åé¢ç”¨ <code>gpu </code>æ¸²æŸ“çš„æ—¶å€™ï¼Œä¸éœ€è¦åšå›¾å±‚çš„æ–°å»ºã€‚</p><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³<strong>å¼ºåˆ¶è§¦å‘ç¡¬ä»¶æ¸²æŸ“</strong>ï¼Œå°±å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ :</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-attribute">will-change</span>: transform<br>transform:<span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>transform: <span class="hljs-built_in">rotateZ</span>(<span class="hljs-number">360deg</span>)<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™äº›æ“ä½œå¼€å¯GPUç¡¬ä»¶åŠ é€Ÿä¹‹åï¼Œæœ‰äº›æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´æµè§ˆå™¨é¢‘ç¹é—ªçƒæˆ–æŠ–åŠ¨ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹åŠæ³•è§£å†³ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs CSS"><span class="hljs-attribute">backface-visibility</span>:hidden;   // <span class="hljs-attribute">backface-visibility</span> æŒ‡å®šå½“å…ƒç´ èƒŒé¢æœå‘è§‚å¯Ÿè€…æ—¶æ˜¯å¦å¯è§ã€‚<br><span class="hljs-attribute">perspective</span>:<span class="hljs-number">1000</span>;  //  <span class="hljs-attribute">perspective</span> æŒ‡å®šäº†è§‚å¯Ÿè€…ä¸ z=<span class="hljs-number">0</span> å¹³é¢çš„è·ç¦»<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>gpu ç¡¬ä»¶åŠ é€Ÿèƒ½å‡è½» cpu å‹åŠ›ï¼Œä½¿å¾—æ¸²æŸ“æ›´æµç•…ï¼Œä½†æ˜¯ä¹Ÿä¼šå¢åŠ å†…å­˜çš„å ç”¨ï¼Œå¯¹äº transformã€opacityã€filter é»˜è®¤ä¼šå¼€å¯ç¡¬ä»¶åŠ é€Ÿã€‚<strong>å…¶ä½™æƒ…å†µï¼Œå»ºè®®åªåœ¨å¿…è¦çš„æ—¶å€™ç”¨</strong>ã€‚</p><p>ä½¿ç”¨GPUæ¸²æŸ“ä¹Ÿä¼šå½±å“å­—ä½“çš„æŠ—é”¯é½¿æ•ˆæœã€‚è¿™æ˜¯å› ä¸ºGPUå’ŒCPUå…·æœ‰ä¸åŒçš„æ¸²æŸ“æœºåˆ¶ã€‚å³ä½¿æœ€ç»ˆç¡¬ä»¶åŠ é€Ÿåœæ­¢äº†ï¼Œæ–‡æœ¬è¿˜æ˜¯ä¼šåœ¨åŠ¨ç”»æœŸé—´æ˜¾ç¤ºå¾—å¾ˆæ¨¡ç³Šã€‚</p><h3 id="å…¶å®ƒåœºæ™¯"><a href="#å…¶å®ƒåœºæ™¯" class="headerlink" title="å…¶å®ƒåœºæ™¯"></a>å…¶å®ƒåœºæ™¯</h3><p>é‡å¤ä¸”å¤§é‡çš„è®¡ç®—ä»»åŠ¡åªæœ‰ 3d æ¸²æŸ“ä¸€ç§åœºæ™¯ä¹ˆï¼Ÿ</p><p>ä¸æ˜¯çš„ï¼ŒAI é¢†åŸŸçš„æœºå™¨å­¦ä¹ ä¹Ÿå¾ˆå…¸å‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å¤§é‡çš„ç¥ç»å…ƒéœ€è¦è®¡ç®—ï¼Œä½†æ˜¯æ¯ä¸ªè®¡ç®—éƒ½æ¯”è¾ƒç®€å•ï¼Œä¹Ÿå¾ˆé€‚åˆç”¨ gpu æ¥è·‘ã€‚</p><p>ç°åœ¨çš„ gpu ä¸åªæ˜¯èƒ½è·‘å›¾å½¢æ¸²æŸ“ï¼Œä¹Ÿæä¾›äº†ä¸€äº›ç¼–ç¨‹èƒ½åŠ›ï¼Œè¿™éƒ¨åˆ† api æœ‰ opencl æ ‡å‡†ã€‚å¯ä»¥é€šè¿‡ gpu çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›æ¥è·‘ä¸€äº›æœ‰å¤§é‡è®¡ç®—ä½†æ˜¯æ²¡æœ‰å¾ˆå¤šé€»è¾‘çš„çš„ä»»åŠ¡ï¼Œä¼šæ¯” cpu æ•ˆç‡æ›´é«˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ€§èƒ½ä¼˜åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GPUæ¸²æŸ“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ğŸ˜ˆè¯·ä»‹ç»ä¸€ä¸‹TCPå’ŒUDP</title>
    <link href="/2023/10/24/TCP%E4%B8%8EUDP/"/>
    <url>/2023/10/24/TCP%E4%B8%8EUDP/</url>
    
    <content type="html"><![CDATA[<h3 id="1-TCP-å’Œ-UDP-çš„æ¦‚å¿µåŠç‰¹ç‚¹"><a href="#1-TCP-å’Œ-UDP-çš„æ¦‚å¿µåŠç‰¹ç‚¹" class="headerlink" title="1. TCP å’Œ UDP çš„æ¦‚å¿µåŠç‰¹ç‚¹"></a>1. TCP å’Œ UDP çš„æ¦‚å¿µåŠç‰¹ç‚¹</h3><p>â­<strong>UDP</strong></p><p><code>UDP</code>çš„å…¨ç§°æ˜¯<strong>ç”¨æˆ·æ•°æ®æŠ¥åè®®</strong>ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®åŒ…ï¼Œæ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼Œåœ¨ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®çš„ä¸Šä¸€å±‚ã€‚<code>UDP</code>æœ‰<strong>ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„å’Œç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åº</strong>çš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾</strong>çš„ã€‚</p><p><code>UDP</code>æœ‰<strong>ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„å’Œç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åº</strong>çš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾</strong>çš„ã€‚</p><blockquote><p>å®ƒçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p></blockquote><p><strong>1ï¼‰é¢å‘æ— è¿æ¥</strong></p><p>é¦–å…ˆ UDP æ˜¯ä¸éœ€è¦å’Œ TCPä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚</p><p>å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p><ul><li><p>åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ <code>UDP</code> åè®®ï¼Œ<code>UDP</code> åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª <code>UDP</code> å¤´æ ‡è¯†ä¸‹æ˜¯ <code>UDP</code> åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†</p></li><li><p>åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼Œ<code>UDP</code> åªå»é™¤ <code>IP</code> æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ</p></li></ul><p><strong>2ï¼‰æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½</strong></p><p><code>UDP</code> ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>UDP</code> æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚</p><p><strong>3ï¼‰é¢å‘æŠ¥æ–‡</strong></p><p>å‘é€æ–¹çš„<code>UDP</code>å¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜<code>IP</code>å±‚ã€‚<code>UDP</code>å¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡</p><p><strong>4ï¼‰ä¸å¯é æ€§</strong></p><p>é¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨<strong>æ— è¿æ¥</strong>ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚</p><p>å¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚</p><p>å†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ <code>UDP</code> å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨<strong>æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨</strong> <code>UDP</code> <strong>è€Œä¸æ˜¯</strong> <code>TCP</code><strong>ã€‚</strong></p><p><strong>5ï¼‰å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</strong><br><code>UDP</code> å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š</p><ul><li>ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£</li><li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦</li><li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯</li></ul><p>å› æ­¤ <code>UDP</code> çš„<strong>å¤´éƒ¨å¼€é”€å°</strong>ï¼Œåªæœ‰<code>8</code>å­—èŠ‚ï¼Œç›¸æ¯” <code>TCP</code> çš„è‡³å°‘<code>20</code>å­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</p><p><code>UDP</code> <strong>åè®®ä¸ºä»€ä¹ˆä¸å¯é  ?</strong></p><p><code>UDP</code>åœ¨ä¼ è¾“æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°ä¸»æœºçš„è¿è¾“å±‚åœ¨æ¥æ”¶åˆ°<code>UDP</code>æŠ¥æ–‡åï¼Œä¸éœ€è¦ç¡®è®¤ï¼Œæä¾›ä¸å¯é äº¤ä»˜ã€‚æ€»ç»“å°±ä»¥ä¸‹å››ç‚¹ï¼š</p><ul><li>ä¸ä¿è¯æ¶ˆæ¯äº¤ä»˜ï¼šä¸ç¡®è®¤ï¼Œä¸é‡ä¼ ï¼Œæ— è¶…æ—¶</li><li>ä¸ä¿è¯äº¤ä»˜é¡ºåºï¼šä¸è®¾ç½®åŒ…åºå·ï¼Œä¸é‡æ’ï¼Œä¸ä¼šå‘ç”Ÿé˜Ÿé¦–é˜»å¡</li><li>ä¸è·Ÿè¸ªè¿æ¥çŠ¶æ€ï¼šä¸å¿…å»ºç«‹è¿æ¥æˆ–é‡å¯çŠ¶æ€æœº</li><li>ä¸è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼šä¸å†…ç½®å®¢æˆ·ç«¯æˆ–ç½‘ç»œåé¦ˆæœºåˆ¶</li></ul><p>â­<strong>TCP</strong></p><p><code>TCP</code>çš„å…¨ç§°æ˜¯ä¼ è¾“æ§åˆ¶åè®® , æ˜¯ä¸€ç§<strong>é¢å‘è¿æ¥çš„ã€å¯é çš„</strong>ã€<strong>åŸºäºå­—èŠ‚æµ</strong>çš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚</p><p>æµå°±æ˜¯æŒ‡ä¸é—´æ–­çš„æ•°æ®ç»“æ„ã€‚</p><blockquote><p>å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p></blockquote><p><strong>1ï¼‰é¢å‘è¿æ¥</strong></p><p>é¢å‘è¿æ¥ï¼Œæ˜¯æŒ‡å‘é€æ•°æ®ä¹‹å‰å¿…é¡»åœ¨ä¸¤ç«¯å»ºç«‹è¿æ¥ã€‚å»ºç«‹è¿æ¥çš„æ–¹æ³•æ˜¯â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œè¿™æ ·èƒ½å»ºç«‹å¯é çš„è¿æ¥ã€‚å»ºç«‹è¿æ¥ï¼Œæ˜¯ä¸ºæ•°æ®çš„å¯é ä¼ è¾“æ‰“ä¸‹äº†åŸºç¡€ã€‚</p><p><strong>2ï¼‰ä»…æ”¯æŒå•æ’­ä¼ è¾“</strong></p><p>æ¯æ¡<code>TCP</code>ä¼ è¾“è¿æ¥åªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼Œåªèƒ½è¿›è¡Œç‚¹å¯¹ç‚¹çš„æ•°æ®ä¼ è¾“ï¼Œä¸æ”¯æŒå¤šæ’­å’Œå¹¿æ’­ä¼ è¾“æ–¹å¼ã€‚</p><p><strong>3ï¼‰é¢å‘å­—èŠ‚æµ</strong></p><p><code>TCP</code>ä¸åƒ<code>UDP</code>ä¸€æ ·é‚£æ ·ä¸€ä¸ªä¸ªæŠ¥æ–‡ç‹¬ç«‹åœ°ä¼ è¾“ï¼Œè€Œæ˜¯åœ¨ä¸ä¿ç•™æŠ¥æ–‡è¾¹ç•Œçš„æƒ…å†µä¸‹ä»¥å­—èŠ‚æµæ–¹å¼è¿›è¡Œä¼ è¾“ã€‚</p><p><strong>4ï¼‰å¯é ä¼ è¾“</strong></p><p>å¯¹äºå¯é ä¼ è¾“ï¼Œåˆ¤æ–­ä¸¢åŒ…ã€è¯¯ç é çš„æ˜¯<code>TCP</code>çš„æ®µç¼–å·ä»¥åŠç¡®è®¤å·ã€‚<code>TCP</code>ä¸ºäº†ä¿è¯æŠ¥æ–‡ä¼ è¾“çš„å¯é ï¼Œå°±ç»™æ¯ä¸ªåŒ…ä¸€ä¸ªåºå·ï¼ŒåŒæ—¶åºå·ä¹Ÿä¿è¯äº†ä¼ é€åˆ°æ¥æ”¶ç«¯å®ä½“çš„åŒ…çš„æŒ‰åºæ¥æ”¶ã€‚ç„¶åæ¥æ”¶ç«¯å®ä½“å¯¹å·²æˆåŠŸæ”¶åˆ°çš„å­—èŠ‚å‘å›ä¸€ä¸ªç›¸åº”çš„ç¡®è®¤(<code>ACK</code>)ï¼›å¦‚æœå‘é€ç«¯å®ä½“åœ¨åˆç†çš„å¾€è¿”æ—¶å»¶(<code>RTT</code>)å†…æœªæ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ï¼ˆå‡è®¾ä¸¢å¤±äº†ï¼‰å°†ä¼šè¢«é‡ä¼ ã€‚</p><blockquote><ul><li><p>æœ‰çŠ¶æ€<br>TCP ä¼šç²¾å‡†è®°å½•å“ªäº›æ•°æ®å‘é€äº†ï¼Œå“ªäº›æ•°æ®è¢«å¯¹æ–¹æ¥æ”¶äº†ï¼Œå“ªäº›æ²¡æœ‰è¢«æ¥æ”¶åˆ°ï¼Œè€Œä¸”ä¿è¯æ•°æ®åŒ…æŒ‰åºåˆ°è¾¾ï¼Œä¸å…è®¸åŠç‚¹å·®é”™ã€‚</p></li><li><p>å¯æ§åˆ¶<br>å½“æ„è¯†åˆ°ä¸¢åŒ…äº†æˆ–è€…ç½‘ç»œç¯å¢ƒä¸ä½³ï¼ŒTCP ä¼šæ ¹æ®å…·ä½“æƒ…å†µè°ƒæ•´è‡ªå·±çš„è¡Œä¸ºï¼Œæ§åˆ¶è‡ªå·±çš„å‘é€é€Ÿåº¦æˆ–è€…é‡å‘ã€‚</p></li></ul></blockquote><p><strong>5ï¼‰æä¾›æ‹¥å¡æ§åˆ¶</strong></p><p>å½“ç½‘ç»œå‡ºç°æ‹¥å¡çš„æ—¶å€™ï¼Œ<code>TCP</code>èƒ½å¤Ÿå‡å°å‘ç½‘ç»œæ³¨å…¥æ•°æ®çš„é€Ÿç‡å’Œæ•°é‡ï¼Œç¼“è§£æ‹¥å¡ã€‚</p><p><strong>6ï¼‰æä¾›å…¨åŒå·¥é€šä¿¡</strong></p><p><code>TCP</code>å…è®¸é€šä¿¡åŒæ–¹çš„åº”ç”¨ç¨‹åºåœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½å‘é€æ•°æ®ï¼Œå› ä¸º<code>TCP</code>è¿æ¥çš„ä¸¤ç«¯éƒ½è®¾æœ‰ç¼“å­˜ï¼Œç”¨æ¥ä¸´æ—¶å­˜æ”¾åŒå‘é€šä¿¡çš„æ•°æ®ã€‚å½“ç„¶ï¼Œ<code>TCP</code>å¯ä»¥ç«‹å³å‘é€ä¸€ä¸ªæ•°æ®æ®µï¼Œä¹Ÿå¯ä»¥ç¼“å­˜ä¸€æ®µæ—¶é—´ä»¥ä¾¿ä¸€æ¬¡å‘é€æ›´å¤šçš„æ•°æ®æ®µï¼ˆæœ€å¤§çš„æ•°æ®æ®µå¤§å°å–å†³äº<code>MSS</code>ï¼‰</p><p><strong>TCP çš„é‡ä¼ æœºåˆ¶</strong></p><p>ç”±äº<code>TCP</code>çš„ä¸‹å±‚ç½‘ç»œï¼ˆç½‘ç»œå±‚ï¼‰å¯èƒ½å‡ºç°<strong>ä¸¢å¤±ã€é‡å¤æˆ–å¤±åº</strong>çš„æƒ…å†µï¼Œ<code>TCP</code>åè®®æä¾›å¯é æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ä¸ºä¿è¯æ•°æ®ä¼ è¾“çš„æ­£ç¡®æ€§ï¼Œ<code>TCP</code>ä¼šé‡ä¼ å…¶è®¤ä¸ºå·²ä¸¢å¤±ï¼ˆåŒ…æ‹¬æŠ¥æ–‡ä¸­çš„æ¯”ç‰¹é”™è¯¯ï¼‰çš„åŒ…ã€‚<code>TCP</code>ä½¿ç”¨ä¸¤å¥—ç‹¬ç«‹çš„æœºåˆ¶æ¥å®Œæˆé‡ä¼ ï¼Œä¸€æ˜¯<strong>åŸºäºæ—¶é—´</strong>ï¼ŒäºŒæ˜¯<strong>åŸºäºç¡®è®¤ä¿¡æ¯</strong>ã€‚</p><p><code>TCP</code>åœ¨å‘é€ä¸€ä¸ªæ•°æ®ä¹‹åï¼Œå°±å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè‹¥æ˜¯åœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å‘é€æ•°æ®çš„<code>ACK</code>ç¡®è®¤æŠ¥æ–‡ï¼Œåˆ™å¯¹è¯¥æŠ¥æ–‡è¿›è¡Œé‡ä¼ ï¼Œåœ¨è¾¾åˆ°ä¸€å®šæ¬¡æ•°è¿˜æ²¡æœ‰æˆåŠŸæ—¶æ”¾å¼ƒå¹¶å‘é€ä¸€ä¸ªå¤ä½ä¿¡å·ã€‚</p><h3 id="2-TCP-å’Œ-UDP-çš„åŒºåˆ«"><a href="#2-TCP-å’Œ-UDP-çš„åŒºåˆ«" class="headerlink" title="2. TCP å’Œ UDP çš„åŒºåˆ«"></a>2. TCP å’Œ UDP çš„åŒºåˆ«</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713024.png" alt="img"></p><h3 id="3-TCP-å’Œ-UDP-çš„ä½¿ç”¨åœºæ™¯"><a href="#3-TCP-å’Œ-UDP-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="3. TCP å’Œ UDP çš„ä½¿ç”¨åœºæ™¯"></a>3. TCP å’Œ UDP çš„ä½¿ç”¨åœºæ™¯</h3><ul><li><code>TCP</code><strong>åº”ç”¨åœºæ™¯ï¼š</strong> æ•ˆç‡è¦æ±‚ç›¸å¯¹ä½ï¼Œä½†å¯¹å‡†ç¡®æ€§è¦æ±‚ç›¸å¯¹é«˜çš„åœºæ™¯ã€‚å› ä¸ºä¼ è¾“ä¸­éœ€è¦å¯¹æ•°æ®ç¡®è®¤ã€é‡å‘ã€æ’åºç­‰æ“ä½œï¼Œç›¸æ¯”ä¹‹ä¸‹æ•ˆç‡æ²¡æœ‰<code>UDP</code>é«˜ã€‚ä¾‹å¦‚ï¼šæ–‡ä»¶ä¼ è¾“ï¼ˆå‡†ç¡®é«˜è¦æ±‚é«˜ã€ä½†æ˜¯é€Ÿåº¦å¯ä»¥ç›¸å¯¹æ…¢ï¼‰ã€æ¥å—é‚®ä»¶ã€è¿œç¨‹ç™»å½•ã€‚</li><li><code>UDP</code><strong>åº”ç”¨åœºæ™¯ï¼š</strong> æ•ˆç‡è¦æ±‚ç›¸å¯¹é«˜ï¼Œå¯¹å‡†ç¡®æ€§è¦æ±‚ç›¸å¯¹ä½çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼šQQèŠå¤©ã€åœ¨çº¿è§†é¢‘ã€ç½‘ç»œè¯­éŸ³ç”µè¯ï¼ˆå³æ—¶é€šè®¯ï¼Œé€Ÿåº¦è¦æ±‚é«˜ï¼Œä½†æ˜¯å‡ºç°å¶å°”æ–­ç»­ä¸æ˜¯å¤ªå¤§é—®é¢˜ï¼Œå¹¶ä¸”æ­¤å¤„å®Œå…¨ä¸å¯ä»¥ä½¿ç”¨é‡å‘æœºåˆ¶ï¼‰ã€å¹¿æ’­é€šä¿¡ï¼ˆå¹¿æ’­ã€å¤šæ’­ï¼‰ã€‚</li></ul><h3 id="4-TCPçš„æ‹¥å¡æ§åˆ¶æœºåˆ¶"><a href="#4-TCPçš„æ‹¥å¡æ§åˆ¶æœºåˆ¶" class="headerlink" title="4. TCPçš„æ‹¥å¡æ§åˆ¶æœºåˆ¶"></a>4. TCPçš„æ‹¥å¡æ§åˆ¶æœºåˆ¶</h3><blockquote><p>æµé‡æ§åˆ¶å‘ç”Ÿåœ¨å‘é€ç«¯è·Ÿæ¥æ”¶ç«¯ä¹‹é—´ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ•´ä¸ªç½‘ç»œç¯å¢ƒçš„å½±å“ï¼Œå¦‚æœè¯´å½“å‰ç½‘ç»œç‰¹åˆ«å·®ï¼Œç‰¹åˆ«å®¹æ˜“ä¸¢åŒ…ï¼Œé‚£ä¹ˆå‘é€ç«¯å°±åº”è¯¥æ³¨æ„ä¸€äº›äº†ã€‚è€Œè¿™ä¹Ÿæ­£æ˜¯æ‹¥å¡æ§åˆ¶éœ€è¦å¤„ç†çš„é—®é¢˜ã€‚</p></blockquote><p>å¯¹äºæ‹¥å¡æ§åˆ¶æ¥è¯´ï¼ŒTCP æ¯æ¡è¿æ¥éƒ½éœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ ¸å¿ƒçŠ¶æ€:</p><ul><li>æ‹¥å¡çª—å£ï¼ˆCongestion Windowï¼Œcwndï¼‰</li><li>æ…¢å¯åŠ¨é˜ˆå€¼ï¼ˆSlow Start Thresholdï¼Œssthreshï¼‰</li></ul><blockquote><p>æ¶‰åŠåˆ°çš„ç®—æ³•(æœºåˆ¶)æœ‰ä»¥ä¸‹å››ç§ï¼š</p></blockquote><ul><li><strong>æ…¢å¯åŠ¨ï¼ˆæ…¢å¼€å§‹ï¼‰</strong></li><li><strong>æ‹¥å¡é¿å…</strong></li><li><strong>å¿«é€Ÿé‡ä¼ </strong></li><li><strong>å¿«é€Ÿæ¢å¤</strong></li></ul><ol><li><strong>æ‹¥å¡çª—å£</strong></li></ol><p>æ‹¥å¡çª—å£ï¼ˆCongestion Windowï¼Œ<code>cwnd</code>ï¼‰æ˜¯æŒ‡ç›®å‰è‡ªå·±è¿˜èƒ½ä¼ è¾“çš„æ•°æ®é‡å¤§å°ã€‚</p><blockquote><p>é‚£ä¹ˆä¹‹å‰ä»‹ç»äº†æ¥æ”¶çª—å£çš„æ¦‚å¿µï¼Œä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p></blockquote><ul><li>æ¥æ”¶çª—å£(rwnd)æ˜¯æ¥æ”¶ç«¯ç»™çš„é™åˆ¶</li><li>æ‹¥å¡çª—å£(cwnd)æ˜¯å‘é€ç«¯çš„é™åˆ¶</li></ul><p><strong>æ‹¥å¡çª—å£(cwnd)æ˜¯å‘é€æ–¹çš„, é™åˆ¶çš„æ˜¯å‘é€çª—å£çš„å¤§å°ã€‚</strong></p><p>æœ‰äº†è¿™ä¸¤ä¸ªçª—å£ï¼Œå¦‚ä½•æ¥è®¡ç®—å‘é€çª—å£ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">å‘é€çª—å£å¤§å° = <span class="hljs-title function_">min</span>(rwnd, cwnd)<br></code></pre></td></tr></table></figure><p>å–ä¸¤è€…çš„è¾ƒå°å€¼ã€‚è€Œæ‹¥å¡æ§åˆ¶ï¼Œå°±æ˜¯æ¥æ§åˆ¶<code>cwnd</code>çš„å˜åŒ–ã€‚</p><ol start="2"><li><strong>æ…¢å¯åŠ¨ï¼ˆæ…¢å¼€å§‹ï¼‰</strong></li></ol><blockquote><p>æ‹¥å¡æ§åˆ¶é¦–å…ˆå°±æ˜¯è¦é‡‡ç”¨ä¸€ç§ä¿å®ˆçš„ç®—æ³•æ¥æ…¢æ…¢åœ°é€‚åº”æ•´ä¸ªç½‘ç»œ, ï¼Œè¿™ç§ç®—æ³•å«æ…¢å¯åŠ¨</p></blockquote><ul><li>é¦–å…ˆï¼Œä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŒæ–¹å®£å‘Šè‡ªå·±çš„æ¥æ”¶çª—å£å¤§å°</li><li>åˆå§‹åŒ–è‡ªå·±çš„æ‹¥å¡çª—å£(cwnd)å¤§å°, è®¾ç½®cwnd &#x3D; 1</li><li>æ€è·¯ï¼šå¼€å§‹ä¼ è¾“çš„æ—¶å€™ä¸è¦å‘é€å¤§é‡æ•°æ®ï¼Œè€Œæ˜¯å…ˆæµ‹è¯•ä¸€ä¸‹ç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œç”±å°åˆ°å¤§å¢åŠ æ‹¥å¡çª—å£çš„å¤§å°ã€‚</li></ul><blockquote><p>å‘é€ç«¯æ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œæ‹¥å¡çª—å£å¤§å°åŠ  1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ç»è¿‡ä¸€ä¸ª RTTï¼Œcwnd ç¿»å€ã€‚å¦‚æœè¯´åˆå§‹çª—å£ä¸º 10ï¼Œé‚£ä¹ˆç¬¬ä¸€è½® 10 ä¸ªæŠ¥æ–‡ä¼ å®Œä¸”å‘é€ç«¯æ”¶åˆ° ACK åï¼Œcwnd å˜ä¸º 20ï¼Œç¬¬äºŒè½®å˜ä¸º 40ï¼Œç¬¬ä¸‰è½®å˜ä¸º 80ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></blockquote><ul><li>ä¸ºäº†é˜²æ­¢<code>cwnd</code>å¢é•¿è¿‡å¤§å¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œè®¾ç½®ä¸€ä¸ªæ…¢å¯åŠ¨é˜ˆå€¼ï¼ˆ<code>ssthresh</code> çŠ¶æ€å˜é‡ï¼‰ <ul><li>å½“<code>cnwd &lt; ssthresh</code>ï¼Œä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•</li><li>å½“<code>cnwd = ssthresh</code>ï¼Œæ—¢å¯ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¥å¡é¿å…ç®—æ³•</li><li>å½“<code>cnwd &gt; ssthresh</code>ï¼Œä½¿ç”¨<strong>æ‹¥å¡é¿å…</strong>ç®—æ³•</li></ul></li></ul><ol start="3"><li><strong>æ‹¥å¡é¿å…</strong></li></ol><ul><li>æ‹¥å¡é¿å…æœªå¿…èƒ½å¤Ÿå®Œå…¨é¿å…æ‹¥å¡ï¼Œæ˜¯è¯´åœ¨æ‹¥å¡é¿å…é˜¶æ®µ<strong>å°†æ‹¥å¡çª—å£æ§åˆ¶ä¸ºæŒ‰çº¿æ€§å¢é•¿</strong>ï¼Œä½¿ç½‘ç»œä¸å®¹æ˜“å‡ºç°é˜»å¡ã€‚</li><li>æ€è·¯ï¼š è®©æ‹¥å¡çª—å£<code>cwnd</code>ç¼“æ…¢çš„å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªè¿”å›æ—¶é—´<code>RTT</code>å°±æŠŠå‘é€æ–¹çš„æ‹¥å¡æ§åˆ¶çª—å£åŠ <code>1</code></li></ul><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥å‰ä¸€ä¸ª RTT ä¸‹æ¥ï¼Œcwndç¿»å€ï¼Œç°åœ¨cwndåªæ˜¯å¢åŠ  1 è€Œå·²ã€‚</p><p>å½“ç„¶ï¼Œæ…¢å¯åŠ¨å’Œæ‹¥å¡é¿å…æ˜¯ä¸€èµ·ä½œç”¨çš„ï¼Œæ˜¯ä¸€ä½“çš„ã€‚</p></blockquote><ul><li>æ— è®ºæ˜¯åœ¨æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯åœ¨æ‹¥å¡é¿å…é˜¶æ®µï¼Œåªè¦å‘é€æ–¹åˆ¤æ–­ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œå°±æŠŠæ…¢å¼€å§‹é—¨é™è®¾ç½®ä¸ºå‡ºç°æ‹¥å¡æ—¶çš„å‘é€çª—å£å¤§å°çš„ä¸€åŠã€‚ç„¶åæŠŠæ‹¥å¡çª—å£è®¾ç½®ä¸º<code>1</code>ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚å…¶ä¸­ï¼Œåˆ¤æ–­ç½‘ç»œå‡ºç°æ‹¥å¡çš„æ ¹æ®å°±æ˜¯æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œè™½ç„¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å¯èƒ½æ˜¯å…¶ä»–åŸå› çš„åˆ†ç»„ä¸¢å¤±ï¼Œä½†æ˜¯å› ä¸ºæ— æ³•åˆ¤å®šï¼Œæ‰€ä»¥éƒ½å½“åšæ‹¥å¡æ¥å¤„ç†ã€‚</li></ul><blockquote><p> å¦‚å›¾ : </p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713132.png" alt="img"></p><ol start="4"><li><strong>å¿«é€Ÿé‡ä¼ </strong></li></ol><ul><li>å¿«é€Ÿé‡ä¼ è¦æ±‚æ¥æ”¶æ–¹åœ¨æ”¶åˆ°ä¸€ä¸ªå¤±åºçš„æŠ¥æ–‡æ®µ(å³ä¸¢åŒ…)åå°±ç«‹å³å‘å‡ºé‡å¤ç¡®è®¤<code>ACK</code>ï¼ˆä¸ºçš„æ˜¯ä½¿å‘é€æ–¹åŠæ—©çŸ¥é“æœ‰æŠ¥æ–‡æ®µæ²¡æœ‰åˆ°è¾¾å¯¹æ–¹ï¼‰ã€‚å‘é€æ–¹åªè¦è¿ç»­æ”¶åˆ°<strong>ä¸‰ä¸ªé‡å¤ç¡®è®¤</strong>å°±ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸ç”¨ç­‰åˆ°ä¸€ä¸ª RTO(è¶…æ—¶é‡ä¼ æ—¶é—´, æ˜¯æ ¹æ®RTTè®¡ç®—å¾—åˆ°) çš„æ—¶é—´åˆ°äº†æ‰é‡ä¼ </li><li>ç”±äºä¸éœ€è¦ç­‰å¾…è®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨åˆ°æœŸï¼Œèƒ½å°½æ—©é‡ä¼ æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œèƒ½æé«˜æ•´ä¸ªç½‘ç»œçš„ååé‡</li></ul><blockquote><p>ä¾‹å­ : æ¯”å¦‚ç¬¬ 5 ä¸ªåŒ…ä¸¢äº†ï¼Œå³ä½¿ç¬¬ 6ã€7 ä¸ªåŒ…åˆ°è¾¾çš„æ¥æ”¶ç«¯ï¼Œæ¥æ”¶ç«¯ä¹Ÿä¸€å¾‹è¿”å›ç¬¬ 4 ä¸ªåŒ…çš„ ACKã€‚å½“å‘é€ç«¯æ”¶åˆ° 3 ä¸ªé‡å¤çš„ ACK æ—¶ï¼Œæ„è¯†åˆ°ä¸¢åŒ…äº†ï¼Œäºæ˜¯é©¬ä¸Šè¿›è¡Œé‡ä¼ ï¼Œä¸ç”¨ç­‰åˆ°ä¸€ä¸ª RTO çš„æ—¶é—´åˆ°äº†æ‰é‡ä¼ ã€‚</p></blockquote><p><strong>é€‰æ‹©æ€§é‡ä¼ </strong></p><blockquote><p>é‚£ä½ å¯èƒ½ä¼šé—®äº†ï¼Œæ—¢ç„¶è¦é‡ä¼ ï¼Œé‚£ä¹ˆåªé‡ä¼ ç¬¬ 5 ä¸ªåŒ…è¿˜æ˜¯ç¬¬5ã€6ã€7 ä¸ªåŒ…éƒ½é‡ä¼ å‘¢ï¼Ÿ</p></blockquote><p>å½“ç„¶ç¬¬ 6ã€7 ä¸ªéƒ½å·²ç»åˆ°è¾¾äº†ï¼Œå·²ç»ä¼ è¿‡å»å¹²å˜›è¿˜è¦ä¼ ï¼Ÿå¹²è„†<strong>è®°å½•ä¸€ä¸‹å“ªäº›åŒ…åˆ°äº†ï¼Œå“ªäº›æ²¡åˆ°ï¼Œé’ˆå¯¹æ€§åœ°é‡ä¼ ã€‚</strong></p><p>åœ¨æ”¶åˆ°å‘é€ç«¯çš„æŠ¥æ–‡åï¼Œæ¥æ”¶ç«¯å›å¤ä¸€ä¸ª <code>ACK</code> æŠ¥æ–‡ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæŠ¥æ–‡é¦–éƒ¨çš„<strong>å¯é€‰é¡¹</strong>ä¸­ï¼Œå°±å¯ä»¥åŠ ä¸Š**<code>SACK</code>**è¿™ä¸ªå±æ€§ï¼Œé€šè¿‡<code>left edge</code>å’Œ<code>right edge</code>å‘ŠçŸ¥å‘é€ç«¯å·²ç»æ”¶åˆ°äº†å“ªäº›åŒºé—´çš„æ•°æ®æŠ¥ã€‚å› æ­¤ï¼Œå³ä½¿ç¬¬ 5 ä¸ªåŒ…ä¸¢åŒ…äº†ï¼Œå½“æ”¶åˆ°ç¬¬ 6ã€7 ä¸ªåŒ…ä¹‹åï¼Œæ¥æ”¶ç«¯ä¾ç„¶ä¼šå‘Šè¯‰å‘é€ç«¯ï¼Œè¿™ä¸¤ä¸ªåŒ…åˆ°äº†ã€‚å‰©ä¸‹ç¬¬ 5 ä¸ªåŒ…æ²¡åˆ°ï¼Œå°±é‡ä¼ è¿™ä¸ªåŒ…ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«åš<strong>é€‰æ‹©æ€§é‡ä¼ </strong>(SACKï¼ŒSelective Acknowledgment)ï¼Œå®ƒè§£å†³çš„æ˜¯å¦‚ä½•é‡ä¼ çš„é—®é¢˜ã€‚</p><ol start="5"><li><strong>å¿«é€Ÿæ¢å¤</strong></li></ol><ul><li><p>å½“å‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤æ—¶ï¼Œå°±æ‰§è¡Œâ€œä¹˜æ³•å‡å°â€ç®—æ³•ï¼ŒæŠŠ<code>ssthresh</code>é—¨é™å‡åŠã€‚ä½†æ˜¯æ¥ä¸‹å»å¹¶ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚</p></li><li><p>è€ƒè™‘åˆ°å¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡çš„è¯å°±ä¸ä¼šæ”¶åˆ°å¥½å‡ ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œæ‰€ä»¥å‘é€æ–¹ç°åœ¨è®¤ä¸ºç½‘ç»œå¯èƒ½æ²¡æœ‰å‡ºç°æ‹¥å¡ã€‚æ‰€ä»¥æ­¤æ—¶ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼Œè€Œæ˜¯å°†<code>cwnd</code>è®¾ç½®ä¸º<code>ssthresh</code>çš„å¤§å°ï¼Œç„¶åæ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// ä»¥ä¸‹æŒ‰é¡ºåºæ‰§è¡Œ<br>æ‹¥å¡é˜ˆå€¼ /<span class="hljs-operator">=</span> <span class="hljs-number">2</span><br>æ‹¥å¡çª—å£å¤§å° <span class="hljs-operator">=</span> æ‹¥å¡é˜ˆå€¼<br>æ‹¥å¡çª—å£å¤§å°çº¿æ€§å¢åŠ <br></code></pre></td></tr></table></figure></li></ul><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713088.png" alt="img"></p><h3 id="5-TCPçš„æµé‡æ§åˆ¶æœºåˆ¶"><a href="#5-TCPçš„æµé‡æ§åˆ¶æœºåˆ¶" class="headerlink" title="5. TCPçš„æµé‡æ§åˆ¶æœºåˆ¶"></a>5. TCPçš„æµé‡æ§åˆ¶æœºåˆ¶</h3><blockquote><p>å¯¹äºå‘é€ç«¯å’Œæ¥æ”¶ç«¯è€Œè¨€ï¼ŒTCP éœ€è¦æŠŠå‘é€çš„æ•°æ®æ”¾åˆ°å‘é€ç¼“å­˜åŒº, å°†æ¥æ”¶çš„æ•°æ®æ”¾åˆ°æ¥æ”¶ç¼“å­˜åŒºã€‚<br>è€Œæµé‡æ§åˆ¶æ‰€è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯åœ¨é€šè¿‡æ¥æ”¶ç¼“å­˜åŒºçš„å¤§å°ï¼Œæ§åˆ¶å‘é€ç«¯çš„å‘é€ã€‚å¦‚æœå¯¹æ–¹çš„æ¥æ”¶ç¼“å­˜åŒºæ»¡äº†ï¼Œå°±ä¸èƒ½å†ç»§ç»­å‘é€äº†ã€‚</p></blockquote><blockquote><p>TCP æ»‘åŠ¨çª—å£åˆ†ä¸ºä¸¤ç§: å‘é€çª—å£å’Œæ¥æ”¶çª—å£ã€‚</p></blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œæµé‡æ§åˆ¶å°±æ˜¯ä¸ºäº†è®©å‘é€æ–¹å‘é€æ•°æ®çš„é€Ÿåº¦ä¸è¦å¤ªå¿«ï¼Œè¦è®©æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚TCPé‡‡ç”¨å¤§å°å¯å˜çš„<strong>æ»‘åŠ¨çª—å£</strong>è¿›è¡Œæµé‡æ§åˆ¶ï¼Œçª—å£å¤§å°çš„å•ä½æ˜¯å­—èŠ‚ã€‚è¿™é‡Œè¯´çš„çª—å£å¤§å°å…¶å®å°±æ˜¯æ¯æ¬¡ä¼ è¾“çš„æ•°æ®å¤§å°ã€‚</p><ul><li>å½“ä¸€ä¸ªè¿æ¥å»ºç«‹æ—¶(ä¸‰æ¬¡æ¡æ‰‹å)ï¼Œè¿æ¥çš„æ¯ä¸€ç«¯åˆ†é…ä¸€ä¸ªç¼“å†²åŒºæ¥ä¿å­˜è¾“å…¥çš„æ•°æ®(åˆå§‹åŒ–çª—å£å¤§å°)ï¼Œå¹¶å°†ç¼“å†²åŒºçš„å¤§å°å‘é€ç»™å¦ä¸€ç«¯ã€‚</li><li>å½“æ•°æ®åˆ°è¾¾æ—¶ï¼Œæ¥æ”¶æ–¹å‘é€ç¡®è®¤ï¼Œå…¶ä¸­åŒ…å«äº†è‡ªå·±å‰©ä½™çš„ç¼“å†²åŒºå¤§å°ã€‚ï¼ˆå‰©ä½™çš„ç¼“å†²åŒºç©ºé—´çš„å¤§å°è¢«ç§°ä¸ºçª—å£ï¼ŒæŒ‡å‡ºçª—å£å¤§å°çš„é€šçŸ¥ç§°ä¸ºçª—å£é€šå‘Š ã€‚æ¥æ”¶æ–¹åœ¨å‘é€çš„æ¯ä¸€ç¡®è®¤ä¸­éƒ½å«æœ‰ä¸€ä¸ªçª—å£é€šå‘Šã€‚) </li><li>å¦‚æœæ¥æ”¶æ–¹åº”ç”¨ç¨‹åºè¯»æ•°æ®çš„é€Ÿåº¦èƒ½å¤Ÿä¸æ•°æ®åˆ°è¾¾çš„é€Ÿåº¦ä¸€æ ·å¿«ï¼Œæ¥æ”¶æ–¹å°†åœ¨æ¯ä¸€ç¡®è®¤ä¸­å‘é€ä¸€ä¸ªæ­£çš„çª—å£é€šå‘Šã€‚</li><li>å¦‚æœå‘é€æ–¹æ“ä½œçš„é€Ÿåº¦å¿«äºæ¥æ”¶æ–¹ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®æœ€ç»ˆå°†å……æ»¡æ¥æ”¶æ–¹çš„ç¼“å†²åŒºï¼Œå¯¼è‡´æ¥æ”¶æ–¹é€šå‘Šä¸€ä¸ªé›¶çª—å£ã€‚å‘é€æ–¹æ”¶åˆ°ä¸€ä¸ªé›¶çª—å£é€šå‘Šæ—¶ï¼Œå¿…é¡»åœæ­¢å‘é€ï¼Œç›´åˆ°æ¥æ”¶æ–¹é‡æ–°é€šå‘Šä¸€ä¸ªæ­£çš„çª—å£ã€‚</li></ul><h3 id="6-TCPçš„å¯é ä¼ è¾“æœºåˆ¶"><a href="#6-TCPçš„å¯é ä¼ è¾“æœºåˆ¶" class="headerlink" title="6. TCPçš„å¯é ä¼ è¾“æœºåˆ¶"></a>6. TCPçš„å¯é ä¼ è¾“æœºåˆ¶</h3><p><code>TCP</code> çš„å¯é ä¼ è¾“æœºåˆ¶æ˜¯åŸºäº<strong>è¿ç»­</strong> <code>ARQ</code> <strong>åè®®</strong>å’Œ<strong>æ»‘åŠ¨çª—å£åè®®</strong>çš„ã€‚</p><p><code>TCP</code> åè®®åœ¨å‘é€æ–¹ç»´æŒäº†ä¸€ä¸ªå‘é€çª—å£</p><ul><li>å‘é€çª—å£ä»¥å‰çš„æŠ¥æ–‡æ®µæ˜¯å·²ç»å‘é€å¹¶ç¡®è®¤äº†çš„æŠ¥æ–‡æ®µï¼Œ</li><li>å‘é€çª—å£å†…åŒ…å«äº†å·²ç»å‘é€ä½†æœªç¡®è®¤çš„æŠ¥æ–‡æ®µå’Œå…è®¸å‘é€ä½†è¿˜æœªå‘é€çš„æŠ¥æ–‡æ®µ</li><li>å‘é€çª—å£ä»¥åçš„æŠ¥æ–‡æ®µæ˜¯ç¼“å­˜ä¸­è¿˜ä¸å…è®¸å‘é€çš„æŠ¥æ–‡æ®µã€‚</li></ul><p>å½“<strong>å‘é€æ–¹</strong>å‘<strong>æ¥æ”¶æ–¹</strong>å‘é€æŠ¥æ–‡æ—¶ï¼Œä¼šä¾æ¬¡å‘é€çª—å£å†…çš„æ‰€æœ‰æŠ¥æ–‡æ®µï¼Œå¹¶ä¸”è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿™ä¸ªå®šæ—¶å™¨å¯ä»¥ç†è§£ä¸ºæ˜¯æœ€æ—©å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„æŠ¥æ–‡æ®µã€‚ </p><ul><li>å¦‚æœåœ¨å®šæ—¶å™¨çš„æ—¶é—´å†…æ”¶åˆ°æŸä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¡®è®¤å›ç­”ï¼Œåˆ™æ»‘åŠ¨çª—å£ï¼Œå°†çª—å£çš„é¦–éƒ¨å‘åæ»‘åŠ¨åˆ°ç¡®è®¤æŠ¥æ–‡æ®µçš„åä¸€ä¸ªä½ç½®ã€‚</li><li>æ­¤æ—¶å¦‚æœè¿˜æœ‰å·²å‘é€ä½†æ²¡æœ‰ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œåˆ™é‡æ–°è®¾ç½®å®šæ—¶å™¨ï¼Œå¦‚æœæ²¡æœ‰äº†åˆ™å…³é—­å®šæ—¶å™¨ã€‚</li><li>å¦‚æœå®šæ—¶å™¨è¶…æ—¶ï¼Œåˆ™<strong>é‡æ–°å‘é€</strong>æ‰€æœ‰å·²ç»å‘é€ä½†è¿˜æœªæ”¶åˆ°ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œå¹¶å°†è¶…æ—¶çš„é—´éš”è®¾ç½®ä¸ºä»¥å‰çš„<strong>ä¸¤å€</strong>ã€‚</li></ul><p>å½“å‘é€æ–¹æ”¶åˆ°æ¥æ”¶æ–¹çš„ä¸‰ä¸ªå†—ä½™çš„ç¡®è®¤åº”ç­”åï¼Œè¿™æ˜¯ä¸€ç§æŒ‡ç¤ºï¼Œ è¯´æ˜è¯¥æŠ¥æ–‡æ®µä»¥åçš„æŠ¥æ–‡æ®µå¾ˆæœ‰å¯èƒ½å‘ç”Ÿä¸¢å¤±äº†ï¼Œé‚£ä¹ˆå‘é€æ–¹ä¼šå¯ç”¨<strong>å¿«é€Ÿé‡ä¼ </strong>çš„æœºåˆ¶ï¼Œå°±æ˜¯å½“å‰å®šæ—¶å™¨ç»“æŸå‰ï¼Œå‘é€æ‰€æœ‰çš„<strong>å·²å‘é€ä½†ç¡®è®¤</strong>çš„æŠ¥æ–‡æ®µã€‚</p><p>æ¥æ”¶æ–¹ä½¿ç”¨çš„æ˜¯<strong>ç´¯è®¡ç¡®è®¤</strong>çš„æœºåˆ¶ï¼Œå¯¹äºæ‰€æœ‰æŒ‰åºåˆ°è¾¾çš„æŠ¥æ–‡æ®µï¼Œæ¥æ”¶æ–¹è¿”å›ä¸€ä¸ªæŠ¥æ–‡æ®µçš„è‚¯å®šå›ç­”ã€‚å¦‚æœæ”¶åˆ°äº†ä¸€ä¸ªä¹±åºçš„æŠ¥æ–‡æ®µï¼Œé‚£ä¹ˆæ¥æ–¹ä¼šç›´æ¥<strong>ä¸¢å¼ƒ</strong>ï¼Œå¹¶è¿”å›ä¸€ä¸ªæœ€è¿‘çš„æŒ‰åºåˆ°è¾¾çš„æŠ¥æ–‡æ®µçš„è‚¯å®šå›ç­”ã€‚ä½¿ç”¨ç´¯è®¡ç¡®è®¤ä¿è¯äº†è¿”å›çš„ç¡®è®¤å·ä¹‹å‰çš„æŠ¥æ–‡æ®µéƒ½å·²ç»æŒ‰åºåˆ°è¾¾äº†ï¼Œæ‰€ä»¥å‘é€çª—å£å¯ä»¥ç§»åŠ¨åˆ°å·²ç¡®è®¤æŠ¥æ–‡æ®µçš„åé¢ã€‚</p><p>å‘é€çª—å£çš„å¤§å°æ˜¯å˜åŒ–çš„ï¼Œå®ƒæ˜¯ç”±æ¥æ”¶çª—å£å‰©ä½™å¤§å°å’Œç½‘ç»œä¸­æ‹¥å¡ç¨‹åº¦æ¥å†³å®šçš„ï¼Œ<code>TCP </code>å°±æ˜¯é€šè¿‡æ§åˆ¶å‘é€çª—å£çš„é•¿åº¦æ¥æ§åˆ¶æŠ¥æ–‡ æ®µçš„å‘é€é€Ÿç‡ã€‚</p><p>ä½†æ˜¯ <code>TCP</code> åè®®å¹¶ä¸å®Œå…¨å’Œæ»‘åŠ¨çª—å£åè®®ç›¸åŒï¼Œå› ä¸ºè®¸å¤šçš„ <code>TCP</code> å®ç°ä¼šå°†å¤±åºçš„æŠ¥æ–‡æ®µç»™<strong>ç¼“å­˜</strong>èµ·æ¥ï¼Œå¹¶ä¸”å‘ç”Ÿé‡ä¼ æ—¶ï¼Œåªä¼šé‡ä¼ ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå› æ­¤ <code>TCP</code> åè®®çš„å¯é ä¼ è¾“æœºåˆ¶æ›´åƒæ˜¯çª—å£æ»‘åŠ¨åè®®å’Œé€‰æ‹©é‡ä¼ åè®®çš„ä¸€ä¸ªæ··åˆä½“ã€‚</p><p><strong>TCP å¦‚ä½•ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„å¯é æ€§?</strong></p><ul><li><strong>æ ¡éªŒå’Œ</strong>ï¼šå‘é€æ–¹åœ¨å‘é€æ•°æ®ä¹‹å‰è®¡ç®—æ ¡éªŒå’Œï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®ååŒæ ·è®¡ç®—ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œé‚£ä¹ˆä¼ è¾“æœ‰è¯¯ã€‚</li><li><strong>ç¡®è®¤åº”ç­”ï¼Œåºåˆ—å·</strong>ï¼š<code>TCP</code>è¿›è¡Œä¼ è¾“æ—¶æ•°æ®éƒ½è¿›è¡Œäº†ç¼–å·ï¼Œæ¯æ¬¡æ¥æ”¶æ–¹è¿”å›<code>ACK</code>éƒ½æœ‰ç¡®è®¤åºåˆ—å·ã€‚</li><li><strong>è¶…æ—¶é‡ä¼ </strong>ï¼šå¦‚æœå‘é€æ–¹å‘é€æ•°æ®ä¸€æ®µæ—¶é—´åæ²¡æœ‰æ”¶åˆ°<code>ACK</code>ï¼Œé‚£ä¹ˆå°±é‡å‘æ•°æ®ã€‚</li><li><strong>è¿æ¥ç®¡ç†</strong>ï¼šä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ã€‚</li><li><strong>æµé‡æ§åˆ¶</strong>ï¼š<code>TCP</code>åè®®æŠ¥å¤´åŒ…å«16ä½çš„çª—å£å¤§å°ï¼Œæ¥æ”¶æ–¹ä¼šåœ¨è¿”å›<code>ACK</code>æ—¶åŒæ—¶æŠŠè‡ªå·±çš„å³æ—¶çª—å£å¡«å…¥ï¼Œå‘é€æ–¹å°±æ ¹æ®æŠ¥æ–‡ä¸­çª—å£çš„å¤§å°æ§åˆ¶å‘é€é€Ÿåº¦ã€‚</li><li><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šåˆšå¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œæ‹¥å¡çª—å£æ˜¯<code>1</code>ï¼Œä»¥åæ¯æ¬¡æ”¶åˆ°<code>ACK</code>ï¼Œåˆ™æ‹¥å¡çª—å£<code>+1</code>ï¼Œç„¶åå°†æ‹¥å¡çª—å£å’Œæ”¶åˆ°çš„çª—å£å–<strong>è¾ƒå°å€¼</strong>ä½œä¸ºå®é™…å‘é€çš„çª—å£ï¼Œå¦‚æœå‘ç”Ÿè¶…æ—¶é‡ä¼ ï¼Œæ‹¥å¡çª—å£é‡ç½®ä¸º<code>1</code>ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¿è¯ä¼ è¾“è¿‡ç¨‹çš„é«˜æ•ˆæ€§å’Œå¯é æ€§ã€‚</li></ul><h3 id="7-â—TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"><a href="#7-â—TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="7. â—TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"></a>7. â—TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</h3><p><strong>â—ä¸‰æ¬¡æ¡æ‰‹</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713110.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713203.png" alt="img"></p><p>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-way Handshakeï¼‰å…¶å®å°±æ˜¯æŒ‡å»ºç«‹ä¸€ä¸ª<code>TCP</code>è¿æ¥æ—¶ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ€»å…±å‘é€<code>3</code>ä¸ªåŒ…ã€‚è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹çš„ä¸»è¦ä½œç”¨å°±æ˜¯<strong>ä¸ºäº†ç¡®è®¤åŒæ–¹çš„æ¥æ”¶èƒ½åŠ›å’Œå‘é€èƒ½åŠ›æ˜¯å¦æ­£å¸¸ã€æŒ‡å®šè‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å·ä¸ºåé¢çš„å¯é æ€§ä¼ é€åšå‡†å¤‡ã€‚</strong></p><blockquote><p>å®è´¨ä¸Šå…¶å®å°±æ˜¯è¿æ¥æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼Œå»ºç«‹<code>TCP</code>è¿æ¥ï¼Œå¹¶åŒæ­¥è¿æ¥åŒæ–¹çš„åºåˆ—å·å’Œç¡®è®¤å·ï¼Œäº¤æ¢<code>TCP</code>çª—å£å¤§å°ä¿¡æ¯ã€‚</p></blockquote><p>åˆšå¼€å§‹å®¢æˆ·ç«¯å¤„äº <code>Closed</code> çš„çŠ¶æ€ï¼ŒæœåŠ¡ç«¯å¤„äº <code>Listen</code> çŠ¶æ€ã€‚</p><ul><li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘ä¸€ä¸ª <code>SYN</code> æŠ¥æ–‡ï¼Œå¹¶æŒ‡æ˜å®¢æˆ·ç«¯çš„åˆå§‹åŒ–åºåˆ—å· <code>ISN</code>ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº   <code>SYN_SENT</code> çŠ¶æ€ã€‚</li></ul><blockquote><p>é¦–éƒ¨çš„åŒæ­¥ä½<code>SYN=1</code>ï¼Œåˆå§‹åºå·<code>seq=x</code>ï¼Œ<code>SYN=1</code>çš„æŠ¥æ–‡æ®µä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚</p></blockquote><ul><li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ <code>SYN</code> æŠ¥æ–‡ä¹‹åï¼Œä¼šä»¥è‡ªå·±çš„ <code>SYN</code> æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æŒ‡å®šäº†è‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å· <code>ISN</code>ã€‚åŒæ—¶ä¼šæŠŠå®¢æˆ·ç«¯çš„ <code>ISN + 1</code> ä½œä¸º<code>ACK</code> çš„å€¼ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ <code>SYN</code>ï¼Œæ­¤æ—¶æœåŠ¡å™¨å¤„äº <code>SYN_RCVD</code> çš„çŠ¶æ€ã€‚</li></ul><blockquote><p>åœ¨ç¡®è®¤æŠ¥æ–‡æ®µä¸­<code>SYN=1</code>ï¼Œ<code>ACK=1</code>ï¼Œç¡®è®¤å·<code>ack=x+1</code>ï¼Œåˆå§‹åºå·<code>seq=y</code></p></blockquote><ul><li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ° <code>SYN</code> æŠ¥æ–‡ä¹‹åï¼Œä¼šå‘é€ä¸€ä¸ª <code>ACK</code> æŠ¥æ–‡ï¼Œå½“ç„¶ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠŠæœåŠ¡å™¨çš„ <code>ISN + 1</code> ä½œä¸º <code>ACK</code> çš„å€¼ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°äº†æœåŠ¡ç«¯çš„ <code>SYN</code> æŠ¥æ–‡ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ã€‚æœåŠ¡å™¨æ”¶åˆ° <code>ACK</code> æŠ¥æ–‡ä¹‹åï¼Œä¹Ÿå¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œæ­¤æ—¶ï¼ŒåŒæ–¹å·²å»ºç«‹èµ·äº†è¿æ¥ã€‚</li></ul><blockquote><p>ç¡®è®¤æŠ¥æ–‡æ®µ<code>ACK=1</code>ï¼Œç¡®è®¤å·<code>ack=y+1</code>ï¼Œåºå·<code>seq=x+1</code>ï¼ˆåˆå§‹ä¸º<code>seq=x</code>ï¼Œç¬¬äºŒä¸ªæŠ¥æ–‡æ®µæ‰€ä»¥è¦<code>+1</code>ï¼‰ï¼Œ   <code>ACK</code>æŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚</p></blockquote><p><strong>é‚£ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹å‘¢ï¼Ÿä¸¤æ¬¡ä¸è¡Œå—ï¼Ÿ</strong></p><ul><li>å¦‚æœæ˜¯ç”¨ä¸¤æ¬¡æ¡æ‰‹ï¼Œåˆ™ä¼šå‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µ</li></ul><p>å¦‚æœå®¢æˆ·ç«¯å‘é€ç¬¬ä¸€ä¸ªè¯·æ±‚, ä½†æ˜¯å› ä¸ºè¯·æ±‚æŠ¥æ–‡ä¸¢å¤±æœåŠ¡ç«¯æœªæ”¶åˆ°, äºæ˜¯å®¢æˆ·ç«¯å‘é€ç¬¬äºŒä¸ªè¯·æ±‚, è¿™æ—¶å€™æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚, å®¢æˆ·ç«¯ä¹Ÿæ”¶åˆ°äº†ç¡®è®¤, è¿™æ—¶ä¾¿å»ºç«‹äº†è¿æ¥ã€‚</p><p>ä½†æ˜¯ç¬¬ä¸€ä¸ªä¸¢å¤±çš„æŠ¥æ–‡æ®µåªæ˜¯åœ¨æŸäº›ç½‘ç»œç»“ç‚¹é•¿æ—¶é—´æ»ç•™äº†ï¼Œå»¶è¯¯åˆ°è¿æ¥é‡Šæ”¾ä»¥åçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾æœåŠ¡ç«¯ï¼Œæ­¤æ—¶æœåŠ¡ç«¯è¯¯è®¤ä¸ºå®¢æˆ·ç«¯åˆå‘å‡ºä¸€æ¬¡æ–°çš„è¿æ¥è¯·æ±‚,  äºæ˜¯å°±å‘å®¢æˆ·ç«¯å‘å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ŒåŒæ„å»ºç«‹è¿æ¥, è¿™æ—¶å®¢æˆ·ç«¯æ”¶åˆ°äº†ç¡®è®¤ä¾¿å»ºç«‹äº†è¿æ¥, ä½†æ˜¯å®¢æˆ·ç«¯ä¸çŸ¥é“è¿™ä¸ªè¿æ¥å’‹æ¥çš„, å°±å¿½ç•¥äº†è¿™ä¸ªç¡®è®¤, é‚£ä¹ˆæœåŠ¡ç«¯å°±ä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®, å°±ä¼šæµªè´¹æœåŠ¡ç«¯çš„èµ„æºã€‚(ä»¥ä¸Šéƒ½æ˜¯å»ºç«‹åœ¨ä¸¤æ¬¡æ¡æ‰‹çš„æƒ…å†µä¸‹)</p><p><strong>ç®€å•æ¥è¯´å°±æ˜¯ä»¥ä¸‹ä¸‰æ­¥ï¼š</strong></p><ul><li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼š</strong> å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è¯¥æŠ¥æ–‡æ®µä¸­åŒ…å«è‡ªèº«çš„æ•°æ®é€šè®¯åˆå§‹åºå·ã€‚è¯·æ±‚å‘é€åï¼Œå®¢æˆ·ç«¯ä¾¿è¿›å…¥ <code>SYN-SENT</code> çŠ¶æ€ã€‚</li><li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼š</strong> æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªåº”ç­”ï¼Œè¯¥åº”ç­”ä¸­ä¹Ÿä¼šåŒ…å«è‡ªèº«çš„æ•°æ®é€šè®¯åˆå§‹åºå·ï¼Œå‘é€å®Œæˆåä¾¿è¿›å…¥ <code>SYN-RECEIVED</code> çŠ¶æ€ã€‚</li><li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼š</strong> å½“å®¢æˆ·ç«¯æ”¶åˆ°è¿æ¥åŒæ„çš„åº”ç­”åï¼Œè¿˜è¦å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ã€‚å®¢æˆ·ç«¯å‘å®Œè¿™ä¸ªæŠ¥æ–‡æ®µåä¾¿è¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåº”ç­”åä¹Ÿè¿›å…¥ <code>ESTABLISHED</code> çŠ¶æ€ï¼Œæ­¤æ—¶è¿æ¥å»ºç«‹æˆåŠŸã€‚</li></ul><p><code>TCP</code> ä¸‰æ¬¡æ¡æ‰‹çš„å»ºç«‹è¿æ¥çš„è¿‡ç¨‹å°±æ˜¯ç›¸äº’ç¡®è®¤åˆå§‹åºå·çš„è¿‡ç¨‹ï¼Œå‘Šè¯‰å¯¹æ–¹ï¼Œä»€ä¹ˆæ ·åºå·çš„æŠ¥æ–‡æ®µèƒ½å¤Ÿè¢«æ­£ç¡®æ¥æ”¶ã€‚ ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„ä½œç”¨æ˜¯å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨ç«¯çš„åˆå§‹åºå·çš„ç¡®è®¤ã€‚å¦‚æœåªä½¿ç”¨ä¸¤æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±æ²¡æœ‰åŠæ³•çŸ¥é“è‡ªå·±çš„åºå·æ˜¯å¦ å·²è¢«ç¡®è®¤ã€‚åŒæ—¶è¿™æ ·ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢å¤±æ•ˆçš„è¯·æ±‚æŠ¥æ–‡æ®µè¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œè€Œå‡ºç°é”™è¯¯çš„æƒ…å†µã€‚</p><p><strong>â—å››æ¬¡æŒ¥æ‰‹</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713172.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310241713016.png" alt="img"></p><p>åŒæ–¹éƒ½å¤„äº <code>ESTABLISHED</code> çŠ¶æ€ï¼Œå‡å¦‚æ˜¯å®¢æˆ·ç«¯å…ˆå‘èµ·å…³é—­è¯·æ±‚ã€‚å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹</strong>ï¼š å®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ª <code>FIN </code>æŠ¥æ–‡ï¼ŒæŠ¥æ–‡ä¸­ä¼šæŒ‡å®šä¸€ä¸ªåºåˆ—å·ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <code>FIN_WAIT1</code> çŠ¶æ€ã€‚</li></ul><blockquote><p>å³å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼ˆ<code>FIN=1</code>ï¼Œåºå·<code>seq=u</code>ï¼‰, å¹¶åœæ­¢å†å‘é€æ•°æ®ï¼Œä¸»åŠ¨å…³é—­<code>TCP</code>è¿æ¥ï¼Œè¿›å…¥<code>FIN_WAIT1</code>ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯çš„ç¡®è®¤ã€‚</p></blockquote><ul><li><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡ç«¯æ”¶åˆ° <code>FIN </code>ä¹‹åï¼Œä¼šå‘é€ <code>ACK</code> æŠ¥æ–‡ï¼Œä¸”æŠŠå®¢æˆ·ç«¯çš„åºåˆ—å·å€¼ <code>+1</code> ä½œä¸º <code>ACK</code> æŠ¥æ–‡çš„åºåˆ—å·å€¼ï¼Œè¡¨æ˜å·²ç»æ”¶åˆ°å®¢æˆ·ç«¯çš„æŠ¥æ–‡äº†ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº <code>CLOSE_WAIT</code> çŠ¶æ€ã€‚å› ä¸º<code>server</code>ç«¯å¯èƒ½è¿˜æœ‰æ²¡æœ‰å‘é€å®Œæˆçš„æ•°æ®</li></ul><blockquote><p>å³æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåå³å‘å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ˆ<code>ACK=1</code>ï¼Œç¡®è®¤å·<code>ack=u+1</code>ï¼Œåºå·<code>seq=v</code>ï¼‰ï¼ŒæœåŠ¡ç«¯è¿›å…¥<code>CLOSE_WAIT</code>ï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ï¼Œæ­¤æ—¶çš„<code>TCP</code>å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¿æ¥é‡Šæ”¾ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ç¡®è®¤åï¼Œè¿›å…¥<code>FIN_WAIT2</code>ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯å‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µã€‚</p></blockquote><ul><li><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼š</strong>ç­‰åˆ°<code>server</code>ç«¯æ•°æ®éƒ½å‘é€å®Œæ¯•ä¹‹å,  è¿™æ—¶æœåŠ¡ç«¯ä¹Ÿæƒ³æ–­å¼€è¿æ¥ï¼Œå’Œå®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ä¸€æ ·ï¼Œå‘ç»™ <code>FIN</code> æŠ¥æ–‡ï¼Œä¸”æŒ‡å®šä¸€ä¸ªåºåˆ—å·ã€‚æ­¤æ—¶æœåŠ¡ç«¯å¤„äº <code>LAST_ACK</code>çš„çŠ¶æ€ã€‚</li></ul><blockquote><p>å³æœåŠ¡ç«¯æ²¡æœ‰è¦å‘å®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼ˆ<code>FIN=1</code>ï¼Œ<code>ACK=1</code>ï¼Œåºå·<code>seq=w</code>ï¼Œç¡®è®¤å·<code>ack=u+1</code>ï¼‰ï¼ŒæœåŠ¡ç«¯è¿›å…¥<code>LAST_ACK</code>ï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚</p></blockquote><ul><li><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼š</strong>å®¢æˆ·ç«¯æ”¶åˆ° <code>FIN</code> ä¹‹åï¼Œä¸€æ ·å‘é€ä¸€ä¸ª <code>ACK</code> æŠ¥æ–‡ä½œä¸ºåº”ç­”ï¼Œä¸”æŠŠæœåŠ¡ç«¯çš„åºåˆ—å·å€¼ <code>+1</code> ä½œä¸ºè‡ªå·± <code>ACK</code> æŠ¥æ–‡çš„åºåˆ—å·å€¼ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¤„äº <code>TIME_WAIT</code> çŠ¶æ€ã€‚éœ€è¦è¿‡ä¸€é˜µå­ä»¥ç¡®ä¿æœåŠ¡ç«¯æ”¶åˆ°è‡ªå·±çš„ <code>ACK</code> æŠ¥æ–‡ä¹‹åæ‰ä¼šè¿›å…¥ <code>CLOSED</code> çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ”¶åˆ° <code>ACK</code> æŠ¥æ–‡ä¹‹åï¼Œå°±å¤„äºå…³é—­è¿æ¥äº†ï¼Œå¤„äº <code>CLOSED</code> çŠ¶æ€ã€‚</li></ul><blockquote><p>å³å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåï¼Œå¯¹æ­¤å‘å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ˆ<code>ACK=1</code>ï¼Œ<code>seq=u+1</code>ï¼Œ<code>ack=w+1</code>ï¼‰ï¼Œå®¢æˆ·ç«¯è¿›å…¥<code>TIME_WAIT</code>ï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ­¤æ—¶<code>TCP</code>æœªé‡Šæ”¾æ‰ï¼Œéœ€è¦ç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´<code>2MSL</code>åï¼Œå®¢æˆ·ç«¯æ‰è¿›å…¥<code>CLOSED</code>çŠ¶æ€ã€‚</p></blockquote><p><strong>ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹å‘¢?</strong></p><p>å› ä¸ºå½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„<code>SYN</code>è¿æ¥è¯·æ±‚æŠ¥æ–‡åï¼Œå¯ä»¥ç›´æ¥å‘é€<code>SYN+ACK</code>æŠ¥æ–‡ã€‚å…¶ä¸­<code>ACK</code>æŠ¥æ–‡æ˜¯ç”¨æ¥åº”ç­”çš„ï¼Œ<code>SYN</code>æŠ¥æ–‡æ˜¯ç”¨æ¥åŒæ­¥çš„ã€‚ä½†æ˜¯å…³é—­è¿æ¥æ—¶ï¼Œå½“æœåŠ¡ç«¯æ”¶åˆ°<code>FIN</code>æŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½å¹¶ä¸ä¼šç«‹å³å…³é—­<code>SOCKET</code>ï¼Œæ‰€ä»¥åªèƒ½å…ˆå›å¤ä¸€ä¸ª<code>ACK</code>æŠ¥æ–‡ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œâ€ä½ å‘çš„<code>FIN</code>æŠ¥æ–‡æˆ‘æ”¶åˆ°äº†â€ã€‚<strong>åªæœ‰ç­‰åˆ°æˆ‘æœåŠ¡ç«¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½å‘é€</strong><code>**FIN**</code><strong>æŠ¥æ–‡</strong>ï¼Œå› æ­¤ä¸èƒ½ä¸€èµ·å‘é€ï¼Œæ•…éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚</p><p><strong>ç®€å•æ¥è¯´å°±æ˜¯ä»¥ä¸‹å››æ­¥ï¼š</strong></p><ul><li><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼š</strong> è‹¥å®¢æˆ·ç«¯è®¤ä¸ºæ•°æ®å‘é€å®Œæˆï¼Œåˆ™å®ƒéœ€è¦å‘æœåŠ¡ç«¯å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ã€‚</li><li><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡ç«¯æ”¶åˆ°è¿æ¥é‡Šæ”¾è¯·æ±‚åï¼Œä¼šå‘Šè¯‰åº”ç”¨å±‚è¦é‡Šæ”¾ <code>TCP</code> é“¾æ¥ã€‚ç„¶åä¼šå‘é€ <code>ACK</code> åŒ…ï¼Œå¹¶è¿›å…¥ <code>CLOSE_WAIT</code> çŠ¶æ€ï¼Œæ­¤æ—¶è¡¨æ˜å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è¿æ¥å·²ç»é‡Šæ”¾ï¼Œä¸å†æ¥æ”¶å®¢æˆ·ç«¯å‘çš„æ•°æ®äº†ã€‚ä½†æ˜¯å› ä¸º <code>TCP</code> è¿æ¥æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ä»æ—§å¯ä»¥å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡ç«¯å¦‚æœæ­¤æ—¶è¿˜æœ‰æ²¡å‘å®Œçš„æ•°æ®ä¼šç»§ç»­å‘é€ï¼Œå®Œæ¯•åä¼šå‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼Œç„¶åæœåŠ¡ç«¯ä¾¿è¿›å…¥ <code>LAST-ACK</code> çŠ¶æ€ã€‚</li><li><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼š</strong> å®¢æˆ·ç«¯æ”¶åˆ°é‡Šæ”¾è¯·æ±‚åï¼Œå‘æœåŠ¡ç«¯å‘é€ç¡®è®¤åº”ç­”ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥ <code>TIME-WAIT</code> çŠ¶æ€ã€‚è¯¥çŠ¶æ€ä¼šæŒç»­ <code>2MSL</code>ï¼ˆæœ€å¤§æ®µç”Ÿå­˜æœŸï¼ŒæŒ‡æŠ¥æ–‡æ®µåœ¨ç½‘ç»œä¸­ç”Ÿå­˜çš„æ—¶é—´ï¼Œè¶…æ—¶ä¼šè¢«æŠ›å¼ƒï¼‰ æ—¶é—´ï¼Œè‹¥è¯¥æ—¶é—´æ®µå†…æ²¡æœ‰æœåŠ¡ç«¯çš„é‡å‘è¯·æ±‚çš„è¯ï¼Œå°±è¿›å…¥ <code>CLOSED</code> çŠ¶æ€ã€‚å½“æœåŠ¡ç«¯æ”¶åˆ°ç¡®è®¤åº”ç­”åï¼Œä¹Ÿä¾¿è¿›å…¥ <code>CLOSED</code> çŠ¶æ€ã€‚</li></ul><p><code>TCP</code> ä½¿ç”¨å››æ¬¡æŒ¥æ‰‹çš„åŸå› æ˜¯å› ä¸º <code>TCP</code> çš„è¿æ¥æ˜¯<strong>å…¨åŒå·¥</strong>çš„ï¼Œæ‰€ä»¥éœ€è¦åŒæ–¹åˆ†åˆ«é‡Šæ”¾åˆ°å¯¹æ–¹çš„è¿æ¥ï¼Œå•ç‹¬ä¸€æ–¹çš„è¿æ¥é‡Šæ”¾ï¼Œåªä»£è¡¨ä¸èƒ½å†å‘å¯¹æ–¹å‘é€æ•°æ®ï¼Œè¿æ¥å¤„äºçš„æ˜¯åŠé‡Šæ”¾çš„çŠ¶æ€ã€‚</p><p>æœ€åä¸€æ¬¡æŒ¥æ‰‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´å†å…³é—­çš„åŸå› ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢å‘é€ç»™æœåŠ¡å™¨çš„ç¡®è®¤æŠ¥æ–‡æ®µä¸¢å¤±æˆ–è€…å‡ºé”™ï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨ç«¯ä¸èƒ½æ­£å¸¸å…³é—­ã€‚</p><h3 id="8-TCP-ç²˜åŒ…æ˜¯æ€ä¹ˆå›äº‹ï¼Œå¦‚ä½•å¤„ç†-ä¸ºä»€ä¹ˆ-UDP-ä¸ä¼š"><a href="#8-TCP-ç²˜åŒ…æ˜¯æ€ä¹ˆå›äº‹ï¼Œå¦‚ä½•å¤„ç†-ä¸ºä»€ä¹ˆ-UDP-ä¸ä¼š" class="headerlink" title="8. TCP ç²˜åŒ…æ˜¯æ€ä¹ˆå›äº‹ï¼Œå¦‚ä½•å¤„ç†? ä¸ºä»€ä¹ˆ UDP ä¸ä¼š?"></a>8. TCP ç²˜åŒ…æ˜¯æ€ä¹ˆå›äº‹ï¼Œå¦‚ä½•å¤„ç†? ä¸ºä»€ä¹ˆ UDP ä¸ä¼š?</h3><p>é»˜è®¤æƒ…å†µä¸‹, <code>TCP</code> è¿æ¥ä¼šå¯ç”¨<strong>å»¶è¿Ÿä¼ é€</strong>ç®—æ³• (<code>Nagle</code> ç®—æ³•), åœ¨æ•°æ®å‘é€ä¹‹å‰ç¼“å­˜ä»–ä»¬. </p><p>å¦‚æœçŸ­æ—¶é—´æœ‰å¤šä¸ªæ•°æ®å‘é€, ä¼šç¼“å†²åˆ°â¼€èµ·ä½œâ¼€æ¬¡å‘é€ (ç¼“å†²å¤§å°è§ <code>socket.bufferSize</code>), è¿™æ ·å¯ä»¥<strong>å‡å°‘</strong> <code>**IO**</code> <strong>æ¶ˆè€—æé«˜æ€§èƒ½.</strong></p><p>å¦‚æœæ˜¯ä¼ è¾“â½‚ä»¶çš„è¯, é‚£ä¹ˆæ ¹æœ¬ä¸ç”¨å¤„ç†ç²˜åŒ…çš„é—®é¢˜, æ¥â¼€ä¸ªåŒ…æ‹¼â¼€ä¸ªåŒ…å°±å¥½äº†ã€‚ä½†æ˜¯å¦‚æœæ˜¯å¤šæ¡æ¶ˆæ¯, æˆ–è€…æ˜¯åˆ«çš„â½¤é€”çš„æ•°æ®é‚£ä¹ˆå°±éœ€è¦å¤„ç†ç²˜åŒ….</p><p><strong>ä¸‹é¢çœ‹â¼€ä¸ªä¾‹â¼¦</strong></p><p>è¿ç»­è°ƒâ½¤ä¸¤æ¬¡ send åˆ†åˆ«å‘é€ä¸¤æ®µæ•°æ® data1 å’Œ data2, åœ¨æ¥æ”¶ç«¯æœ‰ä»¥ä¸‹â¼ç§å¸¸â»…çš„æƒ…å†µ:</p><ul><li>A. å…ˆæ¥æ”¶åˆ° data1, ç„¶åæ¥æ”¶åˆ° data2 . </li><li>B. å…ˆæ¥æ”¶åˆ° data1 çš„éƒ¨åˆ†æ•°æ®, ç„¶åæ¥æ”¶åˆ° data1 ä½™ä¸‹çš„éƒ¨åˆ†ä»¥åŠ data2 çš„å…¨éƒ¨. </li><li>C. å…ˆæ¥æ”¶åˆ°äº† data1 çš„å…¨éƒ¨æ•°æ®å’Œ data2 çš„éƒ¨åˆ†æ•°æ®, ç„¶åæ¥æ”¶åˆ°äº† data2 çš„ä½™ä¸‹çš„æ•°æ®. </li><li>D. â¼€æ¬¡æ€§æ¥æ”¶åˆ°äº† data1 å’Œ data2 çš„å…¨éƒ¨æ•°æ®.</li></ul><blockquote><p>å…¶ä¸­çš„ BCD å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ç²˜åŒ…çš„æƒ…å†µ.</p></blockquote><p>â½½å¯¹äºå¤„ç†ç²˜åŒ…çš„é—®é¢˜, å¸¸â»…çš„è§£å†³â½…æ¡ˆæœ‰ : </p><ul><li><strong>å¤šæ¬¡å‘é€ä¹‹å‰é—´éš”â¼€ä¸ªç­‰å¾…æ—¶é—´</strong>ï¼šåªéœ€è¦ç­‰ä¸Šâ¼€æ®µæ—¶é—´å†è¿›â¾ä¸‹â¼€æ¬¡ <code>send</code> å°±å¥½, é€‚â½¤äºäº¤äº’é¢‘ç‡ç‰¹åˆ«ä½çš„åœºæ™¯. ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾, å¯¹äºâ½è¾ƒé¢‘ç¹çš„åœºæ™¯â½½â¾”ä¼ è¾“æ•ˆç‡å®åœ¨å¤ªä½ï¼Œä¸è¿‡â¼ä¹ä¸â½¤åšä»€ä¹ˆå¤„ç†.</li><li><strong>å…³é—­ Nagle ç®—æ³•</strong>ï¼šå…³é—­ <code>Nagle</code> ç®—æ³•, åœ¨ <code>Node.js</code> ä¸­ä½ å¯ä»¥é€šè¿‡ <code>socket.setNoDelay()</code> â½…æ³•æ¥å…³é—­ <code>Nagle</code> ç®—æ³•, è®©æ¯â¼€æ¬¡ <code>send</code> éƒ½ä¸ç¼“å†²ç›´æ¥å‘é€ã€‚è¯¥æ–¹æ³•æ¯”è¾ƒé€‚ç”¨äºæ¯æ¬¡å‘é€çš„æ•°æ®éƒ½æ¯”è¾ƒå¤§ (ä½†ä¸æ˜¯â½‚ä»¶é‚£ä¹ˆå¤§), å¹¶ä¸”é¢‘ç‡ä¸æ˜¯ç‰¹åˆ«é«˜çš„åœºæ™¯<strong>ã€‚</strong>å¦‚æœæ˜¯æ¯æ¬¡å‘é€çš„æ•°æ®é‡æ¯”è¾ƒå°, å¹¶ä¸”é¢‘ç‡ç‰¹åˆ«é«˜çš„, å…³é—­ <code>Nagle</code> çº¯å±è‡ªåºŸæ­¦åŠŸã€‚</li><li><strong>è¿›è¡Œå°åŒ…&#x2F;æ‹†åŒ…ï¼š</strong> å°åŒ…&#x2F;æ‹†åŒ…æ˜¯â½¬å‰ä¸šå†…å¸¸â»…çš„è§£å†³â½…æ¡ˆäº†ã€‚å³ç»™æ¯ä¸ªæ•°æ®åŒ…åœ¨å‘é€ä¹‹å‰, äºå…¶å‰&#x2F;åæ”¾â¼€äº›æœ‰ç‰¹å¾çš„æ•°æ®, ç„¶åæ”¶åˆ°æ•°æ®çš„æ—¶å€™æ ¹æ®ç‰¹å¾æ•°æ®åˆ†å‰²å‡ºæ¥å„ä¸ªæ•°æ®åŒ…ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆudpä¸ä¼šç²˜åŒ…ï¼Ÿ</strong></p><ul><li><code>TCP</code>åè®®æ˜¯é¢å‘æµçš„åè®®ï¼Œ<code>UDP</code>æ˜¯é¢å‘æ¶ˆæ¯çš„åè®®ã€‚<code>UDP</code>æ®µéƒ½æ˜¯â¼€æ¡æ¶ˆæ¯ï¼Œåº”â½¤ç¨‹åºå¿…é¡»<strong>ä»¥æ¶ˆæ¯ä¸ºå•ä½</strong>æå–æ•°æ®ï¼Œä¸èƒ½â¼€æ¬¡æå–ä»»æ„å­—èŠ‚çš„æ•°æ®</li><li><code>UDP</code>å…·æœ‰ä¿æŠ¤æ¶ˆæ¯è¾¹ç•Œï¼Œåœ¨æ¯ä¸ª<code>UDP</code>åŒ…ä¸­å°±æœ‰äº†æ¶ˆæ¯å¤´ï¼ˆæ¶ˆæ¯æ¥æºåœ°å€ï¼Œç«¯â¼ç­‰ä¿¡æ¯ï¼‰ï¼Œè¿™æ ·å¯¹äºæ¥æ”¶ç«¯æ¥è¯´å°±å®¹æ˜“è¿›â¾åŒºåˆ†å¤„ç†äº†ã€‚ä¼ è¾“åè®®æŠŠæ•°æ®å½“ä½œâ¼€æ¡ç‹¬â½´çš„æ¶ˆæ¯åœ¨â½¹ä¸Šä¼ è¾“ï¼Œæ¥æ”¶ç«¯åªèƒ½æ¥æ”¶ç‹¬â½´çš„æ¶ˆæ¯ã€‚æ¥æ”¶ç«¯â¼€æ¬¡åªèƒ½æ¥æ”¶å‘é€ç«¯å‘å‡ºçš„â¼€ä¸ª<strong>æ•°æ®åŒ…</strong> , å¦‚æœâ¼€æ¬¡æ¥å—æ•°æ®çš„å¤§å°å°äºå‘é€ç«¯â¼€æ¬¡å‘é€çš„æ•°æ®â¼¤â¼©ï¼Œå°±ä¼šä¸¢å¤±â¼€éƒ¨åˆ†æ•°æ®ï¼Œå³ä½¿ä¸¢å¤±ï¼Œæ¥å—ç«¯ä¹Ÿä¸ä¼šåˆ†ä¸¤æ¬¡å»æ¥æ”¶ã€‚</li></ul><blockquote><p>ç¥å¤§å®¶ç¨‹åºå‘˜èŠ‚å¿«ä¹ğŸ‰ğŸ¾(10.24)</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œåè®®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒå‰æ ‘å±‚åºéå†, ä½ çœŸçš„æ‡‚äº†å—ï¼Ÿ</title>
    <link href="/2023/10/21/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/"/>
    <url>/2023/10/21/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/</url>
    
    <content type="html"><![CDATA[<p>â­å€Ÿé‰´äºä»£ç éšæƒ³å½•</p><p>äºŒå‰æ ‘çš„å±‚åºéå†ï¼Œ<strong>å°±æ˜¯å›¾è®ºä¸­çš„å¹¿åº¦ä¼˜å…ˆæœç´¢åœ¨äºŒå‰æ ‘ä¸­çš„åº”ç”¨</strong>ï¼Œéœ€è¦å€ŸåŠ©é˜Ÿåˆ—æ¥å®ç°</p><blockquote><p> æ­¤æ—¶åˆå‘ç°é˜Ÿåˆ—çš„ä¸€ä¸ªåº”ç”¨äº†ã€‚</p></blockquote><p>æ¥ â€” ä¸€å£æ°”æ‰“åä¸ª!  (å…¶å®æ˜¯ä¹ä¸ª)</p><hr><h3 id="1-äºŒå‰æ ‘çš„å±‚åºéå†"><a href="#1-äºŒå‰æ ‘çš„å±‚åºéå†" class="headerlink" title="1. äºŒå‰æ ‘çš„å±‚åºéå†"></a>1. äºŒå‰æ ‘çš„å±‚åºéå†</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739444.png" alt="img"></p><p>å±‚åºéå†ä¸€ä¸ªäºŒå‰æ ‘ã€‚å°±æ˜¯ä»å·¦åˆ°å³ä¸€å±‚ä¸€å±‚çš„å»éå†äºŒå‰æ ‘ã€‚è¿™ç§éå†çš„æ–¹å¼å’Œæˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„éƒ½ä¸å¤ªä¸€æ ·ã€‚</p><p>éœ€è¦å€Ÿç”¨ä¸€ä¸ªè¾…åŠ©æ•°æ®ç»“æ„å³é˜Ÿåˆ—æ¥å®ç°ï¼Œ<strong>é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼Œç¬¦åˆä¸€å±‚ä¸€å±‚éå†çš„é€»è¾‘ï¼Œè€Œç”¨æ ˆå…ˆè¿›åå‡ºé€‚åˆæ¨¡æ‹Ÿæ·±åº¦ä¼˜å…ˆéå†ä¹Ÿå°±æ˜¯é€’å½’çš„é€»è¾‘ã€‚</strong></p><p><strong>è€Œè¿™ç§å±‚åºéå†æ–¹å¼å°±æ˜¯å›¾è®ºä¸­çš„å¹¿åº¦ä¼˜å…ˆéå†ï¼Œåªä¸è¿‡æˆ‘ä»¬åº”ç”¨åœ¨äºŒå‰æ ‘ä¸Šã€‚</strong></p><p>ä½¿ç”¨é˜Ÿåˆ—å®ç°äºŒå‰æ ‘å¹¿åº¦ä¼˜å…ˆéå†ï¼ŒåŠ¨ç”»å¦‚ä¸‹ï¼š</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739987.gif" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> levelOrder = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> res = [], queue = [];<br>    <span class="hljs-keyword">if</span>(root === <span class="hljs-literal">null</span>)  <span class="hljs-keyword">return</span> res;<br>    queue.<span class="hljs-title function_">push</span>(root); <span class="hljs-comment">// rootåªæ˜¯æ ¹èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> length = queue.<span class="hljs-property">length</span>; <span class="hljs-comment">// è®°å½•å½“å‰å±‚çº§æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹</span><br>        <span class="hljs-keyword">let</span> curLevel = []; <span class="hljs-comment">// å­˜æ”¾æ¯ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>(); <span class="hljs-comment">// æ¯æ¬¡æ‹¿åˆ°é˜Ÿå¤´å…ƒç´ </span><br>            curLevel.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">val</span>); <span class="hljs-comment">// å­˜æ”¾å½“å‰å±‚ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹</span><br>            node.<span class="hljs-property">left</span> &amp;&amp; queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            node.<span class="hljs-property">right</span> &amp;&amp; queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>        res.<span class="hljs-title function_">push</span>(curLevel); <span class="hljs-comment">//æŠŠæ¯ä¸€å±‚çš„ç»“æœ(æ‰€æœ‰èŠ‚ç‚¹)æ”¾åˆ°ç»“æœæ•°ç»„</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="2-äºŒå‰æ ‘çš„å±‚åºéå†-åç€æ¥"><a href="#2-äºŒå‰æ ‘çš„å±‚åºéå†-åç€æ¥" class="headerlink" title="2. äºŒå‰æ ‘çš„å±‚åºéå†(åç€æ¥)"></a>2. äºŒå‰æ ‘çš„å±‚åºéå†(åç€æ¥)</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739428.png" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> levelOrderBottom = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> res = [];<br>    <span class="hljs-keyword">let</span> queue = [];<br>    <span class="hljs-keyword">if</span>(root === <span class="hljs-literal">null</span>)<span class="hljs-keyword">return</span> res;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        <span class="hljs-keyword">let</span> curLevel = [];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            curLevel.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">val</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>        res.<span class="hljs-title function_">unshift</span>(curLevel)<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æœ€åæ”¹ä¸€ä¸‹ push çš„é¡ºåºå°±è¡Œ</p><h3 id="3-äºŒå‰æ ‘çš„å³è§†å›¾"><a href="#3-äºŒå‰æ ‘çš„å³è§†å›¾" class="headerlink" title="3. äºŒå‰æ ‘çš„å³è§†å›¾"></a>3. äºŒå‰æ ‘çš„å³è§†å›¾</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739435.png" alt="img"></p><p>ä¾ç„¶æ˜¯æŒ‰ç…§é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåº, ä¸è¦æå¤æ‚äº†</p><p>è¿™é‡Œå°±æ˜¯å½“éå†åˆ°æ¯ä¸€å±‚æœ€å³è¾¹çš„èŠ‚ç‚¹æ—¶å°±åŠ å…¥åˆ° curLevel æ•°ç»„ä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> rightSideView = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> res = [], queue = [];<br>    <span class="hljs-keyword">if</span>(!root) <span class="hljs-keyword">return</span> res;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        <span class="hljs-keyword">let</span> curLevel = [];<br>        <span class="hljs-keyword">while</span>(len--) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            <span class="hljs-keyword">if</span>(!len) curLevel.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">val</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>        res.<span class="hljs-title function_">push</span>(curLevel);<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="4-äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼"><a href="#4-äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼" class="headerlink" title="4. äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼"></a>4. äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739460.png" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for a binary tree node.</span><br><span class="hljs-comment"> * function TreeNode(val, left, right) &#123;</span><br><span class="hljs-comment"> *     this.val = (val===undefined ? 0 : val)</span><br><span class="hljs-comment"> *     this.left = (left===undefined ? null : left)</span><br><span class="hljs-comment"> *     this.right = (right===undefined ? null : right)</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">var</span> averageOfLevels = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> res = [], queue = [];<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            sum += node.<span class="hljs-property">val</span>;<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>        res.<span class="hljs-title function_">push</span>(sum / len)<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="5-N-å‰æ ‘çš„å±‚åºéå†"><a href="#5-N-å‰æ ‘çš„å±‚åºéå†" class="headerlink" title="5. N å‰æ ‘çš„å±‚åºéå†"></a>5. N å‰æ ‘çš„å±‚åºéå†</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739433.png" alt="img"></p><blockquote><p> è·Ÿæ¨¡æ¿æ²¡å•¥å·®åˆ«</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * // Definition for a Node.</span><br><span class="hljs-comment"> * function Node(val,children) &#123;</span><br><span class="hljs-comment"> *    this.val = val;</span><br><span class="hljs-comment"> *    this.children = children;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Node|null</span>&#125; <span class="hljs-variable">root</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">number[][]</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> levelOrder = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> res = [], queue = [];<br>    <span class="hljs-keyword">if</span>(root === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> res;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        <span class="hljs-keyword">let</span> curLevel = [];<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            curLevel.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">val</span>);<br>          <span class="hljs-comment">// pushæ‰€æœ‰å­èŠ‚ç‚¹å°±è¡Œ</span><br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">children</span>) queue.<span class="hljs-title function_">push</span>(...node.<span class="hljs-property">children</span>)<br>        &#125;<br>        res.<span class="hljs-title function_">push</span>(curLevel);<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="6-åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼"><a href="#6-åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼" class="headerlink" title="6. åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼"></a>6. åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739217.png" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript">ar largestValues = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> res = [], queue = [];<br>    <span class="hljs-keyword">if</span>(!root) <span class="hljs-keyword">return</span> res;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        <span class="hljs-keyword">let</span> max = -<span class="hljs-title class_">Infinity</span>;  <span class="hljs-comment">// æ³¨æ„æœ‰å¯èƒ½ä¸ºè´Ÿå€¼, æ‰€ä»¥ä¸èƒ½å–0</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(max, node.<span class="hljs-property">val</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>        res.<span class="hljs-title function_">push</span>(max);<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="7-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ"><a href="#7-å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ" class="headerlink" title="7. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ"></a>7. å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ</h3><p>è¿™é¢˜å°† â€œå®Œç¾äºŒå‰æ ‘â€ æ”¹ä¸º â€œäºŒå‰æ ‘â€ ä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«, ä¸€æ¨¡ä¸€æ ·çš„ä»£ç  ~~</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739299.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739194.png" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * // Definition for a Node.</span><br><span class="hljs-comment"> * function Node(val, left, right, next) &#123;</span><br><span class="hljs-comment"> *    this.val = val === undefined ? null : val;</span><br><span class="hljs-comment"> *    this.left = left === undefined ? null : left;</span><br><span class="hljs-comment"> *    this.right = right === undefined ? null : right;</span><br><span class="hljs-comment"> *    this.next = next === undefined ? null : next;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">Node</span>&#125; <span class="hljs-variable">root</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">Node</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> connect = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> queue = [];<br>    <span class="hljs-keyword">if</span>(root === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> root;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>          <span class="hljs-comment">// å› ä¸ºå‰ä¸€ä¸ªå·²ç»shiftäº†, åä¸€ä¸ªå°±æ˜¯é˜Ÿé¦–å…ƒç´ , ä¸”è¦ä¿è¯ä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ </span><br>            <span class="hljs-comment">// å¦‚æœæ˜¯æœ€åä¸€ä¸ªå…ƒç´ , æ­£å¥½nextå°±ç­‰äºé»˜è®¤çš„null</span><br>            <span class="hljs-keyword">if</span>(i &lt; len - <span class="hljs-number">1</span>) node.<span class="hljs-property">next</span> = queue[<span class="hljs-number">0</span>]; <br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>)<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> root;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="8-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#8-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="8. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>8. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</h3><p>ç”¨å±‚åºéå†ä¹ŸæŒºç®€å•, æœ€å¤§æ·±åº¦å°±æ˜¯å±‚æ•°</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739209.png" alt="img"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> maxDepth = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> queue = [], cnt = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(root === <span class="hljs-literal">null</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        cnt++;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cnt;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="9-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"><a href="#9-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦" class="headerlink" title="9. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"></a>9. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310211739223.png" alt="img"></p><p>å¦‚æœæŸä¸€å±‚çš„èŠ‚ç‚¹æ²¡æœ‰å·¦å³å­èŠ‚ç‚¹, é‚£ä¹ˆæœ€å°æ·±åº¦å°±æ˜¯è¿™ä¸€å±‚çš„å±‚æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> minDepth = <span class="hljs-keyword">function</span>(<span class="hljs-params">root</span>) &#123;<br>    <span class="hljs-keyword">let</span> queue = [], cnt = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(!root) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    queue.<span class="hljs-title function_">push</span>(root);<br>    <span class="hljs-keyword">while</span>(queue.<span class="hljs-property">length</span>) &#123;<br>        <span class="hljs-keyword">let</span> len = queue.<span class="hljs-property">length</span>;<br>        cnt++;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            <span class="hljs-keyword">let</span> node = queue.<span class="hljs-title function_">shift</span>();<br>            <span class="hljs-comment">// å¦‚æœæŸä¸€å±‚çš„èŠ‚ç‚¹æ²¡æœ‰å·¦å³å­èŠ‚ç‚¹, é‚£ä¹ˆæœ€å°æ·±åº¦å°±æ˜¯è¿™ä¸€å±‚çš„å±‚æ•°</span><br>            <span class="hljs-keyword">if</span>(!node.<span class="hljs-property">left</span> &amp;&amp; !node.<span class="hljs-property">right</span>)<span class="hljs-keyword">return</span> cnt;<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">left</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">left</span>);<br>            <span class="hljs-keyword">if</span>(node.<span class="hljs-property">right</span>) queue.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">right</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cnt;<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>over</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äºŒå‰æ ‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»‹ç»ä¸‹ HTTP çš„æ¼”åŒ–è¿‡ç¨‹å’Œä¼˜åŒ–ï¼Ÿ</title>
    <link href="/2023/10/20/HTTP%E6%BC%94%E5%8C%96/"/>
    <url>/2023/10/20/HTTP%E6%BC%94%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h3 id="1-HTTP-x2F-1-0-å­˜åœ¨çš„é—®é¢˜"><a href="#1-HTTP-x2F-1-0-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="1. HTTP&#x2F;1.0 å­˜åœ¨çš„é—®é¢˜"></a>1. HTTP&#x2F;1.0 å­˜åœ¨çš„é—®é¢˜</h3><ul><li>é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼šå› ä¸ºåªæœ‰â¼€ä¸ªè¿æ¥ï¼Œæ‰€ä»¥å¦‚æœæœ‰â¼€ä¸ªè¯·æ±‚è¢«é˜»å¡ï¼Œåç»­è¯·æ±‚ä¹Ÿä¼šè¢«é˜»å¡ã€‚</li><li>æ— æ³•å¤šè·¯å¤ç”¨ï¼šåªèƒ½æŒ‰é¡ºåºä¼ è¾“â¼€ä¸ªè¯·æ±‚å’Œå“åº”ï¼Œæ— æ³•åŒæ—¶ä¼ è¾“å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚</li><li>æ¯æ¬¡è¯·æ±‚éœ€è¦æ–°å»ºè¿æ¥ï¼šæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦æ–°å»ºè¿æ¥ï¼Œè¿æ¥çš„å»ºâ½´å’Œå…³é—­è¿‡ç¨‹ä¼šæ¶ˆè€—æ—¶é—´ã€‚</li></ul><h3 id="2-HTTP-x2F-1-0-åˆ°-HTTP-x2F-1-1-çš„ä¼˜åŒ–ï¼š"><a href="#2-HTTP-x2F-1-0-åˆ°-HTTP-x2F-1-1-çš„ä¼˜åŒ–ï¼š" class="headerlink" title="2. HTTP&#x2F;1.0 åˆ° HTTP&#x2F;1.1 çš„ä¼˜åŒ–ï¼š"></a>2. HTTP&#x2F;1.0 åˆ° HTTP&#x2F;1.1 çš„ä¼˜åŒ–ï¼š</h3><ul><li><strong>æŒä¹…è¿æ¥</strong>ï¼šåœ¨ HTTP&#x2F;1.0 ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºâ½´â¼€ä¸ªæ–°çš„TCPè¿æ¥ï¼Œâ½½åœ¨ HTTP&#x2F;1.1 ä¸­ï¼Œå¼•â¼Šäº†æŒä¹…è¿æ¥ï¼ˆä¹Ÿç§°ä¸ºå¤â½¤è¿æ¥ï¼‰ï¼Œè¿™æ ·å¯ä»¥åœ¨â¼€ä¸ª<code>TCP</code>è¿æ¥ä¸Šå‘é€å¤šä¸ª<code>HTTP</code>è¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†<code>TCP</code>è¿æ¥çš„å»ºç«‹å’Œå…³é—­æ‰€éœ€çš„æ—¶é—´å’Œèµ„æºæ¶ˆè€—ã€‚ </li><li>**ç®¡çº¿åŒ– [1]**ï¼šåœ¨ HTTP&#x2F;1.1 ä¸­ï¼Œâ½€æŒè¯·æ±‚ç®¡çº¿åŒ–ï¼Œå³å®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œåœ¨æœåŠ¡ç«¯å¤„ç†å®Œç¬¬â¼€ä¸ªè¯·æ±‚ä¹‹å‰ä¸å¿…ç­‰å¾…å…¶å®ƒè¯·æ±‚çš„è¿”å›ã€‚è¿™ç§â½…å¼è™½ç„¶æâ¾¼äº†æ€§èƒ½ï¼Œä½†ç”±äºå„ä¸ªè¯·æ±‚ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå½“å…¶ä¸­â¼€ä¸ªè¯·æ±‚å‡ºé”™æ—¶ï¼Œä¼šå¯¼è‡´åç»­è¯·æ±‚éƒ½å¤±è´¥.</li><li><strong>ç¼“å­˜æ–¹é¢</strong>ï¼Œåœ¨ http1.0 ä¸­ä¸»è¦ä½¿ç”¨ header é‡Œçš„ If-Modified-Sinceã€Expires æ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼Œhttp1.1 åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼Œä¾‹å¦‚ Etagã€If-Unmodified-Sinceã€If-Matchã€If-None-Match ç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li><li><strong>æ”¯æŒ Host å­—æ®µ:</strong>  http1.1 ä¸­æ–°å¢äº† host å­—æ®µï¼Œé€šè¿‡åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  Host å­—æ®µæ¥åŒºåˆ†ä¸åŒçš„ä¸»æœºã€‚ç”¨æ¥æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåã€‚http1.0 ä¸­è®¤ä¸ºæ¯å°æœåŠ¡å™¨éƒ½ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ï¼Œå› æ­¤ï¼Œè¯·æ±‚æ¶ˆæ¯ä¸­çš„ URL å¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚ä½†éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•ï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œå¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ªIPåœ°å€ã€‚å› æ­¤æœ‰äº† host å­—æ®µï¼Œè¿™æ ·å°±å¯ä»¥å°†è¯·æ±‚å‘å¾€åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„ä¸åŒç½‘ç«™ã€‚</li><li><strong>æ”¯æŒæ–­ç‚¹ç»­ä¼ </strong> :  HTTP1.0 ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚http1.1 åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº† range å¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯ 206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li><li><strong>æ–°å¢ HTTP æ–¹æ³•</strong> :  http1.1 ç›¸å¯¹äº http1.0 è¿˜æ–°å¢äº†å¾ˆå¤šè¯·æ±‚æ–¹æ³•ï¼Œå¦‚ PUTã€HEADã€OPTIONS ç­‰ã€‚</li></ul><p><strong>ä»€ä¹ˆæ˜¯ç®¡çº¿åŒ–(ç®¡é“ç½‘ç»œè¿è¾“)?</strong></p><blockquote><p>ç®¡é“ï¼ˆpipelineï¼‰ç½‘ç»œä¼ è¾“æ˜¯æŒ‡ï¼šå¯ä»¥åœ¨åŒä¸€ä¸ª <code>TCP</code> è¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œåªè¦ç¬¬ä¸€ä¸ªè¯·æ±‚å‘å‡ºå»äº†ï¼Œä¸å¿…ç­‰å…¶å›æ¥ï¼Œå°±å¯ä»¥å‘ç¬¬äºŒä¸ªè¯·æ±‚å‡ºå»ï¼Œå¯ä»¥å‡å°‘æ•´ä½“çš„å“åº”æ—¶é—´ã€‚ä½†æ˜¯æœåŠ¡å™¨è¿˜æ˜¯æŒ‰ç…§é¡ºåºå›åº”è¯·æ±‚ã€‚å¦‚æœå‰é¢çš„å›åº”ç‰¹åˆ«æ…¢ï¼Œåé¢å°±ä¼šæœ‰è®¸å¤šè¯·æ±‚æ’é˜Ÿç­‰ç€ã€‚è¿™ç§°ä¸ºé˜Ÿå¤´å µå¡ã€‚</p></blockquote><h3 id="3-HTTP-x2F-1-1-åˆ°-HTTP-x2F-2-çš„ä¼˜åŒ–ï¼š"><a href="#3-HTTP-x2F-1-1-åˆ°-HTTP-x2F-2-çš„ä¼˜åŒ–ï¼š" class="headerlink" title="3. HTTP&#x2F;1.1 åˆ° HTTP&#x2F;2 çš„ä¼˜åŒ–ï¼š"></a>3. HTTP&#x2F;1.1 åˆ° HTTP&#x2F;2 çš„ä¼˜åŒ–ï¼š</h3><ul><li><strong>äºŒè¿›åˆ¶åè®®</strong>ï¼šHTTP&#x2F;2 æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ã€‚åœ¨ HTTP&#x2F;1.1 ç‰ˆä¸­ï¼ŒæŠ¥æ–‡çš„å¤´ä¿¡æ¯å¿…é¡»æ˜¯æ–‡æœ¬ï¼ˆASCII ç¼–ç ï¼‰ï¼Œæ•°æ®ä½“å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚HTTP&#x2F;2 åˆ™æ˜¯ä¸€ä¸ªå½»åº•çš„äºŒè¿›åˆ¶åè®®ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸ºâ€å¸§â€ï¼Œå¯ä»¥åˆ†ä¸ºå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚ å¸§çš„æ¦‚å¿µæ˜¯å®ƒå®ç°å¤šè·¯å¤ç”¨çš„åŸºç¡€ã€‚</li><li><strong>æ•°æ®æµï¼š</strong> HTTP&#x2F;2 ä½¿ç”¨äº†æ•°æ®æµçš„æ¦‚å¿µï¼Œå› ä¸º HTTP&#x2F;2 çš„æ•°æ®åŒ…æ˜¯ä¸æŒ‰é¡ºåºå‘é€çš„ï¼ŒåŒä¸€ä¸ªè¿æ¥é‡Œé¢è¿ç»­çš„æ•°æ®åŒ…ï¼Œå¯èƒ½å±äºä¸åŒçš„è¯·æ±‚ã€‚å› æ­¤ï¼Œå¿…é¡»è¦å¯¹æ•°æ®åŒ…åšæ ‡è®°ï¼ŒæŒ‡å‡ºå®ƒå±äºå“ªä¸ªè¯·æ±‚ã€‚HTTP&#x2F;2 å°†æ¯ä¸ªè¯·æ±‚æˆ–å›åº”çš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œç§°ä¸ºä¸€ä¸ªæ•°æ®æµã€‚æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–å·ã€‚æ•°æ®åŒ…å‘é€æ—¶ï¼Œéƒ½å¿…é¡»æ ‡è®°æ•°æ®æµ ID ï¼Œç”¨æ¥åŒºåˆ†å®ƒå±äºå“ªä¸ªæ•°æ®æµã€‚</li><li><strong>å¤šè·¯å¤ç”¨</strong>ï¼šHTTP&#x2F;1.x ä¸­â¼€ä¸ª TCP è¿æ¥åªèƒ½åŒæ—¶å¤„ç†â¼€ä¸ªè¯·æ±‚ï¼Œè€Œ HTTP&#x2F;2 ä¸­â½€æŒå¤šè·¯å¤ç”¨ï¼Œå³åŒâ¼€ä¸ªè¿æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›åº”ï¼Œè€Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å‘é€,  è¿™æ ·å°±é¿å…äº†â€é˜Ÿå¤´å µå¡â€[1] çš„é—®é¢˜ã€‚</li><li><strong>å¤´ä¿¡æ¯å‹ç¼©ï¼š</strong> HTTP&#x2F;2 å®ç°äº†å¤´ä¿¡æ¯å‹ç¼©ï¼Œç”±äº HTTP 1.1 åè®®ä¸å¸¦çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œè¯·æ±‚çš„å¾ˆå¤šå­—æ®µéƒ½æ˜¯é‡å¤çš„ï¼Œæ¯”å¦‚ Cookie å’Œ User Agent ï¼Œä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„å¸¦ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šå¸¦å®½ï¼Œä¹Ÿå½±å“é€Ÿåº¦ã€‚HTTP&#x2F;2 å¯¹è¿™ä¸€ç‚¹åšäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†å¤´ä¿¡æ¯å‹ç¼©æœºåˆ¶ã€‚ä¸€æ–¹é¢ï¼Œå¤´ä¿¡æ¯ä½¿ç”¨ gzip æˆ– compress å‹ç¼©åå†å‘é€ï¼›å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨(é¦–éƒ¨è¡¨)ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±èƒ½æé«˜é€Ÿåº¦äº†ã€‚</li><li><strong>æœåŠ¡å™¨æ¨é€ï¼š</strong> HTTP&#x2F;2 å…è®¸æœåŠ¡å™¨æœªç»è¯·æ±‚ï¼Œä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€èµ„æºï¼Œè¿™å«åšæœåŠ¡å™¨æ¨é€ã€‚ä½¿ç”¨æœåŠ¡å™¨æ¨é€æå‰ç»™å®¢æˆ·ç«¯æ¨é€å¿…è¦çš„èµ„æºï¼Œè¿™æ ·å°±å¯ä»¥ç›¸å¯¹å‡å°‘ä¸€äº›å»¶è¿Ÿæ—¶é—´ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ http2 ä¸‹æœåŠ¡å™¨ä¸»åŠ¨æ¨é€çš„æ˜¯é™æ€èµ„æºï¼Œå’Œ WebSocket ä»¥åŠä½¿ç”¨ SSE ç­‰æ–¹å¼å‘å®¢æˆ·ç«¯å‘é€å³æ—¶æ•°æ®çš„æ¨é€æ˜¯ä¸åŒçš„ã€‚</li></ul><p><strong>ä»€ä¹ˆæ˜¯é˜Ÿå¤´å µå¡?</strong></p><blockquote><p>é˜Ÿå¤´é˜»å¡æ˜¯ç”± HTTP åŸºæœ¬çš„â€œè¯·æ±‚ - åº”ç­”â€æ¨¡å‹æ‰€å¯¼è‡´çš„ã€‚HTTP è§„å®šæŠ¥æ–‡å¿…é¡»æ˜¯â€œä¸€å‘ä¸€æ”¶â€ï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„â€œä¸²è¡Œâ€é˜Ÿåˆ—ã€‚é˜Ÿåˆ—é‡Œçš„è¯·æ±‚æ˜¯æ²¡æœ‰ä¼˜å…ˆçº§çš„ï¼Œåªæœ‰å…¥é˜Ÿçš„å…ˆåé¡ºåºï¼Œæ’åœ¨æœ€å‰é¢çš„è¯·æ±‚ä¼šè¢«æœ€ä¼˜å…ˆå¤„ç†ã€‚å¦‚æœé˜Ÿé¦–çš„è¯·æ±‚å› ä¸ºå¤„ç†çš„å¤ªæ…¢è€½è¯¯äº†æ—¶é—´ï¼Œé‚£ä¹ˆé˜Ÿåˆ—é‡Œåé¢çš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸å¾—ä¸è·Ÿç€ä¸€èµ·ç­‰å¾…ï¼Œç»“æœå°±æ˜¯å…¶ä»–çš„è¯·æ±‚æ‰¿æ‹…äº†ä¸åº”æœ‰çš„æ—¶é—´æˆæœ¬ï¼Œé€ æˆäº†é˜Ÿå¤´å µå¡çš„ç°è±¡ã€‚</p></blockquote><p> <strong>é¡µé¢æœ‰å¤šå¼ å›¾ç‰‡ï¼ŒHTTPæ˜¯æ€æ ·çš„åŠ è½½è¡¨ç°ï¼Ÿ</strong></p><ul><li>åœ¨HTTP 1ä¸‹ï¼Œæµè§ˆå™¨å¯¹ä¸€ä¸ªåŸŸåä¸‹æœ€å¤§<code>TCP</code>è¿æ¥æ•°ä¸º6ï¼Œæ‰€ä»¥ä¼šè¯·æ±‚å¤šæ¬¡ã€‚å¯ä»¥ç”¨å¤šåŸŸåéƒ¨ç½²è§£å†³ã€‚è¿™æ ·å¯ä»¥æé«˜åŒæ—¶è¯·æ±‚çš„æ•°ç›®ï¼ŒåŠ å¿«é¡µé¢å›¾ç‰‡çš„è·å–é€Ÿåº¦ã€‚</li><li>åœ¨HTTP 2ä¸‹ï¼Œå¯ä»¥ä¸€ç¬é—´åŠ è½½å‡ºæ¥å¾ˆå¤šèµ„æºï¼Œå› ä¸ºï¼ŒHTTP2æ”¯æŒ<strong>å¤šè·¯å¤ç”¨</strong>ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­å‘é€å¤šä¸ªHTTPè¯·æ±‚ã€‚</li></ul><p><strong>HTTP2çš„å¤´éƒ¨å‹ç¼©ç®—æ³•æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><p><code>HTTP2</code>çš„å¤´éƒ¨å‹ç¼©æ˜¯<code>HPACK</code>ç®—æ³•ã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤ç«¯å»ºç«‹â€œå­—å…¸â€ï¼Œç”¨ç´¢å¼•å·è¡¨ç¤ºé‡å¤çš„å­—ç¬¦ä¸²ï¼Œé‡‡ç”¨<strong>å“ˆå¤«æ›¼ç¼–ç </strong>æ¥å‹ç¼©æ•´æ•°å’Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥è¾¾åˆ°50%~90%çš„é«˜å‹ç¼©ç‡ã€‚å…·ä½“æ¥è¯´ : </p><ul><li>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®å€¼å¯¹ï¼Œ<strong>å¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ï¼›</strong></li><li>é¦–éƒ¨è¡¨åœ¨<code>HTTP/2</code>çš„è¿æ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ¸è¿›åœ°æ›´æ–°ï¼›</li><li>æ¯ä¸ªæ–°çš„é¦–éƒ¨é”®å€¼å¯¹è¦ä¹ˆè¢«è¿½åŠ åˆ°å½“å‰è¡¨çš„æœ«å°¾ï¼Œè¦ä¹ˆæ›¿æ¢è¡¨ä¸­ä¹‹å‰çš„å€¼ã€‚</li></ul><h3 id="4-HTTP-x2F-2-åˆ°-HTTP-x2F-3-çš„ä¼˜åŒ–ï¼š"><a href="#4-HTTP-x2F-2-åˆ°-HTTP-x2F-3-çš„ä¼˜åŒ–ï¼š" class="headerlink" title="4. HTTP&#x2F;2 åˆ° HTTP&#x2F;3 çš„ä¼˜åŒ–ï¼š"></a>4. HTTP&#x2F;2 åˆ° HTTP&#x2F;3 çš„ä¼˜åŒ–ï¼š</h3><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310202352356.png" alt="img"></p><blockquote><p>äº†è§£</p></blockquote><p><code>HTTP/3</code>åŸºäº<code>UDP</code>åè®®å®ç°äº†ç±»ä¼¼äº<code>TCP</code>çš„å¤šè·¯å¤ç”¨æ•°æ®æµã€ä¼ è¾“å¯é æ€§ç­‰åŠŸèƒ½ï¼Œè¿™å¥—åŠŸèƒ½è¢«ç§°ä¸º<code>QUIC</code>åè®®ã€‚</p><ul><li><strong>æµé‡æ§åˆ¶ã€ä¼ è¾“å¯é æ€§åŠŸèƒ½</strong>ï¼š<code>QUIC</code>åœ¨<code>UDP</code>çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€å±‚æ¥ä¿è¯æ•°æ®ä¼ è¾“å¯é æ€§ï¼Œå®ƒæä¾›äº†æ•°æ®åŒ…é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ã€ä»¥åŠå…¶ä»–ä¸€äº›<code>TCP</code>ä¸­çš„ç‰¹æ€§ã€‚</li><li><strong>é›†æˆ</strong><code>**TLS**</code><strong>åŠ å¯†åŠŸèƒ½</strong>ï¼šç›®å‰<code>QUIC</code>ä½¿ç”¨<code>TLS1.3</code>ï¼Œå‡å°‘äº†æ¡æ‰‹æ‰€èŠ±è´¹çš„<code>RTT</code>æ•°ã€‚</li><li><strong>å¤šè·¯å¤ç”¨</strong>ï¼šåŒä¸€ç‰©ç†è¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æ•°æ®æµï¼Œå®ç°äº†æ•°æ®æµçš„å•ç‹¬ä¼ è¾“ï¼Œè§£å†³äº†<code>TCP</code>çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚</li><li><strong>å¿«é€Ÿæ¡æ‰‹</strong>ï¼šç”±äºåŸºäº<code>UDP</code>ï¼Œå¯ä»¥å®ç°ä½¿ç”¨<code>0 ~ 1</code>ä¸ª<code>RTT</code>æ¥å»ºç«‹è¿æ¥ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œåè®®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½ äº†è§£æµè§ˆå™¨å®‰å…¨å—?</title>
    <link href="/2023/10/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8/"/>
    <url>/2023/10/18/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%89%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="1-ä»€ä¹ˆæ˜¯-XSS-æ”»å‡»ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯-XSS-æ”»å‡»ï¼Ÿ" class="headerlink" title="1.  ä»€ä¹ˆæ˜¯ XSS æ”»å‡»ï¼Ÿ"></a>1.  ä»€ä¹ˆæ˜¯ XSS æ”»å‡»ï¼Ÿ</h2><blockquote><p>æ¦‚å¿µ</p></blockquote><p>XSS æ”»å‡»æŒ‡çš„æ˜¯<strong>è·¨ç«™è„šæœ¬æ”»å‡»</strong>ï¼Œæ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ç½‘ç«™æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œä»è€Œç›—å–ç”¨æˆ·çš„ä¿¡æ¯å¦‚ <code>cookie</code> ç­‰ã€‚</p><p>XSS çš„<strong>æœ¬è´¨</strong>æ˜¯å› ä¸ºç½‘ç«™æ²¡æœ‰å¯¹æ¶æ„ä»£ç è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ­£å¸¸çš„ä»£ç æ··åˆåœ¨ä¸€èµ·äº†ï¼Œæµè§ˆå™¨æ²¡æœ‰åŠæ³•åˆ†è¾¨å“ªäº›è„šæœ¬æ˜¯å¯ä¿¡çš„ï¼Œä»è€Œå¯¼è‡´äº†æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚</p><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™ç§æ”»å‡»æ–¹å¼å¯ä»¥è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>è·å–é¡µé¢çš„æ•°æ®ï¼Œå¦‚<code>DOM</code>ã€<code>cookie</code>ã€<code>localStorage</code>ï¼›</li><li><code>DOS</code>æ”»å‡»ï¼Œå‘é€åˆç†è¯·æ±‚ï¼Œå ç”¨æœåŠ¡å™¨èµ„æºï¼Œä»è€Œä½¿ç”¨æˆ·æ— æ³•è®¿é—®æœåŠ¡å™¨ï¼›</li><li>ç ´åé¡µé¢ç»“æ„ï¼›</li><li>æµé‡åŠ«æŒï¼ˆå°†é“¾æ¥æŒ‡å‘æŸç½‘ç«™ï¼‰ï¼›</li></ul><blockquote><p>æ”»å‡»ç±»å‹</p></blockquote><p><code>XSS</code> å¯ä»¥åˆ†ä¸º<strong>å­˜å‚¨å‹</strong>ã€<strong>åå°„å‹</strong>å’Œ <strong>DOM</strong> å‹ï¼š</p><ul><li>å­˜å‚¨å‹æŒ‡çš„æ˜¯æ¶æ„è„šæœ¬ä¼šå­˜å‚¨åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¼ å›å¹¶æ‰§è¡Œã€‚</li><li>åå°„å‹æŒ‡çš„æ˜¯æ”»å‡»è€…è¯±å¯¼ç”¨æˆ·è®¿é—®ä¸€ä¸ªå¸¦æœ‰æ¶æ„ä»£ç çš„ URL åï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶æ•°æ®åå¤„ç†ï¼Œç„¶åæŠŠå¸¦æœ‰æ¶æ„ä»£ç çš„æ•°æ®å‘é€åˆ°æµè§ˆå™¨ç«¯ï¼Œæµè§ˆå™¨ç«¯è§£æè¿™æ®µå¸¦æœ‰ XSS ä»£ç çš„æ•°æ®åå½“åšè„šæœ¬æ‰§è¡Œï¼Œæœ€ç»ˆå®Œæˆ XSS æ”»å‡»ã€‚ </li><li>DOM å‹æŒ‡çš„é€šè¿‡ä¿®æ”¹é¡µé¢çš„ DOM èŠ‚ç‚¹å½¢æˆçš„ XSSã€‚</li></ul><p><strong>1ï¼‰å­˜å‚¨å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š</strong></p><ol><li>æ”»å‡»è€…å°†æ¶æ„ä»£ç æäº¤åˆ°â½¬æ ‡â½¹ç«™çš„æ•°æ®åº“ä¸­ã€‚</li><li>â½¤æˆ·æ‰“å¼€â½¬æ ‡â½¹ç«™æ—¶ï¼Œâ½¹ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä»<strong>æ•°æ®åº“</strong>å–å‡ºï¼Œæ‹¼æ¥åœ¨ <code>**HTML**</code> ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚</li><li>â½¤æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§â¾ï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§â¾ã€‚</li><li>æ¶æ„ä»£ç çªƒå–â½¤æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„â½¹ç«™ï¼Œæˆ–è€…å†’å……â½¤æˆ·çš„â¾ä¸ºï¼Œè°ƒâ½¤â½¬æ ‡â½¹ç«™æ¥â¼æ‰§â¾æ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚</li></ol><p>è¿™ç§æ”»å‡»å¸¸â»…äºå¸¦æœ‰â½¤æˆ·ä¿å­˜æ•°æ®çš„â½¹ç«™åŠŸèƒ½ï¼Œå¦‚è®ºå›å‘å¸–ã€å•†å“è¯„è®ºã€â½¤æˆ·ç§ä¿¡ç­‰ã€‚</p><p><strong>2ï¼‰åå°„å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š</strong></p><ol><li>æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚</li><li>â½¤æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URL æ—¶ï¼Œâ½¹ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä» URL ä¸­å–å‡ºï¼Œæ‹¼æ¥åœ¨ HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚</li><li>â½¤æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§â¾ï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§â¾ã€‚</li><li>æ¶æ„ä»£ç çªƒå–â½¤æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„â½¹ç«™ï¼Œæˆ–è€…å†’å……â½¤æˆ·çš„â¾ä¸ºï¼Œè°ƒâ½¤â½¬æ ‡â½¹ç«™æ¥â¼æ‰§â¾æ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚</li></ol><p>åå°„å‹ XSS è·Ÿå­˜å‚¨å‹ XSS çš„åŒºåˆ«æ˜¯ï¼šå­˜å‚¨å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨æ•°æ®åº“â¾¥ï¼Œåå°„å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨ <strong>URL</strong> â¾¥ã€‚</p><p>åå°„å‹ XSS æ¼æ´å¸¸â»…äºé€šè¿‡ URL ä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œå¦‚â½¹ç«™æœç´¢ã€è·³è½¬ç­‰ã€‚ ç”±äºéœ€è¦â½¤æˆ·ä¸»åŠ¨æ‰“å¼€æ¶æ„çš„ URL æ‰èƒ½â½£æ•ˆï¼Œæ”»å‡»è€…å¾€å¾€ä¼šç»“åˆå¤šç§â¼¿æ®µè¯±å¯¼â½¤æˆ·ç‚¹å‡»ã€‚</p><p><strong>3ï¼‰DOM å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š</strong></p><ol><li>æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚</li><li>â½¤æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URLã€‚</li><li>â½¤æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§â¾ï¼Œ<strong>å‰ç«¯</strong> <code>**JavaScript**</code> å–å‡º URL ä¸­çš„æ¶æ„ä»£ç å¹¶æ‰§â¾ã€‚</li><li>æ¶æ„ä»£ç çªƒå–â½¤æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„â½¹ç«™ï¼Œæˆ–è€…å†’å……â½¤æˆ·çš„â¾ä¸ºï¼Œè°ƒâ½¤â½¬æ ‡â½¹ç«™æ¥â¼æ‰§â¾æ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚</li></ol><p>DOM å‹ XSS è·Ÿå‰ä¸¤ç§ XSS çš„åŒºåˆ«ï¼šDOM å‹ XSS æ”»å‡»ä¸­ï¼Œå–å‡ºå’Œæ‰§â¾æ¶æ„ä»£ç ç”±<strong>æµè§ˆå™¨ç«¯</strong>å®Œæˆï¼Œå±äºå‰ç«¯JavaScript â¾ƒèº«çš„å®‰å…¨æ¼æ´ï¼Œâ½½å…¶ä»–ä¸¤ç§ XSS éƒ½å±äºæœåŠ¡ç«¯çš„å®‰å…¨æ¼æ´ã€‚</p><h2 id="2-å¦‚ä½•é˜²å¾¡-XSS-æ”»å‡»ï¼Ÿ"><a href="#2-å¦‚ä½•é˜²å¾¡-XSS-æ”»å‡»ï¼Ÿ" class="headerlink" title="2. å¦‚ä½•é˜²å¾¡ XSS æ”»å‡»ï¼Ÿ"></a>2. å¦‚ä½•é˜²å¾¡ XSS æ”»å‡»ï¼Ÿ</h2><p>å¯ä»¥çœ‹åˆ°<code>XSS</code>å±å®³å¦‚æ­¤ä¹‹å¤§ï¼Œ é‚£ä¹ˆåœ¨å¼€å‘ç½‘ç«™æ—¶å°±è¦åšå¥½é˜²å¾¡æªæ–½ï¼Œå…·ä½“æªæ–½å¦‚ä¸‹ï¼š</p><ol><li>å¯ä»¥ä»æµè§ˆå™¨çš„æ‰§è¡Œæ¥è¿›è¡Œé¢„é˜²ï¼Œä¸€ç§æ˜¯ä½¿ç”¨çº¯å‰ç«¯çš„æ–¹å¼ï¼Œä¸ç”¨æœåŠ¡å™¨ç«¯æ‹¼æ¥åè¿”å›ï¼ˆä¸ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ï¼‰ã€‚å¦ä¸€ç§æ˜¯å¯¹éœ€è¦æ’å…¥åˆ° HTML ä¸­çš„ä»£ç åšå¥½å……åˆ†çš„<strong>è½¬ä¹‰</strong>ã€‚å¯¹äº DOM å‹çš„æ”»å‡»ï¼Œä¸»è¦æ˜¯å‰ç«¯è„šæœ¬çš„ä¸å¯é è€Œé€ æˆçš„ï¼Œå¯¹äºæ•°æ®è·å–æ¸²æŸ“å’Œå­—ç¬¦ä¸²æ‹¼æ¥çš„æ—¶å€™åº”è¯¥å¯¹å¯èƒ½å‡ºç°çš„æ¶æ„ä»£ç æƒ…å†µè¿›è¡Œåˆ¤æ–­ã€‚</li><li>ä½¿ç”¨ <code>**CSP**</code> ï¼ŒCSP çš„æœ¬è´¨æ˜¯å»ºç«‹ä¸€ä¸ªç™½åå•ï¼Œå‘Šè¯‰æµè§ˆå™¨å“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œï¼Œä»è€Œé˜²æ­¢æ¶æ„ä»£ç çš„æ³¨å…¥æ”»å‡»ã€‚</li></ol><ul><li>CSP æŒ‡çš„æ˜¯å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œå®ƒçš„æœ¬è´¨æ˜¯å»ºç«‹ä¸€ä¸ªç™½åå•ï¼Œå‘Šè¯‰æµè§ˆå™¨å“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œã€‚æˆ‘ä»¬åªéœ€è¦<strong>é…ç½®è§„åˆ™</strong>ï¼Œå¦‚ä½•æ‹¦æˆªç”±æµè§ˆå™¨è‡ªå·±æ¥å®ç°ã€‚</li><li>é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼æ¥å¼€å¯ <code>CSP</code>ï¼Œä¸€ç§æ˜¯è®¾ç½® HTTP é¦–éƒ¨ä¸­çš„ <code>Content-Security-Policy</code>ï¼Œä¸€ç§æ˜¯è®¾ç½® <code>meta</code> æ ‡ç­¾çš„æ–¹å¼</li></ul><ol start="3"><li>å¯¹ä¸€äº›æ•æ„Ÿä¿¡æ¯è¿›è¡Œä¿æŠ¤ï¼Œæ¯”å¦‚ <code>cookie</code> ä½¿ç”¨ <code>http-only</code>ï¼Œä½¿å¾—è„šæœ¬æ— æ³•è·å–ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨éªŒè¯ç ï¼Œé¿å…è„šæœ¬ä¼ªè£…æˆç”¨æˆ·æ‰§è¡Œä¸€äº›æ“ä½œã€‚</li></ol><h2 id="3-ä»€ä¹ˆæ˜¯-CSRF-æ”»å‡»ï¼Ÿ"><a href="#3-ä»€ä¹ˆæ˜¯-CSRF-æ”»å‡»ï¼Ÿ" class="headerlink" title="3. ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Ÿ"></a>3. ä»€ä¹ˆæ˜¯ CSRF æ”»å‡»ï¼Ÿ</h2><blockquote><p>æ¦‚å¿µ</p></blockquote><p>CSRF æ”»å‡»æŒ‡çš„æ˜¯<strong>è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»</strong>ï¼Œæ”»å‡»è€…åˆ©ç”¨å—å®³è€…åœ¨ç™»å½•çŠ¶æ€ä¸‹è®¿é—®æ¶æ„ç½‘ç«™ï¼Œé€šè¿‡æ„é€ ä¸€ä¸ªä¼ªè£…æˆå—å®³è€…å·²ç»æˆæƒçš„è¯·æ±‚æ¥æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œéæ³•æ“ä½œï¼Œä»è€Œå®ç°æ”»å‡»ç›®çš„ã€‚</p><p>CSRF æ”»å‡»é€šå¸¸éœ€è¦æ”»å‡»è€…æ„é€ ç‰¹å®šçš„è¯·æ±‚ï¼Œè¯±ä½¿ç”¨æˆ·ç‚¹å‡»æˆ–è§¦å‘ã€‚</p><blockquote><ol><li>ç”¨æˆ·Cæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®å—ä¿¡ä»»ç½‘ç«™Aï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¯·æ±‚ç™»å½•ç½‘ç«™Aï¼›</li><li>åœ¨ç”¨æˆ·ä¿¡æ¯é€šè¿‡éªŒè¯åï¼Œç½‘ç«™Aäº§ç”Ÿ<code>Cookie</code>ä¿¡æ¯å¹¶è¿”å›ç»™æµè§ˆå™¨ï¼Œæ­¤æ—¶ç”¨æˆ·ç™»å½•ç½‘ç«™AæˆåŠŸï¼Œå¯ä»¥æ­£å¸¸å‘é€è¯·æ±‚åˆ°ç½‘ç«™Aï¼›(æ¯”å¦‚ç™»å½•é“¶è¡Œç½‘ç«™)</li><li>ç”¨æˆ·æœªé€€å‡ºç½‘ç«™Aä¹‹å‰ï¼Œåœ¨åŒä¸€æµè§ˆå™¨ä¸­ï¼Œæ‰“å¼€ä¸€ä¸ªTABé¡µè®¿é—®ç½‘ç«™Bï¼›(ç½‘ç«™ B ä¸­å«æœ‰æ¶æ„ä»£ç )</li><li>ç½‘ç«™Bæ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚åï¼Œè¿”å›ä¸€äº›æ”»å‡»æ€§ä»£ç ï¼Œå¹¶å‘å‡ºä¸€ä¸ªè¯·æ±‚è¦æ±‚è®¿é—®ç¬¬ä¸‰æ–¹ç«™ç‚¹A(æ¯”å¦‚è¯´éšè—çš„è¡¨å•, ç»™è´¦æˆ·è½¬é’±, æˆ–è€…ä¿®æ”¹å¯†ç )</li><li>æµè§ˆå™¨åœ¨æ¥æ”¶åˆ°è¿™äº›æ”»å‡»æ€§ä»£ç åï¼Œæ ¹æ®ç½‘ç«™Bçš„è¯·æ±‚ï¼Œåœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æºå¸¦Cookieä¿¡æ¯ï¼Œå‘ç½‘ç«™Aå‘å‡ºè¯·æ±‚ã€‚ç½‘ç«™Aå¹¶ä¸çŸ¥é“è¯¥è¯·æ±‚å…¶å®æ˜¯ç”±Bå‘èµ·çš„ï¼Œæ‰€ä»¥ä¼šæ ¹æ®ç”¨æˆ·Cçš„Cookieä¿¡æ¯ä»¥Cçš„æƒé™å¤„ç†è¯¥è¯·æ±‚ï¼Œå¯¼è‡´æ¥è‡ªç½‘ç«™Bçš„æ¶æ„ä»£ç è¢«æ‰§è¡Œã€‚</li></ol></blockquote><p>CSRF æ”»å‡»çš„<strong>æœ¬è´¨æ˜¯åˆ©ç”¨ cookie ä¼šåœ¨åŒæºè¯·æ±‚ä¸­æºå¸¦å‘é€ç»™æœåŠ¡å™¨çš„ç‰¹ç‚¹ï¼Œä»¥æ­¤æ¥å®ç°ç”¨æˆ·çš„å†’å……ã€‚</strong></p><blockquote><p> æ”»å‡»ç±»å‹</p></blockquote><p>å¸¸è§çš„ <code>CSRF</code> æ”»å‡»æœ‰<strong>ä¸‰ç§</strong>ï¼š</p><ul><li><code>GET</code> ç±»å‹çš„ <code>CSRF</code> æ”»å‡»ï¼Œæ¯”å¦‚åœ¨ç½‘ç«™ä¸­çš„ä¸€ä¸ª <code>img</code> æ ‡ç­¾é‡Œæ„å»ºä¸€ä¸ªè¯·æ±‚ï¼Œå½“ç”¨æˆ·æ‰“å¼€è¿™ä¸ªç½‘ç«™çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨å‘èµ·æäº¤ã€‚</li><li><code>POST</code> ç±»å‹çš„ <code>CSRF</code> æ”»å‡»ï¼Œæ¯”å¦‚æ„å»ºä¸€ä¸ªè¡¨å•ï¼Œç„¶åéšè—å®ƒï¼Œå½“ç”¨æˆ·è¿›å…¥é¡µé¢æ—¶ï¼Œè‡ªåŠ¨æäº¤è¿™ä¸ªè¡¨å•ã€‚</li><li>é“¾æ¥ç±»å‹çš„ <code>CSRF </code>æ”»å‡»ï¼Œæ¯”å¦‚åœ¨ <code>a</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§é‡Œæ„å»ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè¯±å¯¼ç”¨æˆ·å»ç‚¹å‡»ã€‚</li></ul><h2 id="4-å¦‚ä½•é˜²å¾¡-CSRF-æ”»å‡»ï¼Ÿ"><a href="#4-å¦‚ä½•é˜²å¾¡-CSRF-æ”»å‡»ï¼Ÿ" class="headerlink" title="4. å¦‚ä½•é˜²å¾¡ CSRF æ”»å‡»ï¼Ÿ"></a>4. å¦‚ä½•é˜²å¾¡ CSRF æ”»å‡»ï¼Ÿ</h2><p><strong>CSRF æ”»å‡»å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥é˜²æŠ¤ï¼š</strong></p><ol><li><strong>è¿›è¡ŒåŒæºæ£€æµ‹</strong>ï¼ŒæœåŠ¡å™¨æ ¹æ® <code>http</code> è¯·æ±‚å¤´ä¸­ <code>origin</code> æˆ–è€… <code>referer</code> ä¿¡æ¯æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸ºå…è®¸è®¿é—®çš„ç«™ç‚¹ï¼Œä»è€Œå¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚å½“ <code>origin</code> æˆ–è€… <code>referer</code> ä¿¡æ¯éƒ½ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œç›´æ¥é˜»æ­¢è¯·æ±‚ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æœ‰äº›æƒ…å†µä¸‹ <code>referer</code> å¯ä»¥è¢«ä¼ªé€ ï¼ŒåŒæ—¶è¿˜ä¼šæŠŠæœç´¢å¼•æ“çš„é“¾æ¥ä¹Ÿç»™å±è”½äº†ã€‚æ‰€ä»¥ä¸€èˆ¬ç½‘ç«™ä¼šå…è®¸æœç´¢å¼•æ“çš„é¡µé¢è¯·æ±‚ï¼Œä½†æ˜¯ç›¸åº”çš„é¡µé¢è¯·æ±‚è¿™ç§è¯·æ±‚æ–¹å¼ä¹Ÿå¯èƒ½è¢«æ”»å‡»è€…ç»™åˆ©ç”¨ã€‚ï¼ˆ<code>Referer</code> å­—æ®µä¼šå‘Šè¯‰æœåŠ¡å™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ï¼‰</li></ol><p>æµè§ˆå™¨åŒæºç­–ç•¥ï¼šåè®®ã€åŸŸåå’Œç«¯å£éƒ½ç›¸åŒå³åŒæºï¼›</p><p>CookieåŒæºç­–ç•¥ï¼šåŸŸåç›¸åŒå³åŒæºï¼›</p><p>åœ¨HTTPåè®®ä¸­ï¼Œæ¯ä¸ªå¼‚æ­¥è¯·æ±‚éƒ½ä¼šæºå¸¦ä¸¤ä¸ªheader, ç”¨æ¥æ ‡è®°æ¥æºåŸŸåï¼š</p><ul><li><code>Origin Header</code></li><li><code>Referer Header</code></li></ul><ol start="2"><li><strong>ä½¿ç”¨ CSRF Token è¿›è¡ŒéªŒè¯</strong>ï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ªéšæœºæ•° Token ï¼Œ<strong>å½“ç½‘ç«™å†æ¬¡å‘èµ·è¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å‚æ•°ä¸­åŠ å…¥æœåŠ¡å™¨ç«¯è¿”å›çš„ token ï¼Œç„¶åæœåŠ¡å™¨å¯¹è¿™ä¸ª token è¿›è¡ŒéªŒè¯</strong>ã€‚è¿™ç§æ–¹æ³•è§£å†³äº†ä½¿ç”¨ cookie å•ä¸€éªŒè¯æ–¹å¼æ—¶ï¼Œå¯èƒ½ä¼šè¢«å†’ç”¨çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç»™ç½‘ç«™ä¸­çš„æ‰€æœ‰è¯·æ±‚éƒ½æ·»åŠ ä¸Šè¿™ä¸ª tokenï¼Œæ“ä½œæ¯”è¾ƒç¹çã€‚è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ä¸€èˆ¬ä¸ä¼šåªæœ‰ä¸€å°ç½‘ç«™æœåŠ¡å™¨ï¼Œå¦‚æœè¯·æ±‚ç»è¿‡è´Ÿè½½å¹³è¡¡è½¬ç§»åˆ°äº†å…¶ä»–çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ session ä¸­æ²¡æœ‰ä¿ç•™è¿™ä¸ª token çš„è¯ï¼Œå°±æ²¡æœ‰åŠæ³•éªŒè¯äº†ã€‚è¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡æ”¹å˜ token çš„æ„å»ºæ–¹å¼æ¥è§£å†³ã€‚</li></ol><p>è¯·æ±‚ä¸­æºå¸¦token </p><ul><li>å¯¹äºGETè¯·æ±‚ï¼Œå°†tokené™„åœ¨è¯·æ±‚åœ°å€ä¹‹åï¼Œå¦‚ï¼š<code>http://url?token=tokenValue</code></li><li>å¯¹äºPOSTè¯·æ±‚ï¼Œè¦åœ¨Formè¡¨å•åé¢åŠ ä¸Š ã€‚</li></ul><p>æœåŠ¡ç«¯éªŒè¯tokenæ˜¯å¦æ­£ç¡®</p><ul><li>æœåŠ¡ç«¯æ‹¿åˆ°å®¢æˆ·ç«¯ç»™çš„tokenåï¼Œå…ˆè§£å¯†token, å†æ¯”å¯¹éšæœºå­—ç¬¦ä¸²æ˜¯å¦ä¸€è‡´ã€æ—¶é—´æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœå­—ç¬¦ä¸²å¯¹æ¯”ä¸€è‡´ä¸”åœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™è¯´æ˜tokenæ­£ç¡®ã€‚</li></ul><ol start="3"><li><strong>åœ¨è®¾ç½® cookie å±æ€§çš„æ—¶å€™è®¾ç½® Samesite ï¼Œé™åˆ¶ cookie ä¸èƒ½ä½œä¸ºè¢«ç¬¬ä¸‰æ–¹ä½¿ç”¨</strong>ï¼Œä»è€Œå¯ä»¥é¿å…è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚Samesite ä¸€å…±æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ cookie åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å¯èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹ Cookie ä½¿ç”¨ï¼Œåœ¨å®½æ¾æ¨¡å¼ä¸‹ï¼Œcookie å¯ä»¥è¢«è¯·æ±‚æ˜¯ GET è¯·æ±‚ï¼Œä¸”ä¼šå‘ç”Ÿé¡µé¢è·³è½¬çš„è¯·æ±‚æ‰€ä½¿ç”¨ã€‚</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-title class_">Set</span>-<span class="hljs-title class_">Cookie</span>: <span class="hljs-title class_">SameSite</span> = <span class="hljs-title class_">Strict</span>;<br><span class="hljs-title class_">Set</span>-<span class="hljs-title class_">Cookie</span>: <span class="hljs-title class_">SameSite</span> = <span class="hljs-title class_">Lax</span>;<br><span class="hljs-title class_">Set</span>-<span class="hljs-title class_">Cookie</span>: <span class="hljs-title class_">SameSite</span> = <span class="hljs-title class_">None</span>; <span class="hljs-title class_">Secure</span>  <span class="hljs-comment">// æœ‰æ•ˆ</span><br></code></pre></td></tr></table></figure><ul><li>Strictï¼š æœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹Cookie, è·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µéƒ½ä¸å‘é€Cookie;</li><li>Laxï¼š é™åˆ¶ç¨å¾®å®½æ¾ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ—¶ä¸å‘é€ç¬¬ä¸‰æ–¹Cookieçš„ï¼Œé™¤äº†aé“¾æ¥ã€é¢„åŠ è½½è¯·æ±‚å’ŒGETè¡¨å•ï¼›</li><li>Noneï¼š å…³é—­SameSiteå±æ€§ï¼Œä½†å¿…é¡»åŒæ—¶è®¾ç½®Secureå±æ€§</li></ul><ol start="4"><li><strong>å¯¹ Cookie è¿›è¡ŒåŒé‡éªŒè¯</strong>ï¼ŒæœåŠ¡å™¨åœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™é¡µé¢æ—¶ï¼Œå‘è¯·æ±‚åŸŸåæ³¨å…¥ä¸€ä¸ªCookieï¼Œå†…å®¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼Œç„¶åå½“ç”¨æˆ·å†æ¬¡å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä» cookie ä¸­å–å‡ºè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ·»åŠ åˆ° URL å‚æ•°ä¸­ï¼Œç„¶åæœåŠ¡å™¨é€šè¿‡å¯¹ cookie ä¸­çš„æ•°æ®å’Œå‚æ•°ä¸­çš„æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼Œæ¥è¿›è¡ŒéªŒè¯ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼æ˜¯åˆ©ç”¨äº†æ”»å‡»è€…åªèƒ½åˆ©ç”¨ cookieï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®è·å– cookie çš„ç‰¹ç‚¹ã€‚å¹¶ä¸”è¿™ç§æ–¹æ³•æ¯” CSRF Token çš„æ–¹æ³•æ›´åŠ æ–¹ä¾¿ï¼Œå¹¶ä¸”ä¸æ¶‰åŠåˆ°åˆ†å¸ƒå¼è®¿é—®çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯å¦‚æœç½‘ç«™å­˜åœ¨ <code>XSS</code> æ¼æ´çš„ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼ä¼šå¤±æ•ˆã€‚åŒæ—¶è¿™ç§æ–¹å¼ä¸èƒ½åšåˆ°å­åŸŸåçš„éš”ç¦»ã€‚</li></ol><blockquote><p>é™¤äº† XSS å’Œ CSRF , iframe çš„æ»¥ç”¨å’Œæ¶æ„ç¬¬ä¸‰æ–¹åº“ä¹Ÿå¯èƒ½å¼•èµ·å‰ç«¯å®‰å…¨çš„é—®é¢˜, è¿™é‡Œå°±ä¸å™è¿°äº†ã€‚</p></blockquote><h2 id="5-ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿå¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ"><a href="#5-ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿå¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ" class="headerlink" title="5. ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿå¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ"></a>5. ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»ï¼Ÿå¦‚ä½•é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Ÿ</h2><p>ä¸­é—´â¼ˆ (Man-in-the-middle attack, MITM) æ˜¯æŒ‡æ”»å‡»è€…ä¸é€šè®¯çš„ä¸¤ç«¯åˆ†åˆ«åˆ›å»ºç‹¬â½´çš„è”ç³», å¹¶äº¤æ¢å…¶æ‰€æ”¶åˆ°çš„æ•°æ®, ä½¿é€šè®¯çš„ä¸¤ç«¯è®¤ä¸ºä»–ä»¬æ­£åœ¨é€šè¿‡â¼€ä¸ªç§å¯†çš„è¿æ¥ä¸å¯¹â½…ç›´æ¥å¯¹è¯, ä½†äº‹å®ä¸Šæ•´ä¸ªä¼šè¯éƒ½è¢«æ”»å‡»è€…å®Œå…¨æ§åˆ¶ã€‚åœ¨ä¸­é—´â¼ˆæ”»å‡»ä¸­ï¼Œ<strong>æ”»å‡»è€…å¯ä»¥æ‹¦æˆªé€šè®¯åŒæ–¹çš„é€šè¯å¹¶æ’â¼Šæ–°çš„å†…å®¹ã€‚</strong></p><p>æ”»å‡»è€…ä¸ä»…èƒ½è·å¾—åŒæ–¹çš„é€šä¿¡ä¿¡æ¯ï¼Œè¿˜èƒ½ä¿®æ”¹é€šä¿¡ä¿¡æ¯ã€‚</p><blockquote><p>æ”»å‡»è¿‡ç¨‹å¦‚ä¸‹:</p></blockquote><ul><li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè¯·æ±‚è¢«ä¸­é—´â¼ˆæˆªè·</li><li>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å…¬é’¥</li><li>ä¸­é—´â¼ˆæˆªè·å…¬é’¥ï¼Œä¿ç•™åœ¨â¾ƒâ¼°â¼¿ä¸Šã€‚ç„¶åâ¾ƒâ¼°â½£æˆâ¼€ä¸ª<strong>ä¼ªé€ çš„</strong>å…¬é’¥ï¼Œå‘ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯æ”¶åˆ°ä¼ªé€ çš„å…¬é’¥åï¼Œâ½£æˆåŠ å¯†hashå€¼å‘ç»™æœåŠ¡å™¨</li><li>ä¸­é—´â¼ˆè·å¾—åŠ å¯†hashå€¼ï¼Œâ½¤â¾ƒâ¼°çš„ç§é’¥è§£å¯†è·å¾—çœŸç§˜é’¥,åŒæ—¶â½£æˆ<strong>å‡çš„</strong>åŠ å¯†hashå€¼ï¼Œå‘ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨â½¤ç§é’¥è§£å¯†è·å¾—å‡å¯†é’¥,ç„¶ååŠ å¯†æ•°æ®ä¼ è¾“ç»™å®¢æˆ·ç«¯</li></ul><h2 id="6-ç½‘ç»œåŠ«æŒæœ‰å“ªå‡ ç§ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿ"><a href="#6-ç½‘ç»œåŠ«æŒæœ‰å“ªå‡ ç§ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿ" class="headerlink" title="6. ç½‘ç»œåŠ«æŒæœ‰å“ªå‡ ç§ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿ"></a>6. ç½‘ç»œåŠ«æŒæœ‰å“ªå‡ ç§ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿ</h2><p>â½¹ç»œåŠ«æŒåˆ†ä¸º<strong>ä¸¤ç§</strong>:</p><p>ï¼ˆ1ï¼‰<strong>DNSåŠ«æŒ</strong>: </p><p>è¾“â¼Šäº¬ä¸œè¢«å¼ºåˆ¶è·³è½¬åˆ°æ·˜å®è¿™å°±å±äº<code>dns</code>åŠ«æŒ</p><ul><li>DNSå¼ºåˆ¶è§£æ: é€šè¿‡ä¿®æ”¹è¿è¥å•†çš„æœ¬åœ°DNSè®°å½•ï¼Œæ¥å¼•å¯¼â½¤æˆ·æµé‡åˆ°ç¼“å­˜æœåŠ¡å™¨</li><li><code>302</code>è·³è½¬çš„â½…å¼: é€šè¿‡ç›‘æ§â½¹ç»œå‡ºâ¼çš„æµé‡ï¼Œåˆ†æåˆ¤æ–­å“ªäº›å†…å®¹æ˜¯å¯ä»¥è¿›â¾åŠ«æŒå¤„ç†çš„,å†å¯¹åŠ«æŒçš„å†…å­˜å‘èµ·<code>302</code>è·³è½¬çš„å›å¤ï¼Œå¼•å¯¼â½¤æˆ·è·å–å†…å®¹</li></ul><p>ï¼ˆ2ï¼‰<strong>HTTPåŠ«æŒ</strong>: </p><p>è®¿é—®â¾•æ­Œä½†æ˜¯â¼€ç›´æœ‰è´ªç©è“â½‰çš„â¼´å‘Š , ç”±äºhttpæ˜â½‚ä¼ è¾“,è¿è¥å•†ä¼šä¿®æ”¹ä½ çš„httpå“åº”å†…å®¹(å³åŠ â¼´å‘Š)</p><p><code>DNS</code>åŠ«æŒç”±äºæ¶‰å«Œè¿æ³•ï¼Œå·²ç»è¢«ç›‘ç®¡èµ·æ¥ï¼Œç°åœ¨å¾ˆå°‘ä¼šæœ‰<code>DNS</code>åŠ«æŒï¼Œâ½½<code>http</code>åŠ«æŒä¾ç„¶â¾®å¸¸ç››â¾ï¼Œæœ€æœ‰æ•ˆçš„åŠæ³•å°±æ˜¯å…¨ç«™<code>HTTPS</code>ï¼Œå°†<code>HTTP</code>åŠ å¯†ï¼Œè¿™ä½¿å¾—è¿è¥å•†â½†æ³•è·å–æ˜â½‚ï¼Œå°±â½†æ³•åŠ«æŒä½ çš„å“åº”å†…å®¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æµè§ˆå™¨åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æµè§ˆå™¨å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºæµè§ˆå™¨çš„å•è¿›ç¨‹/å¤šè¿›ç¨‹æ¶æ„</title>
    <link href="/2023/10/17/%E6%B5%8F%E8%A7%88%E5%99%A8--/"/>
    <url>/2023/10/17/%E6%B5%8F%E8%A7%88%E5%99%A8--/</url>
    
    <content type="html"><![CDATA[<p>Chromeæ‰“å¼€ä¸€ä¸ªé¡µé¢éœ€è¦å¯åŠ¨å¤šå°‘è¿›ç¨‹ï¼Ÿ</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310171854683.png" alt="img"></p><p><strong>ä»…ä»…æ‰“å¼€äº†1ä¸ªé¡µé¢ï¼Œä¸ºä»€ä¹ˆæœ‰4ä¸ªè¿›ç¨‹ï¼Ÿ</strong></p><p>åœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹è¿›ç¨‹ä¸çº¿ç¨‹çš„æ¦‚å¿µã€‚</p><h3 id="1-è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#1-è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="1. è¿›ç¨‹å’Œçº¿ç¨‹"></a>1. è¿›ç¨‹å’Œçº¿ç¨‹</h3><p>è®¡ç®—æœºä¸­çš„å¹¶è¡Œå¤„ç†å°±æ˜¯åŒä¸€æ—¶åˆ»å¤„ç†å¤šä¸ªä»»åŠ¡, æ¯”å¦‚æˆ‘ä»¬è¦è®¡ç®—ä¸‰ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶æ˜¾ç¤ºå‡ºç»“æœã€‚</p><ul><li>æ­£å¸¸æƒ…å†µä¸‹ç¨‹åºå¯ä»¥ä½¿ç”¨<strong>å•çº¿ç¨‹</strong>æ¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯åˆ†å››æ­¥æŒ‰ç…§é¡ºåºåˆ†åˆ«æ‰§è¡Œè¿™å››ä¸ªä»»åŠ¡ã€‚</li><li>ä½†å¦‚æœé‡‡ç”¨<strong>å¤šçº¿ç¨‹</strong>ï¼Œæˆ‘ä»¬åªéœ€åˆ†â€œä¸¤æ­¥èµ°â€ : ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå‰ä¸‰ä¸ªä»»åŠ¡ï¼›ç¬¬äºŒæ­¥ï¼Œå†æ‰§è¡Œç¬¬å››ä¸ªæ˜¾ç¤ºä»»åŠ¡ã€‚</li></ul><p><strong>é€šè¿‡å¯¹æ¯”å‘ç°ç”¨å•çº¿ç¨‹æ‰§è¡Œéœ€è¦å››æ­¥ï¼Œè€Œä½¿ç”¨å¤šçº¿ç¨‹åªéœ€è¦ä¸¤æ­¥ã€‚å› æ­¤ï¼Œä½¿ç”¨å¹¶è¡Œå¤„ç†èƒ½å¤§å¤§æå‡æ€§èƒ½ã€‚</strong></p><p>å¤šçº¿ç¨‹å¯ä»¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹æ˜¯ä¸èƒ½å•ç‹¬å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ç”±è¿›ç¨‹æ¥å¯åŠ¨å’Œç®¡ç†çš„ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯è¿›ç¨‹å‘¢?</p></blockquote><p>ä¸€ä¸ª<strong>è¿›ç¨‹</strong>å°±æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚</p><p>è¯¦ç»†è§£é‡Šå°±æ˜¯ï¼Œå¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„ä¸€ä¸ªè¿è¡Œç¯å¢ƒå«è¿›ç¨‹ã€‚</p><blockquote><p>å•çº¿ç¨‹ä¸å¤šçº¿ç¨‹çš„è¿›ç¨‹å¯¹æ¯”å›¾</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310171854780.png" alt="img"></p><p><strong>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹æ˜¯ä¾é™„äºè¿›ç¨‹çš„ï¼Œè€Œè¿›ç¨‹ä¸­ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†èƒ½æå‡è¿ç®—æ•ˆç‡ã€‚</strong></p><p><strong>è¿›ç¨‹å’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»æœ‰ä»¥ä¸‹4ä¸ªç‰¹ç‚¹ã€‚</strong></p><ol><li><strong>è¿›ç¨‹ä¸­çš„ä»»æ„ä¸€çº¿ç¨‹æ‰§è¡Œå‡ºé”™ï¼Œéƒ½ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹çš„å´©æºƒã€‚</strong></li><li><strong>çº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹ä¸­çš„æ•°æ®ã€‚</strong></li><li><strong>å½“ä¸€ä¸ªè¿›ç¨‹å…³é—­ä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šå›æ”¶è¿›ç¨‹æ‰€å ç”¨çš„å†…å­˜ã€‚</strong></li></ol><ul><li>å½“ä¸€ä¸ªè¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå›æ”¶è¯¥è¿›ç¨‹æ‰€ç”³è¯·çš„æ‰€æœ‰èµ„æºï¼›å³ä½¿å…¶ä¸­ä»»æ„çº¿ç¨‹å› ä¸ºæ“ä½œä¸å½“å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå½“è¿›ç¨‹é€€å‡ºæ—¶ï¼Œè¿™äº›å†…å­˜ä¹Ÿä¼šè¢«æ­£ç¡®å›æ”¶ã€‚</li></ul><ol start="4"><li><strong>è¿›ç¨‹ä¹‹é—´çš„å†…å®¹ç›¸äº’éš”ç¦»</strong></li></ol><ul><li>æ­£æ˜¯å› ä¸ºè¿›ç¨‹ä¹‹é—´çš„æ•°æ®æ˜¯ä¸¥æ ¼éš”ç¦»çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹å¦‚æœå´©æºƒäº†ï¼Œæˆ–è€…æŒ‚èµ·äº†ï¼Œæ˜¯ä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹çš„ã€‚å¦‚æœè¿›ç¨‹ä¹‹é—´éœ€è¦è¿›è¡Œæ•°æ®çš„é€šä¿¡è¿™æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ç”¨äºè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æœºåˆ¶äº†ã€‚</li></ul><h3 id="2-å•è¿›ç¨‹æµè§ˆå™¨æ—¶ä»£"><a href="#2-å•è¿›ç¨‹æµè§ˆå™¨æ—¶ä»£" class="headerlink" title="2. å•è¿›ç¨‹æµè§ˆå™¨æ—¶ä»£"></a>2. å•è¿›ç¨‹æµè§ˆå™¨æ—¶ä»£</h3><p>å•è¿›ç¨‹æµè§ˆå™¨æ˜¯æŒ‡æµè§ˆå™¨çš„æ‰€æœ‰åŠŸèƒ½æ¨¡å—éƒ½æ˜¯è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œäº›æ¨¡å—åŒ…å«äº†ç½‘ç»œã€æ’ä»¶ã€JavaScriptè¿è¡Œç¯å¢ƒã€æ¸²æŸ“å¼•æ“å’Œé¡µé¢ç­‰ã€‚<img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310171854877.png" alt="img"></p><p>å¦‚æ­¤å¤šçš„åŠŸèƒ½æ¨¡å—è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œæ˜¯å¯¼è‡´å•è¿›ç¨‹æµè§ˆå™¨<strong>ä¸ç¨³å®šã€ä¸æµç•…å’Œä¸å®‰å…¨</strong>çš„ä¸€ä¸ªä¸»è¦å› ç´ ã€‚</p><p><strong>ä¸ç¨³å®š</strong></p><ul><li>æ—©æœŸæµè§ˆå™¨éœ€è¦å€ŸåŠ©äºæ’ä»¶æ¥å®ç°è¯¸å¦‚Webè§†é¢‘ã€Webæ¸¸æˆç­‰å„ç§å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ’ä»¶æ˜¯æœ€å®¹æ˜“å‡ºé—®é¢˜çš„æ¨¡å—ï¼Œå¹¶ä¸”è¿˜è¿è¡Œåœ¨æµè§ˆå™¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ‰€ä»¥ä¸€ä¸ªæ’ä»¶çš„æ„å¤–å´©æºƒä¼šå¼•èµ·æ•´ä¸ªæµè§ˆå™¨çš„å´©æºƒ</li><li>é™¤äº†æ’ä»¶ä¹‹å¤–ï¼Œæ¸²æŸ“å¼•æ“æ¨¡å—ä¹Ÿæ˜¯ä¸ç¨³å®šçš„ï¼Œé€šå¸¸ä¸€äº›å¤æ‚çš„JavaScriptä»£ç å°±æœ‰å¯èƒ½å¼•èµ·æ¸²æŸ“å¼•æ“æ¨¡å—çš„å´©æºƒã€‚å’Œæ’ä»¶ä¸€æ ·ï¼Œæ¸²æŸ“å¼•æ“çš„å´©æºƒä¹Ÿä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨çš„å´©æºƒã€‚</li></ul><p><strong>ä¸æµç•…</strong></p><ul><li>å•è¿›ç¨‹æµè§ˆå™¨ä¸­æ‰€æœ‰é¡µé¢çš„æ¸²æŸ“æ¨¡å—ã€JavaScriptæ‰§è¡Œç¯å¢ƒä»¥åŠæ’ä»¶éƒ½æ˜¯è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„ï¼Œè¿™å°±æ„å‘³ç€åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ¨¡å—å¯ä»¥æ‰§è¡Œã€‚<strong>å½“æœ‰è„šæœ¬å‘ç”Ÿæ— é™å¾ªç¯æ—¶ï¼Œ</strong>å®ƒä¼šç‹¬å æ•´ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å¯¼è‡´å…¶ä»–è¿è¡Œåœ¨è¯¥çº¿ç¨‹ä¸­çš„æ¨¡å—å°±æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œã€‚å› ä¸ºæµè§ˆå™¨ä¸­æ‰€æœ‰çš„é¡µé¢éƒ½è¿è¡Œåœ¨è¯¥çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥è¿™äº›é¡µé¢éƒ½æ²¡æœ‰æœºä¼šå»æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨å¤±å»å“åº”ï¼Œå˜å¡é¡¿ã€‚</li><li>é™¤äº†ä¸Šè¿°è„šæœ¬æˆ–è€…æ’ä»¶ä¼šè®©å•è¿›ç¨‹æµè§ˆå™¨å˜å¡é¡¿å¤–ï¼Œ<strong>é¡µé¢çš„å†…å­˜æ³„æ¼</strong>ä¹Ÿæ˜¯å•è¿›ç¨‹å˜æ…¢çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚é€šå¸¸æµè§ˆå™¨çš„å†…æ ¸éƒ½æ˜¯éå¸¸å¤æ‚çš„ï¼Œè¿è¡Œä¸€ä¸ªå¤æ‚ç‚¹çš„é¡µé¢å†å…³é—­é¡µé¢ï¼Œä¼šå­˜åœ¨å†…å­˜ä¸èƒ½å®Œå…¨å›æ”¶çš„æƒ…å†µï¼Œè¿™æ ·å¯¼è‡´çš„é—®é¢˜æ˜¯ä½¿ç”¨æ—¶é—´è¶Šé•¿ï¼Œå†…å­˜å ç”¨è¶Šé«˜ï¼Œæµè§ˆå™¨ä¼šå˜å¾—è¶Šæ…¢ã€‚</li></ul><p><strong>ä¸å®‰å…¨</strong></p><ul><li>æ’ä»¶å¯ä»¥ä½¿ç”¨C&#x2F;C++ç­‰ä»£ç ç¼–å†™ï¼Œ<strong>é€šè¿‡æ’ä»¶å¯ä»¥è·å–åˆ°æ“ä½œç³»ç»Ÿçš„ä»»æ„èµ„æºï¼Œ</strong>å½“ä½ åœ¨é¡µé¢è¿è¡Œä¸€ä¸ªæ’ä»¶æ—¶ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªæ’ä»¶èƒ½å®Œå…¨æ“ä½œä½ çš„ç”µè„‘ã€‚å¦‚æœæ˜¯ä¸ªæ¶æ„æ’ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥é‡Šæ”¾ç—…æ¯’ã€çªƒå–ä½ çš„è´¦å·å¯†ç ï¼Œå¼•å‘å®‰å…¨æ€§é—®é¢˜ã€‚</li><li><strong>é¡µé¢è„šæœ¬å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„æ¼æ´æ¥è·å–ç³»ç»Ÿæƒé™</strong>ï¼Œè¿™äº›è„šæœ¬è·å–ç³»ç»Ÿæƒé™ä¹‹åä¹Ÿå¯ä»¥å¯¹ä½ çš„ç”µè„‘åšä¸€äº›æ¶æ„çš„äº‹æƒ…ï¼ŒåŒæ ·ä¹Ÿä¼šå¼•å‘å®‰å…¨é—®é¢˜ã€‚</li></ul><blockquote><p>å¥½åœ¨ç°ä»£æµè§ˆå™¨å·²ç»è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿè¿™å°±å¾—èŠèŠæˆ‘ä»¬è¿™ä¸ªâ€œå¤šè¿›ç¨‹æµè§ˆå™¨æ—¶ä»£â€äº†ã€‚</p></blockquote><h3 id="3-å¤šè¿›ç¨‹æµè§ˆå™¨æ—¶ä»£"><a href="#3-å¤šè¿›ç¨‹æµè§ˆå™¨æ—¶ä»£" class="headerlink" title="3. å¤šè¿›ç¨‹æµè§ˆå™¨æ—¶ä»£"></a>3. å¤šè¿›ç¨‹æµè§ˆå™¨æ—¶ä»£</h3><blockquote><p>å¤šè¿›ç¨‹æµè§ˆå™¨æ¶æ„çš„ç‰¹ç‚¹</p></blockquote><p><strong>ç¨³å®š</strong></p><ul><li>ç”±äºè¿›ç¨‹æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ‰€ä»¥å½“ä¸€ä¸ªé¡µé¢æˆ–è€…æ’ä»¶å´©æºƒæ—¶ï¼Œå½±å“åˆ°çš„ä»…ä»…æ˜¯å½“å‰çš„é¡µé¢è¿›ç¨‹æˆ–è€…æ’ä»¶è¿›ç¨‹ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°æµè§ˆå™¨å’Œå…¶ä»–é¡µé¢ï¼Œè¿™å°±å®Œç¾åœ°è§£å†³äº†é¡µé¢æˆ–è€…æ’ä»¶çš„å´©æºƒä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨å´©æºƒï¼Œä¹Ÿå°±æ˜¯ä¸ç¨³å®šçš„é—®é¢˜ã€‚</li></ul><p><strong>æµç•…</strong></p><ul><li>JavaScriptä¹Ÿæ˜¯è¿è¡Œåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥å³ä½¿<strong>JavaScripté˜»å¡äº†æ¸²æŸ“è¿›ç¨‹</strong>ï¼Œå½±å“åˆ°çš„ä¹Ÿåªæ˜¯å½“å‰çš„æ¸²æŸ“é¡µé¢ï¼Œè€Œå¹¶ä¸ä¼šå½±å“æµè§ˆå™¨å’Œå…¶ä»–é¡µé¢ï¼Œå› ä¸ºå…¶ä»–é¡µé¢çš„è„šæœ¬æ˜¯è¿è¡Œåœ¨å®ƒä»¬è‡ªå·±çš„æ¸²æŸ“è¿›ç¨‹ä¸­çš„ã€‚æ‰€ä»¥å³ä½¿Chromeä¸­è¿è¡Œä¸Šé¢æ­»å¾ªç¯çš„è„šæœ¬æ—¶ï¼Œæ²¡æœ‰å“åº”çš„ä»…ä»…ä¹Ÿæ˜¯å½“å‰çš„é¡µé¢ã€‚</li><li>å¯¹äº<strong>å†…å­˜æ³„æ¼çš„è§£å†³æ–¹æ³•</strong>é‚£å°±æ›´ç®€å•äº†ï¼Œå› ä¸ºå½“å…³é—­ä¸€ä¸ªé¡µé¢æ—¶ï¼Œæ•´ä¸ªæ¸²æŸ“è¿›ç¨‹ä¹Ÿä¼šè¢«å…³é—­ï¼Œä¹‹åè¯¥è¿›ç¨‹æ‰€å ç”¨çš„å†…å­˜éƒ½ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œè¿™æ ·å°±è½»æ¾è§£å†³äº†æµè§ˆå™¨é¡µé¢çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</li></ul><p><strong>å®‰å…¨</strong></p><ul><li>é‡‡ç”¨å¤šè¿›ç¨‹æ¶æ„çš„é¢å¤–å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨å®‰å…¨æ²™ç®±ã€‚æ²™ç®±å¯ä»¥çœ‹æˆæ˜¯æ“ä½œç³»ç»Ÿç»™è¿›ç¨‹ä¸Šäº†ä¸€æŠŠé”ï¼Œæ²™ç®±é‡Œé¢çš„ç¨‹åºå¯ä»¥è¿è¡Œï¼Œä½†æ˜¯ä¸èƒ½åœ¨ä½ çš„ç¡¬ç›˜ä¸Šå†™å…¥ä»»ä½•æ•°æ®ï¼Œä¹Ÿä¸èƒ½åœ¨æ•æ„Ÿä½ç½®è¯»å–ä»»ä½•æ•°æ®ã€‚</li><li>ä¾‹å¦‚ä½ çš„æ–‡æ¡£å’Œæ¡Œé¢ã€‚ChromeæŠŠæ’ä»¶è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹é”åœ¨æ²™ç®±é‡Œé¢ï¼Œè¿™æ ·å³ä½¿åœ¨æ¸²æŸ“è¿›ç¨‹æˆ–è€…æ’ä»¶è¿›ç¨‹é‡Œé¢æ‰§è¡Œäº†æ¶æ„ç¨‹åºï¼Œæ¶æ„ç¨‹åºä¹Ÿæ— æ³•çªç ´æ²™ç®±å»è·å–ç³»ç»Ÿæƒé™ã€‚</li></ul><blockquote><p>ç›®å‰çš„å¤šè¿›ç¨‹æ¶æ„</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310171854713.png" alt="img"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ€æ–°çš„Chromeæµè§ˆå™¨åŒ…æ‹¬ï¼š</p><p>1ä¸ªæµè§ˆå™¨ï¼ˆBrowserï¼‰ä¸»è¿›ç¨‹ã€1ä¸ª GPU è¿›ç¨‹ã€1ä¸ªç½‘ç»œï¼ˆNetWorkï¼‰è¿›ç¨‹ã€å¤šä¸ªæ¸²æŸ“è¿›ç¨‹å’Œå¤šä¸ªæ’ä»¶è¿›ç¨‹ã€‚</p><blockquote><p>ä¸‹é¢æ¥é€ä¸ªåˆ†æä¸‹è¿™å‡ ä¸ªè¿›ç¨‹çš„åŠŸèƒ½ï¼š</p></blockquote><p><strong>Browseræµè§ˆå™¨è¿›ç¨‹</strong></p><p>ä¸»è¦è´Ÿè´£ç•Œé¢æ˜¾ç¤ºã€ç”¨æˆ·äº¤äº’ã€å­è¿›ç¨‹ç®¡ç†ï¼ŒåŒæ—¶æä¾›å­˜å‚¨ç­‰åŠŸèƒ½ã€‚</p><p><strong>æ¸²æŸ“è¿›ç¨‹</strong></p><p>æ ¸å¿ƒä»»åŠ¡æ˜¯å°† HTMLã€CSS å’Œ JS è½¬æ¢ä¸ºç”¨æˆ·å¯ä»¥ä¸ä¹‹äº¤äº’çš„ç½‘é¡µï¼Œæ’ç‰ˆå¼•æ“Blinkå’ŒJSå¼•æ“V8éƒ½æ˜¯è¿è¡Œåœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒChromeä¼šä¸ºæ¯ä¸ªTabæ ‡ç­¾åˆ›å»ºä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ¸²æŸ“è¿›ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨æ²™ç®±æ¨¡å¼ä¸‹ã€‚</p><p><strong>GPUè¿›ç¨‹</strong></p><p>Chromeåˆšå¼€å§‹å‘å¸ƒçš„æ—¶å€™æ˜¯æ²¡æœ‰GPUè¿›ç¨‹çš„ã€‚è€ŒGPUçš„ä½¿ç”¨åˆè¡·æ˜¯ä¸ºäº†å®ç°3D CSSçš„æ•ˆæœï¼Œåªæ˜¯éšåç½‘é¡µã€Chromeçš„UIç•Œé¢éƒ½é€‰æ‹©é‡‡ç”¨GPUæ¥ç»˜åˆ¶ï¼Œè¿™ä½¿å¾—GPUæˆä¸ºæµè§ˆå™¨æ™®éçš„éœ€æ±‚ã€‚æœ€åï¼ŒChromeåœ¨å…¶å¤šè¿›ç¨‹æ¶æ„ä¸Šä¹Ÿå¼•å…¥äº†GPUè¿›ç¨‹ã€‚</p><p><strong>NetWorkç½‘ç»œè¿›ç¨‹</strong></p><p>ä¸»è¦è´Ÿè´£é¡µé¢çš„ç½‘ç»œèµ„æºåŠ è½½ï¼Œä¹‹å‰æ˜¯ä½œä¸ºä¸€ä¸ªæ¨¡å—è¿è¡Œåœ¨æµè§ˆå™¨è¿›ç¨‹é‡Œé¢çš„ï¼Œç›´è‡³æœ€è¿‘æ‰ç‹¬ç«‹å‡ºæ¥ï¼Œæˆä¸ºä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ã€‚</p><p><strong>æ’ä»¶è¿›ç¨‹</strong></p><p>ä¸»è¦æ˜¯è´Ÿè´£æ’ä»¶çš„è¿è¡Œï¼Œå› æ’ä»¶æ˜“å´©æºƒï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡æ’ä»¶è¿›ç¨‹æ¥éš”ç¦»ï¼Œä»¥ä¿è¯æ’ä»¶è¿›ç¨‹å´©æºƒä¸ä¼šå¯¹æµè§ˆå™¨å’Œé¡µé¢é€ æˆå½±å“ã€‚</p><p>è®²åˆ°è¿™é‡Œï¼Œç°åœ¨åº”è¯¥å°±æ˜ç™½æ–‡ç« å¼€å¤´æåˆ°çš„é—®é¢˜äº†ï¼š</p><p><strong>ä»…ä»…æ‰“å¼€äº†1ä¸ªé¡µé¢ï¼Œä¸ºä»€ä¹ˆæœ‰4ä¸ªè¿›ç¨‹ï¼Ÿ</strong></p><p>å¼€1ä¸ªé¡µé¢è‡³å°‘éœ€è¦1ä¸ªç½‘ç»œè¿›ç¨‹ã€1ä¸ªæµè§ˆå™¨è¿›ç¨‹ã€1ä¸ªGPUè¿›ç¨‹ä»¥åŠ1ä¸ªæ¸²æŸ“è¿›ç¨‹ï¼Œå…±4ä¸ªï¼›å¦‚æœæ‰“å¼€çš„é¡µé¢æœ‰è¿è¡Œæ’ä»¶çš„è¯ï¼Œè¿˜éœ€è¦å†åŠ ä¸Š1ä¸ªæ’ä»¶è¿›ç¨‹ã€‚</p><h3 id="4-æ¸²æŸ“è¿›ç¨‹ä¸­çš„çº¿ç¨‹"><a href="#4-æ¸²æŸ“è¿›ç¨‹ä¸­çš„çº¿ç¨‹" class="headerlink" title="4. æ¸²æŸ“è¿›ç¨‹ä¸­çš„çº¿ç¨‹"></a>4. æ¸²æŸ“è¿›ç¨‹ä¸­çš„çº¿ç¨‹</h3><p>æˆ‘ä»¬å¹³æ—¶çœ‹åˆ°çš„æµè§ˆå™¨å‘ˆç°å‡ºé¡µé¢è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­å®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¸²æŸ“è¿›ç¨‹ä¸­çš„çº¿ç¨‹ã€‚</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310171854633.png" alt="img"></p><p><strong>GUIæ¸²æŸ“çº¿ç¨‹ï¼š</strong></p><ul><li>è´Ÿè´£æ¸²æŸ“æµè§ˆå™¨ç•Œé¢ï¼Œè§£æHTMLï¼ŒCSSï¼Œæ„å»ºDOMæ ‘å’ŒRenderObjectæ ‘ï¼Œå¸ƒå±€å’Œç»˜åˆ¶ç­‰ã€‚</li><li>å½“ç•Œé¢éœ€è¦é‡ç»˜ï¼ˆRepaintï¼‰æˆ–ç”±äºæŸç§æ“ä½œå¼•å‘å›æµ(reflow)æ—¶ï¼Œè¯¥çº¿ç¨‹å°±ä¼šæ‰§è¡Œ</li><li>æ³¨æ„ï¼ŒGUIæ¸²æŸ“çº¿ç¨‹ä¸JSå¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå½“JSå¼•æ“æ‰§è¡Œæ—¶GUIçº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ˆç›¸å½“äºè¢«å†»ç»“äº†ï¼‰ï¼ŒGUIæ›´æ–°ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰åˆ°JSå¼•æ“ç©ºé—²æ—¶&#x2F;æ‰§è¡Œå®Œæ—¶ç«‹å³è¢«æ‰§è¡Œã€‚</li></ul><p><strong>JSå¼•æ“çº¿ç¨‹ï¼š</strong></p><ul><li><p>ä¹Ÿç§°ä¸ºJSå†…æ ¸ï¼Œè´Ÿè´£å¤„ç†Javascriptè„šæœ¬ç¨‹åºã€‚å¦‚V8å¼•æ“</p></li><li><p>JSå¼•æ“çº¿ç¨‹è´Ÿè´£è§£æJavascriptè„šæœ¬ï¼Œè¿è¡Œä»£ç ã€‚</p></li><li><p>JSå¼•æ“ä¸€ç›´ç­‰å¾…ç€ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„åˆ°æ¥ï¼Œç„¶ååŠ ä»¥å¤„ç†ï¼Œä¸€ä¸ªTabé¡µï¼ˆrendererè¿›ç¨‹ï¼‰ä¸­æ— è®ºä»€ä¹ˆæ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªJSçº¿ç¨‹åœ¨è¿è¡ŒJSç¨‹åº</p></li><li><p>åŒæ ·æ³¨æ„ï¼ŒGUIæ¸²æŸ“çº¿ç¨‹ä¸JSå¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œæ‰€ä»¥å¦‚æœJSæ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œè¿™æ ·å°±ä¼šé€ æˆé¡µé¢çš„æ¸²æŸ“ä¸è¿è´¯ï¼Œå¯¼è‡´é¡µé¢æ¸²æŸ“åŠ è½½é˜»å¡ã€‚</p></li></ul><p><strong>äº‹ä»¶è§¦å‘çº¿ç¨‹</strong></p><ul><li>å½’å±äºæµè§ˆå™¨è€Œä¸æ˜¯JSå¼•æ“ï¼Œç”¨æ¥æ§åˆ¶äº‹ä»¶å¾ªç¯ï¼ˆå¯ä»¥ç†è§£ï¼ŒJSå¼•æ“è‡ªå·±éƒ½å¿™ä¸è¿‡æ¥ï¼Œéœ€è¦æµè§ˆå™¨å¦å¼€çº¿ç¨‹ååŠ©ï¼‰</li><li>å½“<code>js</code>ä»£ç åœ¨è§£ææ—¶ï¼Œé‡åˆ°äº‹ä»¶æ¯”å¦‚é¼ æ ‡äº‹ä»¶æ—¶ï¼Œä¼šå°†è¿™äº›ä»»åŠ¡æ·»åŠ åˆ°äº‹ä»¶è§¦å‘çº¿ç¨‹ä¸­</li><li>å½“å¯¹åº”çš„äº‹ä»¶ç¬¦åˆè§¦å‘æ¡ä»¶è¢«è§¦å‘æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šæŠŠäº‹ä»¶æ·»åŠ åˆ°å¾…å¤„ç†é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…JSå¼•æ“çš„å¤„ç†</li><li>æ³¨æ„ï¼Œç”±äºJSçš„å•çº¿ç¨‹å…³ç³»ï¼Œæ‰€ä»¥è¿™äº›å¾…å¤„ç†é˜Ÿåˆ—ä¸­çš„äº‹ä»¶éƒ½å¾—æ’é˜Ÿç­‰å¾…JSå¼•æ“å¤„ç†ï¼ˆå½“JSå¼•æ“ç©ºé—²æ—¶æ‰ä¼šå»æ‰§è¡Œï¼‰</li></ul><p><strong>å®šæ—¶è§¦å‘å™¨çº¿ç¨‹</strong></p><ul><li>æŒ‡setIntervalä¸setTimeoutæ‰€åœ¨çº¿ç¨‹</li><li>æµè§ˆå™¨å®šæ—¶è®¡æ•°å™¨å¹¶ä¸æ˜¯ç”±JavaScriptå¼•æ“è®¡æ•°çš„ï¼Œå› ä¸ºJSå¼•æ“æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å¦‚æœå¤„äºé˜»å¡çŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¼šå½±å“è®°è®¡æ—¶çš„å‡†ç¡®ï¼Œæ‰€ä»¥éœ€è¦å•ç‹¬çš„çº¿ç¨‹æ¥è´Ÿè´£è®¡æ—¶å™¨å·¥ä½œã€‚</li><li>è®¡æ—¶å®Œæ¯•åï¼Œæ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…JSå¼•æ“ç©ºé—²åæ‰§è¡Œã€‚</li><li>æ³¨æ„ï¼ŒW3Cåœ¨HTMLæ ‡å‡†ä¸­è§„å®šï¼Œè§„å®šè¦æ±‚setTimeoutä¸­ä½äº4msçš„æ—¶é—´é—´éš”ç®—ä¸º4msã€‚</li></ul><p><strong>å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ï¼š</strong></p><ul><li>XMLHttpRequestè¿æ¥åæµè§ˆå™¨å¼€çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚è¯·æ±‚æœ‰å›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥çº¿ç¨‹å°±ä¼šå°†å›è°ƒå‡½æ•°åŠ å…¥äº‹ä»¶é˜Ÿåˆ—ï¼Œç­‰å¾…JSå¼•æ“ç©ºé—²æ‰§è¡Œ</li><li>å°†æ£€æµ‹åˆ°çŠ¶æ€å˜æ›´æ—¶ï¼Œå¦‚æœè®¾ç½®æœ‰å›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥çº¿ç¨‹å°±äº§ç”ŸçŠ¶æ€å˜æ›´äº‹ä»¶ï¼Œå°†è¿™ä¸ªå›è°ƒå†æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚å†ç”±JavaScriptå¼•æ“æ‰§è¡Œã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æµè§ˆå™¨åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿›ç¨‹/çº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½ äº†è§£å‘å¸ƒ-è®¢é˜…æ¨¡å¼å—?</title>
    <link href="/2023/10/16/%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E5%90%97/"/>
    <url>/2023/10/16/%E4%BD%A0%E4%BA%86%E8%A7%A3%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E5%90%97/</url>
    
    <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><blockquote><p>åœ¨è½¯ä»¶æ¶æ„ä¸­ï¼Œå‘å¸ƒ&#x2F;è®¢é˜…ï¼ˆPublishâ€“subscribe patternï¼‰æ˜¯ä¸€ç§æ¶ˆæ¯èŒƒå¼ï¼Œæ¶ˆæ¯çš„å‘é€è€…ï¼ˆç§°ä¸ºå‘å¸ƒè€…ï¼‰ä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„æ¥æ”¶è€…ï¼ˆç§°ä¸ºè®¢é˜…è€…ï¼‰ã€‚è€Œæ˜¯å°†å‘å¸ƒçš„æ¶ˆæ¯åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œæ— éœ€äº†è§£å“ªäº›è®¢é˜…è€…ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å¯èƒ½å­˜åœ¨ã€‚åŒæ ·çš„ï¼Œè®¢é˜…è€…å¯ä»¥è¡¨è¾¾å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªç±»åˆ«çš„å…´è¶£ï¼Œåªæ¥æ”¶æ„Ÿå…´è¶£çš„æ¶ˆæ¯ï¼Œæ— éœ€äº†è§£å“ªäº›å‘å¸ƒè€…ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å­˜åœ¨ã€‚</p></blockquote><p>å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„å‘å¸ƒå’Œè®¢é˜…éƒ½ç”±ç»Ÿä¸€çš„ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒæ¥å¤„ç†ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ¨¡å¼å‘¢æ˜¯æœ‰ä¸‰éƒ¨åˆ†ç»„æˆçš„</p><ul><li>å‘å¸ƒè€…ï¼šå°†æ¶ˆæ¯äº‹ä»¶å‘å¸ƒåˆ°è°ƒåº¦ä¸­å¿ƒ</li><li>è®¢é˜…è€…ï¼š æŠŠè‡ªå·±æƒ³å…³æ³¨çš„æ¶ˆæ¯äº‹ä»¶ï¼Œæ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒ</li><li>è°ƒåº¦ä¸­å¿ƒï¼šå¤„ç†äº‹ä»¶æ³¨å†Œä¸å‘å¸ƒ</li></ul><blockquote><p>æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Œå°±æ˜¯åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­å®ç°æ›´æ¾çš„è§£è€¦</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310162023791.png" alt="img"></p><h3 id="ä¸è§‚å¯Ÿè€…æ¨¡å¼çš„åŒºåˆ«â—"><a href="#ä¸è§‚å¯Ÿè€…æ¨¡å¼çš„åŒºåˆ«â—" class="headerlink" title="ä¸è§‚å¯Ÿè€…æ¨¡å¼çš„åŒºåˆ«â—"></a>ä¸è§‚å¯Ÿè€…æ¨¡å¼çš„åŒºåˆ«â—</h3><ul><li><p><strong>å®ç°æ–¹å¼ï¼š</strong>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè§‚å¯Ÿè€…ï¼ˆObserverï¼‰é€šå¸¸ä¼šç›´æ¥è®¢é˜…ï¼ˆSubscribeï¼‰ä¸»é¢˜ï¼ˆSubjectï¼‰çš„æ›´æ–°ï¼Œè€Œä¸»é¢˜åˆ™ä¼šåœ¨çŠ¶æ€æ”¹å˜æ—¶ç›´æ¥è°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚è€Œåœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œå‘å¸ƒè€…ï¼ˆPublisherï¼‰å’Œè®¢é˜…è€…ï¼ˆSubscriberï¼‰é€šå¸¸ä¸ä¼šç›´æ¥äº¤äº’ï¼Œè€Œæ˜¯<strong>é€šè¿‡ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒï¼ˆMessage broker æˆ– Event busï¼‰æ¥è¿›è¡Œé€šä¿¡ã€‚</strong></p></li><li><p><strong>è€¦åˆæ€§ï¼š</strong>è§‚å¯Ÿè€…æ¨¡å¼ä¸­çš„è§‚å¯Ÿè€…å’Œä¸»é¢˜ä¹‹é—´çš„è€¦åˆæ€§ç›¸å¯¹è¾ƒé«˜ï¼Œå› ä¸ºè§‚å¯Ÿè€…éœ€è¦ç›´æ¥è®¢é˜…ä¸»é¢˜ã€‚è€Œåœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œç”±äºå¼•å…¥äº†è°ƒåº¦ä¸­å¿ƒï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„è€¦åˆæ€§è¾ƒä½ã€‚</p></li><li><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong>è§‚å¯Ÿè€…æ¨¡å¼é€šå¸¸ç”¨äºå¤„ç†è¾ƒä¸ºç®€å•çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚GUIä¸­çš„äº‹ä»¶å¤„ç†ç­‰ã€‚è€Œå‘å¸ƒè®¢é˜…æ¨¡å¼åˆ™æ›´é€‚åˆå¤„ç†å¤æ‚çš„å¼‚æ­¥å¤„ç†å’Œè·¨ç³»ç»Ÿé€šä¿¡ç­‰åœºæ™¯ï¼Œä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚</p></li></ul><p><strong><code>è§‚å¯Ÿè€…æ¨¡å¼ï¼šç›´æ¥å’Œå…¬å¸ç­¾</code></strong><br><strong><code>è®¢é˜…è€…æ¨¡å¼ï¼šç­¾å¤§å‚çš„å¤–åŒ…å…¬å¸</code></strong></p><h3 id="JSå®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#JSå®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="JSå®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>JSå®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><blockquote><p>å…ˆåˆ—ä¸¾ä¸‹éœ€è¦å®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„æ€è·¯ï¼Œç›®çš„å‘¢å°±æ˜¯å®ç°ä¸‰ä¸ªæ–¹æ³•ï¼Œæ·»åŠ ã€åˆ é™¤ã€æ´¾å‘</p></blockquote><p>ğŸ¾<strong>ç¬¬ä¸€æ­¥ï¼š</strong> å®ç°å‘å¸ƒè®¢é˜…æ¨¡å¼çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜å‚¨äº‹ä»¶åŠå…¶å¯¹åº”å›è°ƒå‡½æ•°çš„å®¹å™¨ã€‚åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ä½œä¸ºè¿™ä¸ªå®¹å™¨ã€‚æ¯ä¸ªäº‹ä»¶éƒ½æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨æ‰€æœ‰è®¢é˜…äº†è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</p><p>ğŸ¾<strong>ç¬¬äºŒæ­¥</strong>ï¼š ç¬¬äºŒæ­¥æ˜¯æ·»åŠ ä¸€ä¸ªåä¸ºsubscribeçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸ç›‘å¬å™¨è®¢é˜…ç‰¹å®šçš„äº‹ä»¶ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯äº‹ä»¶åï¼Œå¦ä¸€ä¸ªæ˜¯å½“äº‹ä»¶è¢«è§¦å‘æ—¶åº”è¯¥è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚</p><p>ğŸ¾<strong>ç¬¬ä¸‰æ­¥ï¼š</strong> ç¬¬ä¸‰æ­¥æ˜¯å®ç°å–æ¶ˆè®¢é˜…çš„åŠŸèƒ½ï¼šæ·»åŠ ä¸€ä¸ªåä¸ºunsubscribeçš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯äº‹ä»¶åï¼Œå¦ä¸€ä¸ªæ˜¯è¦å–æ¶ˆè®¢é˜…çš„å›è°ƒå‡½æ•°ã€‚</p><p>ğŸ¾<strong>ç¬¬å››æ­¥ï¼š</strong> ç¬¬å››æ­¥æ˜¯å®ç°äº‹ä»¶å‘å¸ƒçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªåä¸ºpublishçš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯äº‹ä»¶åï¼Œå¦ä¸€ä¸ªæ˜¯å½“äº‹ä»¶è¢«è§¦å‘æ—¶åº”è¯¥ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„æ•°æ®ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PubSub</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = &#123;&#125;;<br>  &#125;<br><br>  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">event, callback</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event] = [];<br>    &#125;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">push</span>(callback);<br>  &#125;<br><br>  <span class="hljs-title function_">unsubscribe</span>(<span class="hljs-params">event, callback</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;äº‹ä»¶æ— æ•ˆ&#x27;</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cb !== callback);<br>  &#125;<br><br>  <span class="hljs-title function_">publish</span>(<span class="hljs-params">event, data</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;è¯¥äº‹ä»¶æœªæ³¨å†Œ&#x27;</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(...data));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ğŸ¾ä½¿ç”¨ç¤ºä¾‹ï¼š è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªåŸºæœ¬çš„å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸‹é¢å±•ç¤ºä¸€ä¸‹å®ƒçš„å…·ä½“ä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„PubSubå®ä¾‹</span><br><span class="hljs-keyword">const</span> pubsub = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PubSub</span>();<br><br><span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªå›è°ƒå‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">callback1</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªå›è°ƒ: &#x27;</span> + data);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">callback2</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;è¿™é‡Œæ˜¯ç¬¬äºŒä¸ªå›è°ƒ: &#x27;</span> + data);<br>&#125;<br><br><span class="hljs-comment">// è®¢é˜…ä¸€ä¸ªäº‹ä»¶</span><br>pubsub.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, callback1);<br>pubsub.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, callback2);<br><br><span class="hljs-comment">// è¾“å‡ºä¸¤ä¸ªå›è°ƒå‡½æ•°çš„ console</span><br>pubsub.<span class="hljs-title function_">publish</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, <span class="hljs-string">&#x27;Hello, world!&#x27;</span>); <br><br><span class="hljs-comment">// å–æ¶ˆè®¢é˜… callback1</span><br>pubsub.<span class="hljs-title function_">unsubscribe</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, callback1);<br><br><span class="hljs-comment">// callback1 çš„è®¢é˜…è¢«å–æ¶ˆäº†ï¼Œä»…æ‰“å° callback2 çš„ console</span><br>pubsub.<span class="hljs-title function_">publish</span>(<span class="hljs-string">&#x27;myEvent&#x27;</span>, <span class="hljs-string">&#x27;Hello, world!&#x27;</span>); <br></code></pre></td></tr></table></figure><h3 id="é”™è¯¯å¤„ç†ä¸åŠŸèƒ½ä¼˜åŒ–"><a href="#é”™è¯¯å¤„ç†ä¸åŠŸèƒ½ä¼˜åŒ–" class="headerlink" title="é”™è¯¯å¤„ç†ä¸åŠŸèƒ½ä¼˜åŒ–"></a>é”™è¯¯å¤„ç†ä¸åŠŸèƒ½ä¼˜åŒ–</h3><p>é¦–å…ˆæ˜¯ç±»å‹åˆ¤æ–­ä¸é”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬åº”å½“æ£€æŸ¥å‚æ•°çš„ç±»å‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PubSub</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = &#123;&#125;;<br>  &#125;<br><br>  <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">event, callback</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Event name must be a string&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Callback must be a function&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event] = [];<br>    &#125;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">push</span>(callback);<br>  &#125;<br><br>  <span class="hljs-title function_">unsubscribe</span>(<span class="hljs-params">event, callback</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Event name must be a string&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Callback must be a function&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cb !== callback);<br>  &#125;<br><br>  <span class="hljs-title function_">publish</span>(<span class="hljs-params">event, data</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Event name must be a string&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(data));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¼€å‘ä¸­æˆ‘ä»¬ä¼šé‡åˆ°ä¸€äº›ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œä¸ä¼šè¢«è§¦å‘ç¬¬äºŒæ¬¡äº†ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªå‚æ•°æ¥çœå»æ‰‹åŠ¨æ¸…é™¤äº‹ä»¶çš„è´Ÿæ‹…ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">publish</span>(<span class="hljs-params">event, data, once = <span class="hljs-literal">false</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Event name must be a string&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event]) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(data));<br>  <span class="hljs-keyword">if</span>(once) <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[event];<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªå›è°ƒå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶è®¢é˜…äº†ç›¸åŒçš„äº‹ä»¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´<strong>æ— é™å¾ªç¯</strong>ã€‚è¿™æ˜¯å› ä¸º<code>publish</code>æ–¹æ³•ä¼šç«‹å³è°ƒç”¨æ‰€æœ‰çš„å›è°ƒå‡½æ•°ï¼Œè€Œè¿™äº›å›è°ƒå‡½æ•°å¯èƒ½ä¼šæ”¹å˜ç›‘å¬å™¨åˆ—è¡¨ã€‚<br>ä¸Šé¢çš„ä»£ç å¹¶æ²¡æœ‰è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä½†æµ‹è¯•åå‘ç°å¹¶ä¸ä¼šå‘ç”Ÿæ— é™å¾ªç¯çš„æƒ…å†µï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿé—®é¢˜å‡ºåœ¨ for å’Œ forEach ä¸­ï¼Œ<strong>forEach æ–¹æ³•åœ¨å¼€å§‹å¾ªç¯æ—¶å°±å·²ç»ç¡®å®šäº†å¾ªç¯çš„æ¬¡æ•°ï¼Œæ‰€ä»¥ï¼Œå³ä½¿åœ¨å›è°ƒå‡½æ•°ä¸­æ·»åŠ æˆ–åˆ é™¤äº†å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå½±å“forEachçš„å¾ªç¯æ¬¡æ•°ï¼›</strong>è€Œ <strong>for å¾ªç¯ä¼šå®æ—¶æ£€æŸ¥</strong>æ•°ç»„çš„é•¿åº¦ï¼Œæ•…è€Œä¼šå‡ºç°ä¸Šè¿°çš„æƒ…å†µã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼ºåˆ¶ç¼“å­˜å’Œåå•†ç¼“å­˜?</title>
    <link href="/2023/10/07/%E5%BC%BA%E5%88%B6%E7%BC%93%E5%AD%98%E5%92%8C%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98/"/>
    <url>/2023/10/07/%E5%BC%BA%E5%88%B6%E7%BC%93%E5%AD%98%E5%92%8C%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ <a href="https://juejin.cn/post/7127194919235485733?searchId=2023100709440962FECF52597D2C3CBEA0#heading-4">ä¸­é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆéƒ½éœ€è¦ç†Ÿæ‚‰çš„æŠ€èƒ½â€“å‰ç«¯ç¼“å­˜ - æ˜é‡‘</a></p></blockquote><p>HTTP ç¼“å­˜å¯ä»¥åˆ†ä¸ºåå•†ç¼“å­˜å’Œå¼ºåˆ¶ç¼“å­˜ä¸¤ç§ç±»å‹ã€‚</p><blockquote><p>å¼ºç¼“å­˜</p></blockquote><p>å¼ºåˆ¶ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨åœ¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¸ä¼šå‘é€ä»»ä½•è¯·æ±‚å¤´ï¼Œç›´æ¥ä»æœ¬åœ°ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œä»â½½æâ¾¼å“åº”é€Ÿåº¦,  åªè¦æµè§ˆå™¨åˆ¤æ–­ç¼“å­˜æ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥ä½¿ç”¨æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ï¼Œå†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„ä¸»åŠ¨æ€§åœ¨äºæµè§ˆå™¨è¿™è¾¹ã€‚</p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310171848158.png" alt="img" style="zoom:50%;" /><blockquote><p>åå•†ç¼“å­˜</p></blockquote><ul><li>åå•†ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨åœ¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šå‘é€â¼€äº›è¯·æ±‚å¤´åˆ°æœåŠ¡å™¨ï¼Œè¯¢é—®æœåŠ¡å™¨èµ„æºæ˜¯å¦å·²ç»å‘â½£æ”¹å˜ã€‚å¦‚æœèµ„æºæœªå‘â½£æ”¹å˜ï¼ŒæœåŠ¡å™¨å°†è¿”å› 304 çŠ¶æ€ç ï¼Œå‘Šè¯‰æµè§ˆå™¨å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œä»â½½å‡å°‘äº†â½¹ç»œå¸¦å®½çš„ä½¿â½¤ã€‚å¼ºåˆ¶ç¼“å­˜å¤±æ•ˆä¹‹åï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ç›¸åº”çš„ç¼“å­˜å­—æ®µæ¥å‘æœåŠ¡å™¨å‘è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå­—æ®µï¼Œæ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œè¿™å°±æ˜¯åå•†ç¼“å­˜ã€‚</li></ul><h3 id="1-åŸºäº-Expires-å­—æ®µå®ç°çš„å¼ºç¼“å­˜"><a href="#1-åŸºäº-Expires-å­—æ®µå®ç°çš„å¼ºç¼“å­˜" class="headerlink" title="1. åŸºäº Expires å­—æ®µå®ç°çš„å¼ºç¼“å­˜"></a>1. åŸºäº Expires å­—æ®µå®ç°çš„å¼ºç¼“å­˜</h3><p>ä½¿ç”¨å“åº”å¤´çš„<code>Expires</code>å­—æ®µå»å®ç°å¼ºç¼“å­˜</p><p><code>Expires</code> å¤´éƒ¨ï¼šæŒ‡å®šèµ„æºè¿‡æœŸçš„æ—¶é—´ï¼Œå¦‚æœåœ¨è¿‡æœŸæ—¶é—´ä¹‹å‰å†æ¬¡è¯·æ±‚è¯¥èµ„æºï¼Œæµè§ˆå™¨å°†ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–èµ„æºã€‚</p><p>æ¯”å¦‚è¯´å°†æŸä¸€èµ„æºè®¾ç½®å“åº”å¤´ä¸º:<code>Expires:new Date(&quot;2022-7-30 23:59:59&quot;)</code>ï¼›</p><p>é‚£ä¹ˆï¼Œè¯¥èµ„æºåœ¨2022-7-30 23:59:59 ä¹‹å‰ï¼Œéƒ½ä¼šå»æœ¬åœ°çš„ç£ç›˜ï¼ˆæˆ–å†…å­˜ï¼‰ä¸­è¯»å–ï¼Œä¸ä¼šå»æœåŠ¡å™¨è¯·æ±‚ã€‚</p><blockquote><p>Expiresåˆ¤æ–­å¼ºç¼“å­˜æ˜¯å¦è¿‡æœŸçš„æœºåˆ¶æ˜¯: è·å–æœ¬åœ°æ—¶é—´æˆ³ï¼Œå¹¶å¯¹å…ˆå‰æ‹¿åˆ°çš„èµ„æºæ–‡ä»¶ä¸­çš„Expireså­—æ®µçš„æ—¶é—´åšæ¯”è¾ƒ, ä½†æ˜¯Expires<strong>è¿‡åº¦ä¾èµ–æœ¬åœ°æ—¶é—´</strong>ï¼Œå¦‚æœæœ¬åœ°ä¸æœåŠ¡å™¨æ—¶é—´ä¸åŒæ­¥ï¼Œå°±ä¼šå‡ºç°èµ„æºæ— æ³•è¢«ç¼“å­˜æˆ–è€…èµ„æºæ°¸è¿œè¢«ç¼“å­˜çš„æƒ…å†µã€‚</p></blockquote><h3 id="2-åŸºäº-Cache-control-å®ç°çš„å¼ºç¼“å­˜"><a href="#2-åŸºäº-Cache-control-å®ç°çš„å¼ºç¼“å­˜" class="headerlink" title="2. åŸºäº Cache-control å®ç°çš„å¼ºç¼“å­˜"></a>2. åŸºäº Cache-control å®ç°çš„å¼ºç¼“å­˜</h3><p><code>Cache-Control</code> å¤´éƒ¨ï¼šå¯ä»¥æŒ‡å®šèµ„æºçš„ç¼“å­˜ç­–ç•¥ï¼ŒåŒ…æ‹¬ max-age,  publicã€privateã€no-cache ç­‰ï¼Œæ§åˆ¶æµè§ˆå™¨çš„ç¼“å­˜â¾ä¸ºã€‚</p><p>é€šè¿‡åœ¨èµ„æºçš„å“åº”å¤´ä¸­è®¾ç½® <code>Cache-Control:max-age=N</code>ï¼ŒNå°±æ˜¯éœ€è¦ç¼“å­˜çš„ç§’æ•°ã€‚</p><p>é‚£ä¹ˆ,  ä»ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºçš„æ—¶å€™å¼€å§‹ï¼Œå¾€åNç§’å†…ï¼Œèµ„æºè‹¥å†æ¬¡è¯·æ±‚ï¼Œåˆ™ç›´æ¥ä»ç£ç›˜ï¼ˆæˆ–å†…å­˜ä¸­è¯»å–ï¼‰ï¼Œä¸ä¸æœåŠ¡å™¨åšä»»ä½•äº¤äº’ã€‚</p><blockquote><p>Cache-controlä¸­å› ä¸ºmax-ageåé¢çš„å€¼æ˜¯ä¸€ä¸ªæ»‘åŠ¨æ—¶é—´ï¼Œä»æœåŠ¡å™¨ç¬¬ä¸€æ¬¡è¿”å›è¯¥èµ„æºæ—¶å¼€å§‹å€’è®¡æ—¶ã€‚æ‰€ä»¥ä¹Ÿå°±ä¸éœ€è¦æ¯”å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ—¶é—´ï¼Œè§£å†³äº†Expiresæ‰€å­˜åœ¨çš„å·¨å¤§æ¼æ´ã€‚</p></blockquote><h3 id="3-åŸºäº-lasted-modified-å®ç°çš„åå•†ç¼“å­˜"><a href="#3-åŸºäº-lasted-modified-å®ç°çš„åå•†ç¼“å­˜" class="headerlink" title="3. åŸºäº lasted-modified å®ç°çš„åå•†ç¼“å­˜"></a>3. åŸºäº lasted-modified å®ç°çš„åå•†ç¼“å­˜</h3><ol><li>æµè§ˆå™¨åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚èµ„æºæ—¶ï¼Œåœ¨æœåŠ¡å™¨ç«¯è¯»å‡ºæ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œå°†è¯»å‡ºæ¥çš„ä¿®æ”¹æ—¶é—´èµ‹ç»™å“åº”å¤´çš„<code>last-modified</code>å­—æ®µã€‚ç„¶åè®¾ç½®<code>Cache-control:no-cache(è·³è¿‡å¼ºç¼“å­˜æ ¡éªŒï¼Œç›´æ¥è¿›è¡Œåå•†ç¼“å­˜)</code>. </li><li>å½“å®¢æˆ·ç«¯è¯»å–åˆ°<code>last-modified</code>çš„æ—¶å€™ï¼Œä¼šåœ¨ä¸‹æ¬¡çš„è¯·æ±‚æ ‡å¤´ä¸­æºå¸¦ä¸€ä¸ªå­—æ®µ<code>If-Modified-Since(è¿™ä¸ªè¯·æ±‚å¤´ä¸­çš„If-Modified-Sinceå°±æ˜¯ä¸Šä¸€æ¬¡è¯·æ±‚è®¾ç½®åœ¨å“åº”å¤´ä¸­çš„ last-modified)</code>ã€‚  </li><li>å½“å†æ¬¡è¯·æ±‚èµ„æºæ—¶, æœåŠ¡ç«¯éœ€è¦æ‹¿åˆ°è¯·æ±‚å¤´ä¸­çš„ <code>If-Modified-Since</code> è¿™ä¸ªæ—¶é—´å¹¶å†æ¬¡è¯»å–è¯¥èµ„æºçš„ä¿®æ”¹æ—¶é—´, è®©ä»–ä»¬ä¸¤ä¸ªåšä¸€ä¸ªæ¯”å¯¹æ¥å†³å®šæ˜¯è¯»å–ç¼“å­˜è¿˜æ˜¯è¿”å›æ–°çš„èµ„æºã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿”å› 304 çŠ¶æ€ç å¹¶è¯»å–ç¼“å­˜ï¼Œå¦åˆ™è¿”å›æ–°çš„èµ„æºå¹¶å°†èµ„æºä¿®æ”¹æ—¶é—´èµ‹å€¼ç»™å“åº”å¤´çš„<code>last-modified</code> å­—æ®µã€‚</li></ol><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310071059690.png" alt="img"></p><p>ä½¿ç”¨ä»¥ä¸Šæ–¹å¼çš„åå•†ç¼“å­˜å­˜åœ¨ä¸¤ä¸ªéå¸¸æ˜æ˜¾çš„æ¼æ´ã€‚è¿™ä¸¤ä¸ªæ¼æ´éƒ½æ˜¯åŸºäºæ–‡ä»¶æ˜¯é€šè¿‡æ¯”è¾ƒä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦æ›´æ”¹è€Œäº§ç”Ÿçš„ã€‚</p><ol><li>å› ä¸ºæ˜¯æ›´å…·æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨æ–‡ä»¶å†…å®¹æœ¬èº«ä¸ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶æœ‰å¯èƒ½æ›´æ–°æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼ˆæ¯”å¦‚ä¿®æ”¹æ–‡ä»¶åå†æ”¹å›æ¥ï¼‰ï¼Œè¿™æ ·ï¼Œå°±æœ‰å¯èƒ½æ–‡ä»¶å†…å®¹æ˜æ˜æ²¡æœ‰ä¿®æ”¹ï¼Œä½†æ˜¯ç¼“å­˜ä¾ç„¶å¤±æ•ˆäº†ã€‚</li><li>å½“æ–‡ä»¶åœ¨æçŸ­æ—¶é—´å†…å®Œæˆä¿®æ”¹çš„æ—¶å€™ï¼ˆæ¯”å¦‚å‡ ç™¾æ¯«ç§’ï¼‰ã€‚å› ä¸ºæ–‡ä»¶ä¿®æ”¹æ—¶é—´è®°å½•çš„æœ€å°å•ä½æ˜¯ç§’ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ–‡ä»¶åœ¨å‡ ç™¾æ¯«ç§’å†…å®Œæˆä¿®æ”¹çš„è¯ï¼Œæ–‡ä»¶ä¿®æ”¹æ—¶é—´ä¸ä¼šæ”¹å˜ï¼Œè¿™æ ·ï¼Œå³ä½¿æ–‡ä»¶å†…å®¹ä¿®æ”¹äº†ï¼Œä¾ç„¶ä¸ä¼šè¿”å›æ–°çš„æ–‡ä»¶ã€‚</li></ol><blockquote><p>ä¸ºäº†è§£å†³ä¸Šè¿°çš„è¿™ä¸¤ä¸ªé—®é¢˜ã€‚ä»http1.1å¼€å§‹æ–°å¢äº†ä¸€ä¸ªå¤´ä¿¡æ¯ï¼ŒETag(Entity å®ä½“æ ‡ç­¾)</p></blockquote><h3 id="4-åŸºäº-ETag-å®ç°çš„åå•†ç¼“å­˜"><a href="#4-åŸºäº-ETag-å®ç°çš„åå•†ç¼“å­˜" class="headerlink" title="4. åŸºäº ETag å®ç°çš„åå•†ç¼“å­˜"></a>4. åŸºäº ETag å®ç°çš„åå•†ç¼“å­˜</h3><ol><li>ç¬¬ä¸€æ¬¡è¯·æ±‚æŸèµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¯»å–æ–‡ä»¶å¹¶è®¡ç®—å‡ºæ–‡ä»¶æŒ‡çº¹ï¼Œå°†æ–‡ä»¶æŒ‡çº¹æ”¾åœ¨å“åº”å¤´çš„<code>etag</code>å­—æ®µä¸­è·Ÿèµ„æºä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>ç¬¬äºŒæ¬¡è¯·æ±‚æŸèµ„æºçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨ä»ç¼“å­˜ä¸­è¯»å–å‡ºä¸Šä¸€æ¬¡æœåŠ¡ç«¯è¿”å›çš„<code>ETag</code>ä¹Ÿå°±æ˜¯æ–‡ä»¶æŒ‡çº¹ã€‚å¹¶èµ‹ç»™è¯·æ±‚å¤´çš„<code>if-None-Match</code>å­—æ®µï¼Œè®©ä¸Šä¸€æ¬¡çš„æ–‡ä»¶æŒ‡çº¹è·Ÿéšè¯·æ±‚ä¸€èµ·å›åˆ°æœåŠ¡ç«¯ã€‚</li><li>æœåŠ¡ç«¯æ‹¿åˆ°è¯·æ±‚å¤´ä¸­çš„<code>if-None-Match</code>å­—æ®µå€¼ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¸€æ¬¡çš„æ–‡ä»¶æŒ‡çº¹ï¼‰ï¼Œå¹¶å†æ¬¡è¯»å–ç›®æ ‡èµ„æºå¹¶ç”Ÿæˆæ–‡ä»¶æŒ‡çº¹ï¼Œä¸¤ä¸ªæŒ‡çº¹åšå¯¹æ¯”ã€‚å¦‚æœä¸¤ä¸ªæ–‡ä»¶æŒ‡çº¹å®Œå…¨å»åˆï¼Œè¯´æ˜æ–‡ä»¶æ²¡æœ‰è¢«æ”¹å˜ï¼Œåˆ™ç›´æ¥è¿”å›304çŠ¶æ€ç å’Œä¸€ä¸ªç©ºçš„å“åº”ä½“å¹¶<code>return</code>(è¿™ä¸ªæ—¶å€™å·²ç»è¯»å–äº†ç¼“å­˜)ã€‚å¦‚æœä¸¤ä¸ªæ–‡ä»¶æŒ‡çº¹ä¸å»åˆï¼Œåˆ™è¯´æ˜æ–‡ä»¶è¢«æ›´æ”¹ï¼Œé‚£ä¹ˆè¿”å›æ–°çš„èµ„æºå¹¶å°†æ–°çš„æ–‡ä»¶æŒ‡çº¹é‡æ–°å­˜å‚¨åˆ°å“åº”å¤´çš„<code>ETag</code>å­—æ®µ</li></ol><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202310071059655.png" alt="img"></p><blockquote><p> ETag çš„ç¼ºç‚¹</p></blockquote><ol><li>ETagéœ€è¦è®¡ç®—æ–‡ä»¶æŒ‡çº¹è¿™æ ·æ„å‘³ç€ï¼ŒæœåŠ¡ç«¯éœ€è¦æ›´å¤šçš„è®¡ç®—å¼€é”€ã€‚ã€‚å¦‚æœæ–‡ä»¶å°ºå¯¸å¤§ï¼Œæ•°é‡å¤šï¼Œå¹¶ä¸”è®¡ç®—é¢‘ç¹ï¼Œé‚£ä¹ˆETagçš„è®¡ç®—å°±ä¼šå½±å“æœåŠ¡å™¨çš„æ€§èƒ½ã€‚æ˜¾ç„¶ï¼ŒETagåœ¨è¿™æ ·çš„åœºæ™¯ä¸‹å°±ä¸æ˜¯å¾ˆé€‚åˆã€‚</li><li>ETagæœ‰å¼ºéªŒè¯å’Œå¼±éªŒè¯ï¼Œæ‰€è°“å°†å¼ºéªŒè¯ï¼ŒETagç”Ÿæˆçš„å“ˆå¸Œç æ·±å…¥åˆ°æ¯ä¸ªå­—èŠ‚ã€‚å“ªæ€•æ–‡ä»¶ä¸­åªæœ‰ä¸€ä¸ªå­—èŠ‚æ”¹å˜äº†ï¼Œä¹Ÿä¼šç”Ÿæˆä¸åŒçš„å“ˆå¸Œå€¼ï¼Œå®ƒå¯ä»¥ä¿è¯æ–‡ä»¶å†…å®¹ç»å¯¹çš„ä¸å˜ã€‚ä½†æ˜¯ï¼Œå¼ºéªŒè¯éå¸¸æ¶ˆè€—è®¡ç®—é‡ã€‚ETagè¿˜æœ‰ä¸€ä¸ªå¼±éªŒè¯ï¼Œå¼±éªŒè¯æ˜¯æå–æ–‡ä»¶çš„éƒ¨åˆ†å±æ€§æ¥ç”Ÿæˆå“ˆå¸Œå€¼ã€‚å› ä¸ºä¸å¿…ç²¾ç¡®åˆ°æ¯ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä»–çš„æ•´ä½“é€Ÿåº¦ä¼šæ¯”å¼ºéªŒè¯å¿«ï¼Œä½†æ˜¯å‡†ç¡®ç‡ä¸é«˜ã€‚ä¼šé™ä½åå•†ç¼“å­˜çš„æœ‰æ•ˆæ€§ã€‚</li></ol><h3 id="5-ç¼“å­˜ä½ç½®"><a href="#5-ç¼“å­˜ä½ç½®" class="headerlink" title="5. ç¼“å­˜ä½ç½®"></a>5. ç¼“å­˜ä½ç½®</h3><p>å½“å¼ºç¼“å­˜å‘½ä¸­æˆ–è€…<code>åå•†ç¼“å­˜</code>ä¸­æœåŠ¡å™¨è¿”å›304çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥ä»ç¼“å­˜ä¸­è·å–èµ„æºã€‚é‚£è¿™äº›èµ„æºç©¶ç«Ÿç¼“å­˜åœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿ</p><p>æµè§ˆå™¨ä¸­çš„ç¼“å­˜ä½ç½®ä¸€å…±æœ‰å››ç§ï¼ŒæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ’åˆ—åˆ†åˆ«æ˜¯ï¼š</p><ul><li>Service Worker</li><li>Memory Cache</li><li>Disk Cache</li><li>Push Cache</li></ul><blockquote><p>Service Worker</p></blockquote><p>Service Worker å€Ÿé‰´äº† Web Workerçš„ æ€è·¯ï¼Œå³è®© JS è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œç”±äºå®ƒè„±ç¦»äº†æµè§ˆå™¨çš„çª—ä½“ï¼Œå› æ­¤æ— æ³•ç›´æ¥è®¿é—®DOMã€‚è™½ç„¶å¦‚æ­¤ï¼Œä½†å®ƒä»ç„¶èƒ½å¸®åŠ©æˆ‘ä»¬å®Œæˆå¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç¦»çº¿ç¼“å­˜ã€æ¶ˆæ¯æ¨é€å’Œç½‘ç»œä»£ç†ç­‰åŠŸèƒ½ã€‚å…¶ä¸­çš„ç¦»çº¿ç¼“å­˜å°±æ˜¯ <strong>Service Worker Cache</strong>ã€‚</p><blockquote><p> Memory Cache å’Œ Disk Cache</p></blockquote><p><strong>Memory Cache</strong>æŒ‡çš„æ˜¯å†…å­˜ç¼“å­˜ï¼Œä»æ•ˆç‡ä¸Šè®²å®ƒæ˜¯æœ€å¿«çš„ã€‚ä½†æ˜¯ä»å­˜æ´»æ—¶é—´æ¥è®²åˆæ˜¯æœ€çŸ­çš„ï¼Œå½“æ¸²æŸ“è¿›ç¨‹ç»“æŸåï¼Œå†…å­˜ç¼“å­˜ä¹Ÿå°±ä¸å­˜åœ¨äº†ã€‚</p><p><strong>Disk Cache</strong>å°±æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ç¼“å­˜ï¼Œä»å­˜å–æ•ˆç‡ä¸Šè®²æ˜¯æ¯”å†…å­˜ç¼“å­˜æ…¢çš„ï¼Œä½†æ˜¯ä»–çš„ä¼˜åŠ¿åœ¨äºå­˜å‚¨å®¹é‡å’Œå­˜å‚¨æ—¶é•¿ã€‚ç¨å¾®æœ‰äº›è®¡ç®—æœºåŸºç¡€çš„åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œå°±ä¸å±•å¼€äº†ã€‚</p><p>å¥½ï¼Œç°åœ¨é—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œé‚£æµè§ˆå™¨å¦‚ä½•å†³å®šå°†èµ„æºæ”¾è¿›å†…å­˜è¿˜æ˜¯ç¡¬ç›˜å‘¢ï¼Ÿä¸»è¦ç­–ç•¥å¦‚ä¸‹ï¼š</p><ul><li>æ¯”è¾ƒå¤§çš„JSã€CSSæ–‡ä»¶ä¼šç›´æ¥è¢«ä¸¢è¿›ç£ç›˜ï¼Œåä¹‹ä¸¢è¿›å†…å­˜</li><li>å†…å­˜ä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¼˜å…ˆè¿›å…¥ç£ç›˜</li></ul><blockquote><p>Push Cache</p></blockquote><p>å³æ¨é€ç¼“å­˜ï¼Œè¿™æ˜¯æµè§ˆå™¨ç¼“å­˜çš„æœ€åä¸€é“é˜²çº¿ã€‚å®ƒæ˜¯ HTTP&#x2F;2 ä¸­çš„å†…å®¹ï¼Œè™½ç„¶ç°åœ¨åº”ç”¨çš„å¹¶ä¸å¹¿æ³›ï¼Œä½†éšç€ HTTP&#x2F;2 çš„æ¨å¹¿ï¼Œå®ƒçš„åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ã€‚</p><h3 id="6-æ€»ç»“ä¸€ä¸‹"><a href="#6-æ€»ç»“ä¸€ä¸‹" class="headerlink" title="6. æ€»ç»“ä¸€ä¸‹"></a>6. æ€»ç»“ä¸€ä¸‹</h3><ul><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåå•†ç¼“å­˜è™½ç„¶å¯ä»¥å‡å°‘â½¹ç»œå¸¦å®½çš„ä½¿â½¤ï¼Œä½†æ˜¯éœ€è¦æœåŠ¡å™¨è¿›â¾èµ„æºâ½è¾ƒï¼Œä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½</li><li>å…³äºå¼ºç¼“å­˜ï¼Œcache-controlæ˜¯Expiresçš„å®Œå…¨æ›¿ä»£æ–¹æ¡ˆï¼Œåœ¨å¯ä»¥ä½¿ç”¨cache-controlçš„æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨expires</li><li>å…³äºåå•†ç¼“å­˜,etagå¹¶ä¸æ˜¯last-modifiedçš„å®Œå…¨æ›¿ä»£æ–¹æ¡ˆï¼Œè€Œæ˜¯è¡¥å……æ–¹æ¡ˆï¼Œå…·ä½“ç”¨å“ªä¸€ä¸ªï¼Œå–å†³äºä¸šåŠ¡åœºæ™¯ã€‚</li><li>æœ‰å“ˆå¸Œå€¼çš„æ–‡ä»¶è®¾ç½®å¼ºç¼“å­˜å³å¯ã€‚æ²¡æœ‰å“ˆå¸Œå€¼çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚index.htmlï¼‰è®¾ç½®åå•†ç¼“å­˜</li><li>æœ‰äº›ç¼“å­˜æ˜¯ä»ç£ç›˜è¯»å–ï¼Œæœ‰äº›ç¼“å­˜æ˜¯ä»å†…å­˜è¯»å–ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç­”ï¼šä»å†…å­˜è¯»å–çš„ç¼“å­˜æ›´å¿«ã€‚</li><li>æ‰€æœ‰å¸¦304çš„èµ„æºéƒ½æ˜¯åå•†ç¼“å­˜ï¼Œæ‰€æœ‰æ ‡æ³¨ï¼ˆä»å†…å­˜ä¸­è¯»å–&#x2F;ä»ç£ç›˜ä¸­è¯»å–ï¼‰çš„èµ„æºéƒ½æ˜¯å¼ºç¼“å­˜ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æµè§ˆå™¨åŸç†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æµè§ˆå™¨ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kmpç®—æ³•(JSç‰ˆ)</title>
    <link href="/2023/09/30/kmp%E7%AE%97%E6%B3%95(JS%E7%89%88)/"/>
    <url>/2023/09/30/kmp%E7%AE%97%E6%B3%95(JS%E7%89%88)/</url>
    
    <content type="html"><![CDATA[<h2 id="KMP"><a href="#KMP" class="headerlink" title="KMP"></a>KMP</h2><p>KMPæ˜¯ä¸€ç§é«˜æ•ˆçš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œç”¨æ¥åœ¨ä¸»å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾æ¨¡å¼å­—ç¬¦ä¸²çš„ä½ç½®</p><blockquote><p>æ¯”å¦‚åœ¨â€œhello,worldâ€ä¸»ä¸²ä¸­æŸ¥æ‰¾â€œworldâ€æ¨¡å¼ä¸²çš„ä½ç½®)ã€‚</p></blockquote><h5 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h5><blockquote><p>åœ¨å¤±é…æ—¶,  å°†æ¨¡æ¿å­—ç¬¦ä¸²å¤±é…å­—ç¬¦çš„ä¸‹æ ‡é€€å›åˆ°å‰é¢ç›¸åº”ä½ç½® ï¼Œè¿™æ ·å°±å¯ä»¥è·³è¿‡å¤§å¤šæ•°çš„å¤±é…æ­¥éª¤ã€‚è€Œæ¯æ¬¡pä¸²ç§»åŠ¨çš„æ­¥æ•°å°±æ˜¯é€šè¿‡æŸ¥æ‰¾next[ ]æ•°ç»„ç¡®å®šçš„ã€‚æ¯”å¦‚ : </p><p>çˆ¶äº²å­—ç¬¦ä¸² :  aabaabaaf</p><p>æ¨¡æ¿å­—ç¬¦ä¸² :  aabaaf</p><p>å½“æ¨¡æ¿å­—ç¬¦ä¸²çš„<code>f</code>ä¸åŒ¹é…çˆ¶å­—ç¬¦ä¸²çš„<code>b</code> æ—¶, æ¨¡æ¿å­—ç¬¦ä¸²ä¸­å­—ç¬¦<code>f</code> å¯¹åº”çš„ä¸‹æ ‡<code>j</code>å°±ä¼šé€€å›åˆ°åŒ…æ‹¬å‰5ä¸ªå­—ç¬¦ç»„æˆçš„å­ä¸²çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦, ä¹Ÿå°±æ˜¯2, äºæ˜¯é€€å›åˆ°ä¸‹æ ‡ä¸º2çš„ä½ç½®, ä»æ¨¡æ¿å­—ç¬¦ä¸²çš„<code>b</code>å­—ç¬¦ç»§ç»­å¼€å§‹å’Œçˆ¶å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…, è‡³å§‹è‡³ç»ˆçˆ¶å­—ç¬¦ä¸²çš„åŒ¹é…ä¸‹æ ‡éƒ½æœªç§»åŠ¨å“¦~</p></blockquote><p><code>KMP</code> ä¸»è¦åˆ†ä¸¤æ­¥ï¼š</p><ol><li>æ±‚nextæ•°ç»„</li><li>åŒ¹é…å­—ç¬¦ä¸²</li></ol><h5 id="ä¸¾ä¾‹-è¯¦è§£"><a href="#ä¸¾ä¾‹-è¯¦è§£" class="headerlink" title="ä¸¾ä¾‹ + è¯¦è§£"></a>ä¸¾ä¾‹ + è¯¦è§£</h5><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309300214173.png" alt="image-20230930021353085"></p><blockquote><p>è¯¦è§£ : éƒ½åœ¨æ³¨é‡Šä¸­äº†</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> readline = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;readline&quot;</span>);<br><span class="hljs-keyword">const</span> rl = readline.<span class="hljs-title function_">createInterface</span>(&#123;<br>  <span class="hljs-attr">input</span>: process.<span class="hljs-property">stdin</span>,<br>  <span class="hljs-attr">output</span>: process.<span class="hljs-property">stdout</span>,<br>&#125;);<br><span class="hljs-keyword">const</span> num = <span class="hljs-number">4</span>;<br><span class="hljs-keyword">const</span> rows = [];<br>rl.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;line&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)&#123;<br>  rows.<span class="hljs-title function_">push</span>(data);<br>  <span class="hljs-keyword">if</span> (rows.<span class="hljs-property">length</span> == num) &#123;<br>    <span class="hljs-keyword">const</span> res = [];<br>    <span class="hljs-keyword">const</span> n = <span class="hljs-title class_">Number</span>(rows[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">const</span> m = <span class="hljs-title class_">Number</span>(rows[<span class="hljs-number">2</span>]);<br>    <span class="hljs-keyword">const</span> p = rows[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">const</span> s = rows[<span class="hljs-number">3</span>];<br>    <span class="hljs-comment">// åˆå§‹åŒ–nextæ•°ç»„ä¸º0, å•ä¸ªæ•°å­—æ˜¯æ²¡æœ‰å‰åç¼€çš„, ä¹Ÿæ²¡æœ‰é•¿åº¦</span><br>    <span class="hljs-keyword">const</span> next = [<span class="hljs-number">0</span>]<br>    <span class="hljs-comment">// æ±‚nextæ•°ç»„ : next[i]å°±æ˜¯åŒ…æ‹¬iä¹‹å‰è¿™ä¸ªå­ä¸²æœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦</span><br>    <span class="hljs-comment">// jä»£è¡¨å‰ç¼€çš„æœ«å°¾ä½ç½®, å‰ç¼€ä»ä¸‹æ ‡0å¼€å§‹, iä»£è¡¨åç¼€çš„æœ«å°¾ä½ç½®, åç¼€æ˜¯ä»ä¸‹æ ‡1å¼€å§‹, å› ä¸ºå•ä¸ªæ•°å­—æ˜¯æ²¡æœ‰å‰åç¼€çš„</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>, j = <span class="hljs-number">0</span>; i &lt; n; i++) &#123;<br> <span class="hljs-comment">// å…³äº j &gt; 0 : å› ä¸ºä¸‹æ ‡ä¸º0æ—¶jæ— æ³•å›é€€åˆ°å‰ä¸€ä¸ªæ•°å­—çš„nextå€¼, ä¹Ÿå°±æ˜¯æ•°ç»„ä¸‹æ ‡-1ä¹Ÿæœ‰é—®é¢˜, æ‰€ä»¥è¦è¿›è¡Œåˆ¤å®š</span><br> <span class="hljs-comment">// å…³äº while : å› ä¸ºjçš„å›é€€ä¹Ÿæ˜¯éœ€è¦æŒç»­è¿›è¡Œçš„, ç›´åˆ°å‰åç¼€ä¸€è‡´æˆ–è€…jå›é€€åˆ°ä¸‹æ ‡ä¸º0çš„ä½ç½®, è¿™ä¸ªåœ°æ–¹ä¹Ÿæ˜¯æ˜“é”™ç‚¹</span><br> <span class="hljs-comment">// å…³äº j = next[j - 1] : å½“ä¸åŒ¹é…æ—¶, jè¦å›é€€åˆ°å‰ä¸€ä¸ªæ•°å­—çš„nextå€¼çš„ä½ç½®, ä¹Ÿå°±æ˜¯åŒ…æ‹¬iåœ¨å†…çš„å­—ç¬¦ä¸²çš„æœ€é•¿ç›¸åŒå‰åç¼€çš„é•¿åº¦</span><br>      <span class="hljs-keyword">while</span>(j &amp;&amp; p[i] != p[j]) j = next[j - <span class="hljs-number">1</span>];<br>      <span class="hljs-comment">// å½“åŒ¹é…æ—¶, j++, å› ä¸ºjä¸ä»…ä»£è¡¨å‰ç¼€æœ«å°¾çš„ä½ç½®, ä¹Ÿä»£è¡¨ç€åŒ…æ‹¬iä¹‹å‰è¿™ä¸ªå­ä¸²çš„æœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦, æ­¤æ—¶åŒ¹é…äº†è‚¯å®šè¦åŠ ä¸€</span><br>      <span class="hljs-keyword">if</span>(p[i] === p[j])j++; <br>      <span class="hljs-comment">// å› ä¸ºjä»£è¡¨ç€åŒ…æ‹¬iä¹‹å‰è¿™ä¸ªå­ä¸²çš„æœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦, ä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„next[i]çš„å€¼, æœ€åèµ‹å€¼å³å¯</span><br>      next[i] = j;<br>    &#125;<br>    <span class="hljs-comment">// è¿›è¡ŒåŒ¹é…</span><br>    <span class="hljs-comment">// éƒ½ä»ç¬¬ä¸€ä¸ªæ•°å¼€å§‹åŒ¹é…, æ‰€ä»¥ä¸‹æ ‡éƒ½ä»0å¼€å§‹, iä¸ºçˆ¶å­—ç¬¦ä¸²ä¸‹æ ‡, jä¸ºæ¨¡æ¿å­—ç¬¦ä¸²ä¸‹æ ‡</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; m; i++) &#123;<br>  <span class="hljs-comment">// å½“jä¸º0æ—¶, æ— éœ€å›é€€ä¸”æ•°ç»„ä¹Ÿä¼šè¶Šç•Œ</span><br>  <span class="hljs-comment">// whileçš„ä½œç”¨: ç”±äºç§»åŠ¨åå¯èƒ½ä»ç„¶å¤±é…, æ‰€ä»¥ç›®çš„æ˜¯è¦ä¿æŒåŒ¹é…</span><br>  <span class="hljs-comment">// å½“ä¸åŒ¹é…æ—¶, jå›é€€åˆ°å‰ä¸€ä¸ªæ•°å­—çš„nextå€¼çš„ä½ç½®, ç»§ç»­ä¸‹ä¸€æ­¥åŒ¹é…, æ³¨æ„è¿™æ—¶å€™iæ˜¯ä¸å˜çš„, ä¹Ÿå°±æ˜¯è¯´iä¸€ç›´å‘å, åªæœ‰jæ˜¯ä¸æ–­å›é€€</span><br>      <span class="hljs-keyword">while</span> (j &amp;&amp; s[i] != p[j]) j = next[j - <span class="hljs-number">1</span>]; <br>      <span class="hljs-comment">// å½“åŒ¹é…æˆåŠŸæ—¶, j++</span><br>      <span class="hljs-keyword">if</span> (s[i] == p[j]) j++;<br>      <span class="hljs-comment">// å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²å·²å…¨åŒ¹é…å®Œ, åˆ™åŒ¹é…å®Œæˆ</span><br>      <span class="hljs-keyword">if</span> (j == n) &#123;<br>        res.<span class="hljs-title function_">push</span>(i - n + <span class="hljs-number">1</span>);<br>        j = next[j - <span class="hljs-number">1</span>];<br>      &#125;<br>      <span class="hljs-comment">// å¦‚æœæœªåŒ¹é…å®Œæˆ, åˆ™i++, ç»§ç»­ä¸‹ä¸€ä¸ªå­—ç¬¦çš„åŒ¹é…</span><br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27; &#x27;</span>));<br>    rl.<span class="hljs-title function_">close</span>();<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><blockquote><p>over</p></blockquote><blockquote><p>ä¾‹å­2  + æ— æ³¨é‡Šç‰ˆ</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309301301231.png" alt="image-20230930130110140"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string</span>&#125; <span class="hljs-variable">haystack</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &#123;<span class="hljs-type">string</span>&#125; <span class="hljs-variable">needle</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-type">number</span>&#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">var</span> strStr = <span class="hljs-keyword">function</span>(<span class="hljs-params">haystack, needle</span>) &#123;<br>    <span class="hljs-keyword">let</span> next = [<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>, i = <span class="hljs-number">1</span>; i &lt; needle.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">while</span>(j &amp;&amp; needle[i] != needle[j]) j = next[j - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">if</span>(needle[i] === needle[j]) j++;<br>        next[i] = j;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; i &lt; haystack.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">while</span>(j &amp;&amp; needle[j] !== haystack[i]) j = next[j - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">if</span>(needle[j] === haystack[i]) j++;<br>        <span class="hljs-keyword">if</span>(j === needle.<span class="hljs-property">length</span>) &#123;<br>            <span class="hljs-keyword">return</span> i - j + <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­—ç¬¦ä¸²åŒ¹é…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹å†™Promise!!</title>
    <link href="/2023/09/18/%E6%89%8B%E5%86%99Promise/"/>
    <url>/2023/09/18/%E6%89%8B%E5%86%99Promise/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ : <a href="https://juejin.cn/post/7269640045043777576">https://juejin.cn/post/7269640045043777576</a></p></blockquote><p>é¦–å…ˆï¼Œ<code>Promise</code>è‚¯å®šæ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰å¯ä»¥<code>new</code>å®ƒï¼Œç„¶å<code>Promiseå®ä¾‹åŒ–</code>çš„æ—¶å€™ç»™å®ƒä¼ å…¥ä¸€ä¸ªå›è°ƒæˆ‘ä»¬å«å®ƒ<code>executor</code>æ–¹æ³•ï¼ŒPromise å†…éƒ¨ä¼š<code>ç«‹å³è°ƒç”¨</code>è¿™ä¸ª<code>executoræ–¹æ³•</code>ï¼Œå¹¶ä¸”ä¼šä¼ å…¥<code>resolve</code>å’Œ<code>reject</code>ä¸¤ä¸ªå‡½æ•°ä½œä¸ºè°ƒç”¨å‚æ•°ï¼Œå¦å¤–åœ¨ Promise ç±»çš„åŸå‹ä¸Šåº”è¯¥æä¾›ä¸€ä¸ª<code>then</code>æ–¹æ³•ï¼Œå®ƒé‡Œé¢å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå›è°ƒï¼Œåˆ†åˆ«ä¸º<code>PromiseæˆåŠŸçš„å›è°ƒ</code>å’Œ<code>Promiseå¤±è´¥çš„å›è°ƒ</code>ã€‚è°ƒç”¨<code>resolve</code>åä¼šèµ°å…¥<code>æˆåŠŸçš„å›è°ƒä¸­</code>ï¼Œè°ƒç”¨<code>reject</code>åä¼šèµ°å…¥<code>å¤±è´¥çš„å›è°ƒä¸­</code>ã€‚</p><h2 id="åˆçº§ç‰ˆæœ¬-Promise"><a href="#åˆçº§ç‰ˆæœ¬-Promise" class="headerlink" title="åˆçº§ç‰ˆæœ¬ Promise"></a>åˆçº§ç‰ˆæœ¬ Promise</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PENDING</span> = <span class="hljs-string">&quot;PENDING&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FULFILLED</span> = <span class="hljs-string">&quot;FULFILLED&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REJECTED</span> = <span class="hljs-string">&quot;REJECTED&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Promise</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">PENDING</span>;<br>    <span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªæ•°ç»„è§£å†³å¼‚æ­¥è°ƒç”¨resolveæˆ–è€…rejectçš„é—®é¢˜</span><br>    <span class="hljs-comment">// å……å½“é˜Ÿåˆ—æŠŠthené‡Œè¾¹çš„å›è°ƒå­˜èµ·æ¥</span><br>    <span class="hljs-comment">// æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç»™åŒä¸€ä¸ªpromiseå®ä¾‹æ‰§è¡Œå¤šæ¬¡thenæ–¹æ³•, é‚£ä¹ˆç›¸åº”çš„onFulfilledå’ŒonRejectedå›è°ƒå¿…é¡»æŒ‰ç…§å…¶å‘èµ·è°ƒç”¨çš„é¡ºåºæ‰§è¡Œã€‚</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span> = [];<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; &#123;<br>      <span class="hljs-comment">// å½“çŠ¶æ€ä¸ºpendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥å»æ”¹å˜çŠ¶æ€ï¼Œå¹¶ä¸”åˆ†åˆ«å°†valueå’Œreasonèµ‹å€¼ç»™å¯¹åº”å€¼ï¼Œå¹¶å»æ‰§è¡Œç›¸åº”å›è°ƒå‡½æ•°</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">FULFILLED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">REJECTED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>      <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-title function_">executor</span>(resolve,reject)<br>      &#125; <span class="hljs-keyword">catch</span>(err) &#123;<br>        <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">//æœ‰æŠ¥é”™ä¼šç›´æ¥æ‰§è¡Œrejectå‡½æ•°å°†çŠ¶æ€å˜ä¸ºå¤±è´¥rejected</span><br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) &#123;<br>    <span class="hljs-comment">//å½“æ‰§è¡Œåˆ°thençš„æ—¶å€™ï¼ŒçŠ¶æ€å·²ç»æ˜¯fulfilledçŠ¶æ€æˆ–è€…æ˜¯rejectedçŠ¶æ€ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ‰§è¡Œå›è°ƒï¼Œå¹¶ä¸”å°†value/reasonä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">FULFILLED</span>) &#123;<br>      onFulfilled &amp;&amp; <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">REJECTED</span>) &#123;<br>      onRejected &amp;&amp; <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>    &#125;<br>     <span class="hljs-comment">//å½“æ‰§è¡Œåˆ°thençš„æ—¶å€™ï¼ŒçŠ¶æ€è¿˜æ˜¯pendingçŠ¶æ€ï¼Œé‚£ä¹ˆéœ€è¦å°†å›è°ƒå­˜èµ·æ¥ï¼Œç­‰åˆ°çŠ¶æ€æ”¹å˜çš„æ—¶å€™å†å»æ‰§è¡Œ</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>      &#125;);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>      &#125;);<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Promise</span>;<br></code></pre></td></tr></table></figure><h2 id="é“¾å¼è°ƒç”¨-Promise"><a href="#é“¾å¼è°ƒç”¨-Promise" class="headerlink" title="é“¾å¼è°ƒç”¨ Promise"></a>é“¾å¼è°ƒç”¨ Promise</h2><blockquote><p>å†…éƒ¨è°ƒç”¨ then æ–¹æ³•æ—¶ï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„ promiseï¼Œå¹¶è®©è¿™ä¸ªæ–°çš„ promise æ¥ç®¡äº†å®ƒä¸‹ä¸€ä¸ª then æ–¹æ³•ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PENDING</span> = <span class="hljs-string">&quot;PENDING&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FULFILLED</span> = <span class="hljs-string">&quot;FULFILLED&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REJECTED</span> = <span class="hljs-string">&quot;REJECTED&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Promise</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">PENDING</span>;<br>    <span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªæ•°ç»„è§£å†³å¼‚æ­¥è°ƒç”¨resovleæˆ–è€…rejectçš„é—®é¢˜</span><br>    <span class="hljs-comment">// å……å½“é˜Ÿåˆ—æŠŠthené‡Œè¾¹çš„å›è°ƒå­˜èµ·æ¥</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span> = [];<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">FULFILLED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">REJECTED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-title function_">executor</span>(resolve, reject);<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">//æœ‰æŠ¥é”™ä¼šç›´æ¥æ‰§è¡Œrejectå‡½æ•°å°†çŠ¶æ€å˜ä¸ºå¤±è´¥rejected</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) &#123;<br>    <span class="hljs-keyword">const</span> promise2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">FULFILLED</span>) &#123;<br>        <span class="hljs-comment">// onFulfilledæ–¹æ³•å¯èƒ½è¿”å›å€¼æˆ–è€…promise</span><br>        <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>        <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">REJECTED</span>) &#123;<br>        <span class="hljs-comment">// onRejectedæ–¹æ³•å¯èƒ½è¿”å›å€¼æˆ–è€…promise</span><br>        <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>        <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>          <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>        &#125;);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>          <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>        &#125;);<br>      &#125;<br>    &#125;);<br>    <span class="hljs-keyword">return</span> promise2;<br>  &#125;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Promise</span>;<br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæœ€ä¸»è¦çš„å°±æ˜¯<code>resolvePromise</code>ï¼Œæ¥çœ‹ä¸‹å®ƒåšäº†ä»€ä¹ˆï¼š</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">resolvePromise</span>(<span class="hljs-params">promise2, x, resolve, reject</span>) &#123;<br>  <span class="hljs-keyword">if</span> (promise2 === x) &#123;<br>    <span class="hljs-comment">// é˜²æ­¢å¾ªç¯å¼•ç”¨</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<br>        <span class="hljs-string">&quot;UnhandledPromiseRejectionWarning: TypeError: Chaining cycle detected for promise #&lt;Promise&gt;&quot;</span><br>      )<br>    );<br>  &#125;<br>  <span class="hljs-keyword">let</span> called; <span class="hljs-comment">// å£°æ˜å˜é‡calledï¼Œç›¸å½“äºåŠ äº†ä¸€æŠŠé”ï¼Œè®©promiseåªèƒ½è°ƒç”¨ä¸€æ¬¡æˆåŠŸæˆ–è€…å¤±è´¥å›è°ƒï¼Œé˜²æ­¢æ­»å¾ªç¯ã€‚</span><br>  <span class="hljs-comment">// åˆ¤æ–­xçš„ç±»å‹ xæ˜¯å¯¹è±¡æˆ–å‡½æ•°æ‰æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªpromise</span><br>  <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; x !== <span class="hljs-literal">null</span>) || <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> then = x.<span class="hljs-property">then</span>;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> then === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>        <span class="hljs-comment">// åªèƒ½è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªpromise</span><br>        then.<span class="hljs-title function_">call</span>(<br>          x,<br>          <span class="hljs-function">(<span class="hljs-params">y</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (called) <span class="hljs-keyword">return</span>;<br>            called = <span class="hljs-literal">true</span>;<br>            <span class="hljs-title function_">resolvePromise</span>(promise2, y, resolve, reject); <span class="hljs-comment">// ç²¾é«“, é€’å½’è§£æ</span><br>          &#125;,<br>          <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (called) <span class="hljs-keyword">return</span>;<br>            called = <span class="hljs-literal">true</span>;<br>            <span class="hljs-title function_">reject</span>(r);<br>          &#125;<br>        );<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(x);<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-keyword">if</span> (called) <span class="hljs-keyword">return</span>;<br>      called = <span class="hljs-literal">true</span>;<br>      <span class="hljs-title function_">reject</span>(e);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_">resolve</span>(x);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å› ä¸º<code>promise</code>åœ¨<code>EventLoop</code>é‡Œé¢æ˜¯ä¸ªå¾®ä»»åŠ¡ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ç®€å•é€šè¿‡<code>setTimout</code>æ¨¡æ‹Ÿã€‚</p><p>ç„¶åæˆ‘ä»¬å†åŠ ä¸Šä¸€äº›æŠ¥é”™çš„æ•è·ä»£ç ä»¥åŠä¸€äº›å‚æ•°çš„å…¼å®¹ä»£ç ï¼Œä»¥åŠå®ç°<code>catch</code>æ–¹æ³•ã€‚</p></blockquote><h2 id="å®Œå…¨ç‰ˆæœ¬-Promise"><a href="#å®Œå…¨ç‰ˆæœ¬-Promise" class="headerlink" title="å®Œå…¨ç‰ˆæœ¬ Promise"></a>å®Œå…¨ç‰ˆæœ¬ Promise</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PENDING</span> = <span class="hljs-string">&quot;PENDING&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FULFILLED</span> = <span class="hljs-string">&quot;FULFILLED&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REJECTED</span> = <span class="hljs-string">&quot;REJECTED&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Promise</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">PENDING</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span> = [];<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">FULFILLED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">REJECTED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br><br>    <span class="hljs-comment">// executoræ‰§è¡Œæ—¶å¢åŠ try catchï¼Œé˜²æ­¢æ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„å‡½æ•°ç›´æ¥å°±æŠ¥é”™äº†ï¼Œè¿™æ—¶æˆ‘ä»¬åº”è¯¥ç›´æ¥reject promiseã€‚</span><br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-title function_">executor</span>(resolve, reject);<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-title function_">reject</span>(e);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) &#123;<br>    <span class="hljs-comment">// è¿™é‡Œå…¼å®¹ä¸‹ onFulfilled å’Œ onRejected çš„ä¼ å‚</span><br>    onFulfilled = <span class="hljs-keyword">typeof</span> onFulfilled === <span class="hljs-string">&quot;function&quot;</span> ? onFulfilled : <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> v;<br>    onRejected =<br>      <span class="hljs-keyword">typeof</span> onRejected === <span class="hljs-string">&quot;function&quot;</span><br>        ? onRejected<br>        : <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">throw</span> err;<br>          &#125;;<br>    <span class="hljs-comment">// è°ƒç”¨onFulfilledå’ŒonRejectedæ—¶ï¼Œéœ€è¦åŒ…è£¹setTimeout</span><br>    <span class="hljs-keyword">const</span> promise2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">FULFILLED</span>) &#123;<br>        <span class="hljs-comment">// ç”¨ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥</span><br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>            <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>          &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            <span class="hljs-title function_">reject</span>(e);<br>          &#125;<br>        &#125;, <span class="hljs-number">0</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">REJECTED</span>) &#123;<br>        <span class="hljs-comment">// ç”¨ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥</span><br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>            <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>          &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>            <span class="hljs-title function_">reject</span>(e);<br>          &#125;<br>        &#125;, <span class="hljs-number">0</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-comment">// ç”¨ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥</span><br>          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>              <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>            &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>              <span class="hljs-title function_">reject</span>(e);<br>            &#125;<br>          &#125;, <span class="hljs-number">0</span>);<br>        &#125;);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-comment">// ç”¨ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥</span><br>          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>              <span class="hljs-title function_">resolvePromise</span>(promise2, x, resolve, reject);<br>            &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>              <span class="hljs-title function_">reject</span>(e);<br>            &#125;<br>          &#125;, <span class="hljs-number">0</span>);<br>        &#125;);<br>      &#125;<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> promise2;<br>  &#125;<br>  <span class="hljs-comment">// catchå‡½æ•°å®é™…ä¸Šé‡Œé¢å°±æ˜¯è°ƒç”¨äº†thenæ–¹æ³•</span><br>  <span class="hljs-keyword">catch</span>(errCallback) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, errCallback);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// è§£å†³é“¾å¼è°ƒç”¨</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">resolvePromise</span>(<span class="hljs-params">promise2, x, resolve, reject</span>) &#123;<br>  <span class="hljs-keyword">if</span> (promise2 === x) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<br>        <span class="hljs-string">&quot;UnhandledPromiseRejectionWarning: TypeError: Chaining cycle detected for promise #&lt;Promise&gt;&quot;</span><br>      )<br>    );<br>  &#125;<br>  <span class="hljs-keyword">let</span> called;<br>  <span class="hljs-comment">// åˆ¤æ–­xçš„ç±»å‹ xæ˜¯å¯¹è±¡æˆ–å‡½æ•°æ‰æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªpromise</span><br>  <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; x !== <span class="hljs-literal">null</span>) || <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> then = x.<span class="hljs-property">then</span>;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> then === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>        <span class="hljs-comment">// åªèƒ½è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªpromise</span><br>        then.<span class="hljs-title function_">call</span>(<br>          x,<br>          <span class="hljs-function">(<span class="hljs-params">y</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (called) <span class="hljs-keyword">return</span>;<br>            called = <span class="hljs-literal">true</span>;<br>            <span class="hljs-title function_">resolvePromise</span>(promise2, y, resolve, reject);<br>          &#125;,<br>          <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (called) <span class="hljs-keyword">return</span>;<br>            called = <span class="hljs-literal">true</span>;<br>            <span class="hljs-title function_">reject</span>(r);<br>          &#125;<br>        );<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(x);<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-keyword">if</span> (called) <span class="hljs-keyword">return</span>;<br>      called = <span class="hljs-literal">true</span>;<br>      <span class="hljs-title function_">reject</span>(e);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_">resolve</span>(x);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Promise</span>;<br></code></pre></td></tr></table></figure><h2 id="æµ‹è¯•-promise-æ˜¯å¦ç¬¦åˆè§„èŒƒ"><a href="#æµ‹è¯•-promise-æ˜¯å¦ç¬¦åˆè§„èŒƒ" class="headerlink" title="æµ‹è¯• promise æ˜¯å¦ç¬¦åˆè§„èŒƒ"></a>æµ‹è¯• promise æ˜¯å¦ç¬¦åˆè§„èŒƒ</h2><ol><li><p>é¦–å…ˆå®‰è£…ä¾èµ–åŒ… <code>npm i promises-aplus-tests -D</code></p></li><li><p>åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æ·»åŠ </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">defer</span> = <span class="hljs-title class_">Promise</span>.<span class="hljs-property">deferred</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">let</span> dfd = &#123;&#125;;<br>  dfd.<span class="hljs-property">promise</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=&gt;</span>&#123;<br>      dfd.<span class="hljs-property">resolve</span> = resolve;<br>      dfd.<span class="hljs-property">reject</span> = reject;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> dfd;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„åˆ«å¿˜äº† <code>module.exports = Promise;</code></p></blockquote></li><li><p>è¿è¡Œ <code>promises-aplus-tests æ–‡ä»¶å</code> å³å¯</p></li><li><p>æœ‰ 872 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå…¨éƒ¨é€šè¿‡å³å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ promiseã€‚</p></li></ol><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309181510458.png" alt="image-20230918151029374"></p><h2 id="å®ç°Promiseçš„å„ç§æ–¹æ³•"><a href="#å®ç°Promiseçš„å„ç§æ–¹æ³•" class="headerlink" title="å®ç°Promiseçš„å„ç§æ–¹æ³•"></a>å®ç°Promiseçš„å„ç§æ–¹æ³•</h2><blockquote><p>Promise çš„å®ä¾‹æ–¹æ³•æœ‰ then&#x2F;catch&#x2F;finally ä¸‰ç§ï¼Œé™æ€æ–¹æ³•æœ‰ all&#x2F;race&#x2F;allSettled&#x2F;any&#x2F;resolve&#x2F;reject å…­ç§</p><p>then å’Œ catch ä¸Šé¢å·²ç»å®ç°è¿‡äº†</p></blockquote><h3 id="å®ç°-Promise-resolve"><a href="#å®ç°-Promise-resolve" class="headerlink" title="å®ç° Promise.resolve"></a>å®ç° Promise.resolve</h3><p>å®ç° resolve é™æ€æ–¹æ³•æœ‰ä¸‰ä¸ªè¦ç‚¹:</p><ol><li>ä¼ å‚ä¸ºä¸€ä¸ª Promise, åˆ™ç›´æ¥è¿”å›å®ƒã€‚</li><li>ä¼ å‚ä¸ºä¸€ä¸ª thenable å¯¹è±¡ï¼Œè¿”å›çš„ Promise ä¼šè·Ÿéšè¿™ä¸ªå¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€ä½œä¸ºè‡ªå·±çš„çŠ¶æ€ã€‚</li><li>å…¶ä»–æƒ…å†µï¼Œç›´æ¥è¿”å›ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€çš„promiseå¯¹è±¡ã€‚</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">resolve</span> = <span class="hljs-function">(<span class="hljs-params">param</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span>(param <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Promise</span>) <span class="hljs-keyword">return</span> param;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(param &amp;&amp; param.<span class="hljs-property">then</span> &amp;&amp; <span class="hljs-keyword">typeof</span> param.<span class="hljs-property">then</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>      <span class="hljs-comment">// param çŠ¶æ€å˜ä¸ºæˆåŠŸä¼šè°ƒç”¨resolveï¼Œå°†æ–° Promise çš„çŠ¶æ€å˜ä¸ºæˆåŠŸï¼Œåä¹‹äº¦ç„¶</span><br>      param.<span class="hljs-title function_">then</span>(resolve, reject);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">resolve</span>(param);<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®ç°-Promise-reject"><a href="#å®ç°-Promise-reject" class="headerlink" title="å®ç° Promise.reject"></a>å®ç° Promise.reject</h3><p>Promise.reject ä¸­ä¼ å…¥çš„å‚æ•°ä¼šä½œä¸ºä¸€ä¸ª reason åŸå°ä¸åŠ¨åœ°å¾€ä¸‹ä¼ , å®ç°å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">reject</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(reason);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="å®ç°-Promise-prototype-finally"><a href="#å®ç°-Promise-prototype-finally" class="headerlink" title="å®ç° Promise.prototype.finally"></a>å®ç° Promise.prototype.finally</h3><p>æ— è®ºå½“å‰ Promise æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œè°ƒç”¨finallyä¹‹åéƒ½ä¼šæ‰§è¡Œ finally ä¸­ä¼ å…¥çš„å‡½æ•°ï¼Œå¹¶ä¸”å°†å€¼åŸå°ä¸åŠ¨çš„å¾€ä¸‹ä¼ ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">finally</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">callback</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> value;<br>    &#125;)<br>  &#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">callback</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">throw</span> error;<br>    &#125;)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="å®ç°-Promise-all"><a href="#å®ç°-Promise-all" class="headerlink" title="å®ç° Promise.all"></a>å®ç° Promise.all</h3><p>å¯¹äº <code>all</code> æ–¹æ³•è€Œè¨€ï¼Œéœ€è¦å®Œæˆä¸‹é¢çš„æ ¸å¿ƒåŠŸèƒ½:</p><ol><li>ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿›è¡Œ<code>resolve</code>ã€‚</li><li>å¦‚æœå‚æ•°ä¸­æœ‰ä¸€ä¸ª<code>promise</code>å¤±è´¥ï¼Œé‚£ä¹ˆ<code>Promise.all</code>è¿”å›çš„<code>promise</code>å¯¹è±¡å¤±è´¥ã€‚</li><li>åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œ<code>Promise.all</code> è¿”å›çš„ <code>promise</code> çš„å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">all</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> result = [];<br>    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">let</span> len = promises.<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">if</span>(len === <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-title function_">resolve</span>(result);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>   <br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>      <span class="hljs-comment">// ä¸ºä»€ä¹ˆä¸ç›´æ¥ promise[i].then, å› ä¸ºpromise[i]å¯èƒ½ä¸æ˜¯ä¸€ä¸ªpromise</span><br>      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promise[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        result[i] = data;<br>        index++;<br>        <span class="hljs-keyword">if</span>(index === len) <span class="hljs-title function_">resolve</span>(result);<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(err);<br>      &#125;)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="-2"><a href="#-2" class="headerlink" title=""></a></h3><h3 id="å®ç°-Promise-allSettled"><a href="#å®ç°-Promise-allSettled" class="headerlink" title="å®ç° Promise.allSettled"></a>å®ç° Promise.allSettled</h3><p>Promise.allSettled() æ–¹æ³•åªæœ‰ç­‰åˆ°å‚æ•°æ•°ç»„çš„æ‰€æœ‰ Promise å®ä¾‹éƒ½å‘ç”ŸçŠ¶æ€å˜æ›´ï¼Œè¿”å›çš„ Promise å®ä¾‹æ‰ä¼šå‘ç”ŸçŠ¶æ€å˜æ›´ï¼Œæ— è®ºæ˜¯æ‰§è¡Œ resolve å›è°ƒè¿˜æ˜¯ reject å›è°ƒçš„çŠ¶æ€ã€‚<br>æ‰“ä¸ªæ¯”æ–¹ï¼šå¤šåå‘˜å·¥åˆ†åˆ«åŒæ—¶è¿›è¡Œå¤šä¸ªé¡¹ç›®ï¼Œä½ è¦æ±‚æ¯ä¸ªä¸€ä¸ªé¡¹ç›®éƒ½å¿…é¡»å®Œæˆï¼Œç„¶åå¾—åˆ°æ‰€æœ‰é¡¹ç›®æ˜¯ä»¤ä½ æ»¡æ„è¿˜æ˜¯ä»¤ä½ ä¸æ»¡æ„çš„ã€‚å¼ºè°ƒçš„æ˜¯æœ€ç»ˆç»“æœã€‚</p><p>åŒæ—¶å› ä¸º Promise.allSettled() å’Œ Promise.all() éƒ½æ˜¯å¯¹æ‰€æœ‰ Promise å®ä¾‹çš„ä¸€ç§å¤„ç†ï¼Œä¸‹é¢å°±å¯ä»¥åˆ©ç”¨ Promise.all() æ¥å®ç° Promise.allSettled() æ–¹æ³•ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">MyPromise</span>.<span class="hljs-property">allSettled</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<br>    promises.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span><br>      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(<br>        <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (&#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;fulfilled&#x27;</span>, value &#125;),<br>        <span class="hljs-function">(<span class="hljs-params">reason</span>) =&gt;</span> (&#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;rejected&#x27;</span>, reason &#125;)<br>      )<br>    )<br>  );<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="å®ç°-Promise-race"><a href="#å®ç°-Promise-race" class="headerlink" title="å®ç° Promise.race"></a>å®ç° Promise.race</h3><p><code>race</code> çš„å®ç°ç›¸æ¯”ä¹‹ä¸‹å°±ç®€å•ä¸€äº›ï¼Œåªè¦æœ‰ä¸€ä¸ª <code>promise</code> æ‰§è¡Œå®Œï¼Œç›´æ¥ <code>resolve</code> å¹¶åœæ­¢æ‰§è¡Œã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">race</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-title function_">resolve</span>();<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">let</span> len = promises.<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">if</span>(len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promise[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(data);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(err);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;)<br>    &#125;<br>   &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®ç°-Promise-any"><a href="#å®ç°-Promise-any" class="headerlink" title="å®ç° Promise.any"></a>å®ç° Promise.any</h3><p>Promise.any() æ–¹æ³•æ˜¯è¿”å›ä»»æ„ä¸€ä¸ªæœ€å¿«æ‰§è¡Œ resolve å›è°ƒçš„ Promise å®ä¾‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">MyPromise</span>.<span class="hljs-property">any</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">let</span> result = [];<br>      <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; promises.<span class="hljs-property">length</span>; i++) &#123;<br>        promises[i].<span class="hljs-title function_">then</span>(<br>          <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(value);<br>          &#125;,<br>          <span class="hljs-function">(<span class="hljs-params">reason</span>) =&gt;</span> &#123;<br>            result[i] = reason;<br>            <span class="hljs-comment">// å¦‚æœæ‰€æœ‰éƒ½å¤±è´¥åˆ™è¿”å›å¤±è´¥</span><br>            <span class="hljs-keyword">if</span> (++index === promises.<span class="hljs-property">length</span>) &#123;<br>              <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AggregateError</span>(result));<br>            &#125;<br>          &#125;<br>        );<br>      &#125;<br>    &#125;<br>  &#125;);<br>&#125;;<br><br></code></pre></td></tr></table></figure><blockquote><p>over</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>JavaScript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ‰‹å†™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹å†™å‡½æ•°æ±‡æ€»</title>
    <link href="/2023/09/15/%E6%89%8B%E5%86%99%E5%87%BD%E6%95%B0/"/>
    <url>/2023/09/15/%E6%89%8B%E5%86%99%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="JavaScript-åŸºç¡€"><a href="#JavaScript-åŸºç¡€" class="headerlink" title="JavaScript åŸºç¡€"></a>JavaScript åŸºç¡€</h2><h3 id="1-æ‰‹å†™-Object-create"><a href="#1-æ‰‹å†™-Object-create" class="headerlink" title="1. æ‰‹å†™ Object.create"></a>1. æ‰‹å†™ Object.create</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">obj</span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">F</span>(<span class="hljs-params"></span>) &#123;&#125;<br>  F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = obj<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>()<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-æ‰‹å†™-instanceof-æ–¹æ³•"><a href="#2-æ‰‹å†™-instanceof-æ–¹æ³•" class="headerlink" title="2.  æ‰‹å†™ instanceof æ–¹æ³•"></a>2.  æ‰‹å†™ instanceof æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceof</span>(<span class="hljs-params">left, right</span>) &#123;<br>  <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(left),<br>  prototype = right.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>; <br> <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!proto) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (proto === prototype) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-æ‰‹å†™-new-æ“ä½œç¬¦"><a href="#3-æ‰‹å†™-new-æ“ä½œç¬¦" class="headerlink" title="3. æ‰‹å†™ new æ“ä½œç¬¦"></a>3. æ‰‹å†™ new æ“ä½œç¬¦</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">newOperator</span>(<span class="hljs-params">ctor, ...args</span>) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> ctor !== <span class="hljs-string">&#x27;function&#x27;</span>)&#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;newOperator function the first param must be a function&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">let</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(ctor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br>    <span class="hljs-keyword">let</span> res = ctor.<span class="hljs-title function_">apply</span>(obj, args);<br><br>    <span class="hljs-comment">// å¦‚æœæ„é€ å‡½æ•°çš„è¿”å›å€¼ res æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ï¼Œåˆ™ç›´æ¥è¿”å›å®ƒã€‚å¦åˆ™ï¼Œè¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡ obj</span><br>    <span class="hljs-keyword">let</span> isObject = (<span class="hljs-keyword">typeof</span> res === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; res !== <span class="hljs-literal">null</span>);<br>    <span class="hljs-keyword">let</span> isFunction = (<span class="hljs-keyword">typeof</span> res === <span class="hljs-string">&#x27;function&#x27;</span>);<br>    <span class="hljs-keyword">return</span> (isObect || isFunction ) ? res : obj;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="4-æ‰‹å†™-Promise-ç®€æ´ç‰ˆ"><a href="#4-æ‰‹å†™-Promise-ç®€æ´ç‰ˆ" class="headerlink" title="4. æ‰‹å†™ Promise (ç®€æ´ç‰ˆ)"></a>4. æ‰‹å†™ Promise (ç®€æ´ç‰ˆ)</h3><p>è¯¦ç»†çš„å¯çœ‹è‡ªå·±çš„åšå®¢ , è¿™é‡Œæœªå®ç°é“¾å¼è°ƒç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PENDING</span> = <span class="hljs-string">&quot;PENDING&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FULFILLED</span> = <span class="hljs-string">&quot;FULFILLED&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REJECTED</span> = <span class="hljs-string">&quot;REJECTED&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Promise</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">PENDING</span>;<br>    <span class="hljs-comment">// å®šä¹‰ä¸¤ä¸ªæ•°ç»„è§£å†³å¼‚æ­¥è°ƒç”¨resolveæˆ–è€…rejectçš„é—®é¢˜</span><br>    <span class="hljs-comment">// å……å½“é˜Ÿåˆ—æŠŠthené‡Œè¾¹çš„å›è°ƒå­˜èµ·æ¥</span><br>    <span class="hljs-comment">// æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç»™åŒä¸€ä¸ªpromiseå®ä¾‹æ‰§è¡Œå¤šæ¬¡thenæ–¹æ³•, é‚£ä¹ˆç›¸åº”çš„onFulfilledå’ŒonRejectedå›è°ƒå¿…é¡»æŒ‰ç…§å…¶å‘èµ·è°ƒç”¨çš„é¡ºåºæ‰§è¡Œã€‚</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span> = [];<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; &#123;<br>      <span class="hljs-comment">// å½“çŠ¶æ€ä¸ºpendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥å»æ”¹å˜çŠ¶æ€ï¼Œå¹¶ä¸”åˆ†åˆ«å°†valueå’Œreasonèµ‹å€¼ç»™å¯¹åº”å€¼ï¼Œå¹¶å»æ‰§è¡Œç›¸åº”å›è°ƒå‡½æ•°</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">FULFILLED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">REJECTED</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>());<br>      &#125;<br>    &#125;;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-title function_">executor</span>(resolve, reject);<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">//æœ‰æŠ¥é”™ä¼šç›´æ¥æ‰§è¡Œrejectå‡½æ•°å°†çŠ¶æ€å˜ä¸ºå¤±è´¥rejected</span><br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) &#123;<br>    <span class="hljs-comment">//å½“æ‰§è¡Œåˆ°thençš„æ—¶å€™ï¼ŒçŠ¶æ€å·²ç»æ˜¯fulfilledçŠ¶æ€æˆ–è€…æ˜¯rejectedçŠ¶æ€ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ‰§è¡Œå›è°ƒï¼Œå¹¶ä¸”å°†value/reasonä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">FULFILLED</span>) &#123;<br>      onFulfilled &amp;&amp; <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">REJECTED</span>) &#123;<br>      onRejected &amp;&amp; <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>    &#125;<br>    <span class="hljs-comment">//å½“æ‰§è¡Œåˆ°thençš„æ—¶å€™ï¼ŒçŠ¶æ€è¿˜æ˜¯pendingçŠ¶æ€ï¼Œé‚£ä¹ˆéœ€è¦å°†å›è°ƒå­˜èµ·æ¥ï¼Œç­‰åˆ°çŠ¶æ€æ”¹å˜çš„æ—¶å€™å†å»æ‰§è¡Œ</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onResolvedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);<br>      &#125;);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);<br>      &#125;);<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">Promise</span>;<br></code></pre></td></tr></table></figure><h3 id="5-æ‰‹å†™-Promise-çš„å„ç§æ–¹æ³•"><a href="#5-æ‰‹å†™-Promise-çš„å„ç§æ–¹æ³•" class="headerlink" title="5. æ‰‹å†™ Promise çš„å„ç§æ–¹æ³•"></a>5. æ‰‹å†™ Promise çš„å„ç§æ–¹æ³•</h3><p>Promise çš„å®ä¾‹æ–¹æ³•æœ‰ then&#x2F;catch&#x2F;finally ä¸‰ç§ï¼Œé™æ€æ–¹æ³•æœ‰ all&#x2F;race&#x2F;allSettled&#x2F;any&#x2F;resolve&#x2F;reject å…­ç§</p><h4 id="5-1-æ‰‹å†™-Promise-resolve"><a href="#5-1-æ‰‹å†™-Promise-resolve" class="headerlink" title="5.1. æ‰‹å†™ Promise.resolve"></a>5.1. æ‰‹å†™ Promise.resolve</h4><p>ä»¥ä¸‹å‡ ç§å…³äº Promise å„ç§æ–¹æ³•å®ç°çš„å…·ä½“ç»†èŠ‚å¯çœ‹<a href="https://www.yuque.com/zweirdo/zxyob8/kg4i04ywgxe469w1#JKyuC">JavaScriptå…«è‚¡</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">resolve</span> = <span class="hljs-function">(<span class="hljs-params">param</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span>(param <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Promise</span>) <span class="hljs-keyword">return</span> param;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(param &amp;&amp; param.<span class="hljs-property">then</span> &amp;&amp; <span class="hljs-keyword">typeof</span> param.<span class="hljs-property">then</span> === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>      <span class="hljs-comment">// param çŠ¶æ€å˜ä¸ºæˆåŠŸä¼šè°ƒç”¨resolveï¼Œå°†æ–° Promise çš„çŠ¶æ€å˜ä¸ºæˆåŠŸï¼Œåä¹‹äº¦ç„¶</span><br>      param.<span class="hljs-title function_">then</span>(resolve, reject);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">resolve</span>(param);<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-2-æ‰‹å†™-Promise-reject"><a href="#5-2-æ‰‹å†™-Promise-reject" class="headerlink" title="5.2. æ‰‹å†™ Promise.reject"></a>5.2. æ‰‹å†™ Promise.reject</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">reject</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(reason);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-3-æ‰‹å†™-Promise-prototype-finally"><a href="#5-3-æ‰‹å†™-Promise-prototype-finally" class="headerlink" title="5.3. æ‰‹å†™ Promise.prototype.finally"></a>5.3. æ‰‹å†™ Promise.prototype.finally</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">finally</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">callback</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> value;<br>    &#125;)<br>  &#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">callback</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">throw</span> error;<br>    &#125;)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-4-æ‰‹å†™-Promise-all"><a href="#5-4-æ‰‹å†™-Promise-all" class="headerlink" title="5.4. æ‰‹å†™ Promise.all"></a>5.4. æ‰‹å†™ Promise.all</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">all</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(promises)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">`promises must be a array`</span>)<br>    <span class="hljs-keyword">let</span> result = [];<br>    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">let</span> len = promises.<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">if</span>(len === <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-title function_">resolve</span>(result);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>   <br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>      <span class="hljs-comment">// ä¸ºä»€ä¹ˆä¸ç›´æ¥ promise[i].then, å› ä¸ºpromise[i]å¯èƒ½ä¸æ˜¯ä¸€ä¸ªpromise</span><br>      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promise[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        result[i] = data;<br>        index++;<br>        <span class="hljs-keyword">if</span>(index === len) <span class="hljs-title function_">resolve</span>(result);<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(err);<br>      &#125;)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-5-æ‰‹å†™-Promise-allSettled"><a href="#5-5-æ‰‹å†™-Promise-allSettled" class="headerlink" title="5.5. æ‰‹å†™ Promise.allSettled"></a>5.5. æ‰‹å†™ Promise.allSettled</h4><p>å› ä¸º Promise.allSettled() å’Œ Promise.all() éƒ½æ˜¯å¯¹<strong>æ‰€æœ‰ Promise å®ä¾‹</strong>çš„ä¸€ç§å¤„ç†ï¼Œä¸‹é¢å°±å¯ä»¥åˆ©ç”¨ Promise.all() æ¥å®ç° Promise.allSettled() æ–¹æ³•ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">MyPromise</span>.<span class="hljs-property">allSettled</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<br>    promises.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span><br>      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(<br>        <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (&#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;fulfilled&#x27;</span>, value &#125;),<br>        <span class="hljs-function">(<span class="hljs-params">reason</span>) =&gt;</span> (&#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;rejected&#x27;</span>, reason &#125;)<br>      )<br>    )<br>  );<br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="5-6-æ‰‹å†™-Promise-race"><a href="#5-6-æ‰‹å†™-Promise-race" class="headerlink" title="5.6. æ‰‹å†™ Promise.race"></a>5.6. æ‰‹å†™ Promise.race</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-property">race</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> len = promises.<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">if</span>(len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(promise[i]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">resolve</span>(data);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        <span class="hljs-title function_">reject</span>(err);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-æ‰‹å†™é˜²æŠ–å‡½æ•°"><a href="#6-æ‰‹å†™é˜²æŠ–å‡½æ•°" class="headerlink" title="6. æ‰‹å†™é˜²æŠ–å‡½æ•°"></a>6. æ‰‹å†™é˜²æŠ–å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) &#123;<br>  <span class="hljs-keyword">let</span> timer;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) &#123;<br>    timer &amp;&amp; <span class="hljs-built_in">clearTimeout</span>(timer);<br>    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);<br>    &#125;, delay);<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-æ‰‹å†™èŠ‚æµå‡½æ•°"><a href="#7-æ‰‹å†™èŠ‚æµå‡½æ•°" class="headerlink" title="7. æ‰‹å†™èŠ‚æµå‡½æ•°"></a>7. æ‰‹å†™èŠ‚æµå‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å®šæ—¶å™¨ç‰ˆæœ¬</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">fn, delay</span>) &#123;<br>  <span class="hljs-keyword">let</span> timer;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!timer) &#123;<br>      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);<br>        timer = <span class="hljs-literal">null</span>;<br>      &#125;, delay);<br>    &#125;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´æˆ³ç‰ˆæœ¬</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">throole</span>(<span class="hljs-params">fn, delay</span>) &#123;<br>  <span class="hljs-keyword">let</span> st = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) &#123;<br>    <span class="hljs-keyword">let</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br>    <span class="hljs-keyword">if</span> (delay - (now - st) &lt;= <span class="hljs-number">0</span>) &#123;<br>      fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);<br>      st = now;<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8-æ‰‹å†™ç±»å‹åˆ¤æ–­å‡½æ•°"><a href="#8-æ‰‹å†™ç±»å‹åˆ¤æ–­å‡½æ•°" class="headerlink" title="8. æ‰‹å†™ç±»å‹åˆ¤æ–­å‡½æ•°"></a>8. æ‰‹å†™ç±»å‹åˆ¤æ–­å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getType</span>(<span class="hljs-params">value</span>) &#123;<br>  <span class="hljs-comment">// åˆ¤æ–­æ•°æ®æ˜¯ null çš„æƒ…å†µ</span><br>  <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">return</span> value + <span class="hljs-string">&quot;&quot;</span>;<br>  &#125;<br>  <span class="hljs-comment">// åˆ¤æ–­æ•°æ®æ˜¯å¼•ç”¨ç±»å‹çš„æƒ…å†µ</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>    <span class="hljs-keyword">let</span> valueClass = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(value), <span class="hljs-comment">// é‡ç‚¹</span><br>    type = valueClass.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot; &quot;</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>);<br>    type.<span class="hljs-title function_">pop</span>();<br>    <span class="hljs-keyword">return</span> type.<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">toLowerCase</span>();<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// åˆ¤æ–­æ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„æƒ…å†µå’Œå‡½æ•°çš„æƒ…å†µ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9-æ‰‹å†™-call-å‡½æ•°"><a href="#9-æ‰‹å†™-call-å‡½æ•°" class="headerlink" title="9. æ‰‹å†™ call å‡½æ•°"></a>9. æ‰‹å†™ call å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ç»™å‡½æ•°å¯¹è±¡æ·»åŠ æ–¹æ³•: mycall</span><br><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">mycall</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">thisArg, ...otherArgs</span>) &#123;<br>    <span class="hljs-comment">// this -&gt; è°ƒç”¨çš„å‡½æ•°å¯¹è±¡</span><br>    <span class="hljs-comment">// thisArg -&gt; ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°, è¦ç»‘å®šçš„this</span><br>    <span class="hljs-comment">// console.log(this) // -&gt; å½“å‰è°ƒç”¨çš„å‡½æ•°å¯¹è±¡</span><br><br>    <span class="hljs-comment">// åˆ¤æ–­è°ƒç”¨å¯¹è±¡</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span> !== <span class="hljs-string">&quot;function&quot;</span>)  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Error&quot;</span>);<br><br>    <span class="hljs-comment">// è·å–thisArg, å¹¶ä¸”ç¡®ä¿æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹</span><br>    thisArg = (thisArg === <span class="hljs-literal">null</span> || thisArg === <span class="hljs-literal">undefined</span>)? <span class="hljs-attr">window</span>: <span class="hljs-title class_">Object</span>(thisArg)<br><br>    <span class="hljs-keyword">const</span> fnKey = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;fn&#x27;</span>);<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(thisArg, fnKey, &#123;<br>        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ä¸å¯æšä¸¾</span><br>        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span><br>    &#125;)<br>    thisArg[fnKey](...otherArgs) <span class="hljs-comment">// é€šè¿‡thisArgè°ƒç”¨æ–¹æ³•, ç›¸å½“äºæ”¹å˜äº†thisæŒ‡å‘</span><br><br>    <span class="hljs-keyword">delete</span> thisArg[fnKey] <span class="hljs-comment">// æœ€åè¦åˆ é™¤</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10-æ‰‹å†™-apply-å‡½æ•°"><a href="#10-æ‰‹å†™-apply-å‡½æ•°" class="headerlink" title="10. æ‰‹å†™ apply å‡½æ•°"></a>10. æ‰‹å†™ apply å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hyapply</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">thisArg, otherArgs</span>) &#123;<br><br>  <span class="hljs-comment">// åˆ¤æ–­è°ƒç”¨å¯¹è±¡</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span> !== <span class="hljs-string">&quot;function&quot;</span>)  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Error&quot;</span>);<br><br>  <span class="hljs-comment">// è·å–thisArg, å¹¶ä¸”ç¡®ä¿æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹</span><br>  thisArg = (thisArg === <span class="hljs-literal">null</span> || thisArg === <span class="hljs-literal">undefined</span>)? <span class="hljs-attr">window</span>: <span class="hljs-title class_">Object</span>(thisArg)<br>  <span class="hljs-comment">// ä¸Šæ–¹çš„windowå¯ä»¥æ”¹æˆglobalThisæ›´ä¸¥è°¨</span><br><br>  <span class="hljs-keyword">const</span> fnKey = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;fn&#x27;</span>); <span class="hljs-comment">// é˜²æ­¢ç¯¡æ”¹thisArgåŸæœ‰çš„å±æ€§</span><br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(thisArg, fnKey, &#123;  <br>    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>    <span class="hljs-comment">// thisæŒ‡å‘è°ƒç”¨è€…</span><br>  &#125;)<br>  thisArg[fnKey](...otherArgs)   <span class="hljs-comment">// å’Œcallçš„åŒºåˆ«å°±æ˜¯åé¢çš„å‚æ•°æ˜¯æ•°ç»„å½¢å¼</span><br>  <span class="hljs-keyword">delete</span> thisArg[fnKey];  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="11-æ‰‹å†™-bind-å‡½æ•°"><a href="#11-æ‰‹å†™-bind-å‡½æ•°" class="headerlink" title="11. æ‰‹å†™ bind å‡½æ•°"></a>11. æ‰‹å†™ bind å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hybind</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">thisArg, ...otherArgs</span>) &#123;<br><br>  <span class="hljs-comment">// åˆ¤æ–­è°ƒç”¨å¯¹è±¡</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span> !== <span class="hljs-string">&quot;function&quot;</span>)  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Error&quot;</span>);<br><br>  thisArg = thisArg === <span class="hljs-literal">null</span> || thisArg === <span class="hljs-literal">undefined</span> ? <span class="hljs-attr">window</span>: <span class="hljs-title class_">Object</span>(thisArg)<br>  <span class="hljs-keyword">const</span> fnKey = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;fn&#x27;</span>); <span class="hljs-comment">// é˜²æ­¢ç¯¡æ”¹thisArgåŸæœ‰çš„å±æ€§</span><br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(thisArg, fnKey, &#123;<br>    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span><br>  &#125;)<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...newArgs</span>) =&gt;</span> &#123;  <span class="hljs-comment">// è¿”å›ä¸€ä¸ªå‡½æ•°æ‹¿å»è°ƒç”¨</span><br>    <span class="hljs-keyword">var</span> allArgs = [...otherArgs, ...newArgs]  <span class="hljs-comment">// å¯èƒ½è¿˜ä¼šä¼ å‚æ•°</span><br>    thisArg[fnKey](...allArgs)<br>    <span class="hljs-comment">// å› ä¸ºä¸‹æ¬¡è°ƒç”¨è¿˜ä¼šä½¿ç”¨è¿™ä¸ªfnKey , æ‰€ä»¥ä¸è¦åˆ é™¤</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="12-æ‰‹å†™æŸ¯é‡ŒåŒ–å‡½æ•°"><a href="#12-æ‰‹å†™æŸ¯é‡ŒåŒ–å‡½æ•°" class="headerlink" title="12. æ‰‹å†™æŸ¯é‡ŒåŒ–å‡½æ•°"></a>12. æ‰‹å†™æŸ¯é‡ŒåŒ–å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a,b,c</span>)&#123;<br>  <span class="hljs-keyword">return</span> a+b+c;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">curring</span>(<span class="hljs-params">fn</span>)&#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">cur</span>(<span class="hljs-params">...args</span>)&#123;<br>    <span class="hljs-keyword">if</span>(args.<span class="hljs-property">length</span>&gt;=fn.<span class="hljs-property">length</span>)&#123;<br>      <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,args);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...newargs</span>)&#123;<br>        <span class="hljs-keyword">return</span> cur.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,args.<span class="hljs-title function_">concat</span>(newargs));<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> cur;<br>&#125;<br><span class="hljs-keyword">let</span> add=<span class="hljs-title function_">curring</span>(foo);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)); <span class="hljs-comment">// 6</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)); <span class="hljs-comment">// 6</span><br></code></pre></td></tr></table></figure><h3 id="13-å®ç°AJAXè¯·æ±‚"><a href="#13-å®ç°AJAXè¯·æ±‚" class="headerlink" title="13. å®ç°AJAXè¯·æ±‚"></a>13. å®ç°AJAXè¯·æ±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SERVER_URL</span> = <span class="hljs-string">&quot;/server&quot;</span>;<br><span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br><span class="hljs-comment">// åˆ›å»º Http è¯·æ±‚</span><br>xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-variable constant_">SERVER_URL</span>, <span class="hljs-literal">true</span>);<br><span class="hljs-comment">// è®¾ç½®çŠ¶æ€ç›‘å¬å‡½æ•°</span><br>xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">readyState</span> !== <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-comment">// å½“è¯·æ±‚æˆåŠŸæ—¶</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>    <span class="hljs-title function_">handle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">response</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">statusText</span>);<br>  &#125;<br>&#125;;<br><span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤±è´¥æ—¶çš„ç›‘å¬å‡½æ•°</span><br>xhr.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">statusText</span>);<br>&#125;;<br><span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯</span><br>xhr.<span class="hljs-property">responseType</span> = <span class="hljs-string">&quot;json&quot;</span>;<br>xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&quot;Accept&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br><span class="hljs-comment">// å‘é€ Http è¯·æ±‚</span><br>xhr.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><h3 id="14-ä½¿ç”¨Promiseå°è£…AJAXè¯·æ±‚"><a href="#14-ä½¿ç”¨Promiseå°è£…AJAXè¯·æ±‚" class="headerlink" title="14. ä½¿ç”¨Promiseå°è£…AJAXè¯·æ±‚"></a>14. ä½¿ç”¨Promiseå°è£…AJAXè¯·æ±‚</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getJSON</span>(<span class="hljs-params">url</span>) &#123;<br>  <span class="hljs-keyword">let</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) &#123;<br>    <span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>    xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>, url, <span class="hljs-literal">true</span>);<br>    xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">readyState</span> !== <span class="hljs-number">4</span>) <span class="hljs-keyword">return</span>;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-title function_">resolve</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">response</span>);  <span class="hljs-comment">// æ³¨æ„</span><br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">statusText</span>));<br>      &#125;<br>    &#125;;<br>    xhr.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">statusText</span>));<br>    &#125;;<br>    xhr.<span class="hljs-property">responseType</span> = <span class="hljs-string">&quot;json&quot;</span>;<br>    xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&quot;Accept&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br>    xhr.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>);<br>  &#125;);<br>  <span class="hljs-keyword">return</span> promise;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="15-æµ…æ‹·è´çš„å„ç§å®ç°æ–¹æ³•"><a href="#15-æµ…æ‹·è´çš„å„ç§å®ç°æ–¹æ³•" class="headerlink" title="15. æµ…æ‹·è´çš„å„ç§å®ç°æ–¹æ³•"></a>15. æµ…æ‹·è´çš„å„ç§å®ç°æ–¹æ³•</h3><p>æ‰‹å†™æµ…æ‹·è´</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">shallowClone</span> = (<span class="hljs-params">target</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> target === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; target !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">const</span> cloneTarget = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(target) ? []: &#123;&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> prop <span class="hljs-keyword">in</span> target) &#123;<br>      <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">hasOwnProperty</span>(prop)) &#123;<br>          cloneTarget[prop] = target[prop];<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cloneTarget;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> target;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Object.assign</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;sy&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;;<br><span class="hljs-keyword">const</span> obj2 = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, obj, &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;sss&#x27;</span>&#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2);<span class="hljs-comment">//&#123; name: &#x27;sss&#x27;, age: 18 &#125;</span><br></code></pre></td></tr></table></figure><p>æ•°ç»„æ–¹æ³• concat </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-keyword">let</span> newArr = arr.<span class="hljs-title function_">concat</span>();<br>newArr[<span class="hljs-number">1</span>] = <span class="hljs-number">100</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);<span class="hljs-comment">//[ 1, 2, 3 ]</span><br></code></pre></td></tr></table></figure><p>æ•°ç»„æ–¹æ³• slice</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-keyword">let</span> newArr = arr.<span class="hljs-title function_">slice</span>();<br>newArr[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);<span class="hljs-comment">//[1, 2, 3]</span><br></code></pre></td></tr></table></figure><p>â€¦å±•å¼€è¿ç®—ç¬¦</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-keyword">let</span> newArr = [...arr];<span class="hljs-comment">//è·Ÿarr.slice()æ˜¯ä¸€æ ·çš„æ•ˆæœ</span><br></code></pre></td></tr></table></figure><h3 id="16-æ·±æ‹·è´çš„å®ç°æ–¹æ³•"><a href="#16-æ·±æ‹·è´çš„å®ç°æ–¹æ³•" class="headerlink" title="16. æ·±æ‹·è´çš„å®ç°æ–¹æ³•"></a>16. æ·±æ‹·è´çš„å®ç°æ–¹æ³•</h3><p>JSON.parse(JSON.stringify(obj))</p><p>å®ƒçš„åŸç†å°±æ˜¯åˆ©ç”¨JSON.stringify å°†jså¯¹è±¡åºåˆ—åŒ–ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰ï¼Œå†ä½¿ç”¨JSON.parseæ¥ååºåˆ—åŒ–(è¿˜åŸ)jså¯¹è±¡ã€‚è¿™æ—¶å€™ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨å°±ä¸ç›¸åŒäº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj1 = &#123; <span class="hljs-attr">a</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">b</span>: &#123;<span class="hljs-attr">c</span>: <span class="hljs-number">0</span>&#125; &#125;;<br><span class="hljs-keyword">let</span> obj2 = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj1));<br>obj1.<span class="hljs-property">a</span> = <span class="hljs-number">1</span>;<br>obj1.<span class="hljs-property">b</span>.<span class="hljs-property">c</span> = <span class="hljs-number">1</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1); <span class="hljs-comment">// &#123;a: 1, b: &#123;c: 1&#125;&#125;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2); <span class="hljs-comment">// &#123;a: 0, b: &#123;c: 0&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å‡½æ•°åº“lodashçš„_.cloneDeepæ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>);<br><span class="hljs-keyword">var</span> obj1 = &#123;<br>    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">b</span>: &#123; <span class="hljs-attr">f</span>: &#123; <span class="hljs-attr">g</span>: <span class="hljs-number">1</span> &#125; &#125;,<br>    <span class="hljs-attr">c</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br>&#125;;<br><span class="hljs-keyword">var</span> obj2 = _.<span class="hljs-title function_">cloneDeep</span>(obj1);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">b</span>.<span class="hljs-property">f</span> === obj2.<span class="hljs-property">b</span>.<span class="hljs-property">f</span>);<span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p><strong>â­ æ‰‹å†™å®ç°æ·±æ‹·è´å‡½æ•°</strong></p><p>å…·ä½“ä¼˜åŒ–ç»†èŠ‚å¯ä»¥çœ‹<a href="https://www.yuque.com/zweirdo/zxyob8/mkhhq2eoodzvocnb#ggm18">18_æ·±æ‹·è´-äº‹ä»¶æ€»çº¿</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isObject</span>(<span class="hljs-params">originValue</span>) &#123;<br>    <span class="hljs-keyword">const</span> myType = <span class="hljs-keyword">typeof</span> originValue;<br>    <span class="hljs-keyword">return</span> myType != <span class="hljs-literal">null</span> &amp;&amp; (myType === <span class="hljs-string">&quot;function&quot;</span> || myType === <span class="hljs-string">&quot;object&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">deepCopy</span>(<span class="hljs-params">originValue, map = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) &#123;<br>  <br>    <span class="hljs-comment">// 1.å¦‚æœå€¼æ˜¯Symbolçš„ç±»å‹</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> originValue === <span class="hljs-string">&quot;symbol&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Symbol</span>(originValue.<span class="hljs-property">description</span>)<br>    &#125;<br><br>    <span class="hljs-comment">// 2.å¦‚æœæ˜¯åŸå§‹ç±»å‹æˆ–è€…promise, ç›´æ¥è¿”å›</span><br>    <span class="hljs-comment">// å¦‚æœä½ æ·±æ‹·è´ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¯èƒ½ä¼šç ´åå…¶å¼‚æ­¥è¡Œä¸ºï¼Œå¹¶ä¸”å¯¼è‡´æ„å¤–è¡Œä¸ºã€‚</span><br>    <span class="hljs-comment">// è¿™æ ·å¯ä»¥é¿å…ç ´åå¼‚æ­¥è¡Œä¸ºå’Œæ„å¤–è¡Œä¸ºã€‚</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isObject</span>(originValue) || originValue <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Promise</span>) &#123;<br>        <span class="hljs-keyword">return</span> originValue<br>    &#125;<br><br>    <span class="hljs-comment">// 3.å¦‚æœæ˜¯setç±»å‹</span><br>    <span class="hljs-keyword">if</span> (originValue <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Set</span>) &#123;<br>        <span class="hljs-keyword">const</span> newSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> setItem <span class="hljs-keyword">of</span> originValue) &#123;<br>            newSet.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">deepCopy</span>(setItem))<br>        &#125;<br>        <span class="hljs-keyword">return</span> newSet<br>    &#125;<br><br>    <span class="hljs-comment">// 4. åˆ¤æ–­å€¼æ˜¯å¦ä¸ºmapç±»å‹</span><br>    <span class="hljs-keyword">if</span> (originValue <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Map</span>) &#123;<br>        <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [i, j] <span class="hljs-keyword">of</span> originValue) &#123;<br>            newMap.<span class="hljs-title function_">set</span>(<span class="hljs-title function_">deepCopy</span>(i, map), <span class="hljs-title function_">deepCopy</span>(j, map));<br>        &#125;<br>        <span class="hljs-keyword">return</span> newMap;<br>    &#125;<br><br>    <span class="hljs-comment">// 5. å¤„ç†æ—¥æœŸå¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> (originValue <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(originValue.<span class="hljs-title function_">getTime</span>());<br>    &#125;<br><br>    <span class="hljs-comment">// 6. å¤„ç†æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> (originValue <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(originValue);<br>    &#125;<br><br>    <span class="hljs-comment">// 7.å¦‚æœæ˜¯å‡½æ•°functionç±»å‹, ä¸éœ€è¦è¿›è¡Œæ·±æ‹·è´</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> originValue === <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> originValue<br>    &#125;<br><br>    <span class="hljs-comment">// 8.å¤„ç†å¾ªç¯å¼•ç”¨</span><br>    <span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">get</span>(originValue)) &#123;<br>        <span class="hljs-keyword">return</span> map.<span class="hljs-title function_">get</span>(originValue)<br>    &#125;<br><br>    <span class="hljs-comment">// 9.åˆ¤æ–­æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„ç±»å‹</span><br>    <span class="hljs-keyword">const</span> newObj = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(originValue) ? []: &#123;&#125;<br>    map.<span class="hljs-title function_">set</span>(originValue, newObj)<br><br>    <span class="hljs-comment">// éå†æ™®é€šçš„key</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> originValue) &#123;<br>        newObj[key] = <span class="hljs-title function_">deepCopy</span>(originValue[key], map);<br>    &#125;<br><br>    <span class="hljs-comment">// å•ç‹¬éå†symbol</span><br>    <span class="hljs-keyword">const</span> symbolKeys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(originValue)<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> symbolKey <span class="hljs-keyword">of</span> symbolKeys) &#123;<br>        newObj[<span class="hljs-title class_">Symbol</span>(symbolKey.<span class="hljs-property">description</span>)] = <span class="hljs-title function_">deepCopy</span>(originValue[symbolKey], map)<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> newObj<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="17-åˆ¤æ–­å¾ªç¯å¼•ç”¨çš„æ–¹æ³•"><a href="#17-åˆ¤æ–­å¾ªç¯å¼•ç”¨çš„æ–¹æ³•" class="headerlink" title="17. åˆ¤æ–­å¾ªç¯å¼•ç”¨çš„æ–¹æ³•"></a>17. åˆ¤æ–­å¾ªç¯å¼•ç”¨çš„æ–¹æ³•</h3><p>åŸç”Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isCycleObject</span> = (<span class="hljs-params">obj, parent</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> parentArr = parent || [obj]; <span class="hljs-comment">//  å¦‚æœæ²¡æœ‰ä¼ å…¥çˆ¶çº§, parentArrå°±ä»£è¡¨åŒ…å«å½“å‰å¯¹è±¡çš„æ•°ç»„</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parentArr);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">in</span> obj) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj[i] === <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>      <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;<br>      parentArr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">pObj</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (pObj === obj[i]) &#123;<br>          flag = <span class="hljs-literal">true</span>;<br>        &#125;<br>      &#125;);<br>      <span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      flag = <span class="hljs-title function_">isCycleObject</span>(obj[i], [...parentArr, obj[i]]); <span class="hljs-comment">// é€’å½’è°ƒç”¨è¿™ä¸ªå­å¯¹è±¡</span><br>      <span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;;<br><br><span class="hljs-keyword">var</span> a = &#123; <span class="hljs-attr">b</span>: &#123; <span class="hljs-attr">c</span>: &#123;&#125; &#125; &#125;;<br><br>a.<span class="hljs-property">b</span>.<span class="hljs-property">c</span>.<span class="hljs-property">d</span> = a;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isCycleObject</span>(a));<br><span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><p>é€’å½’ + å“ˆå¸Œè¡¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isCircular</span>(<span class="hljs-params">obj, hash = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) &#123;<br>  <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&#x27;object&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  <span class="hljs-keyword">if</span> (hash.<span class="hljs-title function_">has</span>(obj)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  hash.<span class="hljs-title function_">set</span>(obj, <span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hasOwnProperty</span>.<span class="hljs-title function_">call</span>(obj, key)) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCircular</span>(obj[key], hash)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><h3 id="1-å®ç°æ•°ç»„çš„æ‰å¹³åŒ–"><a href="#1-å®ç°æ•°ç»„çš„æ‰å¹³åŒ–" class="headerlink" title="1. å®ç°æ•°ç»„çš„æ‰å¹³åŒ–"></a>1. å®ç°æ•°ç»„çš„æ‰å¹³åŒ–</h3><p>å®ç°æ•°ç»„æ‰å¹³åŒ–æœ‰ 6 ç§æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript">ary = ary.<span class="hljs-title function_">flat</span>(<span class="hljs-title class_">Infinity</span>); <span class="hljs-comment">// Infinity ä»£è¡¨æ‰å¹³å¤šå°‘å±‚</span><br>ary = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(\[|\])/g</span>, <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;,&#x27;</span>) <span class="hljs-comment">// æŠŠæ‹¬å·å…¨éƒ¨æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²</span><br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]]];<br><span class="hljs-keyword">let</span> fn = <span class="hljs-keyword">function</span>(<span class="hljs-params">ary</span>) &#123;<br>  <span class="hljs-keyword">let</span> result = [];<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; ary.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">let</span> item = ary[i];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(item))&#123;<br>      result = result.<span class="hljs-title function_">concat</span>(<span class="hljs-title function_">fn</span>(item));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      result.<span class="hljs-title function_">push</span>(item);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">fn</span>(arr))  <span class="hljs-comment">// [ 1, 2, 3, 4, 5 ]</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">flatten</span>(<span class="hljs-params">ary</span>) &#123;<br>    <span class="hljs-keyword">return</span> ary.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">pre, cur</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> pre.<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(cur) ? <span class="hljs-title function_">flatten</span>(cur) : cur);<br>    &#125;, []);<br>&#125;<br><span class="hljs-comment">//åªè¦æœ‰ä¸€ä¸ªå…ƒç´ æœ‰æ•°ç»„ï¼Œé‚£ä¹ˆå¾ªç¯ç»§ç»­</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">flatten</span>(<span class="hljs-params">arr</span>) &#123;<br>    <span class="hljs-keyword">while</span> (arr.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(item))) &#123;<br>        arr = [].<span class="hljs-title function_">concat</span>(...arr);<br>    &#125;<br>    <span class="hljs-keyword">return</span> arr;<br>&#125;<br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]];<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">flatten</span>(<span class="hljs-params">arr</span>) &#123;<br>    <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;,&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">flatten</span>(arr)); <span class="hljs-comment">//  [ 1, 2, 3, 4 ]</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šæ•°ç»„ <code>arr.toString()</code> ä¹‹å ç›´æ¥å˜æˆäº† <code>1,2,3,4</code></p><h3 id="2-å®ç°æ•°ç»„å„ä¸ªæ–¹æ³•"><a href="#2-å®ç°æ•°ç»„å„ä¸ªæ–¹æ³•" class="headerlink" title="2. å®ç°æ•°ç»„å„ä¸ªæ–¹æ³•"></a>2. å®ç°æ•°ç»„å„ä¸ªæ–¹æ³•</h3><p>flat</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">_flat</span>(<span class="hljs-params">arr, depth</span>) &#123;<br>  <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arr) || depth &lt;= <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> arr;<br>  &#125;<br>  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">prev, cur</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(cur)) &#123;<br>      <span class="hljs-keyword">return</span> prev.<span class="hljs-title function_">concat</span>(<span class="hljs-title function_">_flat</span>(cur, depth - <span class="hljs-number">1</span>))<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> prev.<span class="hljs-title function_">concat</span>(cur);<br>    &#125;<br>  &#125;, []);<br>&#125;<br></code></pre></td></tr></table></figure><p>push</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ç®€ä¾¿å†™æ³•</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">for</span>( <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span> ; i &lt; <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> ; i++)&#123;<br><span class="hljs-variable language_">this</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>] = <span class="hljs-variable language_">arguments</span>[i] ;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>;<br>&#125;<br><br><br><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">...items</span>) &#123;<br>  <span class="hljs-keyword">let</span> O = <span class="hljs-title class_">Object</span>(<span class="hljs-variable language_">this</span>);<br>  <span class="hljs-keyword">let</span> len = <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span> &gt;&gt;&gt; <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">let</span> argCount = items.<span class="hljs-property">length</span> &gt;&gt;&gt; <span class="hljs-number">0</span>;<br>  <span class="hljs-comment">// 2 ** 53 - 1 ä¸ºJSèƒ½è¡¨ç¤ºçš„æœ€å¤§æ­£æ•´æ•°</span><br>  <span class="hljs-keyword">if</span> (len + argCount &gt; <span class="hljs-number">2</span> ** <span class="hljs-number">53</span> - <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;The number of array is over the max value restricted!&quot;</span>)<br>  &#125;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; argCount; i++) &#123;<br>    O[len + i] = items[i];<br>  &#125;<br>  <span class="hljs-keyword">let</span> newLength = len + argCount;<br>  O.<span class="hljs-property">length</span> = newLength;<br>  <span class="hljs-keyword">return</span> newLength;<br>&#125;<br></code></pre></td></tr></table></figure><p>pop</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">pop</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> O = <span class="hljs-title class_">Object</span>(<span class="hljs-variable language_">this</span>);<br>  <span class="hljs-keyword">let</span> len = <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span> &gt;&gt;&gt; <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) &#123;<br>    O.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;<br>  &#125;<br>  len --;<br>  <span class="hljs-keyword">let</span> value = O[len];<br>  <span class="hljs-keyword">delete</span> O[len];<br>  O.<span class="hljs-property">length</span> = len;<br>  <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></td></tr></table></figure><p>filter</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_filter</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">const</span> res = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, len = <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>; i &lt; len; i++) &#123;<br>        <span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>[i]) &amp;&amp; res.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>[i]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><p>map</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ç®€ä¾¿å†™æ³•</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">cb,thisArg</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-variable language_">this</span>) || <span class="hljs-keyword">typeof</span> cb != <span class="hljs-string">&#x27;function&#x27;</span>)&#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;has Error, please check!&#x27;</span>)<br>    &#125;<br>    <span class="hljs-keyword">var</span> res = []<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>; i++)&#123;<br>     <span class="hljs-comment">//ä½¿ç”¨callæ–¹æ³•æ¥æ”¹å˜thisæŒ‡å‘å³å¯</span><br>     res.<span class="hljs-title function_">push</span>(cb.<span class="hljs-title function_">call</span>(thisArg,<span class="hljs-variable language_">this</span>[i],i,<span class="hljs-variable language_">this</span>))<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>  &#125;<br><br><br><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_map</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) &#123;<br>   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">&quot;function&quot;</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">const</span> res = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, len = <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>; i &lt; len; i++) &#123;<br>        res.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>[i]));<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><p>reduce</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">reduce</span>  = <span class="hljs-keyword">function</span>(<span class="hljs-params">callbackfn, initialValue</span>) &#123;<br>  <span class="hljs-comment">// å¼‚å¸¸å¤„ç†ï¼Œå’Œ map ä¸€æ ·</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span> === <span class="hljs-literal">undefined</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Cannot read property &#x27;reduce&#x27; of null or undefined&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(callbackfn) != <span class="hljs-string">&quot;[object Function]&quot;</span>) &#123; <span class="hljs-comment">//æ³¨æ„ä¸­é—´æ— é€—å·</span><br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(callbackfn + <span class="hljs-string">&#x27; is not a function&#x27;</span>)<br>  &#125;<br>  <span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>;  <span class="hljs-comment">// åé¢è¦é‡å¤åˆ©ç”¨</span><br>  <span class="hljs-keyword">let</span> O = <span class="hljs-title class_">Object</span>(<span class="hljs-variable language_">this</span>);  <span class="hljs-comment">// å…ˆå°†è°ƒç”¨è€…è½¬ä¸ºå¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> len = O.<span class="hljs-property">length</span> &gt;&gt;&gt; <span class="hljs-number">0</span>;  <span class="hljs-comment">// ç¡®è®¤ä¸ºæ•´æ•°</span><br>  <span class="hljs-keyword">let</span> accumulator = initialValue; <span class="hljs-comment">// ç§¯ç´¯å€¼</span><br>  <span class="hljs-keyword">if</span> (accumulator === <span class="hljs-literal">undefined</span>) &#123;   <span class="hljs-comment">// æ²¡ä¼ åˆå§‹å€¼</span><br>    <span class="hljs-keyword">for</span>(; k &lt; len ; k++) &#123;<br>      <span class="hljs-keyword">if</span> (k <span class="hljs-keyword">in</span> O) &#123;  <br>        accumulator = O[k];<br>        k++;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">// è¡¨ç¤ºæ•°ç»„å…¨ä¸ºç©º</span><br>  <span class="hljs-keyword">if</span>(k === len &amp;&amp; accumulator === <span class="hljs-literal">undefined</span>) <br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Each element of the array is empty&#x27;</span>);<br>  <br>  <span class="hljs-keyword">for</span>(;k &lt; len; k++) &#123;<br>    <span class="hljs-keyword">if</span> (k <span class="hljs-keyword">in</span> O) &#123;<br>      accumulator = callbackfn.<span class="hljs-title function_">call</span>(<span class="hljs-literal">undefined</span>, accumulator, O[k], k, O);   <span class="hljs-comment">// æ³¨æ„ï¼Œæ ¸å¿ƒï¼</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> accumulator;<br>&#125;<br></code></pre></td></tr></table></figure><p>sort</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> quick_sort = <span class="hljs-keyword">function</span>(<span class="hljs-params">a, l, r</span>)&#123;<br>    <span class="hljs-keyword">if</span>(l &gt;= r)<span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">let</span> i = l - <span class="hljs-number">1</span>, j = r + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">let</span> mid = l + r &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">let</span> x = a[mid];<br>    <span class="hljs-keyword">while</span>(i &lt; j)&#123;<br>        <span class="hljs-keyword">do</span> i++; <span class="hljs-keyword">while</span>(a[i] &lt; x);<br>        <span class="hljs-keyword">do</span> j--; <span class="hljs-keyword">while</span>(a[j] &gt; x);<br>        <span class="hljs-keyword">if</span>(i &lt; j)&#123;<br>            <span class="hljs-keyword">let</span> z = a[i];<br>            a[i] = a[j];<br>            a[j] = z;<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_">quick_sort</span>(a, l, j);<br>    <span class="hljs-title function_">quick_sort</span>(a, j + <span class="hljs-number">1</span>, r);<br>&#125;<br><span class="hljs-keyword">var</span> q = [<span class="hljs-number">1</span>,<span class="hljs-number">44</span>,<span class="hljs-number">6</span>,<span class="hljs-number">713</span>,<span class="hljs-number">76</span>];<br><span class="hljs-title function_">quick_sort</span>(q, <span class="hljs-number">0</span>, q.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(q);  <span class="hljs-comment">// [ 1, 6, 44, 76, 713 ]</span><br></code></pre></td></tr></table></figure><p>splice æ–¹æ³•(äº†è§£åŸç†)</p><details class="lake-collapse"><summary id="u3d2e2d29"><span class="ne-text">ä»£ç </span></summary><pre data-language="javascript" id="YT8RU" class="ne-codeblock language-javascript" style="border: 1px solid #e8e8e8; border-radius: 2px; background: #f9f9f9; padding: 16px; font-size: 13px; color: #595959"><code>Array.prototype.splice = function(startIndex, deleteCount, ...addElements)  &#123;  // 1. åˆå§‹å·¥ä½œ  let argumentsLen = arguments.length;  let array = Object(this);  let len = array.length;  let deleteArr = new Array(deleteCount);<pre><code class="hljs">// 2. å‚æ•°çš„æ¸…æ´—å·¥ä½œ</code></pre><p>  &#x2F;&#x2F; å½“ç”¨æˆ·ä¼ æ¥éæ³•çš„ startIndex å’Œ deleteCount æˆ–è€…è´Ÿç´¢å¼•çš„æ—¶å€™ï¼Œéœ€è¦æˆ‘ä»¬åšå‡ºç‰¹æ®Šçš„å¤„ç†ã€‚<br>  if (startIndex &lt; 0) {<br>    startIndex &#x3D; startIndex + len &gt; 0 ? startIndex + len: 0;<br>  }<br>  else startIndex &#x3D; startIndex &gt;&#x3D; len ? len: startIndex;</p><p>  &#x2F;&#x2F; åˆ é™¤æ•°ç›®æ²¡æœ‰ä¼ ï¼Œé»˜è®¤åˆ é™¤startIndexåŠåé¢æ‰€æœ‰çš„<br>  if (argumentsLen &#x3D;&#x3D;&#x3D; 1)  deleteCount &#x3D; len - startIndex;<br>  else if (deleteCount &lt; 0) deleteCount &#x3D; 0 &#x2F;&#x2F; åˆ é™¤æ•°ç›®è¿‡å°<br>  else if (deleteCount &gt; len - startIndex) deletCount &#x3D; len - startIndex; &#x2F;&#x2F;åˆ é™¤æ•°ç›®è¿‡å¤§</p><pre><code class="hljs">// 3. åˆ¤æ–­ sealed å¯¹è±¡å’Œ frozen å¯¹è±¡, å³ å¯†å°å¯¹è±¡ å’Œ å†»ç»“å¯¹è±¡if (Object.isSealed(array) &amp;amp;&amp;amp; deleteCount !== addElements.length) &#123;throw new TypeError(&#39;the object is a sealed object!&#39;)</code></pre><p>  } else if(Object.isFrozen(array) &amp;&amp; (deleteCount &gt; 0 || addElements.length &gt; 0)) {<br>    throw new TypeError(â€˜the object is a frozen object!â€™)<br>  }</p><p>  &#x2F;&#x2F; 4.æ‹·è´åˆ é™¤çš„å…ƒç´ <br>  for (let i &#x3D; 0; i &lt; deleteCount; i++) {<br>    let index &#x3D; startIndex + i;<br>    if (index in array) {<br>      let current &#x3D; array[index];<br>      deleteArr[i] &#x3D; current;<br>    }<br>  }</p><p>  &#x2F;&#x2F; 5.ç§»åŠ¨åˆ é™¤å…ƒç´ åé¢çš„å…ƒç´ </p><p>  &#x2F;&#x2F; å¯¹åˆ é™¤å…ƒç´ åé¢çš„å…ƒç´ è¿›è¡ŒæŒªåŠ¨, æŒªåŠ¨åˆ†ä¸ºä¸‰ç§æƒ…å†µ:<br>  &#x2F;&#x2F; * æ·»åŠ çš„å…ƒç´ å’Œåˆ é™¤çš„å…ƒç´ ä¸ªæ•°ç›¸ç­‰<br>  &#x2F;&#x2F; * æ·»åŠ çš„å…ƒç´ ä¸ªæ•°å°äºåˆ é™¤çš„å…ƒç´ <br>  &#x2F;&#x2F; * æ·»åŠ çš„å…ƒç´ ä¸ªæ•°å¤§äºåˆ é™¤çš„å…ƒç´ </p><p>  if (deleteCount &#x3D;&#x3D;&#x3D; addElements.length) &#x2F;&#x2F; å°±ä»€ä¹ˆä¹Ÿä¸ç®¡<br>  else if(deleteCount &gt; addElements.length) {<br>    &#x2F;&#x2F; åˆ é™¤çš„å…ƒç´ æ¯”æ–°å¢çš„å…ƒç´ å¤šï¼Œé‚£ä¹ˆåé¢çš„å…ƒç´ æ•´ä½“å‘å‰æŒªåŠ¨<br>    for (let i &#x3D; startIndex + deleteCount; i &lt; len; i++) {<br>      let fromIndex &#x3D; i; &#x2F;&#x2F; ç§»åŠ¨å…ƒç´ çš„èµ·å§‹ä½ç½®<br>      let toIndex &#x3D; i - (deleteCount - addElements.length); &#x2F;&#x2F; å°†è¦æŒªåŠ¨åˆ°çš„ç›®æ ‡ä½ç½®<br>      if (fromIndex in array) {<br>        array[toIndex] &#x3D; array[fromIndex];<br>      } else {<br>        delete array[toIndex];<br>      }<br>    }<br>    &#x2F;&#x2F; æ³¨æ„æ³¨æ„ï¼è¿™é‡Œæˆ‘ä»¬æŠŠåé¢çš„å…ƒç´ å‘å‰æŒªï¼Œç›¸å½“äºæ•°ç»„é•¿åº¦å‡å°äº†ï¼Œéœ€è¦åˆ é™¤å†—ä½™å…ƒç´ <br>    &#x2F;&#x2F; ç›®å‰é•¿åº¦ä¸º len + addElements - deleteCount<br>    for (let i &#x3D; len - 1; i &gt;&#x3D; len + addElements.length - deleteCount; i â€“) {<br>      delete array[i];<br>    }<br>  }<br>     else if(deleteCount &lt; addElements.length) {<br>    &#x2F;&#x2F; åˆ é™¤çš„å…ƒç´ æ¯”æ–°å¢çš„å…ƒç´ å°‘ï¼Œé‚£ä¹ˆåé¢çš„å…ƒç´ æ•´ä½“å‘åæŒªåŠ¨<br>    &#x2F;&#x2F; æ€è€ƒä¸€ä¸‹: è¿™é‡Œä¸ºä»€ä¹ˆè¦ä»åå¾€å‰éå†ï¼Ÿä»å‰å¾€åä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ<br>    for (let i &#x3D; len - 1; i &gt;&#x3D; startIndex + deleteCount; iâ€“) {<br>      let fromIndex &#x3D; i;  &#x2F;&#x2F; æŒªåŠ¨å…ƒç´ çš„åˆå§‹ä½ç½®<br>      let toIndex &#x3D; i + (addElements.length - deleteCount); &#x2F;&#x2F; å°†è¦æŒªåŠ¨åˆ°çš„ç›®æ ‡ä½ç½®<br>      if (fromIndex in array) {<br>        array[toIndex] &#x3D; array[fromIndex];<br>      } else {<br>        delete array[toIndex];<br>      }<br>    }<br>  }</p><p>  &#x2F;&#x2F; 6.æ’å…¥æ–°å…ƒç´ <br>  for (let i &#x3D; 0; i &lt; addElements.length; i++) {<br>    array[startIndex + i] &#x3D; addElements[i];<br>  }<br>  array.length &#x3D; len - deleteCount + addElements.length;</p><p>  &#x2F;&#x2F; 7.è¿”å›è¢«åˆ é™¤å…ƒç´ ç»„æˆçš„æ•°ç»„<br>  return deleteArr;<br>}</code></pre></details></p><h3 id="å®ç°æ•°ç»„çš„ä¹±åºè¾“å‡º"><a href="#å®ç°æ•°ç»„çš„ä¹±åºè¾“å‡º" class="headerlink" title="å®ç°æ•°ç»„çš„ä¹±åºè¾“å‡º"></a>å®ç°æ•°ç»„çš„ä¹±åºè¾“å‡º</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> arr = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) &#123;<br>  <span class="hljs-comment">// æ³¨æ„æœ€ååŠ iå°±è¡Œ, å¦åˆ™ä¼šé‡å¤è¾“å‡ºåŒä¸€ä¸ªå€¼</span><br>  <span class="hljs-keyword">const</span> randomIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (arr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span> - i)) + i; <br>  [arr[i], arr[randomIndex]] = [arr[randomIndex], arr[i]];<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr)<br></code></pre></td></tr></table></figure><h3 id="å®ç°å­—ç¬¦ä¸²çš„-repeat-æ–¹æ³•"><a href="#å®ç°å­—ç¬¦ä¸²çš„-repeat-æ–¹æ³•" class="headerlink" title="å®ç°å­—ç¬¦ä¸²çš„ repeat æ–¹æ³•"></a>å®ç°å­—ç¬¦ä¸²çš„ repeat æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">repeat</span>(<span class="hljs-params">s, n</span>) &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>)).<span class="hljs-title function_">join</span>(s);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-å®ç°å­—ç¬¦ä¸²å„ä¸ªæ–¹æ³•"><a href="#3-å®ç°å­—ç¬¦ä¸²å„ä¸ªæ–¹æ³•" class="headerlink" title="3. å®ç°å­—ç¬¦ä¸²å„ä¸ªæ–¹æ³•"></a>3. å®ç°å­—ç¬¦ä¸²å„ä¸ªæ–¹æ³•</h3><p>repeat</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">repeat</span>(<span class="hljs-params">s, n</span>) &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>)).<span class="hljs-title function_">join</span>(s);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-å°†æ•°å­—æ¯åƒåˆ†ä½ç”¨é€—å·éš”å¼€"><a href="#4-å°†æ•°å­—æ¯åƒåˆ†ä½ç”¨é€—å·éš”å¼€" class="headerlink" title="4. å°†æ•°å­—æ¯åƒåˆ†ä½ç”¨é€—å·éš”å¼€"></a>4. å°†æ•°å­—æ¯åƒåˆ†ä½ç”¨é€—å·éš”å¼€</h3><p>æ•°å­—æ— å°æ•°ç‰ˆæœ¬</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">format</span> = n =&gt; &#123;<br>    <span class="hljs-keyword">let</span> num = n.<span class="hljs-title function_">toString</span>() <br>    <span class="hljs-keyword">let</span> len = num.<span class="hljs-property">length</span><br>    <span class="hljs-keyword">if</span> (len &lt;= <span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-keyword">return</span> num<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">let</span> remainder = len % <span class="hljs-number">3</span><br>        <span class="hljs-keyword">if</span> (remainder &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// ä¸æ˜¯3çš„æ•´æ•°å€</span><br>          <span class="hljs-comment">// æ¯éš”ä¸‰ä¸ªæ•°å­—ç”¨é€—å·åˆ†éš”ä¸ºå­—ç¬¦ä¸²</span><br>          <span class="hljs-keyword">return</span> num.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, remainder) + <span class="hljs-string">&#x27;,&#x27;</span> + num.<span class="hljs-title function_">slice</span>(remainder, len).<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d&#123;3&#125;/g</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;,&#x27;</span>) <br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// æ˜¯3çš„æ•´æ•°å€</span><br>            <span class="hljs-keyword">return</span> num.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, len).<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d&#123;3&#125;/g</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;,&#x27;</span>) <br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_">format</span>(<span class="hljs-number">1232323</span>)  <span class="hljs-comment">// &#x27;1,232,323&#x27;</span><br></code></pre></td></tr></table></figure><p>æ•°å­—æœ‰å°æ•°ç‰ˆæœ¬</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">format</span> = n =&gt; &#123;<br>    <span class="hljs-keyword">let</span> num = n.<span class="hljs-title function_">toString</span>() <span class="hljs-comment">// è½¬æˆå­—ç¬¦ä¸²</span><br>    <span class="hljs-keyword">let</span> decimals = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰å°æ•°</span><br>    num.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;.&#x27;</span>) &gt; -<span class="hljs-number">1</span> ? decimals = num.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>] : decimals<br>    <span class="hljs-keyword">let</span> len = num.<span class="hljs-property">length</span><br>    <span class="hljs-keyword">if</span> (len &lt;= <span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-keyword">return</span> num<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">let</span> temp = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">let</span> remainder = len % <span class="hljs-number">3</span><br>        decimals ? temp = <span class="hljs-string">&#x27;.&#x27;</span> + decimals : temp<br>        <span class="hljs-keyword">if</span> (remainder &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// ä¸æ˜¯3çš„æ•´æ•°å€</span><br>            <span class="hljs-keyword">return</span> num.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, remainder) + <span class="hljs-string">&#x27;,&#x27;</span> + num.<span class="hljs-title function_">slice</span>(remainder, len).<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d&#123;3&#125;/g</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;,&#x27;</span>) + temp<br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// æ˜¯3çš„æ•´æ•°å€</span><br>            <span class="hljs-keyword">return</span> num.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, len).<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d&#123;3&#125;/g</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;,&#x27;</span>) + temp <br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-title function_">format</span>(<span class="hljs-number">12323.33</span>)  <span class="hljs-comment">// &#x27;12,323.33&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="5-æ‰‹å†™æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°"><a href="#5-æ‰‹å†™æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°" class="headerlink" title="5. æ‰‹å†™æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°"></a>5. æ‰‹å†™æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">dateFormat</span> = (<span class="hljs-params">dateInput, format</span>)=&gt;&#123;<br>    <span class="hljs-keyword">var</span> day = dateInput.<span class="hljs-title function_">getDate</span>() <br>    <span class="hljs-keyword">var</span> month = dateInput.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>  <br>    <span class="hljs-keyword">var</span> year = dateInput.<span class="hljs-title function_">getFullYear</span>()   <br>    format = format.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/yyyy/</span>, year)<br>    format = format.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/MM/</span>,month)<br>    format = format.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/dd/</span>,day)<br>    <span class="hljs-keyword">return</span> format<br>&#125;<br><span class="hljs-title function_">dateFormat</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2020-12-01&#x27;</span>), <span class="hljs-string">&#x27;yyyy/MM/dd&#x27;</span>) <span class="hljs-comment">// 2020/12/01</span><br><span class="hljs-title function_">dateFormat</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2020-04-01&#x27;</span>), <span class="hljs-string">&#x27;yyyy/MM/dd&#x27;</span>) <span class="hljs-comment">// 2020/04/01</span><br><span class="hljs-title function_">dateFormat</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2020-04-01&#x27;</span>), <span class="hljs-string">&#x27;yyyyå¹´MMæœˆddæ—¥&#x27;</span>) <span class="hljs-comment">// 2020å¹´04æœˆ01æ—¥</span><br></code></pre></td></tr></table></figure><h3 id="6-å®ç°å¤§æ•´æ•°ç›¸åŠ "><a href="#6-å®ç°å¤§æ•´æ•°ç›¸åŠ " class="headerlink" title="6. å®ç°å¤§æ•´æ•°ç›¸åŠ "></a>6. å®ç°å¤§æ•´æ•°ç›¸åŠ </h3><p>æ¥è‡ªç®—æ³•ç¯‡ç« </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-string">&#x27;13124342343353535235&#x27;</span><br><span class="hljs-keyword">let</span> b = <span class="hljs-string">&#x27;34423434234234243233&#x27;</span><br><span class="hljs-comment">// ä¸¤ä¸ªå­—ç¬¦ä¸²a, b</span><br><span class="hljs-keyword">let</span> arr1 = a.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);<br><span class="hljs-keyword">let</span> arr2 = b.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);<br><span class="hljs-keyword">let</span> res = [];<br><span class="hljs-keyword">let</span> flag = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span>(arr1.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> || arr2.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>  <span class="hljs-keyword">let</span> t1 = arr1.<span class="hljs-title function_">pop</span>() || <span class="hljs-number">0</span>;  <span class="hljs-comment">// åˆ¤æ–­arr1æ˜¯å¦å·²ç»ä¸ºç©º</span><br>  <span class="hljs-keyword">let</span> t2 = arr2.<span class="hljs-title function_">pop</span>() || <span class="hljs-number">0</span>;  <span class="hljs-comment">// åˆ¤æ–­arr2æ˜¯å¦å·²ç»ä¸ºç©º</span><br>  <span class="hljs-keyword">let</span> tmp = t1 + t2 + flag;<br>  flag = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(tmp / <span class="hljs-number">10</span>)<br>  res.<span class="hljs-title function_">unshift</span>(tmp % <span class="hljs-number">10</span>)<br>&#125;<br><span class="hljs-keyword">if</span>(flag) res.<span class="hljs-title function_">unshift</span>(flag);<br>res = res.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res); <span class="hljs-comment">// 47547776577587778468</span><br></code></pre></td></tr></table></figure><h3 id="7-è§£æ-URL-Params-ä¸ºå¯¹è±¡"><a href="#7-è§£æ-URL-Params-ä¸ºå¯¹è±¡" class="headerlink" title="7. è§£æ URL Params ä¸ºå¯¹è±¡"></a>7. è§£æ URL Params ä¸ºå¯¹è±¡</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> url = <span class="hljs-string">&#x27;http://www.domain.com/?user=anonymous&amp;id=123&amp;id=456&amp;city=%E5%8C%97%E4%BA%AC&amp;enabled&#x27;</span>;<br><span class="hljs-title function_">parseParam</span>(url)<br><span class="hljs-comment">/* ç»“æœ</span><br><span class="hljs-comment">&#123; user: &#x27;anonymous&#x27;,</span><br><span class="hljs-comment">  id: [ 123, 456 ], // é‡å¤å‡ºç°çš„ key è¦ç»„è£…æˆæ•°ç»„ï¼Œèƒ½è¢«è½¬æˆæ•°å­—çš„å°±è½¬æˆæ•°å­—ç±»å‹</span><br><span class="hljs-comment">  city: &#x27;åŒ—äº¬&#x27;, // ä¸­æ–‡éœ€è§£ç </span><br><span class="hljs-comment">  enabled: true, // æœªæŒ‡å®šå€¼å¾— key çº¦å®šä¸º true</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>exec æ˜¯æ­£åˆ™çš„æ–¹æ³•</p><p>exec() æ–¹æ³•åœ¨ä¸€ä¸ªæŒ‡å®šå­—ç¬¦ä¸²ä¸­æ‰§è¡Œä¸€ä¸ªæœç´¢åŒ¹é…ã€‚è¿”å›ä¸€ä¸ªç»“æœæ•°ç»„æˆ– nullã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseParam</span>(<span class="hljs-params">url</span>) &#123;<br>  <span class="hljs-keyword">const</span> paramsStr = <span class="hljs-regexp">/.+\?(.+)$/</span>.<span class="hljs-title function_">exec</span>(url)[<span class="hljs-number">1</span>]; <span class="hljs-comment">// å°† ? åé¢çš„å­—ç¬¦ä¸²å–å‡ºæ¥â—</span><br>  <span class="hljs-keyword">const</span> paramsArr = paramsStr.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&amp;&#x27;</span>); <span class="hljs-comment">// å°†å­—ç¬¦ä¸²ä»¥ &amp; åˆ†å‰²åå­˜åˆ°æ•°ç»„ä¸­</span><br>  <span class="hljs-keyword">let</span> paramsObj = &#123;&#125;;<br>  <span class="hljs-comment">// å°† params å­˜åˆ°å¯¹è±¡ä¸­</span><br>  paramsArr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">param</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/=/</span>.<span class="hljs-title function_">test</span>(param)) &#123; <span class="hljs-comment">// å¤„ç†æœ‰ value çš„å‚æ•°, å­˜åœ¨ &#x27;=&#x27;</span><br>      <span class="hljs-keyword">let</span> [key, val] = param.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;=&#x27;</span>); <span class="hljs-comment">// åˆ†å‰² key å’Œ value</span><br>      val = <span class="hljs-built_in">decodeURIComponent</span>(val); <span class="hljs-comment">// è§£ç â— æ³¨æ„è¿˜éœ€è§£ç </span><br>      val = <span class="hljs-regexp">/^\d+$/</span>.<span class="hljs-title function_">test</span>(val) ? <span class="hljs-built_in">parseFloat</span>(val) : val; <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦è½¬ä¸ºæ•°å­—</span><br>      <span class="hljs-keyword">if</span> (paramsObj.<span class="hljs-title function_">hasOwnProperty</span>(key)) &#123; <span class="hljs-comment">// å¦‚æœå¯¹è±¡æœ‰ keyï¼Œåˆ™æ·»åŠ ä¸€ä¸ªå€¼</span><br>        paramsObj[key] = [].<span class="hljs-title function_">concat</span>(paramsObj[key], val); <span class="hljs-comment">// å°†å…¶å˜ä¸ºæ•°ç»„, å› ä¸ºæœ‰å¤šä¸ªå€¼, å°±ç”¨æ•°ç»„å­˜èµ·æ¥</span><br>      &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// å¦‚æœå¯¹è±¡æ²¡æœ‰è¿™ä¸ª keyï¼Œåˆ›å»º key å¹¶è®¾ç½®å€¼</span><br>        paramsObj[key] = val;<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// å¤„ç†æ²¡æœ‰ value çš„å‚æ•°</span><br>      paramsObj[param] = <span class="hljs-literal">true</span>;<br>    &#125;<br>  &#125;)<br>  <span class="hljs-keyword">return</span> paramsObj;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaScript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ‰‹å†™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vueå“åº”å¼åŸç†</title>
    <link href="/2023/09/12/Vue%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
    <url>/2023/09/12/Vue%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="1-è®¤è¯†å“åº”å¼é€»è¾‘"><a href="#1-è®¤è¯†å“åº”å¼é€»è¾‘" class="headerlink" title="1. è®¤è¯†å“åº”å¼é€»è¾‘"></a>1. è®¤è¯†å“åº”å¼é€»è¾‘</h2><blockquote><p>æŠ½è±¡æç»˜</p></blockquote><ul><li>å‡å¦‚ä½ æœ‰ä¸€ä¸ªå˜é‡m , ä½ çš„æŸä¸€æ®µä»£ç ä½¿ç”¨äº†å˜é‡m , å¦‚æœæŸä¸ªæ—¶åˆ»å˜é‡må‘ç”Ÿäº†æ”¹å˜, é‚£ä¹ˆè¿™æ®µä»£ç ä¹Ÿä¼šé‡æ–°æ‰§è¡Œ.</li><li>ä½†å®é™…ä¸Šæ‰§è¡Œçš„ä»£ç ä¸­å¯èƒ½ä¸æ­¢ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä»£ç æ”¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸­, äºæ˜¯å°±å˜æˆäº†, <strong>ä½ æœ‰ä¸€ä¸ªå¯¹è±¡, ä½ çš„æŸä¸ªå‡½æ•°ä½¿ç”¨äº†å¯¹è±¡çš„æŸä¸ªå±æ€§, å¦‚æœæŸä¸ªæ—¶å€™è¿™ä¸ªå±æ€§å‘ç”Ÿæ”¹å˜, è¿™ä¸ªå‡½æ•°ä¹Ÿä¼šé‡æ–°æ‰§è¡Œ</strong></li></ul><blockquote><p>å…·ä½“æè¿°</p></blockquote><p>æ•°æ®é©±åŠ¨è§†å›¾ </p><p>ç®€æ´ç‰ˆ :</p><p>åœ¨ Vue å®ä¾‹åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆå¯¹æ‰€æœ‰å±æ€§è¿›è¡ŒåŠ«æŒ ( vue2 &#x2F; vue3 æ–¹æ³•å’ŒåŸç†éƒ½ä¸åŒ, æ³¨æ„è¾¨åˆ« ) ,   åŒæ—¶ä¼šä¸ºæ¯ä¸ªæ•°æ®å±æ€§åˆ›å»ºä¸€ä¸ª <code>Dep</code>ï¼ˆä¾èµ–ï¼‰ï¼ŒDep ç”¨äºæ”¶é›†æ‰€æœ‰è®¢é˜…äº†è¯¥å±æ€§çš„ <code>Watcher</code>ã€‚å½“å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒVue ä¼šé€šçŸ¥è¯¥å±æ€§å¯¹åº”çš„è¿™äº› <code>Watcher</code> å®ä¾‹è¿›è¡Œç›¸åº”çš„æ›´æ–°æ“ä½œã€‚</p><ul><li>æ•°æ®å“åº”å¼</li></ul><p>Vueé‡‡ç”¨çš„æ˜¯<strong>æ•°æ®åŠ«æŒ</strong>ç»“åˆ<strong>å‘å¸ƒå’Œ-è®¢é˜…è€…æ¨¡å¼</strong>çš„æ–¹å¼</p><blockquote><p> é€šè¿‡æ‹¦æˆªå¯¹æ•°æ®çš„æ“ä½œï¼Œåœ¨æ•°æ®å˜åŠ¨æ—¶å‘å¸ƒæ¶ˆæ¯ç»™è®¢é˜…è€…ï¼Œè§¦å‘ç›¸åº”çš„ç›‘å¬å›è°ƒã€‚</p></blockquote><h3 id=""><a href="#" class="headerlink" title=""></a></h3><ul><li>æ•°æ®åŠ«æŒ</li></ul><blockquote><p>vue2æ•°æ®åŠ«æŒ</p></blockquote><p>vue2é€šè¿‡<code>Object.defineProperty</code>å¯¹<code>data</code>ä¸Šçš„æ•°æ®<strong>é€’å½’åœ°</strong>è¿›è¡Œ(è½¬ä¸º)<code>getter</code>å’Œ<code>setter</code>æ“ä½œã€‚ä¹Ÿå°±æ˜¯å¯¹å±æ€§çš„è¯»å–ã€ä¿®æ”¹è¿›è¡Œæ‹¦æˆªï¼ˆæ•°æ®åŠ«æŒï¼‰</p><p>æ³¨æ„æ˜¯å°† data ä¸­çš„æ‰€æœ‰å±æ€§è¿›è¡Œç›‘å¬</p><blockquote><p>vue3 æ•°æ®åŠ«æŒ</p></blockquote><p>vue3é€šè¿‡<code>Proxy</code>å¯¹è±¡åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚<code>Proxy</code>çš„ç›‘å¬æ˜¯æ·±å±‚æ¬¡çš„ï¼Œ<strong>ç›‘å¬æ•´ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æŸä¸ªå±æ€§ã€‚</strong></p><p>è¿™é‡Œæ˜¯å°† reactive () ä¸­çš„æ‰€æœ‰å±æ€§è¿›è¡Œç›‘å¬</p><ul><li>å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼</li></ul><p>ç®€å•åœ°è¯´ï¼Œå‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼çš„æµç¨‹å°±æ˜¯ï¼Œç›‘å¬å™¨<code>**Observer**</code>ç›‘å¬æ•°æ®çŠ¶æ€å˜åŒ–, ä¸€æ—¦æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¼šé€šçŸ¥(æ•°æ®)å¯¹åº”çš„è®¢é˜…è€…<code>**Watcher**</code>ï¼Œè®©è®¢é˜…è€…æ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘ ã€‚</p><ul><li>æ•´ä¸ªå“åº”å¼æ‰§è¡Œè¿‡ç¨‹</li></ul><ol><li>åœ¨ Vue å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œ æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨<code>**Observer**</code>ï¼Œæ­¤å®ä¾‹çš„æ‰€æœ‰ç›¸å…³å±æ€§ä¼šè¢«ç›‘å¬(ä¹Ÿå°±æ˜¯ä¸Šæ–¹çš„æ•°æ®åŠ«æŒ)  . åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒVue ä¼šå¯¹<strong>æ¯ä¸ªå±æ€§</strong>åˆ›å»ºä¸€ä¸ª <code>dep</code> å®ä¾‹</li></ol><ul><li>vue2 å¯¹ data ä¸­çš„å±æ€§è¿›è¡Œéå†ç”Ÿæˆ <code>dep</code> å®ä¾‹</li><li>vue3 ä¸­å¯¹ <code>reactive()</code> ä¸­çš„å¯¹è±¡è¿›è¡Œéå†ç”Ÿæˆ <code>dep</code> å®ä¾‹</li><li><code>dep</code> å®ä¾‹ä¼šæ”¶é›†æ‰€æœ‰è®¢é˜…äº†è¯¥å±æ€§çš„ <code>Watcher è®¢é˜…è€…</code>, å¹¶å°†è¯¥ <code>Watcher</code> ç»‘å®šæ›´æ–°å‡½æ•°</li><li>è¿™äº›æ›´æ–°å‡½æ•°å¯èƒ½ä¼šæ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ›´æ–°æ¨¡æ¿ä¸­çš„æ–‡æœ¬ã€è®¡ç®—æ–°çš„å€¼ç­‰</li></ul><ol><li>é€šè¿‡<code>Compile</code>è§£ææ¨¡æ¿æŒ‡ä»¤ï¼Œå°†æ¨¡æ¿ä¸­çš„æ•°æ®å’Œæ–¹æ³•ä¸çœŸå® DOM èŠ‚ç‚¹å…³è”èµ·æ¥ï¼Œä½¿å¾—æ•°æ®å’Œæ–¹æ³•èƒ½å¤Ÿè¢«è§†å›¾è®¿é—®å’Œä½¿ç”¨, ç„¶åå†åˆå§‹åŒ–æ¸²æŸ“é¡µé¢è§†å›¾.</li><li>ä¸€æ—¦å±æ€§å‘ç”Ÿå˜åŒ–ï¼ŒVue ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…äº†å½“å‰å±æ€§çš„çš„è®¢é˜…è€…<code>Watcher</code>(è¿™äº› <code>Watcher</code> æ”¾åœ¨å±æ€§å¯¹åº”çš„ <code>dep</code> å®ä¾‹å½“ä¸­), æ¥æ‰§è¡Œæ­¤è®¢é˜…è€…å¯¹åº”çš„æ›´æ–°å‡½æ•°,  ä»è€Œæ›´æ–°è§†å›¾.</li></ol><blockquote><p> MVVMä½œä¸ºæ•°æ®ç»‘å®šçš„å…¥å£ï¼Œæ•´åˆObserverã€Compileå’ŒWatcherä¸‰è€…ï¼Œé€šè¿‡Observeræ¥ç›‘å¬è‡ªå·±çš„modelæ•°æ®å˜åŒ–ï¼Œé€šè¿‡Compileæ¥è§£æç¼–è¯‘æ¨¡æ¿æŒ‡ä»¤ï¼Œæœ€ç»ˆåˆ©ç”¨Watcheræ­èµ·Observerå’ŒCompileä¹‹é—´çš„é€šä¿¡æ¡¥æ¢ï¼Œè¾¾åˆ°æ•°æ®å˜åŒ– -&gt; è§†å›¾æ›´æ–°ï¼›è§†å›¾äº¤äº’å˜åŒ–(input) -&gt; æ•°æ®modelå˜æ›´çš„åŒå‘ç»‘å®šæ•ˆæœã€‚</p></blockquote><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309210946810.png" alt="image-20230921094628751"></p><h2 id="2-å“åº”å¼ä¾èµ–æ”¶é›†"><a href="#2-å“åº”å¼ä¾èµ–æ”¶é›†" class="headerlink" title="2. å“åº”å¼ä¾èµ–æ”¶é›†"></a>2. å“åº”å¼ä¾èµ–æ”¶é›†</h2><h3 id="2-1-å“åº”å¼å‡½æ•°çš„å®ç°watchFn"><a href="#2-1-å“åº”å¼å‡½æ•°çš„å®ç°watchFn" class="headerlink" title="2.1. å“åº”å¼å‡½æ•°çš„å®ç°watchFn"></a>2.1. å“åº”å¼å‡½æ•°çš„å®ç°watchFn</h3><p>æˆ‘ä»¬ç°åœ¨å®ç°ä¸€ä¸ªå“åº”å¼å‡½æ•°</p><p>â—¼ ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆåŒºåˆ†å‘¢ï¼Ÿ</p><ul><li>ï°è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°è£…ä¸€ä¸ªæ–°çš„å‡½æ•°<code>watchFn</code>ï¼›</li><li>ï°<strong>å‡¡æ˜¯ä¼ å…¥åˆ°watchFnçš„å‡½æ•°ï¼Œå°±æ˜¯éœ€è¦å“åº”å¼çš„ï¼›</strong></li><li>ï°å…¶ä»–é»˜è®¤å®šä¹‰çš„å‡½æ•°éƒ½æ˜¯ä¸éœ€è¦å“åº”å¼çš„ï¼›</li></ul><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927280.png" alt="img"></p><p>å¦‚å›¾, fooä»¥åŠbaréƒ½æ˜¯éœ€è¦å“åº”å¼çš„</p><p>æˆ‘ä»¬å°†è¿™äº›å‡½æ•°åœ¨å“åº”ä¹‹å‰å…ˆæ‰§è¡Œä¸€æ¬¡</p><p>å½“objçš„æŸä¸ªå±æ€§å‘ç”Ÿå˜åŒ–æ—¶, å°±ä¾æ¬¡æ‰§è¡ŒreactiveFnsä¸­çš„å‡½æ•°</p><p>ç›®å‰å½“ç„¶æ˜¯æä¸ºä¸å®Œå–„, å¾…åç»­ä¼˜åŒ–hhh</p><h3 id="2-2-å“åº”å¼ä¾èµ–çš„æ”¶é›†-ç±»"><a href="#2-2-å“åº”å¼ä¾èµ–çš„æ”¶é›†-ç±»" class="headerlink" title="2.2. å“åº”å¼ä¾èµ–çš„æ”¶é›†__ç±»"></a>2.2. å“åº”å¼ä¾èµ–çš„æ”¶é›†__ç±»</h3><p>â—¼ ç›®å‰æˆ‘ä»¬æ”¶é›†çš„ä¾èµ–æ˜¯æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æ¥ä¿å­˜çš„ï¼Œä½†æ˜¯è¿™é‡Œä¼šå­˜åœ¨æ•°æ®ç®¡ç†çš„é—®é¢˜ï¼š</p><ul><li>ï° æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­<strong>éœ€è¦ç›‘å¬å¾ˆå¤šå¯¹è±¡çš„å“åº”å¼ï¼›</strong></li><li>ï° è¿™äº›å¯¹è±¡éœ€è¦ç›‘å¬çš„ä¸åªæ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒä»¬å¾ˆå¤šå±æ€§çš„å˜åŒ–ï¼Œéƒ½ä¼šæœ‰å¯¹åº”çš„å“åº”å¼å‡½æ•°ï¼›</li><li>ï° æˆ‘ä»¬ä¸<strong>å¯èƒ½åœ¨å…¨å±€ç»´æŠ¤ä¸€å¤§å †çš„æ•°ç»„æ¥ä¿å­˜è¿™äº›å“åº”å‡½æ•°ï¼›</strong></li></ul><p>â—¼ æ‰€ä»¥æˆ‘ä»¬è¦<strong>è®¾è®¡ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ç”¨äºç®¡ç†æŸä¸€ä¸ªå¯¹è±¡çš„æŸä¸€ä¸ªå±æ€§çš„æ‰€æœ‰å“åº”å¼å‡½æ•°ï¼š</strong></p><ul><li>ï° ç›¸å½“äºæ›¿ä»£äº†åŸæ¥çš„ç®€å• reactiveFns çš„æ•°ç»„ï¼›</li></ul><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927189.png" alt="img"></p><p>è¿™ä¸ªç±»è®°ä½</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927257.png" alt="img"></p><p>å½“æˆ‘ä»¬æŸä¸ªå±æ€§å‘ç”Ÿå˜åŒ–æ—¶, åªéœ€æ‰§è¡Œdep.notify()å°±è¡Œäº†, æ— éœ€ä¸€ä¸ªä¸€ä¸ªçš„éå†å‡½æ•°</p><p>è¿™ä¸ªobjå¯¹è±¡å°±å¯¹åº”Dependç±»æ‰€åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡</p><p>å½“ç„¶, è¿˜éœ€å¤§å¤§çš„ä¼˜åŒ–</p><p>ç°åœ¨æˆ‘ä»¬æ¯æ¬¡ä¿®æ”¹äº†ä¸€ä¸ªå±æ€§ä¹‹åéƒ½æ˜¯æ‰‹åŠ¨çš„å»è°ƒç”¨, è¿™æ ·å¤ªéº»çƒ¦äº†, æˆ‘ä»¬æƒ³è¦è®©å®ƒè‡ªåŠ¨å»è°ƒç”¨å“åº”å‡½æ•°,</p><p>å› æ­¤æˆ‘ä»¬è¦å»ç›‘å¬å±æ€§çš„å˜åŒ–</p><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h2 id="3-Object-defineProperty-ç›‘å¬å±æ€§å˜åŒ–"><a href="#3-Object-defineProperty-ç›‘å¬å±æ€§å˜åŒ–" class="headerlink" title="3. Object.defineProperty()ç›‘å¬å±æ€§å˜åŒ–"></a>3. Object.defineProperty()ç›‘å¬å±æ€§å˜åŒ–</h2><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927250.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927238.png" alt="img"></p><p>å†è®°ä¸€éè¿™ä¸ªç±»</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927292.png" alt="img"></p><p>æ³¨æ„çœ‹æ³¨é‡Š</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927814.png" alt="img"></p><p>è¿™é‡Œåœ¨å±æ€§å˜åŒ–åå°±ä¸ç”¨æ‰‹åŠ¨ç»™å®ƒé€šçŸ¥äº†, è‡ªåŠ¨å“åº”å®ç°</p><p>ä¸è¿‡è¿™ç§æ”¶é›†æ–¹å¼å…¶å®æ˜¯é”™è¯¯çš„hhhhh</p><h2 id="4-è‡ªåŠ¨æ”¶é›†ä¾èµ–-ğŸ”¥"><a href="#4-è‡ªåŠ¨æ”¶é›†ä¾èµ–-ğŸ”¥" class="headerlink" title="4. è‡ªåŠ¨æ”¶é›†ä¾èµ– ğŸ”¥"></a>4. è‡ªåŠ¨æ”¶é›†ä¾èµ– ğŸ”¥</h2><p>æˆ‘ä»¬ç°åœ¨å‘ç°äº†ä¸€ä¸ªé—®é¢˜ , obj å¯¹è±¡çš„ä¸¤ä¸ªå±æ€§éƒ½ä¾èµ–äº åŒä¸€ä¸ªdepå¯¹è±¡çš„reactiveFns,</p><p>è¿™æ ·å°±ä¼šé€ æˆæˆ‘ä»¬æ ¹æœ¬æ²¡åŠæ³•åŒºåˆ†å®ƒä»¬</p><p>å¯¹äºåŒä¸€ä¸ªå¯¹è±¡æ¥è¯´, æˆ‘ä»¬è¿˜æ˜¯ç»™å®ƒæ”¾åˆ°äº†åŒä¸€ä¸ªdepé‡Œé¢, è¿™ä¼šé€ æˆæ— æ³•å°†å®ƒçš„å±æ€§åŒºåˆ†</p><p><strong>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ ?</strong> </p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927843.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927050.png" alt="img"></p><p>æ¯”å¦‚æˆ‘ä»¬è¦è·å–objå¯¹è±¡çš„nameå±æ€§çš„ä¾èµ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> dep = objMap.<span class="hljs-title function_">get</span>(obj).<span class="hljs-title function_">get</span>(name);<br>dep.<span class="hljs-title function_">notifiy</span>();<br></code></pre></td></tr></table></figure><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927155.png" alt="img"></p><ul><li><p>depå¯¹è±¡æ•°æ®ç»“æ„çš„ç®¡ç†</p></li><li><p>æ¯ä¸€ä¸ªå¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§éƒ½ä¼šå¯¹åº”ä¸€ä¸ªdepå¯¹è±¡</p></li><li><p>åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§çš„depå¯¹è±¡æ˜¯å­˜æ”¾ä¸€ä¸ªmapå¯¹è±¡ä¸­</p></li><li><p>å¤šä¸ªå¯¹è±¡çš„mapå¯¹è±¡, ä¼šè¢«å­˜æ”¾åˆ°ä¸€ä¸ªobjMapçš„å¯¹è±¡ä¸­</p></li><li><p>å½“æ‰§è¡Œgetå‡½æ•°, è‡ªåŠ¨çš„æ·»åŠ fnå‡½æ•°</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Depend</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span> = []<br>  &#125;<br><br>  <span class="hljs-title function_">addDepend</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-keyword">if</span> (fn) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span>.<span class="hljs-title function_">push</span>(fn)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">notify</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> &#123;<br>      <span class="hljs-title function_">fn</span>()<br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> obj = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;why&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span><br>&#125;<br><br><span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªä¸“é—¨æ‰§è¡Œå“åº”å¼å‡½æ•°çš„ä¸€ä¸ªå‡½æ•°</span><br><span class="hljs-keyword">let</span> reactiveFn = <span class="hljs-literal">null</span> <span class="hljs-comment">// </span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">watchFn</span>(<span class="hljs-params">fn</span>) &#123;<br>  reactiveFn = fn<br>  <span class="hljs-title function_">fn</span>() <span class="hljs-comment">// æ‰§è¡Œä¸‹æ–¹çš„getæ–¹æ³• , ä½¿å¾—é—´æ¥çš„æŠŠå‡½æ•°åŠ åˆ°ç‰¹å®šçš„depå¯¹è±¡ä¸Š</span><br>  <span class="hljs-comment">//(å› ä¸ºå‡½æ•°ä¸­ä¼šæœ‰ä¸€äº›å¯¹è±¡ä¼šæœ‰ä¸€äº›å±æ€§)</span><br>  reactiveFn = <span class="hljs-literal">null</span> <span class="hljs-comment">// ä½¿ç”¨å®Œåå†ç½®ä¸ºnull, ä¸ç„¶å¯èƒ½ä¼šé€ æˆå½±å“</span><br>&#125;<br><br><span class="hljs-comment">// å°è£…ä¸€ä¸ªå‡½æ•°: è´Ÿè´£é€šè¿‡objçš„keyè·å–å¯¹åº”çš„Dependå¯¹è±¡</span><br><span class="hljs-comment">// æˆ‘ä»¬ç”¨ä¸€ä¸ªWeakMapå¯¹æ‰€æœ‰å¯¹è±¡è¿›è¡Œç®¡ç†, æˆ‘ä»¬ä¸éœ€è¦å¯¹é‡Œé¢è¿›è¡Œå¼ºå¼•ç”¨, </span><br><span class="hljs-comment">// å¦‚æœæœ‰ä¸€å¤©objä¸ºnull,é‚£å°±æ— æ³•é”€æ¯äº†</span><br><span class="hljs-keyword">const</span> objMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()<br><br><br><span class="hljs-comment">// è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡å¯¹è±¡çš„keyæ‰¾åˆ°å®ƒçš„depå¯¹è±¡</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getDepend</span>(<span class="hljs-params">obj, key</span>) &#123;<br>  <br>  <span class="hljs-comment">// 1.æ ¹æ®å¯¹è±¡obj, æ‰¾åˆ°å¯¹åº”çš„mapå¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> map = objMap.<span class="hljs-title function_">get</span>(obj) <span class="hljs-comment">// æ²¡æœ‰å°±newä¸€ä¸ª</span><br>  <span class="hljs-keyword">if</span> (!map) &#123;<br>    map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()<br>    objMap.<span class="hljs-title function_">set</span>(obj, map)<br>  &#125;<br><br>  <span class="hljs-comment">// 2.æ ¹æ®key, æ‰¾åˆ°å¯¹åº”çš„dependå¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> dep = map.<span class="hljs-title function_">get</span>(key)<br>  <span class="hljs-keyword">if</span> (!dep) &#123;<br>    dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>()<br>    map.<span class="hljs-title function_">set</span>(key, dep)<br>  &#125;<br>  <span class="hljs-keyword">return</span> dep<br>&#125;<br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> value = obj[key]<br><br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, key, &#123;<br>    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) &#123;<br>      value = newValue<br>      <span class="hljs-comment">// æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„å±æ€§çš„depå¯¹è±¡</span><br>      <span class="hljs-keyword">const</span> dep = <span class="hljs-title function_">getDepend</span>(obj, key)<br>      dep.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// å¯¹è¿™äº›</span><br>    &#125;,<br>    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-comment">// åœ¨å‡½æ•°ä¸­æ‹¿åˆ°obj å’Œ key å°±ä¼šè°ƒç”¨è¿™ä¸ªgetæ–¹æ³•</span><br>      <span class="hljs-comment">// console.log(&quot;getå‡½æ•°ä¸­:&quot;, obj, key)</span><br>      <span class="hljs-comment">// æ‰¾åˆ°å¯¹åº”çš„objå¯¹è±¡çš„keyå¯¹åº”çš„depå¯¹è±¡</span><br>      <span class="hljs-keyword">const</span> dep = <span class="hljs-title function_">getDepend</span>(obj, key) <br>      <span class="hljs-comment">// æ„å‘³ç€æˆ‘ä»¬åªä¼šåˆ›å»ºobjå¯¹è±¡çš„keyå±æ€§çš„depå¯¹è±¡</span><br>      dep.<span class="hljs-title function_">addDepend</span>(reactiveFn) <br>      <span class="hljs-comment">// ç²¾é«“ : åœ¨è¿™ä¸ªdepå¯¹è±¡ä¸Šæ”¾å…¥è·Ÿç‰¹æœ‰å¯¹è±¡çš„ç‰¹æœ‰å±æ€§ç›¸å…³çš„å‡½æ•°,å³reactiveFn</span><br>      <span class="hljs-comment">// depè¿™ä¸ªå¯¹è±¡å°±æ˜¯ä¿å­˜äº†è·Ÿè¿™ä¸ªç‰¹æœ‰å¯¹è±¡ç‰¹æœ‰å±æ€§ç›¸å…³çš„ä¸€äº›å‡½æ•°</span><br>      <br>      <span class="hljs-keyword">return</span> value<br>    &#125;<br>  &#125;)<br>&#125;)<br><br><span class="hljs-title function_">watchFn</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;foo function&quot;</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;foo:&quot;</span>, obj.<span class="hljs-property">name</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;foo&quot;</span>, obj.<span class="hljs-property">age</span>)<br>&#125;)<br><br><span class="hljs-title function_">watchFn</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;bar function&quot;</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;bar:&quot;</span>, obj.<span class="hljs-property">age</span> + <span class="hljs-number">10</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>æ³¨æ„çœ‹æ³¨é‡Š !!!!!</p><p>ä½ ç”¨äº†æˆ‘çš„æ•°æ®, æˆ‘å°±æ”¶é›†ä½ çš„ä¾èµ–, ä½ æ²¡ç”¨, æˆ‘å°±ä¸æ”¶é›† â€”</p><p>æˆ‘ä»¬è¿˜æœ‰å¯ä»¥ä¼˜åŒ–çš„ç‚¹ : </p><p>å½“æˆ‘ä»¬æ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç æ—¶</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927937.png" alt="img"></p><p>ageå‘ç”Ÿå˜åŒ–æ—¶, å®ƒä¼šæ‰§è¡Œä¸¤æ¬¡å‡½æ•°</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œ</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927105.png" alt="img"></p><p>æˆ‘ä»¬çš„reactiveFnsæ˜¯ä¸€ä¸ªSet, è¿™æ ·å®ƒå°±ä¸ä¼šæ·»åŠ ç›¸åŒçš„å‡½æ•°åˆ°è¿™é‡Œé¢å»</p><p>ç„¶åä¸‹æ–¹çš„pushæ”¹ä¸ºadd</p><p>è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯æˆ‘ä»¬å¯ä»¥ç»™<img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927328.png" alt="img">è¿™ä¸ªåœ°æ–¹æ¢ä¸ªå†™æ³•</p><p>æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å°†reactiveFnæ·»åŠ æ”¾åˆ°getä¸­ï¼Œå› ä¸ºå®ƒæ˜¯å±äºDepçš„è¡Œä¸º (ä¹Ÿå¯ä»¥ä¸æ¢, çœ‹è‡ªå·± )</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927511.png" alt="img"></p><p>æˆ‘ä»¬ç›´æ¥åœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•è‡ªåŠ¨è·å–æ”¶é›†çš„å‡½æ•°<code>depend()</code></p><p>ç›¸å½“äºåˆ©ç”¨åˆ°è¿™ä¸ªè‡ªç”±å˜é‡<code>reactiveFn</code></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927495.png" alt="img"></p><p>ç„¶åç›´æ¥<code>dep.depen()</code>è°ƒç”¨å³å¯</p><p>ä¸è¿‡è¿™ä¸¤ç§å†™æ³•éƒ½å¯ä»¥ hhh</p><p>ä½†è¿™ä¸ªä»£ç è¿˜æœ‰ä¸è¶³, å…³äº<strong>å¤šä¸ªå¯¹è±¡</strong>, æˆ‘ä»¬å¦‚ä½•ç»™å®ƒæŒ¨ä¸ªæ¥è‡ªåŠ¨æ”¶é›†ä¾èµ–, å› ä¸ºæˆ‘ä»¬è¿™é‡Œæ˜¯å†™æ­»ç»™objå¯¹è±¡è‡ªåŠ¨æ”¶é›†ä¾èµ–çš„</p><p>å¦‚ä½•è§£å†³å‘¢? </p><p>æ–¹æ³•å¦‚ä¸‹hhh â€”- å¤šä¸ªå¯¹è±¡å“åº”å¼</p><h2 id="5-å¤šä¸ªå¯¹è±¡å“åº”å¼"><a href="#5-å¤šä¸ªå¯¹è±¡å“åº”å¼" class="headerlink" title="5. å¤šä¸ªå¯¹è±¡å“åº”å¼"></a>5. å¤šä¸ªå¯¹è±¡å“åº”å¼</h2><p>æˆ‘ä»¬åªéœ€è¦å°†ç›‘å¬å¯¹è±¡å±æ€§çš„è¿™ä¸€ä¸²ä»£ç å°è£…ä¸ºä¸€ä¸ªå‡½æ•°</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927710.png" alt="img"></p><p>è¿™é‡Œæˆ‘ä»¬å°†è¿™ä¸€ä¸²ä»£ç å°è£…ä¸ºä¸€ä¸ªå‡½æ•°reactive, æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å°±å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’è¿›å», é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§å°±èƒ½è¢«ç›‘å¬åˆ°äº†, ç„¶åæˆ‘ä»¬<strong>è¿”å›ä¸€ä¸ªè¢«ç›‘å¬çš„å¯¹è±¡</strong></p><p>æ³¨æ„ : éœ€è¦è¿”å›è¿™ä¸ªå¯¹è±¡å“ˆ, åˆ«æå¿˜äº†</p><p>ç„¶åæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä½¿ç”¨è¿™ä¸ªå‡½æ•°, é‚£ä¹ˆå¯¹è±¡çš„æ‰€æœ‰å±æ€§å°±èƒ½è¢«ç›‘å¬åˆ°äº†</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927717.png" alt="img"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927766.png" alt="img"></p><p>ä»¥ä¸Šéƒ½æ˜¯vue2å“åº”å¼åŸç†(ä¹Ÿå°±æ˜¯defineProperty), æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨vue3å¯¹ä»£ç è¿›è¡Œé‡æ„</p><p>ç‰¹åˆ«easy</p><h2 id="6-vue3-ç›‘å¬å¯¹è±¡-proxy"><a href="#6-vue3-ç›‘å¬å¯¹è±¡-proxy" class="headerlink" title="6. vue3__ç›‘å¬å¯¹è±¡__proxy"></a>6. vue3__ç›‘å¬å¯¹è±¡__proxy</h2><p>æˆ‘ä»¬ç›´æ¥å°†</p><p>Object.defineProperty</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927710.png" alt="img"></p><p>è¿™éƒ¨åˆ†ä»£ç æ”¹æˆ</p><p>proxy</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927876.png" alt="img"></p><p>åœ¨æˆ‘ä»¬è°ƒç”¨äº†Proxyçš„getæ•è·å™¨æ—¶, æ”¶é›†ä¾èµ–</p><p>å› ä¸ºå¦‚æœä¸€ä¸ªå‡½æ•°ä¸­ä½¿ç”¨äº†æŸä¸ªå¯¹è±¡çš„keyï¼Œé‚£ä¹ˆå®ƒåº”è¯¥è¢«æ”¶é›†ä¾èµ–ï¼›</p><p>è¿™éƒ¨åˆ†ä»£ç å³å¯</p><p>éƒ½æ˜¯å­¦è¿‡çš„ä¸œè¥¿ , å¿˜äº†å°±ç¿»ç¿»å‰é¢çš„ç¬”è®° </p><h2 id="7-å®Œæ•´å“åº”å¼ä»£ç "><a href="#7-å®Œæ•´å“åº”å¼ä»£ç " class="headerlink" title="7. å®Œæ•´å“åº”å¼ä»£ç "></a>7. å®Œæ•´å“åº”å¼ä»£ç </h2><p>å®Œæ•´å“åº”å¼ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Depend</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()<br>  &#125;<br><br>  <span class="hljs-title function_">addDepend</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-keyword">if</span> (fn) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span>.<span class="hljs-title function_">add</span>(fn)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">depend</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (reactiveFn) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span>.<span class="hljs-title function_">add</span>(reactiveFn)<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">notify</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reactiveFns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> &#123;<br>      <span class="hljs-title function_">fn</span>()<br>    &#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> reactiveFn = <span class="hljs-literal">null</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">watchFn</span>(<span class="hljs-params">fn</span>) &#123;<br>  reactiveFn = fn<br>  <span class="hljs-title function_">fn</span>()<br>  reactiveFn = <span class="hljs-literal">null</span><br>&#125;<br><br><span class="hljs-keyword">const</span> objMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>()<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getDepend</span>(<span class="hljs-params">obj, key</span>) &#123;<br>  <span class="hljs-comment">// 1.æ ¹æ®å¯¹è±¡obj, æ‰¾åˆ°å¯¹åº”çš„mapå¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> map = objMap.<span class="hljs-title function_">get</span>(obj)<br>  <span class="hljs-keyword">if</span> (!map) &#123;<br>    map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()<br>    objMap.<span class="hljs-title function_">set</span>(obj, map)<br>  &#125;<br><br>  <span class="hljs-comment">// 2.æ ¹æ®key, æ‰¾åˆ°å¯¹åº”çš„dependå¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> dep = map.<span class="hljs-title function_">get</span>(key)<br>  <span class="hljs-keyword">if</span> (!dep) &#123;<br>    dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Depend</span>()<br>    map.<span class="hljs-title function_">set</span>(key, dep)<br>  &#125;<br>  <span class="hljs-keyword">return</span> dep<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">obj</span>) &#123;<br>  <span class="hljs-keyword">const</span> objProxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, &#123;<br>    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">target, key, newValue, receiver</span>) &#123;<br>      <span class="hljs-comment">// target[key] = newValue</span><br>      <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, newValue, receiver)<br>      <span class="hljs-keyword">const</span> dep = <span class="hljs-title function_">getDepend</span>(target, key)<br>      dep.<span class="hljs-title function_">notify</span>()<br>    &#125;,<br>    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">target, key, receiver</span>) &#123;<br>      <span class="hljs-keyword">const</span> dep = <span class="hljs-title function_">getDepend</span>(target, key)<br>      dep.<span class="hljs-title function_">depend</span>()<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver)<br>    &#125;<br>  &#125;)<br>  <span class="hljs-keyword">return</span> objProxy <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸šåŠ¡ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;why&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,<br>  <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;å¹¿å·å¸‚&quot;</span><br>&#125;)<br><br><span class="hljs-title function_">watchFn</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">name</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">age</span>)<br>&#125;)<br><br><span class="hljs-comment">// ä¿®æ”¹name</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;--------------&quot;</span>)<br><span class="hljs-comment">// obj.name = &quot;kobe&quot;</span><br>obj.<span class="hljs-property">age</span> = <span class="hljs-number">20</span><br><span class="hljs-comment">// obj.address = &quot;ä¸Šæµ·å¸‚&quot;</span><br><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;=============== user =================&quot;</span>)<br><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>(&#123;<br>  <span class="hljs-attr">nickname</span>: <span class="hljs-string">&quot;abc&quot;</span>,<br>  <span class="hljs-attr">level</span>: <span class="hljs-number">100</span><br>&#125;)<br><br><span class="hljs-title function_">watchFn</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;nickname:&quot;</span>, user.<span class="hljs-property">nickname</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;level:&quot;</span>, user.<span class="hljs-property">level</span>)<br>&#125;)<br><br>user.<span class="hljs-property">nickname</span> = <span class="hljs-string">&quot;cba&quot;</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202309121927019.png" alt="img"></p><p>æ€»ç»“ : </p><ul><li>Vue3ä¸»è¦æ˜¯é€šè¿‡Proxyæ¥ç›‘å¬æ•°æ®çš„å˜åŒ–ä»¥åŠæ”¶é›†ç›¸å…³çš„ä¾èµ–çš„ï¼›</li><li>ue2ä¸­é€šè¿‡æˆ‘ä»¬å‰é¢å­¦ä¹ è¿‡çš„Object.defineProertyçš„æ–¹å¼æ¥å®ç°å¯¹è±¡å±æ€§çš„ç›‘å¬ï¼›</li></ul>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ‰‹å†™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åç«¯æŠ½è±¡ç†è§£</title>
    <link href="/2023/06/19/%E5%90%8E%E7%AB%AF%E5%BD%A2%E8%B1%A1%E7%90%86%E8%A7%A3%E7%AF%87/"/>
    <url>/2023/06/19/%E5%90%8E%E7%AB%AF%E5%BD%A2%E8%B1%A1%E7%90%86%E8%A7%A3%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚ä½•å½¢è±¡çš„ç†è§£-spring"><a href="#å¦‚ä½•å½¢è±¡çš„ç†è§£-spring" class="headerlink" title="å¦‚ä½•å½¢è±¡çš„ç†è§£ spring?"></a>å¦‚ä½•å½¢è±¡çš„ç†è§£ spring?</h2><blockquote><p>ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå¸®åŠ©ä½ ç®¡ç† Java å¯¹è±¡ï¼Œé›†æˆä¸€äº›å…¶ä»–çš„å†…å®¹</p></blockquote><p>è®©æˆ‘ä»¬ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€æ¥è§£é‡ŠSpringæ¡†æ¶ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ä½ åœ¨ç»„è£…ä¸€å°ç”µè„‘ã€‚ä½ éœ€è¦è¿æ¥å„ä¸ªç¡¬ä»¶ç»„ä»¶ï¼Œå¦‚CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰ï¼Œå¹¶ç¡®ä¿å®ƒä»¬èƒ½å¤ŸååŒå·¥ä½œã€‚Springæ¡†æ¶å°±åƒæ˜¯ç”µè„‘ç»„è£…çš„åŠ©æ‰‹ï¼Œå®ƒå¸®åŠ©ä½ ç®¡ç†å’Œç»„ç»‡å„ä¸ªç»„ä»¶ï¼Œå¹¶æä¾›ä¸€äº›ä¾¿æ·çš„åŠŸèƒ½ã€‚</p><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼š</p><ul><li>ä½ å¯ä»¥å°†ç¡¬ä»¶ç»„ä»¶çœ‹ä½œæ˜¯ä½ çš„åº”ç”¨ç¨‹åºä¸­çš„ä¸åŒéƒ¨åˆ†ï¼Œå¦‚æœåŠ¡ã€æ•°æ®è®¿é—®å¯¹è±¡ã€æ§åˆ¶å™¨ç­‰ã€‚</li><li>Springæ¡†æ¶åˆ™æ‰®æ¼”äº†ç®¡ç†å’Œç»„ç»‡è¿™äº›ç»„ä»¶çš„è§’è‰²ï¼Œç¡®ä¿å®ƒä»¬èƒ½å¤ŸååŒå·¥ä½œã€‚</li><li>æ¡†æ¶æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼æ¥è¿æ¥å’Œé…ç½®è¿™äº›ç»„ä»¶ï¼Œå°±åƒä½ å°†ç¡¬ä»¶ç»„ä»¶æ’å…¥ä¸»æ¿ä¸Šçš„æ’æ§½ä¸€æ ·ã€‚</li><li>æ¡†æ¶è¿˜æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼Œå°±åƒæ˜¯å¸®åŠ©ä½ å°†å„ä¸ªç¡¬ä»¶ç»„ä»¶è¿æ¥åœ¨ä¸€èµ·ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’é€šä¿¡å’Œåä½œã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨æ¡†æ¶æä¾›çš„åŠŸèƒ½æ¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå°±åƒåœ¨ç”µè„‘ä¸Šè¿è¡Œè½¯ä»¶åº”ç”¨ç¨‹åºä¸€æ ·ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒSpringæ¡†æ¶æ˜¯ä¸€ä¸ªå¸®åŠ©ä½ ç®¡ç†å’Œç»„ç»‡åº”ç”¨ç¨‹åºç»„ä»¶çš„å·¥å…·ã€‚å®ƒç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œæä¾›äº†ä¾¿æ·çš„è¿æ¥å’Œé…ç½®æ–¹å¼ï¼Œå¹¶æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½æ¥å¢å¼ºåº”ç”¨ç¨‹åºçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä½¿ç”¨Springæ¡†æ¶ï¼Œä½ å¯ä»¥æ›´è½»æ¾åœ°æ„å»ºå’Œç®¡ç†å¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œå¹¶æä¾›é«˜æ•ˆã€å¯é çš„åŠŸèƒ½ã€‚</p><h2 id="å¦‚ä½•å½¢è±¡çš„ç†è§£ä¾èµ–æ³¨å…¥"><a href="#å¦‚ä½•å½¢è±¡çš„ç†è§£ä¾èµ–æ³¨å…¥" class="headerlink" title="å¦‚ä½•å½¢è±¡çš„ç†è§£ä¾èµ–æ³¨å…¥?"></a>å¦‚ä½•å½¢è±¡çš„ç†è§£ä¾èµ–æ³¨å…¥?</h2><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªæ—¥å¸¸ç”Ÿæ´»çš„æ¯”å–»æ¥å½¢è±¡åœ°ç†è§£ä¾èµ–æ³¨å…¥ã€‚</p><p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªå¨å¸ˆï¼Œéœ€è¦å‡†å¤‡ä¸€é“èœã€‚ä¸ºäº†å®Œæˆè¿™é“èœï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€äº›é£Ÿæï¼Œå¦‚è”¬èœã€è‚‰ç±»ã€è°ƒå‘³æ–™ç­‰ã€‚</p><p>åœ¨æ²¡æœ‰ä¾èµ–æ³¨å…¥çš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦è‡ªå·±å»è´­ä¹°è¿™äº›é£Ÿæï¼Œå¹¶å°†å®ƒä»¬æºå¸¦åˆ°å¨æˆ¿ã€‚è¿™æ„å‘³ç€ä½ è¦äº²è‡ªç®¡ç†é£Ÿæçš„é‡‡è´­ã€æºå¸¦å’Œä½¿ç”¨è¿‡ç¨‹ã€‚è¿™å¯èƒ½ä¼šå¢åŠ ä½ çš„è´Ÿæ‹…å’Œå·¥ä½œé‡ï¼Œè¿˜å¯èƒ½å¯¼è‡´æ··ä¹±å’Œé”™è¯¯ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå¨å¸ˆåŠ©æ‰‹ï¼Œä»–è´Ÿè´£ä¸ºä½ æä¾›æ‰€éœ€çš„é£Ÿæã€‚è¿™å°±æ˜¯ä¾èµ–æ³¨å…¥çš„æ¦‚å¿µåœ¨ç”Ÿæ´»ä¸­çš„ä½“ç°ã€‚</p><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼š</p><ul><li>ä½ æ˜¯ä¸»å¨ï¼Œè´Ÿè´£èœçš„åˆ¶ä½œï¼Œå³åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ã€‚</li><li>é£Ÿææ˜¯ä½ æ‰€éœ€è¦çš„ä¾èµ–å¯¹è±¡ï¼Œå¦‚æœåŠ¡ã€æ•°æ®è®¿é—®å¯¹è±¡ç­‰ã€‚</li><li>å¨å¸ˆåŠ©æ‰‹æ˜¯ä¾èµ–æ³¨å…¥çš„æœºåˆ¶ï¼Œè´Ÿè´£å°†é£Ÿææä¾›ç»™ä½ ï¼Œä»¥ä¾›ä½ ä½¿ç”¨ã€‚</li><li>ä¾èµ–æ³¨å…¥è®©ä½ ä»ç¹ççš„é‡‡è´­å’Œç®¡ç†ä»»åŠ¡ä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äºèœçš„åˆ¶ä½œã€‚</li></ul><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œä¾èµ–æ³¨å…¥çš„æ¦‚å¿µç±»ä¼¼ã€‚å®ƒæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡åœ¨éœ€è¦ä½¿ç”¨æŸä¸ªå¯¹è±¡çš„åœ°æ–¹å°†å…¶æ³¨å…¥ï¼ˆæä¾›ï¼‰ç»™ç›®æ ‡å¯¹è±¡ï¼Œå‡å°‘äº†ç›®æ ‡å¯¹è±¡ä¸ä¾èµ–å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ã€‚è¿™æ ·ï¼Œç›®æ ‡å¯¹è±¡å¯ä»¥ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå¦‚ä½•åˆ›å»ºæˆ–è·å–ä¾èµ–å¯¹è±¡ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œä¾èµ–æ³¨å…¥å°±åƒæ˜¯ä¸€ä¸ªå¨å¸ˆåŠ©æ‰‹ä¸ºä½ æä¾›æ‰€éœ€é£Ÿæä¸€æ ·ï¼Œå®ƒè®©ä½ ä»ç¹ççš„ä¾èµ–ç®¡ç†ä¸­è§£æ”¾å‡ºæ¥ï¼Œè®©ä½ çš„ä»£ç æ›´åŠ æ¸…æ™°ã€æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚å®ƒä½¿ä»£ç çš„ç»„ç»‡å’Œåä½œæ›´åŠ çµæ´»å’Œç®€å•ã€‚</p><h2 id="å¦‚ä½•å½¢è±¡çš„ç†è§£-springmvc"><a href="#å¦‚ä½•å½¢è±¡çš„ç†è§£-springmvc" class="headerlink" title="å¦‚ä½•å½¢è±¡çš„ç†è§£ springmvc ?"></a>å¦‚ä½•å½¢è±¡çš„ç†è§£ springmvc ?</h2><blockquote><p>web æ¡†æ¶ï¼Œæä¾›æ¥å£è®¿é—®ã€restfulæ¥å£ç­‰èƒ½åŠ›</p></blockquote><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç±»æ¯”æ¥å½¢è±¡åœ°ç†è§£Spring MVCã€‚</p><p>å‡è®¾ä½ æ˜¯ä¸€å®¶å¿«é¤åº—çš„æœåŠ¡å‘˜ï¼Œè´Ÿè´£æ¥å¾…é¡¾å®¢å¹¶å¤„ç†ä»–ä»¬çš„ç‚¹é¤è¯·æ±‚ã€‚</p><p>åœ¨æ²¡æœ‰Spring MVCçš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªäººæ¥å¤„ç†æ‰€æœ‰çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ¥å¾…é¡¾å®¢ã€è®°å½•ç‚¹é¤ã€å–é¤ã€ä¸Šèœç­‰ã€‚è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°å¿™ç¢Œå’Œæ··ä¹±ï¼Œå¾ˆéš¾æœ‰æ•ˆåœ°å¤„ç†é¡¾å®¢çš„éœ€æ±‚ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾å¿«é¤åº—å¼•å…¥äº†Spring MVCæ¡†æ¶æ¥ååŠ©ä½ è¿›è¡Œå·¥ä½œã€‚è¿™å°±æ˜¯Spring MVCçš„ä½œç”¨ã€‚</p><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼š</p><ul><li>ä½ æ˜¯æœåŠ¡å‘˜ï¼Œè´Ÿè´£å¤„ç†é¡¾å®¢çš„ç‚¹é¤è¯·æ±‚ï¼Œå³å¤„ç†Webè¯·æ±‚çš„æ§åˆ¶å™¨ã€‚</li><li>é¡¾å®¢æ˜¯Webåº”ç”¨çš„ç”¨æˆ·ï¼Œå‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ã€‚</li><li>Spring MVCæ¡†æ¶åˆ™æ‰®æ¼”äº†ä¸€ä¸ªåè°ƒè€…çš„è§’è‰²ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚ã€è·¯ç”±è¯·æ±‚åˆ°é€‚å½“çš„æ§åˆ¶å™¨ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚</li><li>æ¡†æ¶æä¾›äº†ä¸€äº›ä¾¿æ·çš„åŠŸèƒ½ï¼Œå¦‚è¯·æ±‚è·¯ç”±ã€å‚æ•°ç»‘å®šã€è§†å›¾æ¸²æŸ“ç­‰ï¼Œä½¿ä½ èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†é¡¾å®¢çš„ç‚¹é¤è¯·æ±‚ã€‚</li></ul><p>ä½¿ç”¨Spring MVCï¼Œä½ å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘åˆ†æ•£åˆ°ä¸åŒçš„æ§åˆ¶å™¨ä¸­ï¼Œæ¯ä¸ªæ§åˆ¶å™¨è´Ÿè´£å¤„ç†ç‰¹å®šç±»å‹çš„è¯·æ±‚ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†ä»£ç ï¼Œå¹¶æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒSpring MVCå°±åƒæ˜¯ä¸€ä¸ªæœåŠ¡å‘˜çš„ååŠ©å·¥å…·ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°å¤„ç†Webè¯·æ±‚ï¼Œåˆ†æ•£å’Œç®¡ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶æä¾›é«˜æ•ˆçš„å¤„ç†æ–¹å¼ã€‚å®ƒç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œæä¾›äº†ä¾¿æ·çš„è·¯ç”±å’Œæ§åˆ¶åŠŸèƒ½ï¼Œä½¿å¾—Webåº”ç”¨çš„å¼€å‘æ›´åŠ æ¨¡å—åŒ–ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•ã€‚</p><h2 id="å¦‚ä½•å½¢è±¡çš„ç†è§£-mybatis"><a href="#å¦‚ä½•å½¢è±¡çš„ç†è§£-mybatis" class="headerlink" title="å¦‚ä½•å½¢è±¡çš„ç†è§£ mybatis ?"></a>å¦‚ä½•å½¢è±¡çš„ç†è§£ mybatis ?</h2><blockquote><p>Java æ“ä½œæ•°æ®åº“çš„æ¡†æ¶ï¼ŒæŒä¹…å±‚æ¡†æ¶ï¼Œå¯¹ jdbc çš„å°è£…</p></blockquote><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç±»æ¯”æ¥å½¢è±¡åœ°ç†è§£MyBatisã€‚</p><p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªå›¾ä¹¦ç®¡ç†å‘˜ï¼Œè´Ÿè´£ç®¡ç†å›¾ä¹¦é¦†çš„å›¾ä¹¦å’Œå€Ÿé˜…è®°å½•ã€‚</p><p>åœ¨æ²¡æœ‰MyBatisçš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨ç®¡ç†å›¾ä¹¦å’Œå€Ÿé˜…è®°å½•çš„å­˜å‚¨ã€æŸ¥è¯¢å’Œæ›´æ–°ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ç¼–å†™å¤§é‡çš„SQLè¯­å¥æ¥æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œå¹¶å¤„ç†ä¸æ•°æ®åº“çš„è¿æ¥ã€äº‹åŠ¡ç­‰ç»†èŠ‚ã€‚è¿™æ ·çš„å·¥ä½œå¯èƒ½ä¼šéå¸¸ç¹çå’Œå¤æ‚ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œä»–å¸®åŠ©ä½ <strong>è‡ªåŠ¨åŒ–å¤„ç†å›¾ä¹¦å’Œå€Ÿé˜…è®°å½•çš„ç®¡ç†</strong>ã€‚è¿™å°±æ˜¯MyBatisçš„ä½œç”¨ã€‚</p><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼š</p><ul><li>ä½ æ˜¯å›¾ä¹¦ç®¡ç†å‘˜ï¼Œè´Ÿè´£å¤„ç†å›¾ä¹¦å’Œå€Ÿé˜…è®°å½•çš„ç®¡ç†ï¼Œå³æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰ã€‚</li><li>å›¾ä¹¦å’Œå€Ÿé˜…è®°å½•æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œéœ€è¦è¿›è¡Œå­˜å‚¨ã€æŸ¥è¯¢å’Œæ›´æ–°ã€‚</li><li>MyBatisæ¡†æ¶åˆ™æ‰®æ¼”äº†ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹çš„è§’è‰²ï¼Œè´Ÿè´£å¤„ç†ä¸æ•°æ®åº“çš„äº¤äº’å’Œæ“ä½œã€‚</li><li>æ¡†æ¶æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼æ¥æ˜ å°„æ•°æ®åº“è¡¨å’Œ<code>Java</code>å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€äº›SQLæ‰§è¡Œå’Œç»“æœæ˜ å°„çš„åŠŸèƒ½ã€‚</li></ul><p>ä½¿ç”¨MyBatisï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®æ–‡ä»¶å’Œæ³¨è§£æ¥å®šä¹‰SQLè¯­å¥å’Œå‚æ•°æ˜ å°„ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™å¤§é‡çš„SQLè¯­å¥ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å¤„ç†ä¸æ•°æ®åº“çš„è¿æ¥ã€äº‹åŠ¡å’Œç»“æœé›†çš„æ˜ å°„ï¼Œè®©ä½ æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒMyBatiså°±åƒæ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¸®åŠ©ä½ ç®€åŒ–å’Œè‡ªåŠ¨åŒ–ä¸æ•°æ®åº“çš„äº¤äº’å’Œæ“ä½œã€‚å®ƒå‡å°‘äº†æ‰‹åŠ¨ç¼–å†™SQLè¯­å¥çš„å·¥ä½œé‡ï¼Œæä¾›äº†ä¾¿æ·çš„æ•°æ®è®¿é—®æ–¹å¼ï¼Œå¹¶å¸®åŠ©ä½ æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†æ•°æ®åº“æ“ä½œçš„ä»£ç ã€‚ä½¿ç”¨MyBatisï¼Œä½ å¯ä»¥æ›´è½»æ¾åœ°è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œå¹¶æä¾›é«˜æ•ˆå’Œå¯ç»´æŠ¤çš„æ•°æ®è®¿é—®å±‚ã€‚</p><h2 id="å¦‚ä½•å½¢è±¡çš„ç†è§£-mybatis-plus"><a href="#å¦‚ä½•å½¢è±¡çš„ç†è§£-mybatis-plus" class="headerlink" title="å¦‚ä½•å½¢è±¡çš„ç†è§£ mybatis - plus ?"></a>å¦‚ä½•å½¢è±¡çš„ç†è§£ mybatis - plus ?</h2><blockquote><p>å¯¹ mybatis çš„å¢å¼ºï¼Œä¸ç”¨å†™ sql ä¹Ÿèƒ½å®ç°å¢åˆ æ”¹æŸ¥</p></blockquote><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç±»æ¯”æ¥å½¢è±¡åœ°ç†è§£MyBatis-Plusã€‚</p><p>å‡è®¾ä½ æ˜¯ä¸€ä½å®¤å†…è®¾è®¡å¸ˆï¼Œè´Ÿè´£è®¾è®¡å®¢æˆ·çš„å®¶å±…è£…ä¿®æ–¹æ¡ˆã€‚</p><p>åœ¨æ²¡æœ‰MyBatis-Plusçš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä»å¤´å¼€å§‹è®¾è®¡å’Œå®æ–½æ¯ä¸ªå®¢æˆ·çš„è£…ä¿®æ–¹æ¡ˆã€‚è¿™æ„å‘³ç€ä½ éœ€è¦è€ƒè™‘å¹¶ç¼–å†™å„ç§ç»†èŠ‚ï¼Œå¦‚æˆ¿é—´å¸ƒå±€ã€ææ–™é€‰æ‹©ã€è‰²å½©æ­é…ç­‰ã€‚è¿™æ ·çš„å·¥ä½œå¯èƒ½ä¼šéå¸¸ç¹çå’Œè€—æ—¶ã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªè£…ä¿®åŠ©æ‰‹ï¼Œä»–ä¸ºä½ æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„è£…ä¿®æ–¹æ¡ˆå’Œè®¾è®¡æ¨¡æ¿ã€‚è¿™å°±æ˜¯MyBatis-Plusçš„ä½œç”¨ã€‚</p><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼š</p><ul><li>ä½ æ˜¯å®¤å†…è®¾è®¡å¸ˆï¼Œè´Ÿè´£è®¾è®¡å’Œå®æ–½è£…ä¿®æ–¹æ¡ˆï¼Œå³æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰ã€‚</li><li>å®¢æˆ·æ˜¯æ•°æ®åº“ä¸­çš„è¡¨ï¼Œæ¯ä¸ªå®¢æˆ·å¯¹åº”ä¸€å¼ è¡¨ï¼Œéœ€è¦è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚</li><li>MyBatis-Plusæ¡†æ¶åˆ™æ‰®æ¼”äº†ä¸€ä¸ªè£…ä¿®åŠ©æ‰‹çš„è§’è‰²ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ ‡å‡†åŒ–çš„æ“ä½œå’Œè®¾è®¡æ¨¡æ¿ã€‚</li><li>æ¡†æ¶æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å®šä¹‰å®ä½“ç±»å’Œæ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»ï¼Œå¹¶æä¾›äº†ä¸€äº›é€šç”¨çš„æ•°æ®è®¿é—®åŠŸèƒ½ã€‚</li></ul><p>ä½¿ç”¨MyBatis-Plusï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•çš„æ³¨è§£å’Œé…ç½®æ¥å®šä¹‰å®ä½“ç±»å’Œæ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ç¹ççš„SQLè¯­å¥ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å¤„ç†ä¸æ•°æ®åº“çš„è¿æ¥ã€äº‹åŠ¡å’ŒCRUDæ“ä½œï¼Œè®©ä½ æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒMyBatis-Pluså°±åƒæ˜¯ä¸€ä¸ªè£…ä¿®åŠ©æ‰‹ï¼Œä¸ºä½ æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ“ä½œå’Œè®¾è®¡æ¨¡æ¿ã€‚å®ƒç®€åŒ–äº†æ•°æ®è®¿é—®å±‚çš„å¼€å‘è¿‡ç¨‹ï¼Œæä¾›äº†ä¾¿æ·çš„æ•°æ®è®¿é—®æ–¹å¼ï¼Œå¹¶å¸®åŠ©ä½ æ›´å¥½åœ°ç»„ç»‡å’Œç®¡ç†æ•°æ®åº“æ“ä½œçš„ä»£ç ã€‚ä½¿ç”¨MyBatis-Plusï¼Œä½ å¯ä»¥æ›´è½»æ¾åœ°è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œå¹¶æä¾›é«˜æ•ˆå’Œå¯ç»´æŠ¤çš„æ•°æ®è®¿é—®å±‚ã€‚</p><h2 id="å¦‚ä½•å½¢è±¡çš„ç†è§£-springboot"><a href="#å¦‚ä½•å½¢è±¡çš„ç†è§£-springboot" class="headerlink" title="å¦‚ä½•å½¢è±¡çš„ç†è§£ springboot ?"></a>å¦‚ä½•å½¢è±¡çš„ç†è§£ springboot ?</h2><blockquote><p>å¿«é€Ÿå¯åŠ¨ &#x2F; å¿«é€Ÿé›†æˆé¡¹ç›®ã€‚ä¸ç”¨è‡ªå·±ç®¡ç† spring é…ç½®ï¼Œä¸ç”¨è‡ªå·±æ•´åˆå„ç§æ¡†æ¶</p></blockquote><p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç±»æ¯”æ¥å½¢è±¡åœ°ç†è§£Spring Bootã€‚</p><p>å‡è®¾ä½ æ˜¯ä¸€ä½å¨å¸ˆï¼Œéœ€è¦å‡†å¤‡ä¸€é“å¤æ‚çš„èœè‚´ã€‚</p><p>åœ¨æ²¡æœ‰Spring Bootçš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä»å¤´å¼€å§‹è´­ä¹°é£Ÿæã€å‡†å¤‡å¨æˆ¿ã€ç ”ç©¶èœè°±ã€è°ƒæ•´çƒ¹é¥ªå‚æ•°ç­‰ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›æ¥å®Œæˆæ¯ä¸ªç¯èŠ‚ï¼Œæ‰èƒ½æœ€ç»ˆå®Œæˆèœè‚´çš„åˆ¶ä½œã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ æœ‰ä¸€å¥—ç°æˆçš„å¨æˆ¿è®¾å¤‡å’Œæ ‡å‡†åŒ–çš„é£Ÿè°±ï¼Œè¿™å°±æ˜¯Spring Bootçš„ä½œç”¨ã€‚</p><p>åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼š</p><ul><li>ä½ æ˜¯å¨å¸ˆï¼Œè´Ÿè´£è®¾è®¡å’Œåˆ¶ä½œèœè‚´ï¼Œå³åº”ç”¨ç¨‹åºçš„å¼€å‘è€…ã€‚</li><li>èœè‚´æ˜¯åº”ç”¨ç¨‹åºï¼Œéœ€è¦è¿›è¡Œé…ç½®ã€å¼€å‘å’Œéƒ¨ç½²ç­‰æ“ä½œã€‚</li><li>Spring Bootæ¡†æ¶åˆ™æ‰®æ¼”äº†ä¸€ä¸ªç°æˆçš„å¨æˆ¿è®¾å¤‡å’Œæ ‡å‡†åŒ–çš„é£Ÿè°±çš„è§’è‰²ï¼Œæä¾›äº†ä¸€å¥—é¢„å®šä¹‰çš„é…ç½®å’Œå¼€å‘è§„èŒƒã€‚</li><li>æ¡†æ¶å¸®åŠ©ä½ ç®€åŒ–äº†åº”ç”¨ç¨‹åºçš„æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ï¼Œæä¾›äº†è‡ªåŠ¨é…ç½®ã€å†…åµŒæœåŠ¡å™¨ã€ä¾èµ–ç®¡ç†ç­‰åŠŸèƒ½ã€‚</li></ul><p>ä½¿ç”¨Spring Bootï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•çš„é…ç½®å’Œçº¦å®šæ¥å¿«é€Ÿæ­å»ºå’Œå¼€å‘åº”ç”¨ç¨‹åºï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ç¹ççš„é…ç½®å’Œä¾èµ–ç®¡ç†ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å¤„ç†ä¸æœåŠ¡å™¨çš„é›†æˆã€é…ç½®çš„åŠ è½½å’Œç®¡ç†ï¼Œè®©ä½ æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒSpring Bootå°±åƒæ˜¯ä¸€ä¸ªç°æˆçš„å¨æˆ¿è®¾å¤‡å’Œæ ‡å‡†åŒ–çš„é£Ÿè°±ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ­å»ºå’Œå¼€å‘åº”ç”¨ç¨‹åºã€‚å®ƒç®€åŒ–äº†åº”ç”¨ç¨‹åºçš„æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ï¼Œæä¾›äº†è‡ªåŠ¨åŒ–çš„é…ç½®å’Œä¾èµ–ç®¡ç†ï¼Œè®©ä½ èƒ½å¤Ÿæ›´è½»æ¾åœ°æ„å»ºé«˜æ•ˆå’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚</p><blockquote><p>Spring Bootæ˜¯Springçš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ—¨åœ¨ç®€åŒ–Springåº”ç”¨ç¨‹åºçš„æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ï¼Œé€šè¿‡è‡ªåŠ¨é…ç½®å’Œçº¦å®šå¤§äºé…ç½®çš„åŸåˆ™ï¼Œæä¾›äº†ä¸€å¥—é¢„å®šä¹‰çš„è§„èŒƒå’Œé…ç½®ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å¿«é€Ÿåœ°åˆ›å»ºç‹¬ç«‹çš„ã€è‡ªåŒ…å«çš„åº”ç”¨ç¨‹åºã€‚</p></blockquote><h2 id="ä»€ä¹ˆæ˜¯-junit-å•å…ƒæµ‹è¯•åº“"><a href="#ä»€ä¹ˆæ˜¯-junit-å•å…ƒæµ‹è¯•åº“" class="headerlink" title="ä»€ä¹ˆæ˜¯ junit å•å…ƒæµ‹è¯•åº“?"></a>ä»€ä¹ˆæ˜¯ junit å•å…ƒæµ‹è¯•åº“?</h2><p>JUnitæ˜¯ä¸€ä¸ªJavaå•å…ƒæµ‹è¯•åº“ï¼Œç”¨äºç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ã€‚å®ƒæä¾›äº†ä¸€ç»„ç”¨äºç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„æ³¨è§£å’Œæ–­è¨€æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…è¿›è¡Œè‡ªåŠ¨åŒ–çš„å•å…ƒæµ‹è¯•ã€‚</p><p>JUnitçš„ä¸»è¦ä½œç”¨æ˜¯å¸®åŠ©å¼€å‘è€…éªŒè¯ä»£ç çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚é€šè¿‡ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œå¼€å‘è€…å¯ä»¥é’ˆå¯¹ä»£ç çš„ä¸åŒæ¨¡å—ã€æ–¹æ³•æˆ–ç±»ç¼–å†™æµ‹è¯•ä»£ç ï¼Œç”¨äºéªŒè¯å…¶é¢„æœŸè¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å•å…ƒæµ‹è¯•å¯ä»¥å¸®åŠ©å¼€å‘è€…å‘ç°å’Œä¿®å¤ä»£ç ä¸­çš„bugï¼Œå‡å°‘ä»£ç å‡ºé”™çš„å¯èƒ½æ€§ï¼Œå¹¶æé«˜ä»£ç çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>JUnitæä¾›äº†ä¸€äº›å¸¸ç”¨çš„æ³¨è§£ï¼Œå¦‚<code>@Test</code>ç”¨äºæ ‡è®°æµ‹è¯•æ–¹æ³•ï¼Œ<code>@Before</code>å’Œ<code>@After</code>ç”¨äºåœ¨æµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œä¸€äº›åˆå§‹åŒ–å’Œæ¸…ç†æ“ä½œï¼Œ<code>@BeforeClass</code>å’Œ<code>@AfterClass</code>ç”¨äºåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–å’Œæ¸…ç†æ“ä½œã€‚æ­¤å¤–ï¼ŒJUnitè¿˜æä¾›äº†ä¸€ç³»åˆ—çš„æ–­è¨€æ–¹æ³•ï¼Œå¦‚<code>assertEquals</code>ã€<code>assertTrue</code>ã€<code>assertFalse</code>ç­‰ï¼Œç”¨äºéªŒè¯æµ‹è¯•ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p><p>ä½¿ç”¨JUnitï¼Œå¼€å‘è€…å¯ä»¥ç¼–å†™ç®€æ´ã€å¯é‡å¤è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶é€šè¿‡è¿è¡ŒJUnitæµ‹è¯•æ¥è‡ªåŠ¨æ‰§è¡Œè¿™äº›æµ‹è¯•ç”¨ä¾‹ï¼Œè·å–æµ‹è¯•ç»“æœã€‚è¿™æ ·å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼Œå‡å°‘æ‰‹åŠ¨æµ‹è¯•çš„å·¥ä½œé‡ï¼Œå¹¶ä¿è¯ä»£ç çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</p><p>æ€»ä¹‹ï¼ŒJUnitæ˜¯ä¸€ä¸ªJavaå•å…ƒæµ‹è¯•åº“ï¼Œå®ƒæä¾›äº†æ³¨è§£å’Œæ–­è¨€æ–¹æ³•ï¼Œç”¨äºç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œå¸®åŠ©å¼€å‘è€…éªŒè¯ä»£ç çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ï¼Œå¹¶æé«˜ä»£ç çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h2 id="å…³äºç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†çš„è¯¦ç»†è¿‡ç¨‹ï¼š"><a href="#å…³äºç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†çš„è¯¦ç»†è¿‡ç¨‹ï¼š" class="headerlink" title="å…³äºç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†çš„è¯¦ç»†è¿‡ç¨‹ï¼š"></a>å…³äºç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†çš„è¯¦ç»†è¿‡ç¨‹ï¼š</h2><ol><li><p>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªä¼šè¯ï¼ˆsessionï¼‰ï¼Œå¹¶è¿”å›ä¼šè¯çš„æ ‡è¯†ç¬¦ï¼ˆsession IDï¼‰ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªä¼šè¯å¯ä»¥æ˜¯åŒ¿åä¼šè¯ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å°šæœªç™»å½•ã€‚</p></li><li><p>å½“ç”¨æˆ·æˆåŠŸç™»å½•æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå…·æœ‰ç”¨æˆ·ä¿¡æ¯çš„ä¼šè¯å¯¹è±¡ï¼Œå¹¶å°†ä¼šè¯å¯¹è±¡å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ã€‚é€šå¸¸ä¼šå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ä¼šè¯å¯¹è±¡çš„å±æ€§ä¸­ï¼Œä¾‹å¦‚ï¼Œå°†ç”¨æˆ·IDã€ç”¨æˆ·åç­‰ä¿¡æ¯å­˜å‚¨ä¸ºä¼šè¯å±æ€§ã€‚</p></li><li><p>æœåŠ¡å™¨å°†ä¼šè¯çš„æ ‡è¯†ç¬¦ï¼ˆsession IDï¼‰å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå¹¶è¦æ±‚å®¢æˆ·ç«¯å°†å…¶å­˜å‚¨ä¸ºä¸€ä¸ª cookieã€‚è¿™ä¸ª cookie çš„ä½œç”¨æ˜¯åœ¨å®¢æˆ·ç«¯ä¿å­˜ä¼šè¯æ ‡è¯†ç¬¦ï¼Œä»¥ä¾¿åœ¨åç»­çš„è¯·æ±‚ä¸­æºå¸¦è¯¥ä¼šè¯æ ‡è¯†ç¬¦ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ä¼šè¯æ ‡è¯†ç¬¦åï¼Œå°†å…¶å­˜å‚¨ä¸º cookieï¼Œä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ã€‚</p></li><li><p>å½“å®¢æˆ·ç«¯å†æ¬¡å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­ä¼šåŒ…å«è¯¥åŸŸåä¸‹çš„æ‰€æœ‰ cookie ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¼šè¯æ ‡è¯†ç¬¦ã€‚</p></li><li><p>æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­æå–å‡ºä¼šè¯æ ‡è¯†ç¬¦ï¼Œé€šè¿‡è¯¥æ ‡è¯†ç¬¦åœ¨æœåŠ¡å™¨ç«¯æŸ¥æ‰¾å¯¹åº”çš„ä¼šè¯å¯¹è±¡ã€‚</p></li><li><p>æœåŠ¡å™¨æ ¹æ®ä¼šè¯æ ‡è¯†ç¬¦æ‰¾åˆ°å¯¹åº”çš„ä¼šè¯å¯¹è±¡åï¼Œå¯ä»¥ä»ä¼šè¯å¯¹è±¡ä¸­è·å–å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·çš„ç™»å½•åç­‰ã€‚</p></li></ol><p>æ€»ç»“ï¼šé€šè¿‡å°†ä¼šè¯æ ‡è¯†ç¬¦å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ cookie ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨åç»­çš„è¯·æ±‚ä¸­æºå¸¦è¯¥ä¼šè¯æ ‡è¯†ç¬¦ï¼Œä½¿æœåŠ¡å™¨èƒ½å¤Ÿè¯†åˆ«å®¢æˆ·ç«¯ï¼Œå¹¶é€šè¿‡ä¼šè¯å¯¹è±¡ç®¡ç†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°è¿‡ç¨‹æ˜¯ä¸€ç§å¸¸è§çš„ç”¨æˆ·ç™»å½•çŠ¶æ€ç®¡ç†æ–¹å¼ï¼Œä½†å®é™…ä¸Šï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥å®ç°ç”¨æˆ·ç™»å½•çŠ¶æ€çš„ç®¡ç†ï¼Œå¦‚ä½¿ç”¨ JSON Web Token (JWT) ç­‰ã€‚å…·ä½“çš„å®ç°æ–¹å¼å¯èƒ½å› æ¡†æ¶å’ŒæŠ€æœ¯é€‰å‹è€Œæœ‰æ‰€å·®å¼‚ã€‚</p><h2 id="ç®€å•è¯´æ˜cookieå’Œsession"><a href="#ç®€å•è¯´æ˜cookieå’Œsession" class="headerlink" title="ç®€å•è¯´æ˜cookieå’Œsession"></a><strong>ç®€å•è¯´æ˜cookieå’Œsession</strong></h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcode">ğŸª” ä»¥æœ€å¸¸è§çš„ç™»é™†æ¡ˆä¾‹è®²è§£cookieçš„ä½¿ç”¨è¿‡ç¨‹ï¼š<br>ï¼ˆ<span class="hljs-number">1</span>ï¼‰é¦–å…ˆç”¨æˆ·åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨å‘æœåŠ¡å™¨é¦–æ¬¡å‘èµ·ç™»é™†è¯·æ±‚<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰ç™»é™†æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šæŠŠç™»é™†çš„ç”¨æˆ·ä¿¡æ¯è®¾ç½®åœ¨cookie ä¸­ï¼Œå¹¶å°†cookieè¿”å›ç»™å®¢æˆ·ç«¯æµè§ˆå™¨<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰å®¢æˆ·ç«¯æµè§ˆå™¨æ¥æ”¶åˆ° cookie è¯·æ±‚åï¼Œä¼šæŠŠ cookie ä¿å­˜åˆ°æœ¬åœ°<span class="hljs-comment">(å¯èƒ½æ˜¯å†…å­˜ï¼Œä¹Ÿå¯èƒ½æ˜¯ç£ç›˜ï¼Œçœ‹å…·ä½“ä½¿ç”¨æƒ…å†µè€Œå®š)</span><br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰ä»¥åå†æ¬¡è®¿é—®è¯¥ web åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨å°±ä¼šæŠŠæœ¬åœ°çš„ cookie å¸¦ä¸Šï¼Œè¿™æ ·æœåŠ¡ç«¯å°±èƒ½æ ¹æ® cookie è·å¾—ç”¨æˆ·ä¿¡æ¯äº†<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ğŸª” åŒæ ·ä»¥ç™»é™†æ¡ˆä¾‹ä¸ºä¾‹å­è®²è§£ <span class="hljs-keyword">session</span> çš„ä½¿ç”¨è¿‡ç¨‹ï¼š<br>ï¼ˆ<span class="hljs-number">1</span>ï¼‰é¦–å…ˆç”¨æˆ·åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨å‘èµ·ç™»é™†è¯·æ±‚<br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰ç™»é™†æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šæŠŠç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œå¹¶è¿”å›ä¸€ä¸ªå”¯ä¸€çš„ <span class="hljs-keyword">session</span> æ ‡è¯†ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚<br>ï¼ˆ<span class="hljs-number">3</span>ï¼‰å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šæŠŠè¿™ä¸ªå”¯ä¸€çš„ <span class="hljs-keyword">session</span> æ ‡è¯†ä¿å­˜åœ¨èµ·æ¥<br>ï¼ˆ<span class="hljs-number">4</span>ï¼‰ä»¥åå†æ¬¡è®¿é—® web åº”ç”¨æ—¶ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨ä¼šæŠŠè¿™ä¸ªå”¯ä¸€çš„ <span class="hljs-keyword">session</span> æ ‡è¯†å¸¦ä¸Šï¼Œè¿™æ ·æœåŠ¡ç«¯å°±èƒ½æ ¹æ®è¿™ä¸ªå”¯ä¸€æ ‡è¯†æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚<br></code></pre></td></tr></table></figure><p><strong>çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šå¼•èµ·ç–‘é—®ï¼šæŠŠå”¯ä¸€çš„ session æ ‡è¯†è¿”å›ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œç„¶åä¿å­˜èµ·æ¥ï¼Œä»¥åè®¿é—®æ—¶å¸¦ä¸Šï¼Œè¿™éš¾é“ä¸æ˜¯ cookie å—ï¼Ÿ</strong></p><blockquote><p>æ²¡é”™ï¼Œsession åªæ˜¯ä¸€ç§ä¼šè¯æœºåˆ¶ï¼Œåœ¨è®¸å¤š web åº”ç”¨ä¸­ï¼Œsession æœºåˆ¶å°±æ˜¯é€šè¿‡ cookie æ¥å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯ä½¿ç”¨äº† cookie çš„åŠŸèƒ½ï¼Œå¹¶ä¸æ˜¯ä½¿ç”¨ cookieå®Œæˆä¼šè¯ä¿å­˜ã€‚ä¸ cookie åœ¨ä¿å­˜å®¢æˆ·ç«¯ä¿å­˜ä¼šè¯çš„æœºåˆ¶ç›¸åï¼Œsession é€šè¿‡ cookie çš„åŠŸèƒ½æŠŠä¼šè¯ä¿¡æ¯ä¿å­˜åˆ°äº†æœåŠ¡ç«¯ã€‚</p></blockquote><p><strong>sessionå’Œcookieæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><ol><li><p>cookie æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œå®ƒå¯ä»¥ç”¨äºç»´æŒå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ä¼šè¯</p></li><li><p>session æŒ‡çš„æ˜¯ç»´æŒå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¼šè¯çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå¯ä»¥é€šè¿‡ cookie å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ«çš„æ‰‹æ®µå®ç°ã€‚</p></li><li><p>å¦‚æœç”¨ cookie å®ç°ä¼šè¯ï¼Œé‚£ä¹ˆä¼šè¯ä¼šä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­</p></li><li><p>è€Œ session æœºåˆ¶æä¾›çš„ä¼šè¯æ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ã€‚</p></li></ol><p><strong>ä¸¾ä¸ªå°ä¾‹å­è¯´æ˜Cookieå’ŒSessionä¹‹é—´çš„åŒºåˆ«å’Œè”ç³»</strong></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">ğŸ¦¥ <br>å‡å¦‚ä¸€ä¸ªå’–å•¡åº—æœ‰å–äº”æ¯èµ ä¸€æ¯å’–å•¡çš„ä¼˜æƒ ï¼Œä½†æ˜¯ä¸€æ¬¡æ€§æ¶ˆè´¹<span class="hljs-number">5</span>æ¯å’–å•¡çš„å®¢äººå¾ˆå°‘ï¼Œè¿™æ—¶å°±éœ€è¦æŸç§æ–¹å¼æ¥è®°å½•æŸä½é¡¾å®¢çš„æ¶ˆè´¹æ•°é‡ã€‚æ— å¤–ä¹ä¸‹é¢çš„å‡ ç§æ–¹æ¡ˆï¼š<br><span class="hljs-number">1</span>ã€è¯¥åº—çš„åº—å‘˜å¾ˆå‰å®³ï¼Œèƒ½è®°ä½æ¯ä½é¡¾å®¢çš„æ¶ˆè´¹æ•°é‡ï¼Œåªè¦é¡¾å®¢ä¸€èµ°è¿›å’–å•¡åº—ï¼Œåº—å‘˜å°±çŸ¥é“è¯¥æ€ä¹ˆå¯¹å¾…äº†ã€‚è¿™ç§åšæ³•å°±æ˜¯åè®®æœ¬èº«æ”¯æŒçŠ¶æ€ã€‚ä½†æ˜¯<span class="hljs-keyword">http</span>åè®®æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ã€‚<br><span class="hljs-number">2</span>ã€å‘ç»™é¡¾å®¢ä¸€å¼ å¡ç‰‡ï¼Œä¸Šé¢è®°å½•ç€æ¶ˆè´¹çš„æ•°é‡ï¼Œä¸€èˆ¬è¿˜æœ‰ä¸ªæœ‰æ•ˆæœŸé™ã€‚æ¯æ¬¡æ¶ˆè´¹æ—¶ï¼Œå¦‚æœé¡¾å®¢å‡ºç¤ºè¿™å¼ å¡ç‰‡ï¼Œåˆ™æ­¤æ¬¡æ¶ˆè´¹å°±ä¼šä¸ä»¥å‰æˆ–ä»¥åçš„æ¶ˆè´¹ç›¸è”ç³»èµ·æ¥ã€‚è¿™ç§åšæ³•å°±æ˜¯åœ¨å®¢æˆ·ç«¯ä¿æŒçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯cookieï¼Œé¡¾å®¢å°±ç›¸å½“äºæµè§ˆå™¨ã€‚<br><span class="hljs-number">3</span>ã€å‘ç»™é¡¾å®¢ä¸€å¼ ä¼šå‘˜å¡ï¼Œé™¤äº†å¡å·ä¹‹å¤–ä»€ä¹ˆä¿¡æ¯ä¹Ÿä¸çºªå½•ï¼Œæ¯æ¬¡æ¶ˆè´¹æ—¶ï¼Œå¦‚æœé¡¾å®¢å‡ºç¤ºè¯¥å¡ç‰‡ï¼Œåˆ™åº—å‘˜åœ¨åº—é‡Œçš„è®°å½•æœ¬ä¸Šæ‰¾åˆ°è¿™ä¸ªå¡å·å¯¹åº”çš„è®°å½•æ·»åŠ ä¸€äº›æ¶ˆè´¹ä¿¡æ¯ã€‚è¿™ç§åšæ³•å°±æ˜¯åœ¨æœåŠ¡å™¨ç«¯ä¿æŒçŠ¶æ€ã€‚<br></code></pre></td></tr></table></figure><h2 id="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><p><a href="https://www.cnblogs.com/taostaryu/p/10547132.html">åŸæ–‡</a></p><blockquote><p>ä»£ç†å…¶å®å°±æ˜¯ä¸€ä¸ªä¸­ä»‹ï¼ŒAå’ŒBæœ¬æ¥å¯ä»¥ç›´è¿ï¼Œä¸­é—´æ’å…¥ä¸€ä¸ªCï¼ŒCå°±æ˜¯ä¸­ä»‹ã€‚<br>åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä»£ç†å¤šæ•°æ˜¯å¸®åŠ©å†…ç½‘clientè®¿é—®å¤–ç½‘serverç”¨çš„<br>åæ¥å‡ºç°äº†åå‘ä»£ç†ï¼Œâ€åå‘â€è¿™ä¸ªè¯åœ¨è¿™å„¿çš„æ„æ€å…¶å®æ˜¯æŒ‡æ–¹å‘ç›¸åï¼Œå³ä»£ç†å°†æ¥è‡ªå¤–ç½‘å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°å†…ç½‘æœåŠ¡å™¨ï¼Œä»å¤–åˆ°å†….</p></blockquote><h4 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h4><p>æ­£å‘ä»£ç†ç±»ä¼¼ä¸€ä¸ªè·³æ¿æœºï¼Œä»£ç†è®¿é—®å¤–éƒ¨èµ„æº .</p><p>æ¯”å¦‚æˆ‘ä»¬å›½å†…è®¿é—®è°·æ­Œï¼Œç›´æ¥è®¿é—®è®¿é—®ä¸åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œè¯·æ±‚å‘åˆ°ä»£ç†æœï¼Œä»£ç†æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®è°·æ­Œï¼Œè¿™æ ·ç”±ä»£ç†å»è°·æ­Œå–åˆ°è¿”å›æ•°æ®ï¼Œå†è¿”å›ç»™æˆ‘ä»¬ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è®¿é—®è°·æ­Œäº† .</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202306181011210.png" alt="image-20230618101113110"></p><p><strong>æ­£å‘ä»£ç†çš„ç”¨é€”ï¼š</strong></p><ol><li>è®¿é—®åŸæ¥æ— æ³•è®¿é—®çš„èµ„æºï¼Œå¦‚google</li><li>å¯ä»¥åšç¼“å­˜ï¼ŒåŠ é€Ÿè®¿é—®èµ„æº</li><li>å¯¹å®¢æˆ·ç«¯è®¿é—®æˆæƒï¼Œä¸Šç½‘è¿›è¡Œè®¤è¯</li><li>ä»£ç†å¯ä»¥è®°å½•ç”¨æˆ·è®¿é—®è®°å½•ï¼ˆä¸Šç½‘è¡Œä¸ºç®¡ç†ï¼‰ï¼Œå¯¹å¤–éšè—ç”¨æˆ·ä¿¡æ¯</li></ol><h4 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h4><p>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰å®é™…è¿è¡Œæ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªæœåŠ¡å™¨</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202306181011725.png" alt="image-20230618101124689"></p><p><strong>åå‘ä»£ç†çš„ä½œç”¨ï¼š</strong></p><ol><li>ä¿è¯å†…ç½‘çš„å®‰å…¨ï¼Œé˜»æ­¢webæ”»å‡»ï¼Œå¤§å‹ç½‘ç«™ï¼Œé€šå¸¸å°†åå‘ä»£ç†ä½œä¸ºå…¬ç½‘è®¿é—®åœ°å€ï¼ŒWebæœåŠ¡å™¨æ˜¯å†…ç½‘ . </li><li>è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨æ¥ä¼˜åŒ–ç½‘ç«™çš„è´Ÿè½½</li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong>æ­£å‘ä»£ç†å³æ˜¯å®¢æˆ·ç«¯ä»£ç†, ä»£ç†å®¢æˆ·ç«¯, æœåŠ¡ç«¯ä¸çŸ¥é“å®é™…å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯.</strong></p><p><strong>åå‘ä»£ç†å³æ˜¯æœåŠ¡ç«¯ä»£ç†, ä»£ç†æœåŠ¡ç«¯, å®¢æˆ·ç«¯ä¸çŸ¥é“å®é™…æä¾›æœåŠ¡çš„æœåŠ¡ç«¯</strong></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202306181014100.png" alt="image-20230618101447052"></p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202306181013811.png" alt="image-20230618101318766"></p><h2 id="javaé¡¹ç›®ä¸­targetæ–‡ä»¶æ˜¯ä»€ä¹ˆæ–‡ä»¶"><a href="#javaé¡¹ç›®ä¸­targetæ–‡ä»¶æ˜¯ä»€ä¹ˆæ–‡ä»¶" class="headerlink" title="javaé¡¹ç›®ä¸­targetæ–‡ä»¶æ˜¯ä»€ä¹ˆæ–‡ä»¶?"></a>javaé¡¹ç›®ä¸­targetæ–‡ä»¶æ˜¯ä»€ä¹ˆæ–‡ä»¶?</h2><p><code>target</code> æ–‡ä»¶å¤¹é€šå¸¸æ˜¯åœ¨æ„å»ºè¿‡ç¨‹ä¸­ç”±æ„å»ºå·¥å…·ç”Ÿæˆçš„é»˜è®¤è¾“å‡ºç›®å½•ï¼Œä¾‹å¦‚ Maven æˆ– Gradleã€‚åœ¨ Maven é¡¹ç›®ä¸­ï¼Œ<code>target</code> æ–‡ä»¶å¤¹ç”¨äºå­˜å‚¨ç¼–è¯‘åçš„ç±»æ–‡ä»¶ã€èµ„æºæ–‡ä»¶å’Œç”Ÿæˆçš„æ„å»ºäº§ç‰©ï¼ˆå¦‚ JAR æ–‡ä»¶ï¼‰ç­‰ã€‚</p><p>å½“ä½ æ‰§è¡Œ Maven çš„æ„å»ºå‘½ä»¤ï¼ˆå¦‚ <code>mvn package</code>ï¼‰æ—¶ï¼ŒMaven ä¼šå°†é¡¹ç›®çš„æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå¹¶å°†ç¼–è¯‘åçš„ç±»æ–‡ä»¶å’Œå…¶ä»–èµ„æºæ–‡ä»¶è¾“å‡ºåˆ° <code>target</code> æ–‡ä»¶å¤¹ä¸­ã€‚æ­¤å¤–ï¼Œæ„å»ºå·¥å…·è¿˜ä¼šåœ¨ <code>target</code> æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆå…¶ä»–ä¸æ„å»ºè¿‡ç¨‹ç›¸å…³çš„ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>target</code> æ–‡ä»¶å¤¹çš„å†…å®¹åº”è¯¥æ˜¯å¯ä»¥è¢«å¿½ç•¥çš„ï¼Œä¸åº”è¯¥è¢«ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰æ‰€è·Ÿè¸ªã€‚è¿™æ˜¯å› ä¸º <code>target</code> æ–‡ä»¶å¤¹çš„å†…å®¹å¯ä»¥é€šè¿‡é‡æ–°æ„å»ºé¡¹ç›®æ¥ç”Ÿæˆï¼Œè€Œä¸éœ€è¦å°†ç”Ÿæˆçš„æ–‡ä»¶åŒ…å«åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>target</code> æ–‡ä»¶å¤¹çš„åç§°å¯ä»¥åœ¨ Maven æˆ– Gradle çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè‡ªå®šä¹‰ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>target</code> æ˜¯é»˜è®¤çš„è¾“å‡ºç›®å½•åç§°ã€‚</p><h2 id="javaé¡¹ç›®ä¸­controlleræ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆ"><a href="#javaé¡¹ç›®ä¸­controlleræ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="javaé¡¹ç›®ä¸­controlleræ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?"></a>javaé¡¹ç›®ä¸­controlleræ–‡ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</h2><p>åœ¨Javaé¡¹ç›®ä¸­ï¼Œæ§åˆ¶å™¨ï¼ˆControllerï¼‰çš„ä½œç”¨æ˜¯å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚å®ƒå……å½“äº†åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œåè°ƒä¸åŒçš„ç»„ä»¶æ¥å®Œæˆç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚æ§åˆ¶å™¨ä¸»è¦è´Ÿè´£ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„å·¥ä½œï¼š</p><ol><li><p><strong>æ¥æ”¶è¯·æ±‚</strong>ï¼šæ§åˆ¶å™¨ç›‘å¬ç‰¹å®šçš„URLè·¯å¾„æˆ–è¯·æ±‚æ–¹æ³•ï¼Œå¹¶æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®ƒå……å½“äº†è¯·æ±‚çš„å…¥å£ï¼Œæ¥æ”¶å¹¶è§£æè¯·æ±‚å‚æ•°ã€è·¯å¾„ã€è¯·æ±‚ä½“ç­‰ä¿¡æ¯ã€‚</p></li><li><p><strong>å¤„ç†ä¸šåŠ¡é€»è¾‘</strong>ï¼šä¸€æ—¦æ¥æ”¶åˆ°è¯·æ±‚ï¼Œæ§åˆ¶å™¨ä¼šè°ƒç”¨ç›¸åº”çš„æœåŠ¡ï¼ˆServiceï¼‰æˆ–ä¸šåŠ¡é€»è¾‘ç»„ä»¶æ¥å¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚å®ƒå¯ä»¥ä»æ•°æ®åº“ã€å¤–éƒ¨æœåŠ¡æˆ–å…¶ä»–ç»„ä»¶ä¸­è·å–æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€è½¬æ¢æˆ–éªŒè¯ã€‚</p></li><li><p><strong>è°ƒç”¨æœåŠ¡å±‚</strong>ï¼šæ§åˆ¶å™¨é€šå¸¸ä¸æœåŠ¡å±‚ï¼ˆService Layerï¼‰è¿›è¡Œäº¤äº’ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥æˆ–æ‰‹åŠ¨åˆ›å»ºå®ä¾‹æ¥è°ƒç”¨æœåŠ¡å±‚æä¾›çš„æ–¹æ³•ã€‚æœåŠ¡å±‚è´Ÿè´£å°è£…ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†æ•°æ®æŒä¹…åŒ–ã€äº‹åŠ¡ç®¡ç†ã€ä¸šåŠ¡è§„åˆ™ç­‰æ“ä½œã€‚</p></li><li><p><strong>è¿”å›å“åº”</strong>ï¼šæ§åˆ¶å™¨æ ¹æ®è¯·æ±‚å¤„ç†çš„ç»“æœç”Ÿæˆç›¸åº”çš„å“åº”ï¼Œå¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å“åº”å¯ä»¥æ˜¯HTMLé¡µé¢ã€JSONæ•°æ®ã€æ–‡ä»¶ä¸‹è½½ç­‰å½¢å¼ã€‚æ§åˆ¶å™¨è´Ÿè´£å°†å“åº”æ•°æ®å°è£…æˆé€‚å½“çš„æ ¼å¼ï¼Œå¹¶è®¾ç½®å“åº”å¤´å’ŒçŠ¶æ€ç ã€‚</p></li><li><p><strong>è·¯ç”±å’ŒURLæ˜ å°„</strong>ï¼šæ§åˆ¶å™¨æ ¹æ®ä¸åŒçš„URLè·¯å¾„å’Œè¯·æ±‚æ–¹æ³•æ¥æ˜ å°„åˆ°ç›¸åº”çš„å¤„ç†æ–¹æ³•ã€‚å®ƒé€šè¿‡ä½¿ç”¨è·¯ç”±é…ç½®æˆ–æ³¨è§£æ¥å®šä¹‰URLä¸å¤„ç†æ–¹æ³•ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä»¥ä¾¿å°†è¯·æ±‚æ­£ç¡®åœ°åˆ†å‘åˆ°å¯¹åº”çš„å¤„ç†æ–¹æ³•ã€‚</p></li><li><p><strong>æ§åˆ¶æµç¨‹å’ŒéªŒè¯</strong>ï¼šæ§åˆ¶å™¨å¯ä»¥å¤„ç†ç”¨æˆ·è¾“å…¥çš„éªŒè¯å’Œæ•°æ®æ ¡éªŒï¼Œç¡®ä¿æ•°æ®çš„åˆæ³•æ€§å’Œå®Œæ•´æ€§ã€‚å®ƒè¿˜å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šè¯·æ±‚çš„æµç¨‹ï¼Œä¾‹å¦‚é‡å®šå‘ã€è½¬å‘æˆ–é”™è¯¯å¤„ç†ç­‰ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œæ§åˆ¶å™¨åœ¨Javaé¡¹ç›®ä¸­èµ·ç€è¿æ¥ç”¨æˆ·ç•Œé¢ã€ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æŒä¹…åŒ–å±‚çš„æ¡¥æ¢ä½œç”¨ã€‚å®ƒæ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ï¼Œåè°ƒå…¶ä»–ç»„ä»¶å®Œæˆç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå¹¶å°†å¤„ç†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ§åˆ¶å™¨çš„è®¾è®¡è‰¯å¥½ä¸å¦å¯¹äºé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œçµæ´»æ€§å…·æœ‰é‡è¦å½±å“ã€‚</p><h2 id="javaé¡¹ç›®é‡Œmapperçš„ä½œç”¨æ˜¯ä»€ä¹ˆ"><a href="#javaé¡¹ç›®é‡Œmapperçš„ä½œç”¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="javaé¡¹ç›®é‡Œmapperçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?"></a>javaé¡¹ç›®é‡Œmapperçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</h2><p>åœ¨Javaé¡¹ç›®ä¸­ï¼ŒMapperï¼ˆæˆ–ç§°ä¸ºæ•°æ®è®¿é—®å¯¹è±¡ï¼ŒDAOï¼‰çš„ä½œç”¨æ˜¯å°è£…å¯¹æ•°æ®åº“çš„è®¿é—®æ“ä½œã€‚å®ƒå……å½“äº†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„æ¡¥æ¢ï¼Œè´Ÿè´£æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢ã€æ›´æ–°ã€æ’å…¥å’Œåˆ é™¤ç­‰æ“ä½œã€‚Mapperçš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š</p><ol><li><p><strong>æ•°æ®åº“è®¿é—®</strong>ï¼šMapperè´Ÿè´£ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæ‰§è¡ŒSQLè¯­å¥æˆ–è°ƒç”¨æ•°æ®åº“çš„APIæ¥å®Œæˆæ•°æ®çš„è¯»å–ã€å†™å…¥å’Œä¿®æ”¹æ“ä½œã€‚å®ƒå°è£…äº†å¯¹æ•°æ®åº“çš„åº•å±‚è®¿é—®ç»†èŠ‚ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥ä»¥é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®åº“ï¼Œè€Œæ— éœ€ç›´æ¥ç¼–å†™åŸå§‹çš„SQLè¯­å¥ã€‚</p></li><li><p><strong>å¯¹è±¡å…³ç³»æ˜ å°„</strong>ï¼ˆORMï¼‰ï¼šMapperå°†æ•°æ®åº“ä¸­çš„è¡¨å’Œå®ä½“å¯¹è±¡è¿›è¡Œæ˜ å°„ï¼Œå®ç°äº†å¯¹è±¡ä¸å…³ç³»æ•°æ®åº“ä¹‹é—´çš„è½¬æ¢ã€‚å®ƒé€šè¿‡é…ç½®æˆ–æ³¨è§£å®šä¹‰å®ä½“ç±»å’Œæ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥ä»¥é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®ï¼Œè€Œä¸éœ€è¦å…³æ³¨æ•°æ®åº“çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p></li><li><p><strong>æ•°æ®åº“äº‹åŠ¡ç®¡ç†</strong>ï¼šMapperå¯ä»¥å¤„ç†æ•°æ®åº“äº‹åŠ¡ï¼Œç¡®ä¿ä¸€ç»„æ•°æ®åº“æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚å®ƒæä¾›äº†äº‹åŠ¡çš„å¼€å§‹ã€æäº¤å’Œå›æ»šç­‰æ“ä½œï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨ä¸€è‡´çš„çŠ¶æ€ä¸‹æ“ä½œæ•°æ®åº“ï¼Œä¿æŒæ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</p></li><li><p><strong>æŸ¥è¯¢ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜</strong>ï¼šMapperå¯ä»¥é€šè¿‡ç¼–å†™é«˜æ•ˆçš„SQLè¯­å¥æˆ–ä½¿ç”¨æ•°æ®åº“çš„ç‰¹å®šç‰¹æ€§æ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚å®ƒå¯ä»¥åˆ©ç”¨æ•°æ®åº“çš„ç´¢å¼•ã€ç¼“å­˜æœºåˆ¶ã€åˆ†é¡µæŸ¥è¯¢ç­‰åŠŸèƒ½æ¥æé«˜æ•°æ®è®¿é—®çš„æ•ˆç‡ï¼Œå‡å°‘æ•°æ®åº“çš„è´Ÿè½½å’Œå“åº”æ—¶é—´ã€‚</p></li><li><p><strong>æ•°æ®åº“è®¿é—®çš„æŠ½è±¡å±‚</strong>ï¼šMapperæä¾›äº†å¯¹æ•°æ®åº“è®¿é—®çš„é«˜å±‚æŠ½è±¡ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥é¢å‘å¯¹è±¡çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œè€Œä¸å¿…å…³æ³¨æ•°æ®åº“çš„ç»†èŠ‚ã€‚å®ƒæä¾›äº†ä¸€ç»„é€šç”¨çš„CRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ–¹æ³•ï¼Œç®€åŒ–äº†å¯¹æ•°æ®çš„æ“ä½œã€‚</p></li></ol><p>æ€»ä¹‹ï¼ŒMapperåœ¨Javaé¡¹ç›®ä¸­èµ·ç€ä¸æ•°æ®åº“äº¤äº’çš„è§’è‰²ï¼Œè´Ÿè´£æ‰§è¡Œæ•°æ®åº“æ“ä½œã€å®ç°å¯¹è±¡ä¸æ•°æ®åº“ä¹‹é—´çš„æ˜ å°„ä»¥åŠæä¾›äº‹åŠ¡ç®¡ç†ç­‰åŠŸèƒ½ã€‚å®ƒä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®åº“ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚é€šè¿‡ä½¿ç”¨Mapperï¼Œå¯ä»¥å°†æ•°æ®åº“æ“ä½œä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼Œæä¾›äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½¿å¾—æ•°æ®è®¿é—®æ›´åŠ æ–¹ä¾¿å’Œé«˜æ•ˆã€‚</p><h2 id="IServiceå’ŒBaseMapperå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#IServiceå’ŒBaseMapperå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="IServiceå’ŒBaseMapperå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>IService<T>å’ŒBaseMapper<T>å®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><p><code>IService&lt;T&gt;</code> å’Œ <code>BaseMapper&lt;T&gt;</code> æ˜¯ MyBatis-Plus æ¡†æ¶ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæ¥å£ï¼Œå®ƒä»¬åœ¨åŠŸèƒ½å’Œä½œç”¨ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚</p><p><code>IService&lt;T&gt;</code> æ¥å£æ˜¯ç”¨äºå®šä¹‰é€šç”¨çš„ä¸šåŠ¡æ“ä½œæ–¹æ³•çš„æ¥å£ï¼Œæä¾›äº†å¯¹æ•°æ®åº“è¡¨è¿›è¡Œå¸¸è§çš„å¢åˆ æ”¹æŸ¥æ“ä½œçš„æ–¹æ³•å®šä¹‰ã€‚å®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œå¦‚ä¿å­˜å®ä½“å¯¹è±¡ã€åˆ é™¤è®°å½•ã€æ›´æ–°è®°å½•ã€æŸ¥è¯¢è®°å½•ç­‰ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å®ç° <code>IService&lt;T&gt;</code> æ¥å£æˆ–ç»§æ‰¿è¯¥æ¥å£æ¥è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘æ“ä½œã€‚</p><p><code>BaseMapper&lt;T&gt;</code> æ¥å£æ˜¯ MyBatis-Plus æ¡†æ¶æä¾›çš„åŸºç¡€æ˜ å°„å™¨æ¥å£ï¼Œç”¨äºå®šä¹‰æ•°æ®åº“è¡¨çš„åŸºæœ¬æ“ä½œæ–¹æ³•ã€‚å®ƒç»§æ‰¿äº† MyBatis ä¸­çš„ <code>Mapper&lt;T&gt;</code> æ¥å£ï¼Œå¹¶é¢å¤–æ·»åŠ äº†ä¸€äº›å¸¸è§çš„æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œå¦‚æ’å…¥è®°å½•ã€åˆ é™¤è®°å½•ã€æ›´æ–°è®°å½•ã€æŸ¥è¯¢è®°å½•ç­‰ã€‚<code>BaseMapper&lt;T&gt;</code> æ¥å£æä¾›äº†å¯¹æ•°æ®åº“è¡¨è¿›è¡ŒåŸºæœ¬æ“ä½œçš„èƒ½åŠ›ã€‚</p><p>åŒºåˆ«æ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li><code>IService&lt;T&gt;</code> æ˜¯å®šä¹‰é€šç”¨ä¸šåŠ¡æ“ä½œæ–¹æ³•çš„æ¥å£ï¼Œç”¨äºå°è£…å’Œå®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œæä¾›äº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä½¿å¾—ä¸šåŠ¡é€»è¾‘æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚</li><li><code>BaseMapper&lt;T&gt;</code> æ˜¯åŸºç¡€æ˜ å°„å™¨æ¥å£ï¼Œç”¨äºå®šä¹‰æ•°æ®åº“è¡¨çš„åŸºæœ¬æ“ä½œæ–¹æ³•ï¼Œæä¾›äº†å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥èƒ½åŠ›ã€‚</li><li><code>IService&lt;T&gt;</code> å¯ä»¥è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼Œå¯¹æ•°æ®åº“æ“ä½œè¿›è¡Œå°è£…ï¼Œè€Œ <code>BaseMapper&lt;T&gt;</code> ä¸»è¦æä¾›äº†ä¸€äº›åŸºæœ¬çš„æ•°æ®åº“æ“ä½œæ–¹æ³•ã€‚</li><li><code>IService&lt;T&gt;</code> å¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ï¼Œè€Œ <code>BaseMapper&lt;T&gt;</code> ä¸»è¦ç”¨äºæ‰§è¡ŒåŸºæœ¬çš„æ•°æ®åº“æ“ä½œã€‚</li></ul><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¼šåŒæ—¶ä½¿ç”¨ <code>IService&lt;T&gt;</code> å’Œ <code>BaseMapper&lt;T&gt;</code> æ¥å£ã€‚<code>IService&lt;T&gt;</code> å¯ä»¥ä½œä¸ºä¸šåŠ¡å±‚çš„æ¥å£ï¼Œå®šä¹‰å…·ä½“ä¸šåŠ¡æ“ä½œæ–¹æ³•ï¼Œè€Œ <code>BaseMapper&lt;T&gt;</code> åˆ™ä½œä¸ºæ•°æ®è®¿é—®å±‚çš„æ¥å£ï¼Œæä¾›åŸºæœ¬çš„æ•°æ®åº“æ“ä½œæ–¹æ³•ã€‚è¿™æ ·å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®æ“ä½œè¿›è¡Œè§£è€¦ï¼Œå¹¶æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h2 id="Autowiredæ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆ"><a href="#Autowiredæ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆ" class="headerlink" title="@Autowiredæ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?"></a>@Autowiredæ³¨è§£çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</h2><p><code>@Autowired</code> æ³¨è§£æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¾èµ–æ³¨å…¥æ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨è£…é…å¯¹è±¡ã€‚</p><p>ä½œç”¨å¦‚ä¸‹ï¼š</p><ol><li>è‡ªåŠ¨è£…é…ä¾èµ–å¯¹è±¡ï¼š<code>@Autowired</code> æ³¨è§£å¯ä»¥è‡ªåŠ¨å°†æ ‡æ³¨çš„å±æ€§ã€æ„é€ å‡½æ•°æˆ–æ–¹æ³•å‚æ•°ä¸å®¹å™¨ä¸­åŒ¹é…çš„ bean è¿›è¡Œå…³è”ï¼Œå®Œæˆä¾èµ–å¯¹è±¡çš„æ³¨å…¥ã€‚</li><li>ç®€åŒ–é…ç½®ï¼šé€šè¿‡ <code>@Autowired</code> æ³¨è§£ï¼Œå¯ä»¥çœå»æ‰‹åŠ¨é…ç½®ä¾èµ–å¯¹è±¡çš„æ­¥éª¤ï¼Œç”± Spring å®¹å™¨è‡ªåŠ¨æŸ¥æ‰¾å¹¶æ³¨å…¥æ‰€éœ€çš„å¯¹è±¡ã€‚</li><li>è§£å†³å¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼šé€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ç”±å®¹å™¨ç®¡ç†ï¼Œå‡å°‘äº†å¯¹è±¡ä¹‹é—´çš„ç›´æ¥ä¾èµ–ï¼Œé™ä½äº†è€¦åˆæ€§ï¼Œæé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li>æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥å¯ä»¥æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¯ä»¥è½»æ¾æ›¿æ¢ä¾èµ–å¯¹è±¡æˆ–ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œæµ‹è¯•ã€‚</li></ol><p>è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ <code>@Autowired</code> æ³¨è§£è¿›è¡Œè‡ªåŠ¨è£…é…æ—¶ï¼Œéœ€è¦ä¿è¯å®¹å™¨ä¸­å­˜åœ¨åŒ¹é…çš„ bean å¯¹è±¡ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªåŒ¹é…çš„ bean å¯¹è±¡ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨ <code>@Qualifier</code> æ³¨è§£æˆ–é€šè¿‡æŒ‡å®š bean çš„åç§°è¿›è¡Œé™å®šï¼Œä»¥ç¡®å®šè¦æ³¨å…¥çš„å…·ä½“å¯¹è±¡ã€‚</p><p>å¦å¤–ï¼Œ<code>@Autowired</code> æ³¨è§£å¯ä»¥ç”¨äºå­—æ®µã€æ„é€ å‡½æ•°ã€Setter æ–¹æ³•ä»¥åŠä¸€äº›ç‰¹æ®Šçš„æ³¨å…¥åœºæ™¯ï¼Œä¾‹å¦‚ <code>@Autowired</code> ä¸ <code>@Qualifier</code> çš„ç»„åˆä½¿ç”¨ï¼Œä»¥åŠä¸ <code>@Value</code> æ³¨è§£ä¸€èµ·ä½¿ç”¨ç­‰ã€‚</p><p>å½“ç”¨æˆ·ä½¿ç”¨ç½‘ä¸Šé›¶é£Ÿå•†åŸçš„é›¶é£Ÿåˆ†ç±»æ¨¡å—æ—¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„æµç¨‹ç¤ºä¾‹ï¼š</p><ol><li>ç”¨æˆ·è¿›å…¥ç½‘ä¸Šé›¶é£Ÿå•†åŸçš„é›¶é£Ÿåˆ†ç±»é¡µé¢ã€‚</li><li>ç”¨æˆ·æä¾›åˆ†ç±»æ¡ä»¶ï¼Œä¾‹å¦‚é€‰æ‹©ç‰¹å®šçš„é£Ÿå“ç±»åˆ«ã€ä»·æ ¼èŒƒå›´æˆ–å“ç‰Œç­‰ã€‚</li><li>ç”¨æˆ·ç‚¹å‡»â€æœç´¢â€æˆ–ç±»ä¼¼çš„æŒ‰é’®ï¼Œå°†è¾“å…¥æ¡ä»¶ä¼ é€’ç»™é›¶é£Ÿåˆ†ç±»æ¨¡å—ã€‚</li><li>é›¶é£Ÿåˆ†ç±»æ¨¡å—æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„æ¡ä»¶ã€‚</li><li>æ¨¡å—å¼€å§‹å¤„ç†ç”¨æˆ·è¾“å…¥çš„æ¡ä»¶ï¼Œè¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š<ul><li>åˆ†æç”¨æˆ·é€‰æ‹©çš„é£Ÿå“ç±»åˆ«ã€ä»·æ ¼èŒƒå›´æˆ–å“ç‰Œç­‰æ¡ä»¶ã€‚</li><li>æŸ¥è¯¢æ•°æ®åº“æˆ–è°ƒç”¨ç›¸å…³æ¥å£ï¼Œè·å–ä¸ç”¨æˆ·æ¡ä»¶åŒ¹é…çš„é›¶é£Ÿåˆ—è¡¨ã€‚</li><li>å¯¹é›¶é£Ÿåˆ—è¡¨è¿›è¡Œç­›é€‰å’Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·çš„æ’åºè¦æ±‚æˆ–å…¶ä»–æ ‡å‡†è¿›è¡Œå¤„ç†ã€‚</li><li>ç”Ÿæˆç»è¿‡åˆ†ç±»å’Œæ’åºçš„é›¶é£Ÿåˆ—è¡¨ã€‚</li></ul></li><li>é›¶é£Ÿåˆ†ç±»æ¨¡å—å°†å¤„ç†ç»“æœè¿”å›ç»™ç”¨æˆ·ç•Œé¢ã€‚</li><li>ç”¨æˆ·ç•Œé¢å±•ç¤ºåˆ†ç±»ç»“æœï¼ŒåŒ…æ‹¬é›¶é£Ÿçš„åç§°ã€ä»·æ ¼ã€å›¾ç‰‡ç­‰ä¿¡æ¯ï¼ˆO1ï¼‰ã€‚</li><li>ç”¨æˆ·å¯ä»¥æµè§ˆæ‰€å±•ç¤ºçš„é›¶é£Ÿåˆ—è¡¨ï¼ŒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶é€‰æ‹©æ„Ÿå…´è¶£çš„é›¶é£Ÿè¿›è¡Œè´­ä¹°ã€‚</li><li>ç”¨æˆ·å¯ä»¥é€‰æ‹©ç‰¹å®šçš„åˆ†ç±»ç»“æœï¼Œä¾‹å¦‚ç‚¹å‡»ç‰¹å®šçš„åˆ†ç±»æ ‡ç­¾ã€‚</li><li>ç”¨æˆ·ç•Œé¢å°†ç”¨æˆ·é€‰æ‹©çš„åˆ†ç±»ç»“æœä¼ é€’ç»™é›¶é£Ÿåˆ†ç±»æ¨¡å—ã€‚</li><li>æ¨¡å—æ¥æ”¶ç”¨æˆ·é€‰æ‹©çš„åˆ†ç±»ç»“æœå¹¶è¿›è¡Œå¤„ç†ï¼Œå±•ç¤ºä¸é€‰æ‹©åˆ†ç±»åŒ¹é…çš„é›¶é£Ÿåˆ—è¡¨ï¼ˆO2ï¼‰ã€‚</li><li>ç”¨æˆ·ç•Œé¢å±•ç¤ºæ ¹æ®</li><li>ç”¨æˆ·é€‰æ‹©çš„åˆ†ç±»ç»“æœæ‰€ç­›é€‰å‡ºçš„é›¶é£Ÿåˆ—è¡¨ï¼Œä¾›ç”¨æˆ·æµè§ˆå’Œè´­ä¹°ã€‚</li><li>ç”¨æˆ·å¯ä»¥ç»§ç»­æµè§ˆå’Œè´­ä¹°æ„Ÿå…´è¶£çš„é›¶é£Ÿï¼Œæˆ–è€…è¿”å›é‡æ–°é€‰æ‹©åˆ†ç±»æ¡ä»¶ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è´¹æ›¼å­¦ä¹ æ³•</title>
    <link href="/2023/06/10/%E8%B4%B9%E6%9B%BC%E5%AD%A6%E4%B9%A0%E6%B3%95/"/>
    <url>/2023/06/10/%E8%B4%B9%E6%9B%BC%E5%AD%A6%E4%B9%A0%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="å…³äºè´¹æ›¼å­¦ä¹ æ³•"><a href="#å…³äºè´¹æ›¼å­¦ä¹ æ³•" class="headerlink" title="å…³äºè´¹æ›¼å­¦ä¹ æ³•"></a>å…³äºè´¹æ›¼å­¦ä¹ æ³•</h2><blockquote><p>å‰ä¸¤å¤©å¶ç„¶é—´äº†è§£åˆ°äº†è´¹æ›¼å­¦ä¹ æ³•, ç®—æ˜¯æ‹“å®½äº†æˆ‘å¯¹å­¦ä¹ æ–¹æ³•çš„è®¤çŸ¥. </p><p>å®ƒå¯ä»¥ç®€åŒ–ä¸ºå››ä¸ªå•è¯ </p></blockquote><p><code>Concept</code> (æ¦‚å¿µ) â€“ <code>Teach</code> (æ•™ç»™åˆ«äºº) â€“ <code>Review</code> (å›é¡¾) â€“ <code>Simplify</code> (ç®€åŒ–)</p><ol><li>ç¬¬ä¸€æ­¥ : å‡è£…æŠŠä¸€ä¸ªçŸ¥è¯†(æ¦‚å¿µ) æ•™ç»™ä¸€ä¸ªå°å­©å­ .</li></ol><p>å°½é‡ç”¨æœ€åŸºç¡€çš„è¯æ±‡, ä»¥ä½¿å¾—è¿™äº›å°å­©å­åˆšå¥½èƒ½ç†è§£è¿™äº›åŸºæœ¬çš„æ¦‚å¿µå’ŒçŸ¥è¯†, å½“ä½ å¡å£³äº†, ä¹Ÿå°±æ˜¯ä¸çŸ¥é“å¦‚ä½•è§£é‡ŠæŸä¸ªæ¦‚å¿µæˆ–ä¸å…¶å®ƒçŸ¥è¯†çš„è”ç³»çš„æ—¶å€™ â€“ é¢„ç¤ºç€å­¦ä¹ çš„æœºä¼šåˆ°æ¥äº†. </p><ol start="2"><li>ç¬¬äºŒæ­¥ : å›é¡¾</li></ol><p>ä½ å·²ç»å‘ç°äº†ä½ å¤§è„‘çŸ¥è¯†åº“çš„è¾¹ç¼˜, æ‡‚å¾—è‡ªå·±èƒ½åŠ›çš„ç•Œé™ä¹Ÿæ˜¯ä¸€ç§èƒ½åŠ›. ä½ éœ€è¦å›åˆ°è‡ªå·±çš„åŸå§‹ææ–™, é‡æ–°å­¦ä¹ , ç›´åˆ°ä½ å¯ä»¥ç”¨åŸºæœ¬çš„æœ¯è¯­è§£é‡Šè¿™ä¸€æ¦‚å¿µ. </p><ol start="3"><li>ç¬¬ä¸‰æ­¥: å°†è¯­è¨€æ¡ç†åŒ– , ç®€åŒ–</li></ol><p>è¦ä¿è¯ä½ çš„æ‰‹ä¸Šæœ‰ä¸€å¥—è‡ªå·±çš„æ‰‹å†™ç¬”è®° , æ£€æŸ¥ä¸€ä¸‹ç¡®ä¿è‡ªå·±æ²¡æœ‰ä»åŸææ–™ä¸­å€Ÿç”¨ä»»ä½•è¡Œè¯. è¯·é˜…è¯»ä¸€éè‡ªå·±çš„æ‰‹å†™ç¬”è®° , å¦‚æœå¬èµ·æ¥æ¯”è¾ƒæ··ä¹± , è¿™æ„å‘³ç€ä½ è¿˜éœ€è¦æ›´æ·±å…¥çš„ç†è§£è¯¥é¢†åŸŸ . è¿™æ—¶å€™ä½ éœ€è¦é‡æ–°å›åˆ°ç¬¬äºŒæ­¥ â€”â€” ä¸€ç›´é‡å¤ç›´åˆ°ä½ çš„æ‰‹å†™ç¬”è®°è§£é‡Šå¾—é€šä¿—æ˜“æ‡‚ä¸”æœ‰æ¡ç†æ€§ . </p><ol start="4"><li>ç¬¬å››æ­¥(å¯é€‰) : ä¼ æˆ</li></ol><p>å¦‚æœä½ çœŸçš„ç¡®ä¿ä½ çš„ç†è§£æ²¡ä»€ä¹ˆé—®é¢˜, æ£€æµ‹çŸ¥è¯†æœ€ç»ˆçš„é€”å¾„å°±æ˜¯ä½ èƒ½æœ‰èƒ½åŠ›æŠŠå®ƒä¼ æ’­ç»™å¦ä¸€ä¸ªäºº , å¦‚æœæ²¡æœ‰è¿™æ ·ä¸€ä¸ªå…·è±¡çš„äºº , é‚£ä½ å¯ä»¥å°†è‡ªå·±çš„ç¬”è®°åˆ†äº«å‡ºå» , é€šè¿‡å¤§å®¶çš„åé¦ˆä»¥ä½¿å¾—è‡ªå·±å¯¹çŸ¥è¯†çš„ç†è§£æ›´åŠ é€šé€. </p><blockquote><p>æ˜¨å¤©åŸºæœ¬ä¸Šä¸€æ•´å¤©æ—¶é—´éƒ½èŠ±åœ¨æ­å»ºåšå®¢ä¸Šäº†, è¿™ä¸ªå­¦ä¹ æ–¹æ³•ä¹Ÿæ²¡æœ‰å¾—åˆ°åº”ç”¨, ä»ä»Šå„¿å¼€å§‹, å°è¯•è¿™ç§å­¦ä¹ æ–¹æ³•~ğŸ†</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æ—¥å¸¸çç¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ æ–¹æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</title>
    <link href="/2023/06/09/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/"/>
    <url>/2023/06/09/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢"><a href="#æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢" class="headerlink" title="æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢"></a>æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</h1><blockquote><p>åˆ†äº«çç¢</p></blockquote><p>å¿™é‡Œå·é—², æˆ–è€…è¯´é—²æ¥æ— äº‹å§, å®é™…ä¸Š, æ—¶é—´å·²ç»æ¥åˆ°æœŸæœ«, å¯æ˜¯å‘¢, æˆ‘è¿˜æ˜¯ä¿ç•™ç€å¯¹æŠ€æœ¯çš„ç–¯ç‹‚çƒ­æƒ…, æ­å»ºè¿™ä¸ªåšå®¢æ˜¯å› ä¸ºå¶ç„¶é—´åœ¨æ˜Ÿçƒå†²æµªæ—¶, çœ‹è§ä¸€ä½å¤§ä½¬æ‰€å†™çš„hexoæ­å»ºåšå®¢ç³»åˆ—. æ­£æ˜¯è¿™ä¸€å¥‘æœºè®©æˆ‘èŠ±äº†å¤§åŠå¤©æ—¶é—´æäº†è¿™ä¸€ä¸ªåšå®¢.</p><p>å…¶å®ä¹‹å‰ä¹Ÿæœ‰èŠ±æ—¶é—´æ­è¿‡ä¸€ä¸ªåšå®¢, æ˜¯é€šè¿‡ <code>VuePress</code> æ­å»ºçš„ </p><p>(åˆšåˆšæäº†å¥½ä¹…çš„å›¾åºŠå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ, ä¸»è¦æ˜¯é€šè¿‡ é˜¿é‡Œäº‘ + Pikgo + Typora æ„å»ºçš„)<br><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202306092321545.png" alt="image-20230609232105109"></p><p>è¿™ç•Œé¢è¿˜æ˜¯ç•¥æ˜¾èŠ±å“¨ , ç›¸æ¯”å‘¢ä»¥ä¸‹ç•Œé¢å°±æ˜¾å¾—éå¸¸æ»´ç®€çº¦å¥½çœ‹</p><p><img src="https://weirdo-blog.oss-cn-chengdu.aliyuncs.com/blog/202306092322286.png" alt="image-20230609232220960"> </p><p>è¯ä¸å¤šè¯´, å‡†å¤‡ä¼˜åŒ–åšå®¢å’¯ â€”â€” hh</p>]]></content>
    
    
    <categories>
      
      <category>æ—¥å¸¸çç¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ„Ÿæƒ³</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
